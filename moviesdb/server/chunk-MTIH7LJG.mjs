import './polyfills.server.mjs';
import{a as _I,b as wI,c as jn,d as SI,e as bI,f as EI,i as CI,m as Lt,n as mr,p as Et,q as Ye,r as TI,s as xI}from"./chunk-R23CMXHA.mjs";import{A as Ie,B as Gn,C as nn,D as Hy,E as LI,F as zu,G as We,H as ri,I as Bf,J as Wy,K as xi,L as As,M as ta,N as Uf,O as FI,P as Yi,Q as dn,a as ie,b as wl,c as Mf,d as II,e as kI,f as un,g as Of,h as Uu,i as $y,j as AI,k as gr,l as jy,m as Nf,n as DI,o as PI,p as Lf,q as Yt,r as RI,s as MI,t as Ti,u as ks,v as Ff,w as qu,x as Gy,y as OI,z as NI}from"./chunk-Y3MPANLB.mjs";import{a as te,b as Hn,c as _t,d as En,e as qf,f as BI,g as zf,h as Ii,i as Vf,j as $f,k as jf,l as Gf,m as Hf,n as Wf,o as Kf,p as Wn,q as Sl}from"./chunk-JVVC2RWW.mjs";import{a as mI,b as $n,d as gI,e as yI,f as vI}from"./chunk-UG6BMPAH.mjs";import{$ as ln,$a as tI,$b as cI,Ab as wi,Bb as Si,Cb as ze,Da as bn,Db as oe,Ea as Zx,Eb as O,Ec as Is,F as Ef,Fb as ii,Fc as bt,Ga as eI,Gb as Af,Gc as De,H as zx,Hb as Df,Hc as vl,Ib as Pf,Ic as Nt,Jb as gl,Jc as pI,K as Cf,Kb as D,L as ea,Lb as J,M as Vx,Mb as ve,Mc as _l,N as qy,Nb as Bu,Nc as Rf,O as $x,Ob as aI,P as Tf,Pb as bi,Q as Xr,Qb as Ei,R as zy,Rb as Ci,T as Nu,Tb as he,U as jx,Ua as pe,Ub as Ki,V as Gx,Va as xf,Vb as Kt,W as Hx,Wb as qe,Xa as ml,Xb as lI,Y as at,Yb as me,Z as Ts,Za as v,Zb as ke,_a as Fu,_b as lt,ab as nI,ac as yl,ba as be,bb as iI,bc as uI,c as Es,ca as H,cc as dI,da as Wx,db as rI,eb as Vn,f as Fx,fb as sI,ga as de,gb as oI,h as fl,ha as xs,i as Bx,ia as Kx,ib as _i,ja as cn,k as Jo,ka as Yx,l as pl,la as Qx,m as Cs,n as yi,nc as Vy,ob as q,pa as Xx,pb as If,qa as Re,qb as kf,r as vt,ra as Me,sa as vi,sb as k,t as Ux,ta as Jr,ub as je,uc as hI,vb as vn,wb as _n,x as qx,xb as p,y as Ou,ya as Jx,yb as m,yc as fI,z as Zo,za as Lu,zb as L}from"./chunk-YRBXCRDU.mjs";import{a as ht,b as Sn,c as Ce,f as j,h as By,i as Uy,j as B}from"./chunk-H6KHSOBK.mjs";var vr=j((rv,lk)=>{"use strict";var Zf=Ce("buffer"),yr=Zf.Buffer;function ak(n,e){for(var t in n)e[t]=n[t]}yr.from&&yr.alloc&&yr.allocUnsafe&&yr.allocUnsafeSlow?lk.exports=Zf:(ak(Zf,rv),rv.Buffer=ra);function ra(n,e,t){return yr(n,e,t)}ra.prototype=Object.create(yr.prototype);ak(yr,ra);ra.from=function(n,e,t){if(typeof n=="number")throw new TypeError("Argument must not be a number");return yr(n,e,t)};ra.alloc=function(n,e,t){if(typeof n!="number")throw new TypeError("Argument must be a number");var i=yr(n);return e!==void 0?typeof t=="string"?i.fill(e,t):i.fill(e):i.fill(0),i};ra.allocUnsafe=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return yr(n)};ra.allocUnsafeSlow=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return Zf.SlowBuffer(n)}});var dk=j(sv=>{"use strict";var ck=Ce("stream").Stream,uk=Ce("util"),sa=function(n){this.readable=this.writable=!0,this._paused=!1,this._driver=n};uk.inherits(sa,ck);sa.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0};sa.prototype.resume=function(){this._paused=!1,this.emit("drain");var n=this._driver.messages;n._paused=!1,n.emit("drain")};sa.prototype.write=function(n){return this.writable?(this._driver.parse(n),!this._paused):!1};sa.prototype.end=function(n){if(this.writable){n!==void 0&&this.write(n),this.writable=!1;var e=this._driver.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))}};sa.prototype.destroy=function(){this.end()};var oa=function(n){this.readable=this.writable=!0,this._paused=!1,this._driver=n};uk.inherits(oa,ck);oa.prototype.pause=function(){this._driver.io._paused=!0};oa.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")};oa.prototype.write=function(n){return this.writable?(typeof n=="string"?this._driver.text(n):this._driver.binary(n),!this._paused):!1};oa.prototype.end=function(n){n!==void 0&&this.write(n)};oa.prototype.destroy=function(){};sv.IO=sa;sv.Messages=oa});var ep=j((Tue,hk)=>{"use strict";var Cl=function(){this.clear()};Cl.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"];Cl.prototype.clear=function(){this._sent={},this._lines=[]};Cl.prototype.set=function(n,e){if(e!==void 0){n=this._strip(n),e=this._strip(e);var t=n.toLowerCase();(!this._sent.hasOwnProperty(t)||this.ALLOWED_DUPLICATES.indexOf(t)>=0)&&(this._sent[t]=!0,this._lines.push(n+": "+e+`\r
`))}};Cl.prototype.toString=function(){return this._lines.join("")};Cl.prototype._strip=function(n){return n.toString().replace(/^ */,"").replace(/ *$/,"")};hk.exports=Cl});var pk=j((xue,fk)=>{"use strict";var tp=vr().Buffer,np=function(){this._queue=[],this._queueSize=0,this._offset=0};np.prototype.put=function(n){!n||n.length===0||(tp.isBuffer(n)||(n=tp.from(n)),this._queue.push(n),this._queueSize+=n.length)};np.prototype.read=function(n){if(n>this._queueSize)return null;if(n===0)return tp.alloc(0);this._queueSize-=n;var e=this._queue,t=n,i=e[0],r,s;if(i.length>=n)return i.length===n?e.shift():(s=i.slice(0,n),e[0]=i.slice(n),s);for(var o=0,a=e.length;o<a&&!(t<e[o].length);o++)t-=e[o].length;return r=e.splice(0,o),t>0&&e.length>0&&(r.push(e[0].slice(0,t)),e[0]=e[0].slice(t)),tp.concat(r,n)};np.prototype.eachByte=function(n,e){for(var t,i,r;this._queue.length>0;){for(t=this._queue[0],i=t.length;this._offset<i;)r=this._offset,this._offset+=1,n.call(e,t[r]);this._offset=0,this._queue.shift()}};fk.exports=np});var Os=j((Iue,wk)=>{"use strict";var mk=vr().Buffer,vk=Ce("events").EventEmitter,H5=Ce("util"),gk=dk(),_k=ep(),W5=pk(),Dn=function(n,e,t){vk.call(this),Dn.validateOptions(t||{},["maxLength","masking","requireMasking","protocols"]),this._request=n,this._reader=new W5,this._options=t||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new _k,this.__queue=[],this.readyState=0,this.url=e,this.io=new gk.IO(this),this.messages=new gk.Messages(this),this._bindEventListeners()};H5.inherits(Dn,vk);Dn.isWebSocket=function(n){var e=n.headers.connection||"",t=n.headers.upgrade||"";return n.method==="GET"&&e.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&t.toLowerCase()==="websocket"};Dn.validateOptions=function(n,e){for(var t in n)if(e.indexOf(t)<0)throw new Error("Unrecognized option: "+t)};var yk={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var n=this;this.messages.on("error",function(){}),this.on("message",function(e){var t=n.messages;t.readable&&t.emit("data",e.data)}),this.on("error",function(e){var t=n.messages;t.readable&&t.emit("error",e)}),this.on("close",function(){var e=n.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(n){return!1},setHeader:function(n,e){return this.readyState>0?!1:(this._headers.set(n,e),!0)},start:function(){if(this.readyState!==0)return!1;if(!Dn.isWebSocket(this._request))return this._failHandshake(new Error("Not a WebSocket request"));var n;try{n=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(n),this._stage!==-1&&this._open(),!0},_failHandshake:function(n){var e=new _k;return e.set("Content-Type","text/plain"),e.set("Content-Length",mk.byteLength(n.message,"utf8")),e=["HTTP/1.1 400 Bad Request",e.toString(),n.message],this._write(mk.from(e.join(`\r
`),"utf8")),this._fail("protocol_error",n.message),!1},text:function(n){return this.frame(n)},binary:function(n){return!1},ping:function(){return!1},pong:function(){return!1},close:function(n,e){return this.readyState!==1?!1:(this.readyState=3,this.emit("close",new Dn.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(n){this.frame.apply(this,n)},this),this.__queue=[],this.emit("open",new Dn.OpenEvent)},_queue:function(n){return this.__queue.push(n),!0},_write:function(n){var e=this.io;e.readable&&e.emit("data",n)},_fail:function(n,e){this.readyState=2,this.emit("error",new Error(e)),this.close()}};for(ov in yk)Dn.prototype[ov]=yk[ov];var ov;Dn.ConnectEvent=function(){};Dn.OpenEvent=function(){};Dn.CloseEvent=function(n,e){this.code=n,this.reason=e};Dn.MessageEvent=function(n){this.data=n};Dn.PingEvent=function(n){this.data=n};Dn.PongEvent=function(n){this.data=n};wk.exports=Dn});var Tk=j(uv=>{"use strict";var lv=Ce("assert");uv.HTTPParser=xe;function xe(n){lv.ok(n===xe.REQUEST||n===xe.RESPONSE||n===void 0),n===void 0||this.initialize(n),this.maxHeaderSize=xe.maxHeaderSize}xe.prototype.initialize=function(n,e){lv.ok(n===xe.REQUEST||n===xe.RESPONSE),this.type=n,this.state=n+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1};xe.encoding="ascii";xe.maxHeaderSize=80*1024;xe.REQUEST="REQUEST";xe.RESPONSE="RESPONSE";var Sk=xe.kOnHeaders=1,av=xe.kOnHeadersComplete=2,ip=xe.kOnBody=3,cv=xe.kOnMessageComplete=4;xe.prototype[Sk]=xe.prototype[av]=xe.prototype[ip]=xe.prototype[cv]=function(){};var bk=!0;Object.defineProperty(xe,"kOnExecute",{get:function(){return bk=!1,99}});var Ek=uv.methods=xe.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],Ck=Ek.indexOf("CONNECT");xe.prototype.reinitialize=xe;xe.prototype.close=xe.prototype.pause=xe.prototype.resume=xe.prototype.free=function(){};xe.prototype._compatMode0_11=!1;xe.prototype.getAsyncId=function(){return 0};var K5={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};xe.prototype.execute=function(n,e,t){if(!(this instanceof xe))throw new TypeError("not a HTTPParser");e=e||0,t=typeof t=="number"?t:n.length,this.chunk=n,this.offset=e;var i=this.end=e+t;try{for(;this.offset<i&&!this[this.state](););}catch(r){if(this.isUserCall)throw r;return this.hadError=!0,r}return this.chunk=null,t=this.offset-e,K5[this.state]&&(this.headerSize+=t,this.headerSize>(this.maxHeaderSize||xe.maxHeaderSize))?new Error("max header size exceeded"):t};var Y5={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};xe.prototype.finish=function(){if(!this.hadError){if(!Y5[this.state])return new Error("invalid state for EOF");this.state==="BODY_RAW"&&this.userCall()(this[cv]())}};xe.prototype.consume=xe.prototype.unconsume=xe.prototype.getCurrentBuffer=function(){};xe.prototype.userCall=function(){this.isUserCall=!0;var n=this;return function(e){return n.isUserCall=!1,e}};xe.prototype.nextRequest=function(){this.userCall()(this[cv]()),this.reinitialize(this.type)};xe.prototype.consumeLine=function(){for(var n=this.end,e=this.chunk,t=this.offset;t<n;t++)if(e[t]===10){var i=this.line+e.toString(xe.encoding,this.offset,t);return i.charAt(i.length-1)==="\r"&&(i=i.substr(0,i.length-1)),this.line="",this.offset=t+1,i}this.line+=e.toString(xe.encoding,this.offset,this.end),this.offset=this.end};var Q5=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,X5=/^[ \t]+(.*[^ \t])/;xe.prototype.parseHeader=function(n,e){if(n.indexOf("\r")!==-1)throw rp("HPE_LF_EXPECTED");var t=Q5.exec(n),i=t&&t[1];if(i)e.push(i),e.push(t[2]);else{var r=X5.exec(n);r&&e.length&&(e[e.length-1]&&(e[e.length-1]+=" "),e[e.length-1]+=r[1])}};var J5=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;xe.prototype.REQUEST_LINE=function(){var n=this.consumeLine();if(n){var e=J5.exec(n);if(e===null)throw rp("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?e[1]:Ek.indexOf(e[1]),this.info.method===-1)throw new Error("invalid request method");this.info.url=e[2],this.info.versionMajor=+e[3],this.info.versionMinor=+e[4],this.body_bytes=0,this.state="HEADER"}};var Z5=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;xe.prototype.RESPONSE_LINE=function(){var n=this.consumeLine();if(n){var e=Z5.exec(n);if(e===null)throw rp("HPE_INVALID_CONSTANT");this.info.versionMajor=+e[1],this.info.versionMinor=+e[2];var t=this.info.statusCode=+e[3];this.info.statusMessage=e[4],((t/100|0)===1||t===204||t===304)&&(this.body_bytes=0),this.state="HEADER"}};xe.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!!(this.body_bytes!==null||this.isChunked)};xe.prototype.HEADER=function(){var n=this.consumeLine();if(n!==void 0){var e=this.info;if(n)this.parseHeader(n,e.headers);else{for(var t=e.headers,i=!1,r,s=!1,o=0;o<t.length;o+=2)switch(t[o].toLowerCase()){case"transfer-encoding":this.isChunked=t[o+1].toLowerCase()==="chunked";break;case"content-length":if(r=+t[o+1],i){if(r!==this.body_bytes)throw rp("HPE_UNEXPECTED_CONTENT_LENGTH")}else i=!0,this.body_bytes=r;break;case"connection":this.connection+=t[o+1].toLowerCase();break;case"upgrade":s=!0;break}this.isChunked&&i&&(i=!1,this.body_bytes=null),s&&this.connection.indexOf("upgrade")!=-1?e.upgrade=this.type===xe.REQUEST||e.statusCode===101:e.upgrade=e.method===Ck,this.isChunked&&e.upgrade&&(this.isChunked=!1),e.shouldKeepAlive=this.shouldKeepAlive();var a;if(bk?a=this.userCall()(this[av](e)):a=this.userCall()(this[av](e.versionMajor,e.versionMinor,e.headers,e.method,e.url,e.statusCode,e.statusMessage,e.upgrade,e.shouldKeepAlive)),a===2)return this.nextRequest(),!0;if(this.isChunked&&!a)this.state="BODY_CHUNKHEAD";else{if(a||this.body_bytes===0)return this.nextRequest(),e.upgrade;this.body_bytes===null?this.state="BODY_RAW":this.state="BODY_SIZED"}}}};xe.prototype.BODY_CHUNKHEAD=function(){var n=this.consumeLine();n!==void 0&&(this.body_bytes=parseInt(n,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")};xe.prototype.BODY_CHUNK=function(){var n=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[ip](this.chunk,this.offset,n)),this.offset+=n,this.body_bytes-=n,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")};xe.prototype.BODY_CHUNKEMPTYLINE=function(){var n=this.consumeLine();n!==void 0&&(lv.equal(n,""),this.state="BODY_CHUNKHEAD")};xe.prototype.BODY_CHUNKTRAILERS=function(){var n=this.consumeLine();n!==void 0&&(n?this.parseHeader(n,this.trailers):(this.trailers.length&&this.userCall()(this[Sk](this.trailers,"")),this.nextRequest()))};xe.prototype.BODY_RAW=function(){var n=this.end-this.offset;this.userCall()(this[ip](this.chunk,this.offset,n)),this.offset=this.end};xe.prototype.BODY_SIZED=function(){var n=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[ip](this.chunk,this.offset,n)),this.offset+=n,this.body_bytes-=n,this.body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(n){var e=xe["kOn"+n];Object.defineProperty(xe.prototype,"on"+n,{get:function(){return this[e]},set:function(t){return this._compatMode0_11=!0,Ck="CONNECT",this[e]=t}})});function rp(n){var e=new Error("Parse Error");return e.code=n,e}});var op=j((Aue,Ik)=>{"use strict";var sp=Tk().HTTPParser,eq=vr().Buffer,tq={request:sp.REQUEST||"request",response:sp.RESPONSE||"response"},Pn=function(n){this._type=n,this._parser=new sp(tq[n]),this._complete=!1,this.headers={};var e=null,t=this;this._parser.onHeaderField=function(i,r,s){e=i.toString("utf8",r,r+s).toLowerCase()},this._parser.onHeaderValue=function(i,r,s){var o=i.toString("utf8",r,r+s);t.headers.hasOwnProperty(e)?t.headers[e]+=", "+o:t.headers[e]=o},this._parser.onHeadersComplete=this._parser[sp.kOnHeadersComplete]=function(i,r,s,o,a,l){var c=arguments[0];if(typeof c=="object"&&(o=c.method,a=c.url,l=c.statusCode,s=c.headers),t.method=typeof o=="number"?Pn.METHODS[o]:o,t.statusCode=l,t.url=a,!!s){for(var u=0,d=s.length,h,f;u<d;u+=2)h=s[u].toLowerCase(),f=s[u+1],t.headers.hasOwnProperty(h)?t.headers[h]+=", "+f:t.headers[h]=f;t._complete=!0}}};Pn.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var xk=process.version?process.version.match(/[0-9]+/g).map(function(n){return parseInt(n,10)}):[];xk[0]===0&&xk[1]===12&&(Pn.METHODS[16]="REPORT",Pn.METHODS[17]="MKACTIVITY",Pn.METHODS[18]="CHECKOUT",Pn.METHODS[19]="MERGE",Pn.METHODS[20]="M-SEARCH",Pn.METHODS[21]="NOTIFY",Pn.METHODS[22]="SUBSCRIBE",Pn.METHODS[23]="UNSUBSCRIBE",Pn.METHODS[24]="PATCH",Pn.METHODS[25]="PURGE");Pn.prototype.isComplete=function(){return this._complete};Pn.prototype.parse=function(n){var e=this._parser.execute(n,0,n.length);if(typeof e!="number"){this.error=e,this._complete=!0;return}this._complete&&(this.body=e<n.length?n.slice(e):eq.alloc(0))};Ik.exports=Pn});var Dk=j((Due,Ak)=>{"use strict";var dv=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,nq=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,iq=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/,hv=new RegExp(dv.source+"(?:=(?:"+dv.source+"|"+iq.source+"))?"),fv=new RegExp(dv.source+"(?: *; *"+hv.source+")*","g"),rq=new RegExp("^"+fv.source+"(?: *, *"+fv.source+")*$"),sq=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,kk=Object.prototype.hasOwnProperty,oq={parseHeader:function(n){var e=new Qu;if(n===""||n===void 0)return e;if(!rq.test(n))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+n);var t=n.match(fv);return t.forEach(function(i){var r=i.match(new RegExp(hv.source,"g")),s=r.shift(),o={};r.forEach(function(a){var l=a.match(hv),c=l[1],u;l[2]!==void 0?u=l[2]:l[3]!==void 0?u=l[3].replace(/\\/g,""):u=!0,sq.test(u)&&(u=parseFloat(u)),kk.call(o,c)?(o[c]=[].concat(o[c]),o[c].push(u)):o[c]=u},this),e.push(s,o)},this),e},serializeParams:function(n,e){var t=[],i=function(s,o){o instanceof Array?o.forEach(function(a){i(s,a)}):o===!0?t.push(s):typeof o=="number"?t.push(s+"="+o):nq.test(o)?t.push(s+'="'+o.replace(/"/g,'\\"')+'"'):t.push(s+"="+o)};for(var r in e)i(r,e[r]);return[n].concat(t).join("; ")}},Qu=function(){this._byName={},this._inOrder=[]};Qu.prototype.push=function(n,e){kk.call(this._byName,n)||(this._byName[n]=[]),this._byName[n].push(e),this._inOrder.push({name:n,params:e})};Qu.prototype.eachOffer=function(n,e){for(var t=this._inOrder,i=0,r=t.length;i<r;i++)n.call(e,t[i].name,t[i].params)};Qu.prototype.byName=function(n){return this._byName[n]||[]};Qu.prototype.toArray=function(){return this._inOrder.slice()};Ak.exports=oq});var pv=j((Pue,Pk)=>{"use strict";var Xu=function(n){this._bufferSize=n,this.clear()};Xu.prototype.clear=function(){this._buffer=new Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0};Xu.prototype.push=function(n){var e=!1,t=!1;this._ringSize<this._bufferSize?e=this._tail===0:this._ringOffset===this._ringSize&&(e=!0,t=this._tail===0),e&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(new Array(this._bufferSize)),this._bufferSize=this._buffer.length,t&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=n,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize};Xu.prototype.peek=function(){if(this.length!==0)return this._buffer[this._head]};Xu.prototype.shift=function(){if(this.length!==0){var n=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,this._ringOffset===0&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,n}};Pk.exports=Xu});var Mk=j((Rue,Rk)=>{"use strict";var aq=pv(),Tl=function(n,e){this._session=n,this._method=e,this._queue=new aq(Tl.QUEUE_SIZE),this._stopped=!1,this.pending=0};Tl.QUEUE_SIZE=8;Tl.prototype.call=function(n,e,t,i){if(!this._stopped){var r={error:n,message:e,callback:t,context:i,done:!1},s=!1,o=this;if(this._queue.push(r),r.error)return r.done=!0,this._stop(),this._flushQueue();var a=function(l,c){s^(s=!0)&&(l?(o._stop(),r.error=l,r.message=null):r.message=c,r.done=!0,o._flushQueue())};try{this._session[this._method](e,a)}catch(l){a(l)}}};Tl.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0};Tl.prototype._flushQueue=function(){for(var n=this._queue,e;n.length>0&&n.peek().done;)e=n.shift(),e.error?(this.pending=0,n.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)};Rk.exports=Tl});var mv=j((Mue,Ok)=>{"use strict";var lq=pv(),aa=function(){this._complete=!1,this._callbacks=new lq(aa.QUEUE_SIZE)};aa.QUEUE_SIZE=4;aa.all=function(n){var e=new aa,t=n.length,i=t;for(t===0&&e.done();i--;)n[i].then(function(){t-=1,t===0&&e.done()});return e};aa.prototype.then=function(n){this._complete?n():this._callbacks.push(n)};aa.prototype.done=function(){this._complete=!0;for(var n=this._callbacks,e;e=n.shift();)e()};Ok.exports=aa});var Fk=j((Oue,Lk)=>{"use strict";var Nk=Mk(),cq=mv(),la=function(n){this._ext=n[0],this._session=n[1],this._functors={incoming:new Nk(this._session,"processIncomingMessage"),outgoing:new Nk(this._session,"processOutgoingMessage")}};la.prototype.pending=function(n){var e=this._functors[n];e._stopped||(e.pending+=1)};la.prototype.incoming=function(n,e,t,i){this._exec("incoming",n,e,t,i)};la.prototype.outgoing=function(n,e,t,i){this._exec("outgoing",n,e,t,i)};la.prototype.close=function(){return this._closed=this._closed||new cq,this._doClose(),this._closed};la.prototype._exec=function(n,e,t,i,r){this._functors[n].call(e,t,function(s,o){s&&(s.message=this._ext.name+": "+s.message),i.call(r,s,o),this._doClose()},this)};la.prototype._doClose=function(){var n=this._functors.incoming,e=this._functors.outgoing;!this._closed||n.pending+e.pending!==0||(this._session&&this._session.close(),this._session=null,this._closed.done())};Lk.exports=la});var Uk=j((Nue,Bk)=>{"use strict";var uq=Fk(),dq=mv(),Ju=function(n){this._cells=n.map(function(e){return new uq(e)}),this._stopped={incoming:!1,outgoing:!1}};Ju.prototype.processIncomingMessage=function(n,e,t){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,n,e,t)};Ju.prototype.processOutgoingMessage=function(n,e,t){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,n,e,t)};Ju.prototype.close=function(n,e){this._stopped={incoming:!0,outgoing:!0};var t=this._cells.map(function(i){return i.close()});n&&dq.all(t).then(function(){n.call(e)})};Ju.prototype._loop=function(n,e,t,i,r,s,o){for(var a=this._cells,l=a.length,c=this;l--;)a[l].pending(n);var u=function(d,h,f){if(d===t)return s.call(o,h,f);a[d][n](h,f,function(g,_){g&&(c._stopped[n]=!0),u(d+i,g,_)})};u(e,null,r)};Bk.exports=Ju});var $k=j((Lue,Vk)=>{"use strict";var Zu=Dk(),qk=Uk(),ap=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};ap.MESSAGE_OPCODES=[1,2];var zk={add:function(n){if(typeof n.name!="string")throw new TypeError("extension.name must be a string");if(n.type!=="permessage")throw new TypeError('extension.type must be "permessage"');if(typeof n.rsv1!="boolean")throw new TypeError("extension.rsv1 must be true or false");if(typeof n.rsv2!="boolean")throw new TypeError("extension.rsv2 must be true or false");if(typeof n.rsv3!="boolean")throw new TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(n.name))throw new TypeError('An extension with name "'+n.name+'" is already registered');this._byName[n.name]=n,this._inOrder.push(n)},generateOffer:function(){var n=[],e=[],t={};return this._inOrder.forEach(function(i){var r=i.createClientSession();if(r){var s=[i,r];n.push(s),t[i.name]=s;var o=r.generateOffer();o=o?[].concat(o):[],o.forEach(function(a){e.push(Zu.serializeParams(i.name,a))},this)}},this),this._sessions=n,this._index=t,e.length>0?e.join(", "):null},activate:function(n){var e=Zu.parseHeader(n),t=[];e.eachOffer(function(i,r){var s=this._index[i];if(!s)throw new Error('Server sent an extension response for unknown extension "'+i+'"');var o=s[0],a=s[1],l=this._reserved(o);if(l)throw new Error("Server sent two extension responses that use the RSV"+l[0]+' bit: "'+l[1]+'" and "'+o.name+'"');if(a.activate(r)!==!0)throw new Error("Server sent unacceptable extension parameters: "+Zu.serializeParams(i,r));this._reserve(o),t.push(s)},this),this._sessions=t,this._pipeline=new qk(t)},generateResponse:function(n){var e=[],t=[],i=Zu.parseHeader(n);return this._inOrder.forEach(function(r){var s=i.byName(r.name);if(!(s.length===0||this._reserved(r))){var o=r.createServerSession(s);o&&(this._reserve(r),e.push([r,o]),t.push(Zu.serializeParams(r.name,o.generateResponse())))}},this),this._sessions=e,this._pipeline=new qk(e),t.length>0?t.join(", "):null},validFrameRsv:function(n){var e={rsv1:!1,rsv2:!1,rsv3:!1},t;if(ap.MESSAGE_OPCODES.indexOf(n.opcode)>=0)for(var i=0,r=this._sessions.length;i<r;i++)t=this._sessions[i][0],e.rsv1=e.rsv1||t.rsv1,e.rsv2=e.rsv2||t.rsv2,e.rsv3=e.rsv3||t.rsv3;return(e.rsv1||!n.rsv1)&&(e.rsv2||!n.rsv2)&&(e.rsv3||!n.rsv3)},processIncomingMessage:function(n,e,t){this._pipeline.processIncomingMessage(n,e,t)},processOutgoingMessage:function(n,e,t){this._pipeline.processOutgoingMessage(n,e,t)},close:function(n,e){if(!this._pipeline)return n.call(e);this._pipeline.close(n,e)},_reserve:function(n){this._rsv1=this._rsv1||n.rsv1&&n.name,this._rsv2=this._rsv2||n.rsv2&&n.name,this._rsv3=this._rsv3||n.rsv3&&n.name},_reserved:function(n){return this._rsv1&&n.rsv1?[1,this._rsv1]:this._rsv2&&n.rsv2?[2,this._rsv2]:this._rsv3&&n.rsv3?[3,this._rsv3]:!1}};for(gv in zk)ap.prototype[gv]=zk[gv];var gv;Vk.exports=ap});var Wk=j((Fue,Hk)=>{"use strict";var Gk=function(){},jk={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(yv in jk)Gk.prototype[yv]=jk[yv];var yv;Hk.exports=Gk});var Xk=j((Bue,Qk)=>{"use strict";var hq=vr().Buffer,Yk=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},Kk={read:function(){return this.data=this.data||hq.concat(this._chunks,this.length)},pushFrame:function(n){this.rsv1=this.rsv1||n.rsv1,this.rsv2=this.rsv2||n.rsv2,this.rsv3=this.rsv3||n.rsv3,this.opcode===null&&(this.opcode=n.opcode),this._chunks.push(n.payload),this.length+=n.length}};for(vv in Kk)Yk.prototype[vv]=Kk[vv];var vv;Qk.exports=Yk});var wv=j((Uue,nA)=>{"use strict";var ed=vr().Buffer,tA=Ce("crypto"),fq=Ce("util"),pq=$k(),ca=Os(),Jk=Wk(),Zk=Xk(),oi=function(n,e,t){if(ca.apply(this,arguments),this._extensions=new pq,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},typeof this._protocols=="string"&&(this._protocols=this._protocols.split(/ *, */)),!!this._request){var i=this._request.headers["sec-websocket-protocol"],r=this._protocols;i!==void 0&&(typeof i=="string"&&(i=i.split(/ *, */)),this.protocol=i.filter(function(s){return r.indexOf(s)>=0})[0]),this.version="hybi-"+oi.VERSION}};fq.inherits(oi,ca);oi.VERSION="13";oi.mask=function(n,e,t){if(!e||e.length===0)return n;t=t||0;for(var i=0,r=n.length-t;i<r;i++)n[t+i]=n[t+i]^e[i%4];return n};oi.generateAccept=function(n){var e=tA.createHash("sha1");return e.update(n+oi.GUID),e.digest("base64")};oi.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var eA={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(n){return this._extensions.add(n),!0},parse:function(n){this._reader.put(n);for(var e=!0;e;)switch(this._stage){case 0:e=this._reader.read(1),e&&this._parseOpcode(e[0]);break;case 1:e=this._reader.read(1),e&&this._parseLength(e[0]);break;case 2:e=this._reader.read(this._frame.lengthBytes),e&&this._parseExtendedLength(e);break;case 3:e=this._reader.read(4),e&&(this._stage=4,this._frame.maskingKey=e);break;case 4:e=this._reader.read(this._frame.length),e&&(this._stage=0,this._emitFrame(e));break;default:e=null}},text:function(n){return this.readyState>1?!1:this.frame(n,"text")},binary:function(n){return this.readyState>1?!1:this.frame(n,"binary")},ping:function(n,e){return this.readyState>1?!1:(n=n||"",e&&(this._pingCallbacks[n]=e),this.frame(n,"ping"))},pong:function(n){return this.readyState>1?!1:(n=n||"",this.frame(n,"pong"))},close:function(n,e){return n=n||"",e=e||this.ERRORS.normal_closure,this.readyState<=0?(this.readyState=3,this.emit("close",new ca.CloseEvent(e,n)),!0):this.readyState===1?(this.readyState=2,this._extensions.close(function(){this.frame(n,"close",e)},this),!0):!1},frame:function(n,e,t){if(this.readyState<=0)return this._queue([n,e,t]);if(this.readyState>2)return!1;n instanceof Array&&(n=ed.from(n)),typeof n=="number"&&(n=n.toString());var i=new Zk,r=typeof n=="string",s,o;i.rsv1=i.rsv2=i.rsv3=!1,i.opcode=this.OPCODES[e||(r?"text":"binary")],s=r?ed.from(n,"utf8"):n,t&&(o=s,s=ed.allocUnsafe(2+o.length),s.writeUInt16BE(t,0),o.copy(s,2)),i.data=s;var a=function(l){var c=new Jk;c.final=!0,c.rsv1=l.rsv1,c.rsv2=l.rsv2,c.rsv3=l.rsv3,c.opcode=l.opcode,c.masked=!!this._masking,c.length=l.data.length,c.payload=l.data,c.masked&&(c.maskingKey=tA.randomBytes(4)),this._sendFrame(c)};return this.MESSAGE_OPCODES.indexOf(i.opcode)>=0?this._extensions.processOutgoingMessage(i,function(l,c){if(l)return this._fail("extension_error",l.message);a.call(this,c)},this):a.call(this,i),!0},_sendFrame:function(n){var e=n.length,t=e<=125?2:e<=65535?4:10,i=t+(n.masked?4:0),r=ed.allocUnsafe(i+e),s=n.masked?this.MASK:0;r[0]=(n.final?this.FIN:0)|(n.rsv1?this.RSV1:0)|(n.rsv2?this.RSV2:0)|(n.rsv3?this.RSV3:0)|n.opcode,e<=125?r[1]=s|e:e<=65535?(r[1]=s|126,r.writeUInt16BE(e,2)):(r[1]=s|127,r.writeUInt32BE(Math.floor(e/4294967296),2),r.writeUInt32BE(e%4294967296,6)),n.payload.copy(r,i),n.masked&&(n.maskingKey.copy(r,t),oi.mask(r,n.maskingKey,i)),this._write(r)},_handshakeResponse:function(){var n=this._request.headers["sec-websocket-key"],e=this._request.headers["sec-websocket-version"];if(e!==oi.VERSION)throw new Error("Unsupported WebSocket version: "+e);if(typeof n!="string")throw new Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",oi.generateAccept(n)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var t=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);t&&this._headers.set("Sec-WebSocket-Extensions",t);var i="HTTP/1.1 101 Switching Protocols",r=[i,this._headers.toString(),""];return ed.from(r.join(`\r
`),"utf8")},_shutdown:function(n,e,t){delete this._frame,delete this._message,this._stage=5;var i=this.readyState===1;this.readyState=2,this._extensions.close(function(){i&&this.frame(e,"close",n),this.readyState=3,t&&this.emit("error",new Error(e)),this.emit("close",new ca.CloseEvent(n,e))},this)},_fail:function(n,e){this.readyState>1||this._shutdown(this.ERRORS[n],e,!0)},_parseOpcode:function(n){var e=[this.RSV1,this.RSV2,this.RSV3].map(function(i){return(n&i)===i}),t=this._frame=new Jk;if(t.final=(n&this.FIN)===this.FIN,t.rsv1=e[0],t.rsv2=e[1],t.rsv3=e[2],t.opcode=n&this.OPCODE,this._stage=1,!this._extensions.validFrameRsv(t))return this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(t.rsv1?1:0)+", reserved2 = "+(t.rsv2?1:0)+", reserved3 = "+(t.rsv3?1:0));if(this.OPCODE_CODES.indexOf(t.opcode)<0)return this._fail("protocol_error","Unrecognized frame opcode: "+t.opcode);if(this.MESSAGE_OPCODES.indexOf(t.opcode)<0&&!t.final)return this._fail("protocol_error","Received fragmented control frame: opcode = "+t.opcode);if(this._message&&this.OPENING_OPCODES.indexOf(t.opcode)>=0)return this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished")},_parseLength:function(n){var e=this._frame;if(e.masked=(n&this.MASK)===this.MASK,e.length=n&this.LENGTH,e.length>=0&&e.length<=125){if(this._stage=e.masked?3:4,!this._checkFrameLength())return}else this._stage=2,e.lengthBytes=e.length===126?2:8;if(this._requireMasking&&!e.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(n){var e=this._frame;if(e.length=this._readUInt(n),this._stage=e.masked?3:4,this.MESSAGE_OPCODES.indexOf(e.opcode)<0&&e.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+e.length);this._checkFrameLength()},_checkFrameLength:function(){var n=this._message?this._message.length:0;return n+this._frame.length>this._maxLength?(this._fail("too_large","WebSocket frame length too large"),!1):!0},_emitFrame:function(n){var e=this._frame,t=e.payload=oi.mask(n,e.maskingKey),i=e.opcode,r,s,o,a,l;if(delete this._frame,i===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(e)}if((i===this.OPCODES.text||i===this.OPCODES.binary)&&(this._message=new Zk,this._message.pushFrame(e)),e.final&&this.MESSAGE_OPCODES.indexOf(i)>=0)return this._emitMessage(this._message);i===this.OPCODES.close&&(s=t.length>=2?t.readUInt16BE(0):null,o=t.length>2?this._encode(t.slice(2)):null,t.length!==0&&!(s!==null&&s>=this.MIN_RESERVED_ERROR&&s<=this.MAX_RESERVED_ERROR)&&this.ERROR_CODES.indexOf(s)<0&&(s=this.ERRORS.protocol_error),(t.length>125||t.length>2&&!o)&&(s=this.ERRORS.protocol_error),this._shutdown(s||this.DEFAULT_ERROR_CODE,o||"")),i===this.OPCODES.ping&&(this.frame(t,"pong"),this.emit("ping",new ca.PingEvent(t.toString()))),i===this.OPCODES.pong&&(a=this._pingCallbacks,r=this._encode(t),l=a[r],delete a[r],l&&l(),this.emit("pong",new ca.PongEvent(t.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(t,i){if(t)return this._fail("extension_error",t.message);var r=i.data;if(i.opcode===this.OPCODES.text&&(r=this._encode(r)),r===null)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new ca.MessageEvent(r))},this)},_encode:function(n){try{var e=n.toString("binary",0,n.length);if(!this.UTF8_MATCH.test(e))return null}catch{}return n.toString("utf8",0,n.length)},_readUInt:function(n){return n.length===2?n.readUInt16BE(0):n.readUInt32BE(0)*4294967296+n.readUInt32BE(4)}};for(_v in eA)oi.prototype[_v]=eA[_v];var _v;nA.exports=oi});var aA=j((que,oA)=>{"use strict";var sA=vr().Buffer,mq=Ce("stream").Stream,iA=Ce("url"),gq=Ce("util"),yq=Os(),vq=ep(),_q=op(),wq={"ws:":80,"wss:":443},bv=function(n,e,t){this._client=n,this._http=new _q("response"),this._origin=typeof n.url=="object"?n.url:iA.parse(n.url),this._url=typeof e=="object"?e:iA.parse(e),this._options=t||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new vq,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var i=this._url.auth&&sA.from(this._url.auth,"utf8").toString("base64");i&&this._headers.set("Proxy-Authorization","Basic "+i)};gq.inherits(bv,mq);var rA={setHeader:function(n,e){return this._state!==0?!1:(this._headers.set(n,e),!0)},start:function(){if(this._state!==0)return!1;this._state=1;var n=this._origin,e=n.port||wq[n.protocol],t="CONNECT "+n.hostname+":"+e+" HTTP/1.1",i=[t,this._headers.toString(),""];return this.emit("data",sA.from(i.join(`\r
`),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(n){if(!this.writable)return!1;if(this._http.parse(n),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this.statusCode===200)this.emit("connect",new yq.ConnectEvent);else{var e="Can't establish a connection to the server at "+this._origin.href;this.emit("error",new Error(e))}return this.end(),!this._paused},end:function(n){this.writable&&(n!==void 0&&this.write(n),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(Sv in rA)bv.prototype[Sv]=rA[Sv];var Sv;oA.exports=bv});var dA=j((zue,uA)=>{"use strict";var cA=vr().Buffer,Sq=Ce("crypto"),bq=Ce("url"),Eq=Ce("util"),Cq=op(),Tq=Os(),xl=wv(),xq=aA(),td=function(n,e){this.version="hybi-"+xl.VERSION,xl.call(this,null,n,e),this.readyState=-1,this._key=td.generateKey(),this._accept=xl.generateAccept(this._key),this._http=new Cq("response");var t=bq.parse(this.url),i=t.auth&&cA.from(t.auth,"utf8").toString("base64");if(this.VALID_PROTOCOLS.indexOf(t.protocol)<0)throw new Error(this.url+" is not a valid WebSocket URL");this._pathname=(t.pathname||"/")+(t.search||""),this._headers.set("Host",t.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",xl.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),i&&this._headers.set("Authorization","Basic "+i)};Eq.inherits(td,xl);td.generateKey=function(){return Sq.randomBytes(16).toString("base64")};var lA={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(n,e){return new xq(this,n,e)},start:function(){return this.readyState!==-1?!1:(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(n){if(this.readyState!==3){if(this.readyState>0)return xl.prototype.parse.call(this,n);this._http.parse(n),this._http.isComplete()&&(this._validateHandshake(),this.readyState!==3&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var n=this._extensions.generateOffer();n&&this._headers.set("Sec-WebSocket-Extensions",n);var e="GET "+this._pathname+" HTTP/1.1",t=[e,this._headers.toString(),""];return cA.from(t.join(`\r
`),"utf8")},_failHandshake:function(n){n="Error during WebSocket handshake: "+n,this.readyState=3,this.emit("error",new Error(n)),this.emit("close",new Tq.CloseEvent(this.ERRORS.protocol_error,n))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(this._http.statusCode!==101)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var n=this._http.headers,e=n.upgrade||"",t=n.connection||"",i=n["sec-websocket-accept"]||"",r=n["sec-websocket-protocol"]||"";if(e==="")return this._failHandshake("'Upgrade' header is missing");if(e.toLowerCase()!=="websocket")return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(t==="")return this._failHandshake("'Connection' header is missing");if(t.toLowerCase()!=="upgrade")return this._failHandshake("'Connection' header value is not 'Upgrade'");if(i!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,r!==""){if(this._protocols.indexOf(r)<0)return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=r}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(s){return this._failHandshake(s.message)}}};for(Ev in lA)td.prototype[Ev]=lA[Ev];var Ev;uA.exports=td});var xv=j((Vue,fA)=>{"use strict";var lp=vr().Buffer,cp=Os(),Iq=Ce("util"),Tv=function(n,e,t){cp.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};Iq.inherits(Tv,cp);var hA={close:function(){return this.readyState===3?!1:(this.readyState=3,this.emit("close",new cp.CloseEvent(null,null)),!0)},parse:function(n){this.readyState>1||(this._reader.put(n),this._reader.eachByte(function(e){var t;switch(this._stage){case-1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(e&127)+128*this._length,this._closing&&this._length===0)return this.close();(e&128)!==128&&(this._length===0?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(e===255)this._stage=0,t=lp.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new cp.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close();break}},this))},frame:function(n){if(this.readyState===0)return this._queue([n]);if(this.readyState>1)return!1;typeof n!="string"&&(n=n.toString());var e=lp.byteLength(n),t=lp.allocUnsafe(e+2);return t[0]=0,t.write(n,1),t[t.length-1]=255,this._write(t),!0},_handshakeResponse:function(){var n="HTTP/1.1 101 Web Socket Protocol Handshake",e=[n,this._headers.toString(),""];return lp.from(e.join(`\r
`),"utf8")},_parseLeadingByte:function(n){(n&128)===128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(Cv in hA)Tv.prototype[Cv]=hA[Cv];var Cv;fA.exports=Tv});var vA=j(($ue,yA)=>{"use strict";var nd=vr().Buffer,kq=Os(),up=xv(),Aq=Ce("crypto"),Dq=Ce("util"),pA=function(n){return parseInt((n.match(/[0-9]/g)||[]).join(""),10)},mA=function(n){return(n.match(/ /g)||[]).length},kv=function(n,e,t){up.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};Dq.inherits(kv,up);var gA={BODY_SIZE:8,start:function(){return up.prototype.start.call(this)?(this._started=!0,this._sendHandshakeBody(),!0):!1},close:function(){return this.readyState===3?!1:(this.readyState===1&&this._write(nd.from([255,0])),this.readyState=3,this.emit("close",new kq.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,n=a["sec-websocket-key1"],e=a["sec-websocket-key2"];if(!n)throw new Error("Missing required header: Sec-WebSocket-Key1");if(!e)throw new Error("Missing required header: Sec-WebSocket-Key2");var t=pA(n),i=mA(n),r=pA(e),s=mA(e);if(t%i!==0||r%s!==0)throw new Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[t/i,r/s];var o="HTTP/1.1 101 WebSocket Protocol Handshake",a=[o,this._headers.toString(),""];return nd.from(a.join(`\r
`),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var n=Aq.createHash("md5"),e=nd.allocUnsafe(8+this.BODY_SIZE);return e.writeUInt32BE(this._keyValues[0],0),e.writeUInt32BE(this._keyValues[1],4),nd.from(this._body).copy(e,8,0,this.BODY_SIZE),n.update(e),nd.from(n.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var n=this._handshakeSignature();n&&(this._write(n),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(n){if(n!==255)return up.prototype._parseLeadingByte.call(this,n);this._closing=!0,this._length=0,this._stage=1}};for(Iv in gA)kv.prototype[Iv]=gA[Iv];var Iv;yA.exports=kv});var wA=j((jue,_A)=>{"use strict";var Pq=Ce("util"),Rq=op(),Pv=Os(),Mq=xv(),Oq=vA(),Nq=wv(),ua=function(n){Pv.call(this,null,null,n),this._http=new Rq("request")};Pq.inherits(ua,Pv);var Dv={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(n){if(this._delegate)return this._delegate.parse(n);if(this._http.parse(n),!!this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var e=this;this._delegate=ua.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(t){this._delegate.on(t,function(i){e.emit(t,i)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new Pv.ConnectEvent)}},_open:function(){this.__queue.forEach(function(n){this._delegate[n[0]].apply(this._delegate,n[1])},this),this.__queue=[]}};["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(n){Dv[n]=function(){return this._delegate?this._delegate[n].apply(this._delegate,arguments):(this.__queue.push([n,arguments]),!0)}});for(Av in Dv)ua.prototype[Av]=Dv[Av];var Av;ua.isSecureRequest=function(n){if(n.connection&&n.connection.authorized!==void 0||n.socket&&n.socket.secure)return!0;var e=n.headers;return e?e.https==="on"||e["x-forwarded-ssl"]==="on"||e["x-forwarded-scheme"]==="https"||e["x-forwarded-proto"]==="https":!1};ua.determineUrl=function(n){var e=this.isSecureRequest(n)?"wss:":"ws:";return e+"//"+n.headers.host+n.url};ua.http=function(n,e){e=e||{},e.requireMasking===void 0&&(e.requireMasking=!0);var t=n.headers,i=t["sec-websocket-version"],r=t["sec-websocket-key"],s=t["sec-websocket-key1"],o=t["sec-websocket-key2"],a=this.determineUrl(n);return i||r?new Nq(n,a,e):s||o?new Oq(n,a,e):new Mq(n,a,e)};_A.exports=ua});var id=j((Gue,bA)=>{"use strict";var SA=Os(),Lq=dA(),dp=wA(),Fq={client:function(n,e){return e=e||{},e.masking===void 0&&(e.masking=!0),new Lq(n,e)},server:function(n){return n=n||{},n.requireMasking===void 0&&(n.requireMasking=!0),new dp(n)},http:function(){return dp.http.apply(dp,arguments)},isSecureRequest:function(n){return dp.isSecureRequest(n)},isWebSocket:function(n){return SA.isWebSocket(n)},validateOptions:function(n,e){SA.validateOptions(n,e)}};bA.exports=Fq});var rd=j((Hue,EA)=>{"use strict";var da=function(n,e){this.type=n;for(var t in e)this[t]=e[t]};da.prototype.initEvent=function(n,e,t){this.type=n,this.bubbles=e,this.cancelable=t};da.prototype.stopPropagation=function(){};da.prototype.preventDefault=function(){};da.CAPTURING_PHASE=1;da.AT_TARGET=2;da.BUBBLING_PHASE=3;EA.exports=da});var Rv=j((Wue,CA)=>{"use strict";var Bq=rd(),Uq={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(n,e,t){this.on(n,e)},removeEventListener:function(n,e,t){this.removeListener(n,e)},dispatchEvent:function(n){n.target=n.currentTarget=this,n.eventPhase=Bq.AT_TARGET,this["on"+n.type]&&this["on"+n.type](n),this.emit(n.type,n)}};CA.exports=Uq});var fp=j((Kue,IA)=>{"use strict";var qq=Ce("stream").Stream,zq=Ce("util"),Vq=id(),TA=Rv(),hp=rd(),Ct=function(n){n=n||{},Vq.validateOptions(n,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var e=n.headers;if(e)for(var t in e)this._driver.setHeader(t,e[t]);var i=n.extensions;i&&[].concat(i).forEach(this._driver.addExtension,this._driver),this._ping=n.ping,this._pingId=0,this.readyState=Ct.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var r=this;this._driver.on("open",function(s){r._open()}),this._driver.on("message",function(s){r._receiveMessage(s.data)}),this._driver.on("close",function(s){r._beginClose(s.reason,s.code)}),this._driver.on("error",function(s){r._emitError(s.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){r.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){r._pingId+=1,r.ping(r._pingId.toString())},this._ping*1e3)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};zq.inherits(Ct,qq);Ct.CONNECTING=0;Ct.OPEN=1;Ct.CLOSING=2;Ct.CLOSED=3;Ct.CLOSE_TIMEOUT=3e4;var xA={write:function(n){return this.send(n)},end:function(n){n!==void 0&&this.send(n),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(n){return this.readyState>Ct.OPEN?!1:(n instanceof Buffer||(n=String(n)),this._driver.messages.write(n))},ping:function(n,e){return this.readyState>Ct.OPEN?!1:this._driver.ping(n,e)},close:function(n,e){if(n===void 0&&(n=1e3),e===void 0&&(e=""),n!==1e3&&(n<3e3||n>4999))throw new Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+n+" is neither.");if(this.readyState<Ct.CLOSING){var t=this;this._closeTimer=setTimeout(function(){t._beginClose("",1006)},Ct.CLOSE_TIMEOUT)}this.readyState!==Ct.CLOSED&&(this.readyState=Ct.CLOSING),this._driver.close(e,n)},_configureStream:function(){var n=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(e){this._stream.on(e,function(){n._finalizeClose()})},this),this._stream.on("error",function(e){n._emitError("Network error: "+n.url+": "+e.message),n._finalizeClose()})},_open:function(){if(this.readyState===Ct.CONNECTING){this.readyState=Ct.OPEN,this.protocol=this._driver.protocol||"";var n=new hp("open");n.initEvent("open",!1,!1),this.dispatchEvent(n)}},_receiveMessage:function(n){if(this.readyState>Ct.OPEN)return!1;this.readable&&this.emit("data",n);var e=new hp("message",{data:n});e.initEvent("message",!1,!1),this.dispatchEvent(e)},_emitError:function(n){if(!(this.readyState>=Ct.CLOSING)){var e=new hp("error",{message:n});e.initEvent("error",!1,!1),this.dispatchEvent(e)}},_beginClose:function(n,e){this.readyState!==Ct.CLOSED&&(this.readyState=Ct.CLOSING,this._closeParams=[n,e],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==Ct.CLOSED){this.readyState=Ct.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var n=this._closeParams?this._closeParams[0]:"",e=this._closeParams?this._closeParams[1]:1006,t=new hp("close",{code:e,reason:n});t.initEvent("close",!1,!1),this.dispatchEvent(t)}}};for(Mv in xA)Ct.prototype[Mv]=xA[Mv];var Mv;for(Ov in TA)Ct.prototype[Ov]=TA[Ov];var Ov;IA.exports=Ct});var MA=j((Que,RA)=>{"use strict";var $q=Ce("util"),jq=Ce("net"),kA=Ce("tls"),AA=Ce("url"),Gq=id(),DA=fp(),Yue=rd(),Hq={"http:":80,"https:":443,"ws:":80,"wss:":443},PA=["https:","wss:"],pp=function(n,e,t){t=t||{},this.url=n,this._driver=Gq.client(this.url,{maxLength:t.maxLength,protocols:e}),["open","error"].forEach(function(h){this._driver.on(h,function(){d.headers=d._driver.headers,d.statusCode=d._driver.statusCode})},this);var i=t.proxy||{},r=AA.parse(i.origin||this.url),s=r.port||Hq[r.protocol],o=PA.indexOf(r.protocol)>=0,a=function(){d._onConnect()},l=t.net||{},c=t.tls||{},u=i.origin?i.tls||{}:c,d=this;l.host=u.host=r.hostname,l.port=u.port=s,c.ca=c.ca||t.ca,u.servername=u.servername||r.hostname,this._stream=o?kA.connect(u,a):jq.connect(l,a),i.origin&&this._configureProxy(i,c),DA.call(this,t)};$q.inherits(pp,DA);pp.prototype._onConnect=function(){var n=this._proxy||this._driver;n.start()};pp.prototype._configureProxy=function(n,e){var t=AA.parse(this.url),i=PA.indexOf(t.protocol)>=0,r=this,s;if(this._proxy=this._driver.proxy(n.origin),n.headers)for(s in n.headers)this._proxy.setHeader(s,n.headers[s]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(i){var o={socket:r._stream,servername:t.hostname};for(s in e)o[s]=e[s];r._stream=kA.connect(o),r._configureStream()}r._driver.io.pipe(r._stream),r._stream.pipe(r._driver.io),r._driver.start()}),this._proxy.on("error",function(o){r._driver.emit("error",o)})};RA.exports=pp});var BA=j((Xue,FA)=>{"use strict";var Wq=Ce("stream").Stream,Kq=Ce("util"),Yq=id(),Qq=ep(),Il=fp(),OA=Rv(),NA=rd(),sd=function(n,e,t){this.writable=!0,t=t||{},this._stream=e.socket,this._ping=t.ping||this.DEFAULT_PING,this._retry=t.retry||this.DEFAULT_RETRY;var i=Yq.isSecureRequest(n)?"https:":"http:";this.url=i+"//"+n.headers.host+n.url,this.lastEventId=n.headers["last-event-id"]||"",this.readyState=Il.CONNECTING;var r=new Qq,s=this;if(t.headers)for(var o in t.headers)r.set(o,t.headers[o]);if(!(!this._stream||!this._stream.writable)){process.nextTick(function(){s._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var a=`HTTP/1.1 200 OK\r
Content-Type: text/event-stream\r
Cache-Control: no-cache, no-store\r
Connection: close\r
`+r.toString()+`\r
retry: `+Math.floor(this._retry*1e3)+`\r
\r
`;this._write(a),this._stream.on("drain",function(){s.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){s.ping()},this._ping*1e3)),["error","end"].forEach(function(l){s._stream.on(l,function(){s.close()})})}};Kq.inherits(sd,Wq);sd.isEventSource=function(n){if(n.method!=="GET")return!1;var e=(n.headers.accept||"").split(/\s*,\s*/);return e.indexOf("text/event-stream")>=0};var LA={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(n){if(!this.writable)return!1;try{return this._stream.write(n,"utf8")}catch{return!1}},_open:function(){if(this.readyState===Il.CONNECTING){this.readyState=Il.OPEN;var n=new NA("open");n.initEvent("open",!1,!1),this.dispatchEvent(n)}},write:function(n){return this.send(n)},end:function(n){n!==void 0&&this.write(n),this.close()},send:function(n,e){if(this.readyState>Il.OPEN)return!1;n=String(n).replace(/(\r\n|\r|\n)/g,"$1data: "),e=e||{};var t="";return e.event&&(t+="event: "+e.event+`\r
`),e.id&&(t+="id: "+e.id+`\r
`),t+="data: "+n+`\r
\r
`,this._write(t)},ping:function(){return this._write(`:\r
\r
`)},close:function(){if(this.readyState>Il.OPEN)return!1;this.readyState=Il.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var n=new NA("close");return n.initEvent("close",!1,!1),this.dispatchEvent(n),!0}};for(Nv in LA)sd.prototype[Nv]=LA[Nv];var Nv;for(Lv in OA)sd.prototype[Lv]=OA[Lv];var Lv;FA.exports=sd});var zA=j((Jue,qA)=>{"use strict";var Xq=Ce("util"),Fv=id(),UA=fp(),Ns=function(n,e,t,i,r){r=r||{},this._stream=e,this._driver=Fv.http(n,{maxLength:r.maxLength,protocols:i});var s=this;if(!(!this._stream||!this._stream.writable)){if(!this._stream.readable)return this._stream.end();var o=function(){s._stream.removeListener("data",o)};this._stream.on("data",o),UA.call(this,r),process.nextTick(function(){s._driver.start(),s._driver.io.write(t)})}};Xq.inherits(Ns,UA);Ns.isWebSocket=function(n){return Fv.isWebSocket(n)};Ns.validateOptions=function(n,e){Fv.validateOptions(n,e)};Ns.WebSocket=Ns;Ns.Client=MA();Ns.EventSource=BA();qA.exports=Ns});var it=j(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=Pi.DEFAULT_MAX_SEND_MESSAGE_LENGTH=Pi.Propagate=Pi.LogVerbosity=Pi.Status=void 0;var pR=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(pR||(Pi.Status=pR={})),mR=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(mR||(Pi.LogVerbosity=mR={})),gR=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(gR||(Pi.Propagate=gR={}));Pi.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;Pi.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Ow=j((Ide,n$)=>{n$.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ft=j(Nn=>{"use strict";var Nw,Lw,Fw,Bw;Object.defineProperty(Nn,"__esModule",{value:!0});Nn.isTracerEnabled=Nn.trace=Nn.log=Nn.setLoggerVerbosity=Nn.setLogger=Nn.getLogger=void 0;var Hs=it(),i$=Ce("process"),r$=Ow().version,s$={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Sa=s$,Gl=Hs.LogVerbosity.ERROR,o$=(Lw=(Nw=process.env.GRPC_NODE_VERBOSITY)!==null&&Nw!==void 0?Nw:process.env.GRPC_VERBOSITY)!==null&&Lw!==void 0?Lw:"";switch(o$.toUpperCase()){case"DEBUG":Gl=Hs.LogVerbosity.DEBUG;break;case"INFO":Gl=Hs.LogVerbosity.INFO;break;case"ERROR":Gl=Hs.LogVerbosity.ERROR;break;case"NONE":Gl=Hs.LogVerbosity.NONE;break;default:}var a$=()=>Sa;Nn.getLogger=a$;var l$=n=>{Sa=n};Nn.setLogger=l$;var c$=n=>{Gl=n};Nn.setLoggerVerbosity=c$;var u$=(n,...e)=>{let t;if(n>=Gl){switch(n){case Hs.LogVerbosity.DEBUG:t=Sa.debug;break;case Hs.LogVerbosity.INFO:t=Sa.info;break;case Hs.LogVerbosity.ERROR:t=Sa.error;break}t||(t=Sa.error),t&&t.bind(Sa)(...e)}};Nn.log=u$;var d$=(Bw=(Fw=process.env.GRPC_NODE_TRACE)!==null&&Fw!==void 0?Fw:process.env.GRPC_TRACE)!==null&&Bw!==void 0?Bw:"",Uw=new Set,yR=new Set;for(let n of d$.split(","))n.startsWith("-")?yR.add(n.substring(1)):Uw.add(n);var h$=Uw.has("all");function f$(n,e,t){vR(e)&&(0,Nn.log)(n,new Date().toISOString()+" | v"+r$+" "+i$.pid+" | "+e+" | "+t)}Nn.trace=f$;function vR(n){return!yR.has(n)&&(h$||Uw.has(n))}Nn.isTracerEnabled=vR});var om=j(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});Hl.getErrorCode=Hl.getErrorMessage=void 0;function p$(n){return n instanceof Error?n.message:String(n)}Hl.getErrorMessage=p$;function m$(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Hl.getErrorCode=m$});var Kn=j(lm=>{"use strict";Object.defineProperty(lm,"__esModule",{value:!0});lm.Metadata=void 0;var g$=Ft(),y$=it(),v$=om(),_$=/^[0-9a-z_.-]+$/,w$=/^[ -~]*$/;function S$(n){return _$.test(n)}function b$(n){return w$.test(n)}function wR(n){return n.endsWith("-bin")}function E$(n){return!n.startsWith("grpc-")}function am(n){return n.toLowerCase()}function _R(n,e){if(!S$(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(wR(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!b$(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var qw=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=am(e),_R(e,t),this.internalRepr.set(e,[t])}add(e,t){e=am(e),_R(e,t);let i=this.internalRepr.get(e);i===void 0?this.internalRepr.set(e,[t]):i.push(t)}remove(e){e=am(e),this.internalRepr.delete(e)}get(e){return e=am(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,i]of this.internalRepr)if(i.length>0){let r=i[0];e[t]=Buffer.isBuffer(r)?Buffer.from(r):r}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[i,r]of this.internalRepr){let s=r.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(i,s)}return e}merge(e){for(let[t,i]of e.internalRepr){let r=(this.internalRepr.get(t)||[]).concat(i);this.internalRepr.set(t,r)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,i]of this.internalRepr)e[t]=i.map(C$);return e}toJSON(){let e={};for(let[t,i]of this.internalRepr)e[t]=i;return e}static fromHttp2Headers(e){let t=new n;for(let i of Object.keys(e)){if(i.charAt(0)===":")continue;let r=e[i];try{wR(i)?Array.isArray(r)?r.forEach(s=>{t.add(i,Buffer.from(s,"base64"))}):r!==void 0&&(E$(i)?r.split(",").forEach(s=>{t.add(i,Buffer.from(s.trim(),"base64"))}):t.add(i,Buffer.from(r,"base64"))):Array.isArray(r)?r.forEach(s=>{t.add(i,s)}):r!==void 0&&t.add(i,r)}catch(s){let o=`Failed to add metadata entry ${i}: ${r}. ${(0,v$.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,g$.log)(y$.LogVerbosity.ERROR,o)}}return t}};lm.Metadata=qw;var C$=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Gw=j(cm=>{"use strict";Object.defineProperty(cm,"__esModule",{value:!0});cm.CallCredentials=void 0;var jw=Kn();function T$(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Wl=class n{static createFromMetadataGenerator(e){return new Vw(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,i)=>{let r;T$(e)?r=e.getRequestHeaders(t.service_url):r=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),r.then(s=>{let o=new jw.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);i(null,o)},s=>{i(s)})})}static createEmpty(){return new $w}};cm.CallCredentials=Wl;var zw=class n extends Wl{constructor(e){super(),this.creds=e}generateMetadata(e){return B(this,null,function*(){let t=new jw.Metadata,i=yield Promise.all(this.creds.map(r=>r.generateMetadata(e)));for(let r of i)t.merge(r);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,i)=>t._equals(e.creds[i])):!1}},Vw=class n extends Wl{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,i)=>{this.metadataGenerator(e,(r,s)=>{s!==void 0?t(s):i(r)})})}compose(e){return new zw([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},$w=class n extends Wl{generateMetadata(e){return Promise.resolve(new jw.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Ww=j(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});Kl.getDefaultRootsData=Kl.CIPHER_SUITES=void 0;var x$=Ce("fs");Kl.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var SR=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Hw=null;function I$(){return SR?(Hw===null&&(Hw=x$.readFileSync(SR)),Hw):null}Kl.getDefaultRootsData=I$});var hm=j(dm=>{"use strict";Object.defineProperty(dm,"__esModule",{value:!0});dm.ChannelCredentials=void 0;var k$=Ce("tls"),A$=Gw(),bR=Ww();function Kw(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Yl=class{constructor(e){this.callCredentials=e||A$.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,i,r){var s;if(Kw(e,"Root certificate"),Kw(t,"Private key"),Kw(i,"Certificate chain"),t&&!i)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&i)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,k$.createSecureContext)({ca:(s=e??(0,bR.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:i??void 0,ciphers:bR.CIPHER_SUITES});return new um(o,r??{})}static createFromSecureContext(e,t){return new um(e,t??{})}static createInsecure(){return new Yw}};dm.ChannelCredentials=Yl;var Yw=class n extends Yl{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},um=class n extends Yl{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Qw(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Qw=class n extends Yl{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Ks=j(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.validateLoadBalancingConfig=Tn.getFirstUsableConfig=Tn.isLoadBalancerNameRegistered=Tn.createLoadBalancer=Tn.registerDefaultLoadBalancerType=Tn.registerLoadBalancerType=Tn.createChildChannelControlHelper=void 0;function D$(n,e){var t,i,r,s,o,a,l,c,u,d;return{createSubchannel:(i=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&i!==void 0?i:n.createSubchannel.bind(n),updateState:(s=(r=e.updateState)===null||r===void 0?void 0:r.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}Tn.createChildChannelControlHelper=D$;var Ws={},Xw=null;function P$(n,e,t){Ws[n]={LoadBalancer:e,LoadBalancingConfig:t}}Tn.registerLoadBalancerType=P$;function R$(n){Xw=n}Tn.registerDefaultLoadBalancerType=R$;function M$(n,e){let t=n.getLoadBalancerName();return t in Ws?new Ws[t].LoadBalancer(e):null}Tn.createLoadBalancer=M$;function O$(n){return n in Ws}Tn.isLoadBalancerNameRegistered=O$;function N$(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Ws)return t;return e&&Xw?new Ws[Xw].LoadBalancingConfig:null}Tn.getFirstUsableConfig=N$;function L$(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Ws)return Ws[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}Tn.validateLoadBalancingConfig=L$});var Jw=j(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.extractAndSelectServiceConfig=Ys.validateServiceConfig=Ys.validateRetryThrottling=void 0;var F$=Ce("os"),fm=it(),B$=Ks(),pm=/^\d+(\.\d{1,9})?s$/,U$="node";function q$(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function z$(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!pm.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!pm.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(fm.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(fm.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function V$(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!pm.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(fm.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(fm.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function $$(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let i of n.name)t.name.push(q$(i));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&pm.test(n.timeout)){let i=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:i[0]|0,nanos:((e=i[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=z$(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=V$(n.hedgingPolicy));return t}function ER(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Ys.validateRetryThrottling=ER;function CR(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let i of n.loadBalancingConfig)e.loadBalancingConfig.push((0,B$.validateLoadBalancingConfig)(i));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let i of n.methodConfig)e.methodConfig.push($$(i));"retryThrottling"in n&&(e.retryThrottling=ER(n.retryThrottling));let t=[];for(let i of e.methodConfig)for(let r of i.name){for(let s of t)if(r.service===s.service&&r.method===s.method)throw new Error(`Invalid service config: duplicate name ${r.service}/${r.method}`);t.push(r)}return e}Ys.validateServiceConfig=CR;function j$(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:CR(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let i of n.clientLanguage)if(typeof i=="string")e.clientLanguage.push(i);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let i of n.clientHostname)if(typeof i=="string")e.clientHostname.push(i);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let i in n)if(!t.includes(i))throw new Error(`Invalid service config choice: unexpected field ${i}`);return e}function G$(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let i=j$(t);if(!(typeof i.percentage=="number"&&e>i.percentage)){if(Array.isArray(i.clientHostname)){let r=!1;for(let s of i.clientHostname)s===F$.hostname()&&(r=!0);if(!r)continue}if(Array.isArray(i.clientLanguage)){let r=!1;for(let s of i.clientLanguage)s===U$&&(r=!0);if(!r)continue}return i.serviceConfig}}throw new Error("No matching service config found")}function H$(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let i=t.join("").substring(12),r=JSON.parse(i);return G$(r,e)}return null}Ys.extractAndSelectServiceConfig=H$});var Ri=j(mm=>{"use strict";Object.defineProperty(mm,"__esModule",{value:!0});mm.ConnectivityState=void 0;var TR=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(TR||(mm.ConnectivityState=TR={}))});var di=j(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.uriToString=Qs.splitHostPort=Qs.parseUri=void 0;var W$=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function K$(n){let e=W$.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Qs.parseUri=K$;var xR=/^\d+$/;function Y$(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let i=n.substring(e+2);return xR.test(i)?{host:t,port:+i}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?xR.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Qs.splitHostPort=Y$;function Q$(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Qs.uriToString=Q$});var Cr=j(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});Mi.mapUriDefaultScheme=Mi.getDefaultAuthority=Mi.createResolver=Mi.registerDefaultScheme=Mi.registerResolver=void 0;var eS=di(),Ql={},Zw=null;function X$(n,e){Ql[n]=e}Mi.registerResolver=X$;function J$(n){Zw=n}Mi.registerDefaultScheme=J$;function Z$(n,e,t){if(n.scheme!==void 0&&n.scheme in Ql)return new Ql[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,eS.uriToString)(n)}`)}Mi.createResolver=Z$;function e9(n){if(n.scheme!==void 0&&n.scheme in Ql)return Ql[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,eS.uriToString)(n)}`)}Mi.getDefaultAuthority=e9;function t9(n){return n.scheme===void 0||!(n.scheme in Ql)?Zw!==null?{scheme:Zw,authority:void 0,path:(0,eS.uriToString)(n)}:null:n}Mi.mapUriDefaultScheme=t9});var Js=j(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.QueuePicker=Xs.UnavailablePicker=Xs.PickResultType=void 0;var n9=Kn(),i9=it(),gm=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(gm||(Xs.PickResultType=gm={})),tS=class{constructor(e){this.status=Object.assign({code:i9.Status.UNAVAILABLE,details:"No connection established",metadata:new n9.Metadata},e)}pick(e){return{pickResultType:gm.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Xs.UnavailablePicker=tS;var nS=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:gm.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Xs.QueuePicker=nS});var qd=j(ym=>{"use strict";Object.defineProperty(ym,"__esModule",{value:!0});ym.BackoffTimeout=void 0;var r9=1e3,s9=1.6,o9=12e4,a9=.2;function l9(n,e){return Math.random()*(e-n)+n}var iS=class{constructor(e,t){this.callback=e,this.initialDelay=r9,this.multiplier=s9,this.maxDelay=o9,this.jitter=a9,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,i;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(i=(t=this.timerId).unref)===null||i===void 0||i.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+l9(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};ym.BackoffTimeout=iS});var _m=j(vm=>{"use strict";Object.defineProperty(vm,"__esModule",{value:!0});vm.ChildLoadBalancerHandler=void 0;var c9=Ks(),u9=Ri(),d9="child_load_balancer_helper",rS=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,i){return this.parent.channelControlHelper.createSubchannel(t,i)}updateState(t,i){var r;if(this.calledByPendingChild()){if(t===u9.ConnectivityState.CONNECTING)return;(r=this.parent.currentChild)===null||r===void 0||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,i)}requestReresolution(){var t;let i=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===i&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,i){let r;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,c9.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,r=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,r=this.pendingChild)}else this.pendingChild===null?r=this.currentChild:r=this.pendingChild;this.latestConfig=t,r.updateAddressList(e,t,i)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return d9}};vm.ChildLoadBalancerHandler=rS});var kR=j(wm=>{"use strict";Object.defineProperty(wm,"__esModule",{value:!0});wm.ResolvingLoadBalancer=void 0;var h9=Ks(),f9=Jw(),Yn=Ri(),p9=Cr(),Xl=Js(),m9=qd(),sS=it(),g9=Kn(),y9=Ft(),v9=it(),_9=di(),w9=_m(),S9="resolving_load_balancer";function IR(n){y9.trace(v9.LogVerbosity.DEBUG,S9,n)}var b9=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function E9(n,e,t,i){for(let r of t.name)switch(i){case"EMPTY":if(!r.service&&!r.method)return!0;break;case"SERVICE":if(r.service===n&&!r.method)return!0;break;case"SERVICE_AND_METHOD":if(r.service===n&&r.method===e)return!0}return!1}function C9(n,e,t,i){for(let r of t)if(E9(n,e,r,i))return r;return null}function T9(n){return function(t,i){var r,s;let o=t.split("/").filter(c=>c.length>0),a=(r=o[0])!==null&&r!==void 0?r:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of b9){let u=C9(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:sS.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:sS.Status.OK,dynamicFilterFactories:[]}}}var oS=class{constructor(e,t,i,r,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=r,this.onFailedResolution=s,this.latestChildState=Yn.ConnectivityState.IDLE,this.latestChildPicker=new Xl.QueuePicker(this),this.currentState=Yn.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,i["grpc.service_config"]?this.defaultServiceConfig=(0,f9.validateServiceConfig)(JSON.parse(i["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Yn.ConnectivityState.IDLE,new Xl.QueuePicker(this)),this.childLoadBalancer=new w9.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(IR("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,p9.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var h;this.backoffTimeout.stop(),this.backoffTimeout.reset();let f=null;l===null?c===null?(this.previousServiceConfig=null,f=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):f=this.previousServiceConfig:(f=l,this.previousServiceConfig=l);let g=(h=f?.loadBalancingConfig)!==null&&h!==void 0?h:[],_=(0,h9.getFirstUsableConfig)(g,!0);if(_===null){this.handleResolutionFailure({code:sS.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new g9.Metadata});return}this.childLoadBalancer.updateAddressList(a,_,d);let S=f??this.defaultServiceConfig;this.onSuccessfulResolution(S,u??T9(S))},onError:a=>{this.handleResolutionFailure(a)}},i);let o={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new m9.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Yn.ConnectivityState.IDLE&&this.updateState(Yn.ConnectivityState.CONNECTING,new Xl.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){IR((0,_9.uriToString)(this.target)+" "+Yn.ConnectivityState[this.currentState]+" -> "+Yn.ConnectivityState[e]),e===Yn.ConnectivityState.IDLE&&(t=new Xl.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Yn.ConnectivityState.IDLE&&(this.updateState(Yn.ConnectivityState.TRANSIENT_FAILURE,new Xl.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Yn.ConnectivityState.IDLE||this.currentState===Yn.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Yn.ConnectivityState.IDLE,this.latestChildPicker=new Xl.QueuePicker(this),this.currentState=Yn.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};wm.ResolvingLoadBalancer=oS});var AR=j(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});Jl.channelOptionsEqual=Jl.recognizedOptions=void 0;Jl.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function x9(n,e){let t=Object.keys(n).sort(),i=Object.keys(e).sort();if(t.length!==i.length)return!1;for(let r=0;r<t.length;r+=1)if(t[r]!==i[r]||n[t[r]]!==e[i[r]])return!1;return!0}Jl.channelOptionsEqual=x9});var xr=j(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.stringToSubchannelAddress=Tr.subchannelAddressToString=Tr.subchannelAddressEqual=Tr.isTcpSubchannelAddress=void 0;var I9=Ce("net");function zd(n){return"port"in n}Tr.isTcpSubchannelAddress=zd;function k9(n,e){return!n&&!e?!0:!n||!e?!1:zd(n)?zd(e)&&n.host===e.host&&n.port===e.port:!zd(e)&&n.path===e.path}Tr.subchannelAddressEqual=k9;function A9(n){return zd(n)?n.host+":"+n.port:n.path}Tr.subchannelAddressToString=A9;var D9=443;function P9(n,e){return(0,I9.isIP)(n)?{host:n,port:e??D9}:{path:n}}Tr.stringToSubchannelAddress=P9});var Sm=j(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.addAdminServicesToServer=Zl.registerAdminService=void 0;var DR=[];function R9(n,e){DR.push({getServiceDefinition:n,getHandlers:e})}Zl.registerAdminService=R9;function M9(n){for(let{getServiceDefinition:e,getHandlers:t}of DR)n.addService(e(),t())}Zl.addAdminServicesToServer=M9});var PR=j(Oi=>{"use strict";Object.defineProperty(Oi,"__esModule",{value:!0});Oi.ClientDuplexStreamImpl=Oi.ClientWritableStreamImpl=Oi.ClientReadableStreamImpl=Oi.ClientUnaryCallImpl=Oi.callErrorFromStatus=void 0;var O9=Ce("events"),dS=Ce("stream"),Vd=it();function N9(n,e){let t=`${n.code} ${Vd.Status[n.code]}: ${n.details}`,r=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:r})}Oi.callErrorFromStatus=N9;var aS=class extends O9.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Vd.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Oi.ClientUnaryCallImpl=aS;var lS=class extends dS.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Vd.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Oi.ClientReadableStreamImpl=lS;var cS=class extends dS.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Vd.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,i){var r;let s={callback:i},o=Number(t);Number.isNaN(o)||(s.flags=o),(r=this.call)===null||r===void 0||r.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Oi.ClientWritableStreamImpl=cS;var uS=class extends dS.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Vd.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,i){var r;let s={callback:i},o=Number(t);Number.isNaN(o)||(s.flags=o),(r=this.call)===null||r===void 0||r.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Oi.ClientDuplexStreamImpl=uS});var RR=j(ec=>{"use strict";Object.defineProperty(ec,"__esModule",{value:!0});ec.InterceptingListenerImpl=ec.isInterceptingListener=void 0;function L9(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}ec.isInterceptingListener=L9;var hS=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};ec.InterceptingListenerImpl=hS});var _S=j(Ni=>{"use strict";Object.defineProperty(Ni,"__esModule",{value:!0});Ni.getInterceptingCall=Ni.InterceptingCall=Ni.RequesterBuilder=Ni.ListenerBuilder=Ni.InterceptorConfigurationError=void 0;var F9=Kn(),MR=RR(),OR=it(),NR=om(),jd=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Ni.InterceptorConfigurationError=jd;var pS=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Ni.ListenerBuilder=pS;var mS=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Ni.RequesterBuilder=mS;var fS={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},$d={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},gS=class{constructor(e,t){var i,r,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(i=t.start)!==null&&i!==void 0?i:$d.start,sendMessage:(r=t.sendMessage)!==null&&r!==void 0?r:$d.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:$d.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:$d.cancel}:this.requester=$d}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var i,r,s,o,a,l;let c={onReceiveMetadata:(r=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&r!==void 0?r:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var h,f,g;this.processingMetadata=!1;let _;if((0,MR.isInterceptingListener)(d))_=d;else{let S={onReceiveMetadata:(h=d.onReceiveMetadata)!==null&&h!==void 0?h:fS.onReceiveMetadata,onReceiveMessage:(f=d.onReceiveMessage)!==null&&f!==void 0?f:fS.onReceiveMessage,onReceiveStatus:(g=d.onReceiveStatus)!==null&&g!==void 0?g:fS.onReceiveStatus};_=new MR.InterceptingListenerImpl(S,c)}this.nextCall.start(u,_),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,i=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,i),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Ni.InterceptingCall=gS;function B9(n,e,t){var i,r;let s=(i=t.deadline)!==null&&i!==void 0?i:1/0,o=t.host,a=(r=t.parent)!==null&&r!==void 0?r:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var bm=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let i;try{i=this.methodDefinition.requestSerialize(t)}catch(r){this.call.cancelWithStatus(OR.Status.INTERNAL,`Request message serialization failure: ${(0,NR.getErrorMessage)(r)}`);return}this.call.sendMessageWithContext(e,i)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let i=null;this.call.start(e,{onReceiveMetadata:r=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,r)},onReceiveMessage:r=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(r)}catch(a){i={code:OR.Status.INTERNAL,details:`Response message parsing error: ${(0,NR.getErrorMessage)(a)}`,metadata:new F9.Metadata},this.call.cancelWithStatus(i.code,i.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:r=>{var s,o;i?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,i):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,r)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},yS=class extends bm{constructor(e,t){super(e,t)}start(e,t){var i,r;let s=!1,o={onReceiveMetadata:(r=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&r!==void 0?r:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},vS=class extends bm{};function U9(n,e,t){let i=B9(n,t.path,e);return t.responseStream?new vS(i,t):new yS(i,t)}function q9(n,e,t,i){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new jd("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new jd("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let r=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?r=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):r=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return r.reduceRight((a,l)=>c=>l(c,a),a=>U9(i,a,e))(s)}Ni.getInterceptingCall=q9});var bS=j(Cm=>{"use strict";Object.defineProperty(Cm,"__esModule",{value:!0});Cm.Client=void 0;var Ir=PR(),z9=ES(),V9=Ri(),Zs=it(),tc=Kn(),Em=_S(),Zi=Symbol(),nc=Symbol(),ic=Symbol(),ns=Symbol();function wS(n){return typeof n=="function"}function rc(n){return n.stack.split(`
`).slice(1).join(`
`)}var SS=class{constructor(e,t,i={}){var r,s;if(i=Object.assign({},i),this[nc]=(r=i.interceptors)!==null&&r!==void 0?r:[],delete i.interceptors,this[ic]=(s=i.interceptor_providers)!==null&&s!==void 0?s:[],delete i.interceptor_providers,this[nc].length>0&&this[ic].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[ns]=i.callInvocationTransformer,delete i.callInvocationTransformer,i.channelOverride)this[Zi]=i.channelOverride;else if(i.channelFactoryOverride){let o=i.channelFactoryOverride;delete i.channelFactoryOverride,this[Zi]=o(e,t,i)}else this[Zi]=new z9.ChannelImplementation(e,t,i)}close(){this[Zi].close()}getChannel(){return this[Zi]}waitForReady(e,t){let i=r=>{if(r){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Zi].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===V9.ConnectivityState.READY)t();else try{this[Zi].watchConnectivityState(s,e,i)}catch{t(new Error("The channel has been closed"))}};setImmediate(i)}checkOptionalUnaryResponseArguments(e,t,i){if(wS(e))return{metadata:new tc.Metadata,options:{},callback:e};if(wS(t))return e instanceof tc.Metadata?{metadata:e,options:{},callback:t}:{metadata:new tc.Metadata,options:e,callback:t};if(!(e instanceof tc.Metadata&&t instanceof Object&&wS(i)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:i}}makeUnaryRequest(e,t,i,r,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:i},h={argument:r,metadata:u.metadata,call:new Ir.ClientUnaryCallImpl,channel:this[Zi],methodDefinition:d,callOptions:u.options,callback:u.callback};this[ns]&&(h=this[ns](h));let f=h.call,g={clientInterceptors:this[nc],clientInterceptorProviders:this[ic],callInterceptors:(l=h.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=h.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},_=(0,Em.getInterceptingCall)(g,h.methodDefinition,h.callOptions,h.channel);f.call=_;let S=null,I=!1,E=new Error;return _.start(h.metadata,{onReceiveMetadata:b=>{f.emit("metadata",b)},onReceiveMessage(b){S!==null&&_.cancelWithStatus(Zs.Status.INTERNAL,"Too many responses received"),S=b},onReceiveStatus(b){if(!I){if(I=!0,b.code===Zs.Status.OK)if(S===null){let M=rc(E);h.callback((0,Ir.callErrorFromStatus)({code:Zs.Status.INTERNAL,details:"No message received",metadata:b.metadata},M))}else h.callback(null,S);else{let M=rc(E);h.callback((0,Ir.callErrorFromStatus)(b,M))}E=null,f.emit("status",b)}}}),_.sendMessage(r),_.halfClose(),f}makeClientStreamRequest(e,t,i,r,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(r,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:i},d={metadata:c.metadata,call:new Ir.ClientWritableStreamImpl(t),channel:this[Zi],methodDefinition:u,callOptions:c.options,callback:c.callback};this[ns]&&(d=this[ns](d));let h=d.call,f={clientInterceptors:this[nc],clientInterceptorProviders:this[ic],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},g=(0,Em.getInterceptingCall)(f,d.methodDefinition,d.callOptions,d.channel);h.call=g;let _=null,S=!1,I=new Error;return g.start(d.metadata,{onReceiveMetadata:E=>{h.emit("metadata",E)},onReceiveMessage(E){_!==null&&g.cancelWithStatus(Zs.Status.INTERNAL,"Too many responses received"),_=E},onReceiveStatus(E){if(!S){if(S=!0,E.code===Zs.Status.OK)if(_===null){let b=rc(I);d.callback((0,Ir.callErrorFromStatus)({code:Zs.Status.INTERNAL,details:"No message received",metadata:E.metadata},b))}else d.callback(null,_);else{let b=rc(I);d.callback((0,Ir.callErrorFromStatus)(E,b))}I=null,h.emit("status",E)}}}),h}checkMetadataAndOptions(e,t){let i,r;return e instanceof tc.Metadata?(i=e,t?r=t:r={}):(e?r=e:r={},i=new tc.Metadata),{metadata:i,options:r}}makeServerStreamRequest(e,t,i,r,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:i},d={argument:r,metadata:c.metadata,call:new Ir.ClientReadableStreamImpl(i),channel:this[Zi],methodDefinition:u,callOptions:c.options};this[ns]&&(d=this[ns](d));let h=d.call,f={clientInterceptors:this[nc],clientInterceptorProviders:this[ic],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},g=(0,Em.getInterceptingCall)(f,d.methodDefinition,d.callOptions,d.channel);h.call=g;let _=!1,S=new Error;return g.start(d.metadata,{onReceiveMetadata(I){h.emit("metadata",I)},onReceiveMessage(I){h.push(I)},onReceiveStatus(I){if(!_){if(_=!0,h.push(null),I.code!==Zs.Status.OK){let E=rc(S);h.emit("error",(0,Ir.callErrorFromStatus)(I,E))}S=null,h.emit("status",I)}}}),g.sendMessage(r),g.halfClose(),h}makeBidiStreamRequest(e,t,i,r,s){var o,a;let l=this.checkMetadataAndOptions(r,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:i},u={metadata:l.metadata,call:new Ir.ClientDuplexStreamImpl(t,i),channel:this[Zi],methodDefinition:c,callOptions:l.options};this[ns]&&(u=this[ns](u));let d=u.call,h={clientInterceptors:this[nc],clientInterceptorProviders:this[ic],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},f=(0,Em.getInterceptingCall)(h,u.methodDefinition,u.callOptions,u.channel);d.call=f;let g=!1,_=new Error;return f.start(u.metadata,{onReceiveMetadata(S){d.emit("metadata",S)},onReceiveMessage(S){d.push(S)},onReceiveStatus(S){if(!g){if(g=!0,d.push(null),S.code!==Zs.Status.OK){let I=rc(_);d.emit("error",(0,Ir.callErrorFromStatus)(S,I))}_=null,d.emit("status",S)}}}),d}};Cm.Client=SS});var TS=j(sc=>{"use strict";Object.defineProperty(sc,"__esModule",{value:!0});sc.loadPackageDefinition=sc.makeClientConstructor=void 0;var Gd=bS(),$9={unary:Gd.Client.prototype.makeUnaryRequest,server_stream:Gd.Client.prototype.makeServerStreamRequest,client_stream:Gd.Client.prototype.makeClientStreamRequest,bidi:Gd.Client.prototype.makeBidiStreamRequest};function CS(n){return["__proto__","prototype","constructor"].includes(n)}function LR(n,e,t){t||(t={});class i extends Gd.Client{}return Object.keys(n).forEach(r=>{if(CS(r))return;let s=n[r],o;if(typeof r=="string"&&r.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=j9($9[o],s.path,a,l);i.prototype[r]=c,Object.assign(i.prototype[r],s),s.originalName&&!CS(s.originalName)&&(i.prototype[s.originalName]=i.prototype[r])}),i.service=n,i.serviceName=e,i}sc.makeClientConstructor=LR;function j9(n,e,t,i){return function(...r){return n.call(this,e,t,i,...r)}}function G9(n){return"format"in n}function H9(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t],r=t.split(".");if(r.some(a=>CS(a)))continue;let s=r[r.length-1],o=e;for(let a of r.slice(0,-1))o[a]||(o[a]={}),o=o[a];G9(i)?o[s]=i:o[s]=LR(i,s,{})}return e}sc.loadPackageDefinition=H9});var a2=j((Zde,o2)=>{"use strict";var W9=1/0,K9="[object Symbol]",Y9=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Q9=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xm="\\ud800-\\udfff",jR="\\u0300-\\u036f\\ufe20-\\ufe23",GR="\\u20d0-\\u20f0",HR="\\u2700-\\u27bf",WR="a-z\\xdf-\\xf6\\xf8-\\xff",X9="\\xac\\xb1\\xd7\\xf7",J9="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Z9="\\u2000-\\u206f",ej=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",KR="A-Z\\xc0-\\xd6\\xd8-\\xde",YR="\\ufe0e\\ufe0f",QR=X9+J9+Z9+ej,IS="['\u2019]",tj="["+xm+"]",FR="["+QR+"]",Tm="["+jR+GR+"]",XR="\\d+",nj="["+HR+"]",JR="["+WR+"]",ZR="[^"+xm+QR+XR+HR+WR+KR+"]",xS="\\ud83c[\\udffb-\\udfff]",ij="(?:"+Tm+"|"+xS+")",e2="[^"+xm+"]",kS="(?:\\ud83c[\\udde6-\\uddff]){2}",AS="[\\ud800-\\udbff][\\udc00-\\udfff]",oc="["+KR+"]",t2="\\u200d",BR="(?:"+JR+"|"+ZR+")",rj="(?:"+oc+"|"+ZR+")",UR="(?:"+IS+"(?:d|ll|m|re|s|t|ve))?",qR="(?:"+IS+"(?:D|LL|M|RE|S|T|VE))?",n2=ij+"?",i2="["+YR+"]?",sj="(?:"+t2+"(?:"+[e2,kS,AS].join("|")+")"+i2+n2+")*",r2=i2+n2+sj,oj="(?:"+[nj,kS,AS].join("|")+")"+r2,aj="(?:"+[e2+Tm+"?",Tm,kS,AS,tj].join("|")+")",lj=RegExp(IS,"g"),cj=RegExp(Tm,"g"),uj=RegExp(xS+"(?="+xS+")|"+aj+r2,"g"),dj=RegExp([oc+"?"+JR+"+"+UR+"(?="+[FR,oc,"$"].join("|")+")",rj+"+"+qR+"(?="+[FR,oc+BR,"$"].join("|")+")",oc+"?"+BR+"+"+UR,oc+"+"+qR,XR,oj].join("|"),"g"),hj=RegExp("["+t2+xm+jR+GR+YR+"]"),fj=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,pj={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},mj=typeof global=="object"&&global&&global.Object===Object&&global,gj=typeof self=="object"&&self&&self.Object===Object&&self,yj=mj||gj||Function("return this")();function vj(n,e,t,i){var r=-1,s=n?n.length:0;for(i&&s&&(t=n[++r]);++r<s;)t=e(t,n[r],r,n);return t}function _j(n){return n.split("")}function wj(n){return n.match(Y9)||[]}function Sj(n){return function(e){return n?.[e]}}var bj=Sj(pj);function s2(n){return hj.test(n)}function Ej(n){return fj.test(n)}function Cj(n){return s2(n)?Tj(n):_j(n)}function Tj(n){return n.match(uj)||[]}function xj(n){return n.match(dj)||[]}var Ij=Object.prototype,kj=Ij.toString,zR=yj.Symbol,VR=zR?zR.prototype:void 0,$R=VR?VR.toString:void 0;function Aj(n,e,t){var i=-1,r=n.length;e<0&&(e=-e>r?0:r+e),t=t>r?r:t,t<0&&(t+=r),r=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(r);++i<r;)s[i]=n[i+e];return s}function Dj(n){if(typeof n=="string")return n;if(Nj(n))return $R?$R.call(n):"";var e=n+"";return e=="0"&&1/n==-W9?"-0":e}function Pj(n,e,t){var i=n.length;return t=t===void 0?i:t,!e&&t>=i?n:Aj(n,e,t)}function Rj(n){return function(e){e=Im(e);var t=s2(e)?Cj(e):void 0,i=t?t[0]:e.charAt(0),r=t?Pj(t,1).join(""):e.slice(1);return i[n]()+r}}function Mj(n){return function(e){return vj(qj(Bj(e).replace(lj,"")),n,"")}}function Oj(n){return!!n&&typeof n=="object"}function Nj(n){return typeof n=="symbol"||Oj(n)&&kj.call(n)==K9}function Im(n){return n==null?"":Dj(n)}var Lj=Mj(function(n,e,t){return e=e.toLowerCase(),n+(t?Fj(e):e)});function Fj(n){return Uj(Im(n).toLowerCase())}function Bj(n){return n=Im(n),n&&n.replace(Q9,bj).replace(cj,"")}var Uj=Rj("toUpperCase");function qj(n,e,t){return n=Im(n),e=t?void 0:e,e===void 0?Ej(n)?xj(n):wj(n):n.match(e)||[]}o2.exports=Lj});var DS=j((ehe,l2)=>{"use strict";l2.exports=zj;function zj(n,e){for(var t=new Array(arguments.length-1),i=0,r=2,s=!0;r<arguments.length;)t[i++]=arguments[r++];return new Promise(function(a,l){t[i]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h++]=arguments[h];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var h2=j(d2=>{"use strict";var km=d2;km.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&e.charAt(t)==="=";)++i;return Math.ceil(e.length*3)/4-i};var ac=new Array(64),u2=new Array(123);for(er=0;er<64;)u2[ac[er]=er<26?er+65:er<52?er+71:er<62?er-4:er-59|43]=er++;var er;km.encode=function(e,t,i){for(var r=null,s=[],o=0,a=0,l;t<i;){var c=e[t++];switch(a){case 0:s[o++]=ac[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=ac[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=ac[l|c>>6],s[o++]=ac[c&63],a=0;break}o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=ac[l],s[o++]=61,a===1&&(s[o++]=61)),r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var c2="invalid encoding";km.decode=function(e,t,i){for(var r=i,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=u2[l])===void 0)throw Error(c2);switch(s){case 0:o=l,s=1;break;case 1:t[i++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[i++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[i++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(c2);return i-r};km.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var p2=j((nhe,f2)=>{"use strict";f2.exports=Am;function Am(){this._listeners={}}Am.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this};Am.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var i=this._listeners[e],r=0;r<i.length;)i[r].fn===t?i.splice(r,1):++r;return this};Am.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,i)}return this}});var S2=j((ihe,w2)=>{"use strict";w2.exports=m2(m2);function m2(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),i=t[3]===128;function r(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=i?r:s,n.writeFloatBE=i?s:r;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=i?o:a,n.readFloatBE=i?a:o}():function(){function e(i,r,s,o){var a=r<0?1:0;if(a&&(r=-r),r===0)i(1/r>0?0:2147483648,s,o);else if(isNaN(r))i(2143289344,s,o);else if(r>34028234663852886e22)i((a<<31|2139095040)>>>0,s,o);else if(r<11754943508222875e-54)i((a<<31|Math.round(r/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(r)/Math.LN2),c=Math.round(r*Math.pow(2,-l)*8388608)&8388607;i((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,g2),n.writeFloatBE=e.bind(null,y2);function t(i,r,s){var o=i(r,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,v2),n.readFloatBE=t.bind(null,_2)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),i=t[7]===128;function r(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=i?r:s,n.writeDoubleBE=i?s:r;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=i?o:a,n.readDoubleBE=i?a:o}():function(){function e(i,r,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)i(0,a,l+r),i(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))i(0,a,l+r),i(2146959360,a,l+s);else if(o>17976931348623157e292)i(0,a,l+r),i((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,i(u>>>0,a,l+r),i((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),i(u*4503599627370496>>>0,a,l+r),i((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,g2,0,4),n.writeDoubleBE=e.bind(null,y2,4,0);function t(i,r,s,o,a){var l=i(o,a+r),c=i(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,h=4294967296*(c&1048575)+l;return d===2047?h?NaN:u*(1/0):d===0?u*5e-324*h:u*Math.pow(2,d-1075)*(h+4503599627370496)}n.readDoubleLE=t.bind(null,v2,0,4),n.readDoubleBE=t.bind(null,_2,4,0)}(),n}function g2(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function y2(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function v2(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function _2(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var PS=j((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var E2=j(b2=>{"use strict";var RS=b2;RS.length=function(e){for(var t=0,i=0,r=0;r<e.length;++r)i=e.charCodeAt(r),i<128?t+=1:i<2048?t+=2:(i&64512)===55296&&(e.charCodeAt(r+1)&64512)===56320?(++r,t+=4):t+=3;return t};RS.read=function(e,t,i){var r=i-t;if(r<1)return"";for(var s=null,o=[],a=0,l;t<i;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};RS.write=function(e,t,i){for(var r=i,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=s&63|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=s&63|128);return i-r}});var T2=j((she,C2)=>{"use strict";C2.exports=Vj;function Vj(n,e,t){var i=t||8192,r=i>>>1,s=null,o=i;return function(l){if(l<1||l>r)return n(l);o+l>i&&(s=n(i),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var I2=j((ohe,x2)=>{"use strict";x2.exports=pn;var Hd=kr();function pn(n,e){this.lo=n>>>0,this.hi=e>>>0}var ba=pn.zero=new pn(0,0);ba.toNumber=function(){return 0};ba.zzEncode=ba.zzDecode=function(){return this};ba.length=function(){return 1};var $j=pn.zeroHash="\0\0\0\0\0\0\0\0";pn.fromNumber=function(e){if(e===0)return ba;var t=e<0;t&&(e=-e);var i=e>>>0,r=(e-i)/4294967296>>>0;return t&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new pn(i,r)};pn.from=function(e){if(typeof e=="number")return pn.fromNumber(e);if(Hd.isString(e))if(Hd.Long)e=Hd.Long.fromString(e);else return pn.fromNumber(parseInt(e,10));return e.low||e.high?new pn(e.low>>>0,e.high>>>0):ba};pn.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296};pn.prototype.toLong=function(e){return Hd.Long?new Hd.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var eo=String.prototype.charCodeAt;pn.fromHash=function(e){return e===$j?ba:new pn((eo.call(e,0)|eo.call(e,1)<<8|eo.call(e,2)<<16|eo.call(e,3)<<24)>>>0,(eo.call(e,4)|eo.call(e,5)<<8|eo.call(e,6)<<16|eo.call(e,7)<<24)>>>0)};pn.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};pn.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};pn.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};pn.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}});var kr=j(MS=>{"use strict";var Ee=MS;Ee.asPromise=DS();Ee.base64=h2();Ee.EventEmitter=p2();Ee.float=S2();Ee.inquire=PS();Ee.utf8=E2();Ee.pool=T2();Ee.LongBits=I2();Ee.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);Ee.global=Ee.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||MS;Ee.emptyArray=Object.freeze?Object.freeze([]):[];Ee.emptyObject=Object.freeze?Object.freeze({}):{};Ee.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Ee.isString=function(e){return typeof e=="string"||e instanceof String};Ee.isObject=function(e){return e&&typeof e=="object"};Ee.isset=Ee.isSet=function(e,t){var i=e[t];return i!=null&&e.hasOwnProperty(t)?typeof i!="object"||(Array.isArray(i)?i.length:Object.keys(i).length)>0:!1};Ee.Buffer=function(){try{var n=Ee.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();Ee._Buffer_from=null;Ee._Buffer_allocUnsafe=null;Ee.newBuffer=function(e){return typeof e=="number"?Ee.Buffer?Ee._Buffer_allocUnsafe(e):new Ee.Array(e):Ee.Buffer?Ee._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Ee.Array=typeof Uint8Array<"u"?Uint8Array:Array;Ee.Long=Ee.global.dcodeIO&&Ee.global.dcodeIO.Long||Ee.global.Long||Ee.inquire("long");Ee.key2Re=/^true|false|0|1$/;Ee.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Ee.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Ee.longToHash=function(e){return e?Ee.LongBits.from(e).toHash():Ee.LongBits.zeroHash};Ee.longFromHash=function(e,t){var i=Ee.LongBits.fromHash(e);return Ee.Long?Ee.Long.fromBits(i.lo,i.hi,t):i.toNumber(!!t)};function k2(n,e,t){for(var i=Object.keys(e),r=0;r<i.length;++r)(n[i[r]]===void 0||!t)&&(n[i[r]]=e[i[r]]);return n}Ee.merge=k2;Ee.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function A2(n){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),i&&k2(this,i)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Ee.newError=A2;Ee.ProtocolError=A2("ProtocolError");Ee.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var r=Object.keys(this),s=r.length-1;s>-1;--s)if(t[r[s]]===1&&this[r[s]]!==void 0&&this[r[s]]!==null)return r[s]}};Ee.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}};Ee.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Ee._configure=function(){var n=Ee.Buffer;if(!n){Ee._Buffer_from=Ee._Buffer_allocUnsafe=null;return}Ee._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,i){return new n(t,i)},Ee._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Pm=j((lhe,M2)=>{"use strict";M2.exports=Ze;var Li=kr(),OS,Dm=Li.LongBits,D2=Li.base64,P2=Li.utf8;function Wd(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function LS(){}function jj(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function Ze(){this.len=0,this.head=new Wd(LS,0,0),this.tail=this.head,this.states=null}var R2=function(){return Li.Buffer?function(){return(Ze.create=function(){return new OS})()}:function(){return new Ze}};Ze.create=R2();Ze.alloc=function(e){return new Li.Array(e)};Li.Array!==Array&&(Ze.alloc=Li.pool(Ze.alloc,Li.Array.prototype.subarray));Ze.prototype._push=function(e,t,i){return this.tail=this.tail.next=new Wd(e,t,i),this.len+=t,this};function FS(n,e,t){e[t]=n&255}function Gj(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function BS(n,e){this.len=n,this.next=void 0,this.val=e}BS.prototype=Object.create(Wd.prototype);BS.prototype.fn=Gj;Ze.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new BS((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Ze.prototype.int32=function(e){return e<0?this._push(US,10,Dm.fromNumber(e)):this.uint32(e)};Ze.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function US(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}Ze.prototype.uint64=function(e){var t=Dm.from(e);return this._push(US,t.length(),t)};Ze.prototype.int64=Ze.prototype.uint64;Ze.prototype.sint64=function(e){var t=Dm.from(e).zzEncode();return this._push(US,t.length(),t)};Ze.prototype.bool=function(e){return this._push(FS,1,e?1:0)};function NS(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}Ze.prototype.fixed32=function(e){return this._push(NS,4,e>>>0)};Ze.prototype.sfixed32=Ze.prototype.fixed32;Ze.prototype.fixed64=function(e){var t=Dm.from(e);return this._push(NS,4,t.lo)._push(NS,4,t.hi)};Ze.prototype.sfixed64=Ze.prototype.fixed64;Ze.prototype.float=function(e){return this._push(Li.float.writeFloatLE,4,e)};Ze.prototype.double=function(e){return this._push(Li.float.writeDoubleLE,8,e)};var Hj=Li.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var r=0;r<e.length;++r)t[i+r]=e[r]};Ze.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(FS,1,0);if(Li.isString(e)){var i=Ze.alloc(t=D2.length(e));D2.decode(e,i,0),e=i}return this.uint32(t)._push(Hj,t,e)};Ze.prototype.string=function(e){var t=P2.length(e);return t?this.uint32(t)._push(P2.write,t,e):this._push(FS,1,0)};Ze.prototype.fork=function(){return this.states=new jj(this),this.head=this.tail=new Wd(LS,0,0),this.len=0,this};Ze.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Wd(LS,0,0),this.len=0),this};Ze.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this};Ze.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t};Ze._configure=function(n){OS=n,Ze.create=R2(),OS._configure()}});var L2=j((che,N2)=>{"use strict";N2.exports=Ar;var O2=Pm();(Ar.prototype=Object.create(O2.prototype)).constructor=Ar;var to=kr();function Ar(){O2.call(this)}Ar._configure=function(){Ar.alloc=to._Buffer_allocUnsafe,Ar.writeBytesBuffer=to.Buffer&&to.Buffer.prototype instanceof Uint8Array&&to.Buffer.prototype.set.name==="set"?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var r=0;r<e.length;)t[i++]=e[r++]}};Ar.prototype.bytes=function(e){to.isString(e)&&(e=to._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Ar.writeBytesBuffer,t,e),this};function Wj(n,e,t){n.length<40?to.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Ar.prototype.string=function(e){var t=to.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Wj,t,e),this};Ar._configure()});var Mm=j((uhe,z2)=>{"use strict";z2.exports=Vt;var tr=kr(),zS,U2=tr.LongBits,Kj=tr.utf8;function nr(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Vt(n){this.buf=n,this.pos=0,this.len=n.length}var F2=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Vt(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Vt(e);throw Error("illegal buffer")},q2=function(){return tr.Buffer?function(t){return(Vt.create=function(r){return tr.Buffer.isBuffer(r)?new zS(r):F2(r)})(t)}:F2};Vt.create=q2();Vt.prototype._slice=tr.Array.prototype.subarray||tr.Array.prototype.slice;Vt.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,nr(this,10);return e}}();Vt.prototype.int32=function(){return this.uint32()|0};Vt.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function qS(){var n=new U2(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw nr(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw nr(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Vt.prototype.bool=function(){return this.uint32()!==0};function Rm(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Vt.prototype.fixed32=function(){if(this.pos+4>this.len)throw nr(this,4);return Rm(this.buf,this.pos+=4)};Vt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw nr(this,4);return Rm(this.buf,this.pos+=4)|0};function B2(){if(this.pos+8>this.len)throw nr(this,8);return new U2(Rm(this.buf,this.pos+=4),Rm(this.buf,this.pos+=4))}Vt.prototype.float=function(){if(this.pos+4>this.len)throw nr(this,4);var e=tr.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Vt.prototype.double=function(){if(this.pos+8>this.len)throw nr(this,4);var e=tr.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Vt.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw nr(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,i);if(t===i){var r=tr.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,i)};Vt.prototype.string=function(){var e=this.bytes();return Kj.read(e,0,e.length)};Vt.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw nr(this,e);this.pos+=e}else do if(this.pos>=this.len)throw nr(this);while(this.buf[this.pos++]&128);return this};Vt.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Vt._configure=function(n){zS=n,Vt.create=q2(),zS._configure();var e=tr.Long?"toLong":"toNumber";tr.merge(Vt.prototype,{int64:function(){return qS.call(this)[e](!1)},uint64:function(){return qS.call(this)[e](!0)},sint64:function(){return qS.call(this).zzDecode()[e](!1)},fixed64:function(){return B2.call(this)[e](!0)},sfixed64:function(){return B2.call(this)[e](!1)}})}});var G2=j((dhe,j2)=>{"use strict";j2.exports=Ea;var $2=Mm();(Ea.prototype=Object.create($2.prototype)).constructor=Ea;var V2=kr();function Ea(n){$2.call(this,n)}Ea._configure=function(){V2.Buffer&&(Ea.prototype._slice=V2.Buffer.prototype.slice)};Ea.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ea._configure()});var W2=j((hhe,H2)=>{"use strict";H2.exports=Kd;var VS=kr();(Kd.prototype=Object.create(VS.EventEmitter.prototype)).constructor=Kd;function Kd(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");VS.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Kd.prototype.rpcCall=function n(e,t,i,r,s){if(!r)throw TypeError("request must be specified");var o=this;if(!s)return VS.asPromise(n,o,e,t,i,r);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof i))try{c=i[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Kd.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var $S=j(K2=>{"use strict";var Yj=K2;Yj.Service=W2()});var jS=j((phe,Y2)=>{"use strict";Y2.exports={}});var J2=j(X2=>{"use strict";var Qn=X2;Qn.build="minimal";Qn.Writer=Pm();Qn.BufferWriter=L2();Qn.Reader=Mm();Qn.BufferReader=G2();Qn.util=kr();Qn.rpc=$S();Qn.roots=jS();Qn.configure=Q2;function Q2(){Qn.util._configure(),Qn.Writer._configure(Qn.BufferWriter),Qn.Reader._configure(Qn.BufferReader)}Q2()});var eM=j((ghe,Z2)=>{"use strict";Z2.exports=GS;function GS(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function i(s){if(typeof s!="string"){var o=r();if(GS.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h]=arguments[++h];if(h=0,s=s.replace(/%([%dfijs])/g,function(g,_){var S=d[h++];switch(_){case"d":case"f":return String(Number(S));case"i":return String(Math.floor(S));case"j":return JSON.stringify(S);case"s":return String(S)}return"%"}),h!==d.length)throw Error("parameter count mismatch");return t.push(s),i}function r(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return i.toString=r,i}GS.verbose=!1});var nM=j((yhe,tM)=>{"use strict";tM.exports=Yd;var Qj=DS(),Xj=PS(),HS=Xj("fs");function Yd(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&HS&&HS.readFile?HS.readFile(n,function(r,s){return r&&typeof XMLHttpRequest<"u"?Yd.xhr(n,e,t):r?t(r):t(null,e.binary?s:s.toString("utf8"))}):Yd.xhr(n,e,t):Qj(Yd,this,n,e)}Yd.xhr=function(e,t,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===4){if(r.status!==0&&r.status!==200)return i(Error("status "+r.status));if(t.binary){var o=r.response;if(!o){o=[];for(var a=0;a<r.responseText.length;++a)o.push(r.responseText.charCodeAt(a)&255)}return i(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return i(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}});var sM=j(rM=>{"use strict";var KS=rM,iM=KS.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},WS=KS.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),i=iM(e),r="";i&&(r=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):i?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return r+t.join("/")};KS.resolve=function(e,t,i){return i||(t=WS(t)),iM(t)?t:(i||(e=WS(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?WS(e+"/"+t):t)}});var Ca=j(oM=>{"use strict";var Qd=oM,Jj=mn(),Zj=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Xd(n,e){var t=0,i={};for(e|=0;t<n.length;)i[Zj[t+e]]=n[t++];return i}Qd.basic=Xd([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Qd.defaults=Xd([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",Jj.emptyArray,null]);Qd.long=Xd([0,0,0,1,1],7);Qd.mapKey=Xd([0,0,0,5,5,0,0,0,1,1,0,2],2);Qd.packed=Xd([1,5,0,0,0,5,5,0,0,0,1,1,0])});var no=j((whe,cM)=>{"use strict";cM.exports=Fi;var Om=Ta();((Fi.prototype=Object.create(Om.prototype)).constructor=Fi).className="Field";var aM=ir(),lM=Ca(),Qt=mn(),YS,eG=/^required|optional|repeated$/;Fi.fromJSON=function(e,t){return new Fi(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Fi(n,e,t,i,r,s,o){if(Qt.isObject(i)?(o=r,s=i,i=r=void 0):Qt.isObject(r)&&(o=s,s=r,r=void 0),Om.call(this,n,s),!Qt.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Qt.isString(t))throw TypeError("type must be a string");if(i!==void 0&&!eG.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(r!==void 0&&!Qt.isString(r))throw TypeError("extend must be a string");i==="proto3_optional"&&(i="optional"),this.rule=i&&i!=="optional"?i:void 0,this.type=t,this.id=e,this.extend=r||void 0,this.required=i==="required",this.optional=!this.required,this.repeated=i==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Qt.Long?lM.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Fi.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Fi.prototype.setOption=function(e,t,i){return e==="packed"&&(this._packed=null),Om.prototype.setOption.call(this,e,t,i)};Fi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Qt.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Fi.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=lM.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof YS?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof aM&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof aM))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Qt.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Qt.base64.test(this.typeDefault)?Qt.base64.decode(this.typeDefault,e=Qt.newBuffer(Qt.base64.length(this.typeDefault)),0):Qt.utf8.write(this.typeDefault,e=Qt.newBuffer(Qt.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Qt.emptyObject:this.repeated?this.defaultValue=Qt.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof YS&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Om.prototype.resolve.call(this)};Fi.d=function(e,t,i,r){return typeof t=="function"?t=Qt.decorateType(t).name:t&&typeof t=="object"&&(t=Qt.decorateEnum(t).name),function(o,a){Qt.decorateType(o.constructor).add(new Fi(a,e,t,i,{default:r}))}};Fi._configure=function(e){YS=e}});var lc=j((She,hM)=>{"use strict";hM.exports=Bi;var Lm=Ta();((Bi.prototype=Object.create(Lm.prototype)).constructor=Bi).className="OneOf";var uM=no(),Nm=mn();function Bi(n,e,t,i){if(Array.isArray(e)||(t=e,e=void 0),Lm.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=i}Bi.fromJSON=function(e,t){return new Bi(e,t.oneof,t.options,t.comment)};Bi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Nm.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function dM(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Bi.prototype.add=function(e){if(!(e instanceof uM))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,dM(this),this};Bi.prototype.remove=function(e){if(!(e instanceof uM))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Bi.prototype.onAdd=function(e){Lm.prototype.onAdd.call(this,e);for(var t=this,i=0;i<this.oneof.length;++i){var r=e.get(this.oneof[i]);r&&!r.partOf&&(r.partOf=t,t.fieldsArray.push(r))}dM(this)};Bi.prototype.onRemove=function(e){for(var t=0,i;t<this.fieldsArray.length;++t)(i=this.fieldsArray[t]).parent&&i.parent.remove(i);Lm.prototype.onRemove.call(this,e)};Bi.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(r,s){Nm.decorateType(r.constructor).add(new Bi(s,e)),Object.defineProperty(r,s,{get:Nm.oneOfGetter(e),set:Nm.oneOfSetter(e)})}}});var dc=j((bhe,gM)=>{"use strict";gM.exports=nt;var QS=Ta();((nt.prototype=Object.create(QS.prototype)).constructor=nt).className="Namespace";var fM=no(),Fm=mn(),tG=lc(),cc,Jd,uc;nt.fromJSON=function(e,t){return new nt(e,t.options).addJSON(t.nested)};function pM(n,e){if(n&&n.length){for(var t={},i=0;i<n.length;++i)t[n[i].name]=n[i].toJSON(e);return t}}nt.arrayToJSON=pM;nt.isReservedId=function(e,t){if(e){for(var i=0;i<e.length;++i)if(typeof e[i]!="string"&&e[i][0]<=t&&e[i][1]>t)return!0}return!1};nt.isReservedName=function(e,t){if(e){for(var i=0;i<e.length;++i)if(e[i]===t)return!0}return!1};function nt(n,e){QS.call(this,n,e),this.nested=void 0,this._nestedArray=null}function mM(n){return n._nestedArray=null,n}Object.defineProperty(nt.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Fm.toArray(this.nested))}});nt.prototype.toJSON=function(e){return Fm.toObject(["options",this.options,"nested",pM(this.nestedArray,e)])};nt.prototype.addJSON=function(e){var t=this;if(e)for(var i=Object.keys(e),r=0,s;r<i.length;++r)s=e[i[r]],t.add((s.fields!==void 0?cc.fromJSON:s.values!==void 0?uc.fromJSON:s.methods!==void 0?Jd.fromJSON:s.id!==void 0?fM.fromJSON:nt.fromJSON)(i[r],s));return this};nt.prototype.get=function(e){return this.nested&&this.nested[e]||null};nt.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof uc)return this.nested[e].values;throw Error("no such enum: "+e)};nt.prototype.add=function(e){if(!(e instanceof fM&&e.extend!==void 0||e instanceof cc||e instanceof tG||e instanceof uc||e instanceof Jd||e instanceof nt))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof nt&&e instanceof nt&&!(t instanceof cc||t instanceof Jd)){for(var i=t.nestedArray,r=0;r<i.length;++r)e.add(i[r]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),mM(this)};nt.prototype.remove=function(e){if(!(e instanceof QS))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),mM(this)};nt.prototype.define=function(e,t){if(Fm.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var i=this;e.length>0;){var r=e.shift();if(i.nested&&i.nested[r]){if(i=i.nested[r],!(i instanceof nt))throw Error("path conflicts with non-namespace objects")}else i.add(i=new nt(r))}return t&&i.addJSON(t),i};nt.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof nt?e[t++].resolveAll():e[t++].resolve();return this.resolve()};nt.prototype.lookup=function(e,t,i){if(typeof t=="boolean"?(i=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Fm.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(e.length===1){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof nt&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof nt&&(r=this._nestedArray[s].lookup(e,t,!0)))return r;return this.parent===null||i?null:this.parent.lookup(e,t)};nt.prototype.lookupType=function(e){var t=this.lookup(e,[cc]);if(!t)throw Error("no such type: "+e);return t};nt.prototype.lookupEnum=function(e){var t=this.lookup(e,[uc]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};nt.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[cc,uc]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};nt.prototype.lookupService=function(e){var t=this.lookup(e,[Jd]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};nt._configure=function(n,e,t){cc=n,Jd=e,uc=t}});var Bm=j((Ehe,yM)=>{"use strict";yM.exports=is;var XS=no();((is.prototype=Object.create(XS.prototype)).constructor=is).className="MapField";var nG=Ca(),Zd=mn();function is(n,e,t,i,r,s){if(XS.call(this,n,e,i,void 0,void 0,r,s),!Zd.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}is.fromJSON=function(e,t){return new is(e,t.id,t.keyType,t.type,t.options,t.comment)};is.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Zd.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};is.prototype.resolve=function(){if(this.resolved)return this;if(nG.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return XS.prototype.resolve.call(this)};is.d=function(e,t,i){return typeof i=="function"?i=Zd.decorateType(i).name:i&&typeof i=="object"&&(i=Zd.decorateEnum(i).name),function(s,o){Zd.decorateType(s.constructor).add(new is(o,e,t,i))}}});var Um=j((Che,vM)=>{"use strict";vM.exports=xa;var JS=Ta();((xa.prototype=Object.create(JS.prototype)).constructor=xa).className="Method";var hc=mn();function xa(n,e,t,i,r,s,o,a,l){if(hc.isObject(r)?(o=r,r=s=void 0):hc.isObject(s)&&(o=s,s=void 0),!(e===void 0||hc.isString(e)))throw TypeError("type must be a string");if(!hc.isString(t))throw TypeError("requestType must be a string");if(!hc.isString(i))throw TypeError("responseType must be a string");JS.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=r?!0:void 0,this.responseType=i,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}xa.fromJSON=function(e,t){return new xa(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};xa.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return hc.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};xa.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),JS.prototype.resolve.call(this))}});var qm=j((The,wM)=>{"use strict";wM.exports=Ui;var io=dc();((Ui.prototype=Object.create(io.prototype)).constructor=Ui).className="Service";var ZS=Um(),eh=mn(),iG=$S();function Ui(n,e){io.call(this,n,e),this.methods={},this._methodsArray=null}Ui.fromJSON=function(e,t){var i=new Ui(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)i.add(ZS.fromJSON(r[s],t.methods[r[s]]));return t.nested&&i.addJSON(t.nested),i.comment=t.comment,i};Ui.prototype.toJSON=function(e){var t=io.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return eh.toObject(["options",t&&t.options||void 0,"methods",io.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};Object.defineProperty(Ui.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=eh.toArray(this.methods))}});function _M(n){return n._methodsArray=null,n}Ui.prototype.get=function(e){return this.methods[e]||io.prototype.get.call(this,e)};Ui.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return io.prototype.resolve.call(this)};Ui.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof ZS?(this.methods[e.name]=e,e.parent=this,_M(this)):io.prototype.add.call(this,e)};Ui.prototype.remove=function(e){if(e instanceof ZS){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,_M(this)}return io.prototype.remove.call(this,e)};Ui.prototype.create=function(e,t,i){for(var r=new iG.Service(e,t,i),s=0,o;s<this.methodsArray.length;++s){var a=eh.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");r[a]=eh.codegen(["r","c"],eh.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return r}});var zm=j((xhe,SM)=>{"use strict";SM.exports=Dr;var rG=kr();function Dr(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Dr.create=function(e){return this.$type.create(e)};Dr.encode=function(e,t){return this.$type.encode(e,t)};Dr.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Dr.decode=function(e){return this.$type.decode(e)};Dr.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Dr.verify=function(e){return this.$type.verify(e)};Dr.fromObject=function(e){return this.$type.fromObject(e)};Dr.toObject=function(e,t){return this.$type.toObject(e,t)};Dr.prototype.toJSON=function(){return this.$type.toObject(this,rG.toJSONOptions)}});var eb=j((Ihe,EM)=>{"use strict";EM.exports=aG;var sG=ir(),rs=Ca(),bM=mn();function oG(n){return"missing required '"+n.name+"'"}function aG(n){var e=bM.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var i=n._fieldsArray[t].resolve(),r=i.resolvedType instanceof sG?"int32":i.type,s="m"+bM.safeProp(i.name);e("case %i: {",i.id),i.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),rs.defaults[i.keyType]!==void 0?e("k=%j",rs.defaults[i.keyType]):e("k=null"),rs.defaults[r]!==void 0?e("value=%j",rs.defaults[r]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",i.keyType)("case 2:"),rs.basic[r]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",r),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),rs.long[i.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):i.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),rs.packed[r]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),rs.basic[r]===void 0?e(i.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,r)):rs.basic[r]===void 0?e(i.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,r),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",oG(o))}return e("return m")}});var ib=j((khe,CM)=>{"use strict";CM.exports=uG;var lG=ir(),tb=mn();function qi(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function nb(n,e,t,i){if(e.resolvedType)if(e.resolvedType instanceof lG){n("switch(%s){",i)("default:")("return%j",qi(e,"enum value"));for(var r=Object.keys(e.resolvedType.values),s=0;s<r.length;++s)n("case %i:",e.resolvedType.values[r[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,i)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",i)("return%j",qi(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",qi(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',i)("return%j",qi(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',i)("return%j",qi(e,"boolean"));break;case"string":n("if(!util.isString(%s))",i)("return%j",qi(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",qi(e,"buffer"));break}return n}function cG(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",qi(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",qi(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",qi(e,"boolean key"));break}return n}function uG(n){var e=tb.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,i={};t.length&&e("var p={}");for(var r=0;r<n.fieldsArray.length;++r){var s=n._fieldsArray[r].resolve(),o="m"+tb.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",qi(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),cG(e,s,"k[i]"),nb(e,s,r,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",qi(s,"array"))("for(var i=0;i<%s.length;++i){",o),nb(e,s,r,o+"[i]")("}");else{if(s.partOf){var a=tb.safeProp(s.partOf.name);i[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),i[s.partOf.name]=1,e("p%s=1",a)}nb(e,s,r,o)}s.optional&&e("}")}return e("return null")}});var ob=j(xM=>{"use strict";var TM=xM,th=ir(),Pr=mn();function rb(n,e,t,i){var r=!1;if(e.resolvedType)if(e.resolvedType instanceof th){n("switch(d%s){",i);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!r&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',i,i,i),e.repeated||n("break"),r=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",i,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',i)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,t,i);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",i,i);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,l)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length >= 0)",i)("m%s=d%s",i,i);break;case"string":n("m%s=String(d%s)",i,i);break;case"bool":n("m%s=Boolean(d%s)",i,i);break}}return n}TM.fromObject=function(e){var t=e.fieldsArray,i=Pr.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return i("return new this.ctor");i("var m=new this.ctor");for(var r=0;r<t.length;++r){var s=t[r].resolve(),o=Pr.safeProp(s.name);s.map?(i("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),rb(i,s,r,o+"[ks[i]]")("}")("}")):s.repeated?(i("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),rb(i,s,r,o+"[i]")("}")("}")):(s.resolvedType instanceof th||i("if(d%s!=null){",o),rb(i,s,r,o),s.resolvedType instanceof th||i("}"))}return i("return m")};function sb(n,e,t,i){if(e.resolvedType)e.resolvedType instanceof th?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",i,t,i,i,t,i,i):n("d%s=types[%i].toObject(m%s,o)",i,t,i);else{var r=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":r=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,r?"true":"",i);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:n("d%s=m%s",i,i);break}}return n}TM.toObject=function(e){var t=e.fieldsArray.slice().sort(Pr.compareFieldsById);if(!t.length)return Pr.codegen()("return {}");for(var i=Pr.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?r:t[a].map?s:o).push(t[a]);if(r.length){for(i("if(o.arrays||o.defaults){"),a=0;a<r.length;++a)i("d%s=[]",Pr.safeProp(r[a].name));i("}")}if(s.length){for(i("if(o.objects||o.defaults){"),a=0;a<s.length;++a)i("d%s={}",Pr.safeProp(s[a].name));i("}")}if(o.length){for(i("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Pr.safeProp(l.name);if(l.resolvedType instanceof th)i("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";i("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else i("d%s=%j",c,l.typeDefault)}i("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],h=e._fieldsArray.indexOf(l),c=Pr.safeProp(l.name);l.map?(d||(d=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),sb(i,l,h,c+"[ks2[j]]")("}")):l.repeated?(i("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),sb(i,l,h,c+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),sb(i,l,h,c),l.partOf&&i("if(o.oneofs)")("d%s=%j",Pr.safeProp(l.partOf.name),l.name)),i("}")}return i("return d")}});var ab=j(IM=>{"use strict";var dG=IM,hG=zm();dG[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var i=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return i.indexOf("/")===-1&&(i="/"+i),this.create({type_url:i,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",i="",r="";if(e&&e.json&&n.type_url&&n.value){r=n.type_url.substring(n.type_url.lastIndexOf("/")+1),i=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(r);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof hG){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return i===""&&(i=t),r=i+a,o["@type"]=r,o}return this.toObject(n,e)}}});var jm=j((Phe,AM)=>{"use strict";AM.exports=pt;var rr=dc();((pt.prototype=Object.create(rr.prototype)).constructor=pt).className="Type";var fG=ir(),ub=lc(),Vm=no(),pG=Bm(),mG=qm(),lb=zm(),cb=Mm(),gG=Pm(),xn=mn(),yG=db(),vG=eb(),_G=ib(),kM=ob(),wG=ab();function pt(n,e){rr.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(pt.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],i=t.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=xn.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=xn.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=pt.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof lb||((n.prototype=new lb).constructor=n,xn.merge(n.prototype,e)),n.$type=n.prototype.$type=this,xn.merge(n,lb,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var i={};for(t=0;t<this.oneofsArray.length;++t)i[this._oneofsArray[t].resolve().name]={get:xn.oneOfGetter(this._oneofsArray[t].oneof),set:xn.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,i)}}});pt.generateConstructor=function(e){for(var t=xn.codegen(["p"],e.name),i=0,r;i<e.fieldsArray.length;++i)(r=e._fieldsArray[i]).map?t("this%s={}",xn.safeProp(r.name)):r.repeated&&t("this%s=[]",xn.safeProp(r.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function $m(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}pt.fromJSON=function(e,t){var i=new pt(e,t.options);i.extensions=t.extensions,i.reserved=t.reserved;for(var r=Object.keys(t.fields),s=0;s<r.length;++s)i.add((typeof t.fields[r[s]].keyType<"u"?pG.fromJSON:Vm.fromJSON)(r[s],t.fields[r[s]]));if(t.oneofs)for(r=Object.keys(t.oneofs),s=0;s<r.length;++s)i.add(ub.fromJSON(r[s],t.oneofs[r[s]]));if(t.nested)for(r=Object.keys(t.nested),s=0;s<r.length;++s){var o=t.nested[r[s]];i.add((o.id!==void 0?Vm.fromJSON:o.fields!==void 0?pt.fromJSON:o.values!==void 0?fG.fromJSON:o.methods!==void 0?mG.fromJSON:rr.fromJSON)(r[s],o))}return t.extensions&&t.extensions.length&&(i.extensions=t.extensions),t.reserved&&t.reserved.length&&(i.reserved=t.reserved),t.group&&(i.group=!0),t.comment&&(i.comment=t.comment),i};pt.prototype.toJSON=function(e){var t=rr.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return xn.toObject(["options",t&&t.options||void 0,"oneofs",rr.arrayToJSON(this.oneofsArray,e),"fields",rr.arrayToJSON(this.fieldsArray.filter(function(r){return!r.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};pt.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var i=this.oneofsArray;for(t=0;t<i.length;)i[t++].resolve();return rr.prototype.resolveAll.call(this)};pt.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};pt.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Vm&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),$m(this)}return e instanceof ub?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),$m(this)):rr.prototype.add.call(this,e)};pt.prototype.remove=function(e){if(e instanceof Vm&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),$m(this)}if(e instanceof ub){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),$m(this)}return rr.prototype.remove.call(this,e)};pt.prototype.isReservedId=function(e){return rr.isReservedId(this.reserved,e)};pt.prototype.isReservedName=function(e){return rr.isReservedName(this.reserved,e)};pt.prototype.create=function(e){return new this.ctor(e)};pt.prototype.setup=function(){for(var e=this.fullName,t=[],i=0;i<this.fieldsArray.length;++i)t.push(this._fieldsArray[i].resolve().resolvedType);this.encode=yG(this)({Writer:gG,types:t,util:xn}),this.decode=vG(this)({Reader:cb,types:t,util:xn}),this.verify=_G(this)({types:t,util:xn}),this.fromObject=kM.fromObject(this)({types:t,util:xn}),this.toObject=kM.toObject(this)({types:t,util:xn});var r=wG[e];if(r){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(s),s.toObject=this.toObject,this.toObject=r.toObject.bind(s)}return this};pt.prototype.encode=function(e,t){return this.setup().encode(e,t)};pt.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};pt.prototype.decode=function(e,t){return this.setup().decode(e,t)};pt.prototype.decodeDelimited=function(e){return e instanceof cb||(e=cb.create(e)),this.decode(e,e.uint32())};pt.prototype.verify=function(e){return this.setup().verify(e)};pt.prototype.fromObject=function(e){return this.setup().fromObject(e)};pt.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};pt.d=function(e){return function(i){xn.decorateType(i,e)}}});var Wm=j((Rhe,OM)=>{"use strict";OM.exports=hi;var Hm=dc();((hi.prototype=Object.create(Hm.prototype)).constructor=hi).className="Root";var fb=no(),PM=ir(),SG=lc(),ro=mn(),RM,hb,nh;function hi(n){Hm.call(this,"",n),this.deferred=[],this.files=[]}hi.fromJSON=function(e,t){return t||(t=new hi),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};hi.prototype.resolvePath=ro.path.resolve;hi.prototype.fetch=ro.fetch;function MM(){}hi.prototype.load=function n(e,t,i){typeof t=="function"&&(i=t,t=void 0);var r=this;if(!i)return ro.asPromise(n,r,e,t);var s=i===MM;function o(f,g){if(i){if(s)throw f;var _=i;i=null,_(f,g)}}function a(f){var g=f.lastIndexOf("google/protobuf/");if(g>-1){var _=f.substring(g);if(_ in nh)return _}return null}function l(f,g){try{if(ro.isString(g)&&g.charAt(0)==="{"&&(g=JSON.parse(g)),!ro.isString(g))r.setOptions(g.options).addJSON(g.nested);else{hb.filename=f;var _=hb(g,r,t),S,I=0;if(_.imports)for(;I<_.imports.length;++I)(S=a(_.imports[I])||r.resolvePath(f,_.imports[I]))&&c(S);if(_.weakImports)for(I=0;I<_.weakImports.length;++I)(S=a(_.weakImports[I])||r.resolvePath(f,_.weakImports[I]))&&c(S,!0)}}catch(E){o(E)}!s&&!u&&o(null,r)}function c(f,g){if(f=a(f)||f,!(r.files.indexOf(f)>-1)){if(r.files.push(f),f in nh){s?l(f,nh[f]):(++u,setTimeout(function(){--u,l(f,nh[f])}));return}if(s){var _;try{_=ro.fs.readFileSync(f).toString("utf8")}catch(S){g||o(S);return}l(f,_)}else++u,r.fetch(f,function(S,I){if(--u,!!i){if(S){g?u||o(null,r):o(S);return}l(f,I)}})}}var u=0;ro.isString(e)&&(e=[e]);for(var d=0,h;d<e.length;++d)(h=r.resolvePath("",e[d]))&&c(h);if(s)return r;u||o(null,r)};hi.prototype.loadSync=function(e,t){if(!ro.isNode)throw Error("not supported");return this.load(e,t,MM)};hi.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Hm.prototype.resolveAll.call(this)};var Gm=/^[A-Z]/;function DM(n,e){var t=e.parent.lookup(e.extend);if(t){var i=new fb(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(i.name)||(i.declaringField=e,e.extensionField=i,t.add(i)),!0}return!1}hi.prototype._handleAdd=function(e){if(e instanceof fb)e.extend!==void 0&&!e.extensionField&&(DM(this,e)||this.deferred.push(e));else if(e instanceof PM)Gm.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof SG)){if(e instanceof RM)for(var t=0;t<this.deferred.length;)DM(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var i=0;i<e.nestedArray.length;++i)this._handleAdd(e._nestedArray[i]);Gm.test(e.name)&&(e.parent[e.name]=e)}};hi.prototype._handleRemove=function(e){if(e instanceof fb){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof PM)Gm.test(e.name)&&delete e.parent[e.name];else if(e instanceof Hm){for(var i=0;i<e.nestedArray.length;++i)this._handleRemove(e._nestedArray[i]);Gm.test(e.name)&&delete e.parent[e.name]}};hi._configure=function(n,e,t){RM=n,hb=e,nh=t}});var mn=j((Mhe,LM)=>{"use strict";var $t=LM.exports=kr(),NM=jS(),pb,mb;$t.codegen=eM();$t.fetch=nM();$t.path=sM();$t.fs=$t.inquire("fs");$t.toArray=function(e){if(e){for(var t=Object.keys(e),i=new Array(t.length),r=0;r<t.length;)i[r]=e[t[r++]];return i}return[]};$t.toObject=function(e){for(var t={},i=0;i<e.length;){var r=e[i++],s=e[i++];s!==void 0&&(t[r]=s)}return t};var bG=/\\/g,EG=/"/g;$t.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};$t.safeProp=function(e){return!/^[$\w_]+$/.test(e)||$t.isReserved(e)?'["'+e.replace(bG,"\\\\").replace(EG,'\\"')+'"]':"."+e};$t.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var CG=/_([a-z])/g;$t.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(CG,function(t,i){return i.toUpperCase()})};$t.compareFieldsById=function(e,t){return e.id-t.id};$t.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&($t.decorateRoot.remove(e.$type),e.$type.name=t,$t.decorateRoot.add(e.$type)),e.$type;pb||(pb=jm());var i=new pb(t||e.name);return $t.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var TG=0;$t.decorateEnum=function(e){if(e.$type)return e.$type;mb||(mb=ir());var t=new mb("Enum"+TG++,e);return $t.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};$t.setProperty=function(e,t,i){function r(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=r(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),r(e,t,i)};Object.defineProperty($t,"decorateRoot",{get:function(){return NM.decorated||(NM.decorated=new(Wm()))}})});var Ta=j((Ohe,FM)=>{"use strict";FM.exports=fi;fi.className="ReflectionObject";var Km=mn(),Ym;function fi(n,e){if(!Km.isString(n))throw TypeError("name must be a string");if(e&&!Km.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(fi.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});fi.prototype.toJSON=function(){throw Error()};fi.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Ym&&t._handleAdd(this)};fi.prototype.onRemove=function(e){var t=e.root;t instanceof Ym&&t._handleRemove(this),this.parent=null,this.resolved=!1};fi.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Ym&&(this.resolved=!0),this)};fi.prototype.getOption=function(e){if(this.options)return this.options[e]};fi.prototype.setOption=function(e,t,i){return(!i||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};fi.prototype.setParsedOption=function(e,t,i){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(i){var s=r.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Km.setProperty(o,i,t)}else s={},s[e]=Km.setProperty({},i,t),r.push(s)}else{var a={};a[e]=t,r.push(a)}return this};fi.prototype.setOptions=function(e,t){if(e)for(var i=Object.keys(e),r=0;r<i.length;++r)this.setOption(i[r],e[i[r]],t);return this};fi.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};fi._configure=function(n){Ym=n}});var ir=j((Nhe,qM)=>{"use strict";qM.exports=Rr;var BM=Ta();((Rr.prototype=Object.create(BM.prototype)).constructor=Rr).className="Enum";var UM=dc(),Qm=mn();function Rr(n,e,t,i,r,s){if(BM.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=r||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Rr.fromJSON=function(e,t){var i=new Rr(e,t.values,t.options,t.comment,t.comments);return i.reserved=t.reserved,i};Rr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Qm.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Rr.prototype.add=function(e,t,i,r){if(!Qm.isString(e))throw TypeError("name must be a string");if(!Qm.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=i||null,this};Rr.prototype.remove=function(e){if(!Qm.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Rr.prototype.isReservedId=function(e){return UM.isReservedId(this.reserved,e)};Rr.prototype.isReservedName=function(e){return UM.isReservedName(this.reserved,e)}});var db=j((Lhe,VM)=>{"use strict";VM.exports=IG;var xG=ir(),gb=Ca(),yb=mn();function zM(n,e,t,i){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,i,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,i,(e.id<<3|2)>>>0)}function IG(n){for(var e=yb.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,i,r=n.fieldsArray.slice().sort(yb.compareFieldsById),t=0;t<r.length;++t){var s=r[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof xG?"int32":s.type,l=gb.basic[a];i="m"+yb.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",i,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",i)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|gb.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,i):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,i),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",i,i),s.packed&&gb.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",i)("w.%s(%s[i])",a,i)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",i),l===void 0?zM(e,s,o,i+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,i)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",i,s.name),l===void 0?zM(e,s,o,i):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,i))}return e("return w")}});var jM=j((Fhe,$M)=>{"use strict";var Qe=$M.exports=J2();Qe.build="light";function kG(n,e,t){return typeof e=="function"?(t=e,e=new Qe.Root):e||(e=new Qe.Root),e.load(n,t)}Qe.load=kG;function AG(n,e){return e||(e=new Qe.Root),e.loadSync(n)}Qe.loadSync=AG;Qe.encoder=db();Qe.decoder=eb();Qe.verifier=ib();Qe.converter=ob();Qe.ReflectionObject=Ta();Qe.Namespace=dc();Qe.Root=Wm();Qe.Enum=ir();Qe.Type=jm();Qe.Field=no();Qe.OneOf=lc();Qe.MapField=Bm();Qe.Service=qm();Qe.Method=Um();Qe.Message=zm();Qe.wrappers=ab();Qe.types=Ca();Qe.util=mn();Qe.ReflectionObject._configure(Qe.Root);Qe.Namespace._configure(Qe.Type,Qe.Service,Qe.Enum);Qe.Root._configure(Qe.Type);Qe.Field._configure(Qe.Type)});var _b=j((Bhe,WM)=>{"use strict";WM.exports=HM;var vb=/[\s{}=;:[\],'"()<>]/g,DG=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,PG=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,RG=/^ *[*/]+ */,MG=/^\s*\*?\/*/,OG=/\n/g,NG=/\s/,LG=/\\(.?)/g,FG={0:"\0",r:"\r",n:`
`,t:"	"};function GM(n){return n.replace(LG,function(e,t){switch(t){case"\\":case"":return t;default:return FG[t]||""}})}HM.unescape=GM;function HM(n,e){n=n.toString();var t=0,i=n.length,r=1,s=0,o={},a=[],l=null;function c(M){return Error("illegal "+M+" (line "+r+")")}function u(){var M=l==="'"?PG:DG;M.lastIndex=t-1;var N=M.exec(n);if(!N)throw c("string");return t=M.lastIndex,S(l),l=null,GM(N[1])}function d(M){return n.charAt(M)}function h(M,N,U){var R={type:n.charAt(M++),lineEmpty:!1,leading:U},x;e?x=2:x=3;var T=M-x,A;do if(--T<0||(A=n.charAt(T))===`
`){R.lineEmpty=!0;break}while(A===" "||A==="	");for(var C=n.substring(M,N).split(OG),P=0;P<C.length;++P)C[P]=C[P].replace(e?MG:RG,"").trim();R.text=C.join(`
`).trim(),o[r]=R,s=r}function f(M){var N=g(M),U=n.substring(M,N),R=/^\s*\/\//.test(U);return R}function g(M){for(var N=M;N<i&&d(N)!==`
`;)N++;return N}function _(){if(a.length>0)return a.shift();if(l)return u();var M,N,U,R,x,T=t===0;do{if(t===i)return null;for(M=!1;NG.test(U=d(t));)if(U===`
`&&(T=!0,++r),++t===i)return null;if(d(t)==="/"){if(++t===i)throw c("comment");if(d(t)==="/")if(e){if(R=t,x=!1,f(t-1)){x=!0;do if(t=g(t),t===i||(t++,!T))break;while(f(t))}else t=Math.min(i,g(t)+1);x&&(h(R,t,T),T=!0),r++,M=!0}else{for(x=d(R=t+1)==="/";d(++t)!==`
`;)if(t===i)return null;++t,x&&(h(R,t-1,T),T=!0),++r,M=!0}else if((U=d(t))==="*"){R=t+1,x=e||d(R)==="*";do{if(U===`
`&&++r,++t===i)throw c("comment");N=U,U=d(t)}while(N!=="*"||U!=="/");++t,x&&(h(R,t-2,T),T=!0),M=!0}else return"/"}}while(M);var A=t;vb.lastIndex=0;var C=vb.test(d(A++));if(!C)for(;A<i&&!vb.test(d(A));)++A;var P=n.substring(t,t=A);return(P==='"'||P==="'")&&(l=P),P}function S(M){a.push(M)}function I(){if(!a.length){var M=_();if(M===null)return null;S(M)}return a[0]}function E(M,N){var U=I(),R=U===M;if(R)return _(),!0;if(!N)throw c("token '"+U+"', '"+M+"' expected");return!1}function b(M){var N=null,U;return M===void 0?(U=o[r-1],delete o[r-1],U&&(e||U.type==="*"||U.lineEmpty)&&(N=U.leading?U.text:null)):(s<M&&I(),U=o[M],delete o[M],U&&!U.lineEmpty&&(e||U.type==="/")&&(N=U.leading?null:U.text)),N}return Object.defineProperty({next:_,peek:I,push:S,skip:E,cmnt:b},"line",{get:function(){return r}})}});var ZM=j((Uhe,JM)=>{"use strict";JM.exports=ss;ss.filename=null;ss.defaults={keepCase:!1};var BG=_b(),KM=Wm(),YM=jm(),QM=no(),UG=Bm(),XM=lc(),qG=ir(),zG=qm(),VG=Um(),wb=Ca(),Sb=mn(),$G=/^[1-9][0-9]*$/,jG=/^-?[1-9][0-9]*$/,GG=/^0[x][0-9a-fA-F]+$/,HG=/^-?0[x][0-9a-fA-F]+$/,WG=/^0[0-7]+$/,KG=/^-?0[0-7]+$/,YG=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Mr=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Or=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,QG=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function ss(n,e,t){e instanceof KM||(t=e,e=new KM),t||(t=ss.defaults);var i=t.preferTrailingComment||!1,r=BG(n,t.alternateCommentMode||!1),s=r.next,o=r.push,a=r.peek,l=r.skip,c=r.cmnt,u=!0,d,h,f,g,_=!1,S=e,I=t.keepCase?function(X){return X}:Sb.camelCase;function E(X,K,se){var Se=ss.filename;return se||(ss.filename=null),Error("illegal "+(K||"token")+" '"+X+"' ("+(Se?Se+", ":"")+"line "+r.line+")")}function b(){var X=[],K;do{if((K=s())!=='"'&&K!=="'")throw E(K);X.push(s()),l(K),K=a()}while(K==='"'||K==="'");return X.join("")}function M(X){var K=s();switch(K){case"'":case'"':return o(K),b();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return U(K,!0)}catch{if(X&&Or.test(K))return K;throw E(K,"value")}}function N(X,K){var se,Se;do K&&((se=a())==='"'||se==="'")?X.push(b()):X.push([Se=R(s()),l("to",!0)?R(s()):Se]);while(l(",",!0));var ye={options:void 0};ye.setOption=function(Pe,dt){this.options===void 0&&(this.options={}),this.options[Pe]=dt},P(ye,function(dt){if(dt==="option")ue(ye,dt),l(";");else throw E(dt)},function(){Le(ye)})}function U(X,K){var se=1;switch(X.charAt(0)==="-"&&(se=-1,X=X.substring(1)),X){case"inf":case"INF":case"Inf":return se*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if($G.test(X))return se*parseInt(X,10);if(GG.test(X))return se*parseInt(X,16);if(WG.test(X))return se*parseInt(X,8);if(YG.test(X))return se*parseFloat(X);throw E(X,"number",K)}function R(X,K){switch(X){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!K&&X.charAt(0)==="-")throw E(X,"id");if(jG.test(X))return parseInt(X,10);if(HG.test(X))return parseInt(X,16);if(KG.test(X))return parseInt(X,8);throw E(X,"id")}function x(){if(d!==void 0)throw E("package");if(d=s(),!Or.test(d))throw E(d,"name");S=S.define(d),l(";")}function T(){var X=a(),K;switch(X){case"weak":K=f||(f=[]),s();break;case"public":s();default:K=h||(h=[]);break}X=b(),l(";"),K.push(X)}function A(){if(l("="),g=b(),_=g==="proto3",!_&&g!=="proto2")throw E(g,"syntax");e.setOption("syntax",g),l(";")}function C(X,K){switch(K){case"option":return ue(X,K),l(";"),!0;case"message":return y(X,K),!0;case"enum":return V(X,K),!0;case"service":return ae(X,K),!0;case"extend":return Ot(X,K),!0}return!1}function P(X,K,se){var Se=r.line;if(X&&(typeof X.comment!="string"&&(X.comment=c()),X.filename=ss.filename),l("{",!0)){for(var ye;(ye=s())!=="}";)K(ye);l(";",!0)}else se&&se(),l(";"),X&&(typeof X.comment!="string"||i)&&(X.comment=c(Se)||X.comment)}function y(X,K){if(!Mr.test(K=s()))throw E(K,"type name");var se=new YM(K);P(se,function(ye){if(!C(se,ye))switch(ye){case"map":Q(se,ye);break;case"required":case"repeated":w(se,ye);break;case"optional":_?w(se,"proto3_optional"):w(se,"optional");break;case"oneof":z(se,ye);break;case"extensions":N(se.extensions||(se.extensions=[]));break;case"reserved":N(se.reserved||(se.reserved=[]),!0);break;default:if(!_||!Or.test(ye))throw E(ye);o(ye),w(se,"optional");break}}),X.add(se)}function w(X,K,se){var Se=s();if(Se==="group"){F(X,K);return}for(;Se.endsWith(".")||a().startsWith(".");)Se+=s();if(!Or.test(Se))throw E(Se,"type");var ye=s();if(!Mr.test(ye))throw E(ye,"name");ye=I(ye),l("=");var Pe=new QM(ye,R(s()),Se,K,se);if(P(Pe,function(an){if(an==="option")ue(Pe,an),l(";");else throw E(an)},function(){Le(Pe)}),K==="proto3_optional"){var dt=new XM("_"+ye);Pe.setOption("proto3_optional",!0),dt.add(Pe),X.add(dt)}else X.add(Pe);!_&&Pe.repeated&&(wb.packed[Se]!==void 0||wb.basic[Se]===void 0)&&Pe.setOption("packed",!1,!0)}function F(X,K){var se=s();if(!Mr.test(se))throw E(se,"name");var Se=Sb.lcFirst(se);se===Se&&(se=Sb.ucFirst(se)),l("=");var ye=R(s()),Pe=new YM(se);Pe.group=!0;var dt=new QM(Se,ye,se,K);dt.filename=ss.filename,P(Pe,function(an){switch(an){case"option":ue(Pe,an),l(";");break;case"required":case"repeated":w(Pe,an);break;case"optional":_?w(Pe,"proto3_optional"):w(Pe,"optional");break;case"message":y(Pe,an);break;case"enum":V(Pe,an);break;default:throw E(an)}}),X.add(Pe).add(dt)}function Q(X){l("<");var K=s();if(wb.mapKey[K]===void 0)throw E(K,"type");l(",");var se=s();if(!Or.test(se))throw E(se,"type");l(">");var Se=s();if(!Mr.test(Se))throw E(Se,"name");l("=");var ye=new UG(I(Se),R(s()),K,se);P(ye,function(dt){if(dt==="option")ue(ye,dt),l(";");else throw E(dt)},function(){Le(ye)}),X.add(ye)}function z(X,K){if(!Mr.test(K=s()))throw E(K,"name");var se=new XM(I(K));P(se,function(ye){ye==="option"?(ue(se,ye),l(";")):(o(ye),w(se,"optional"))}),X.add(se)}function V(X,K){if(!Mr.test(K=s()))throw E(K,"name");var se=new qG(K);P(se,function(ye){switch(ye){case"option":ue(se,ye),l(";");break;case"reserved":N(se.reserved||(se.reserved=[]),!0);break;default:ne(se,ye)}}),X.add(se)}function ne(X,K){if(!Mr.test(K))throw E(K,"name");l("=");var se=R(s(),!0),Se={options:void 0};Se.setOption=function(ye,Pe){this.options===void 0&&(this.options={}),this.options[ye]=Pe},P(Se,function(Pe){if(Pe==="option")ue(Se,Pe),l(";");else throw E(Pe)},function(){Le(Se)}),X.add(K,se,Se.comment,Se.options)}function ue(X,K){var se=l("(",!0);if(!Or.test(K=s()))throw E(K,"name");var Se=K,ye=Se,Pe;se&&(l(")"),Se="("+Se+")",ye=Se,K=a(),QG.test(K)&&(Pe=K.slice(1),Se+=K,s())),l("=");var dt=W(X,Se);re(X,ye,dt,Pe)}function W(X,K){if(l("{",!0)){for(var se={};!l("}",!0);){if(!Mr.test(Dt=s()))throw E(Dt,"name");if(Dt===null)throw E(Dt,"end of input");var Se,ye=Dt;if(l(":",!0),a()==="{")Se=W(X,K+"."+Dt);else if(a()==="["){Se=[];var Pe;if(l("[",!0)){do Pe=M(!0),Se.push(Pe);while(l(",",!0));l("]"),typeof Pe<"u"&&ee(X,K+"."+Dt,Pe)}}else Se=M(!0),ee(X,K+"."+Dt,Se);var dt=se[ye];dt&&(Se=[].concat(dt).concat(Se)),se[ye]=Se,l(",",!0),l(";",!0)}return se}var ni=M(!0);return ee(X,K,ni),ni}function ee(X,K,se){X.setOption&&X.setOption(K,se)}function re(X,K,se,Se){X.setParsedOption&&X.setParsedOption(K,se,Se)}function Le(X){if(l("[",!0)){do ue(X,"option");while(l(",",!0));l("]")}return X}function ae(X,K){if(!Mr.test(K=s()))throw E(K,"service name");var se=new zG(K);P(se,function(ye){if(!C(se,ye))if(ye==="rpc")Ae(se,ye);else throw E(ye)}),X.add(se)}function Ae(X,K){var se=c(),Se=K;if(!Mr.test(K=s()))throw E(K,"name");var ye=K,Pe,dt,ni,an;if(l("("),l("stream",!0)&&(dt=!0),!Or.test(K=s())||(Pe=K,l(")"),l("returns"),l("("),l("stream",!0)&&(an=!0),!Or.test(K=s())))throw E(K);ni=K,l(")");var bs=new VG(ye,Se,Pe,ni,dt,an);bs.comment=se,P(bs,function(Xo){if(Xo==="option")ue(bs,Xo),l(";");else throw E(Xo)}),X.add(bs)}function Ot(X,K){if(!Or.test(K=s()))throw E(K,"reference");var se=K;P(null,function(ye){switch(ye){case"required":case"repeated":w(X,ye,se);break;case"optional":_?w(X,"proto3_optional",se):w(X,"optional",se);break;default:if(!_||!Or.test(ye))throw E(ye);o(ye),w(X,"optional",se);break}})}for(var Dt;(Dt=s())!==null;)switch(Dt){case"package":if(!u)throw E(Dt);x();break;case"import":if(!u)throw E(Dt);T();break;case"syntax":if(!u)throw E(Dt);A();break;case"option":ue(S,Dt),l(";");break;default:if(C(S,Dt)){u=!1;continue}throw E(Dt)}return ss.filename=null,{package:d,imports:h,weakImports:f,syntax:g,root:e}}});var nO=j((qhe,tO)=>{"use strict";tO.exports=sr;var XG=/\/|\./;function sr(n,e){XG.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),sr[n]=e}sr("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var eO;sr("duration",{Duration:eO={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});sr("timestamp",{Timestamp:eO});sr("empty",{Empty:{fields:{}}});sr("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});sr("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});sr("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});sr.get=function(e){return sr[e]||null}});var rO=j((zhe,iO)=>{"use strict";var so=iO.exports=jM();so.build="full";so.tokenize=_b();so.parse=ZM();so.common=nO();so.Root._configure(so.Type,so.parse,so.common)});var Xm=j((Vhe,sO)=>{"use strict";sO.exports=rO()});var bb=j(($he,JG)=>{JG.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var uO=j((He,cO)=>{"use strict";var Ln=Xm();cO.exports=He=Ln.descriptor=Ln.Root.fromJSON(bb()).lookup(".google.protobuf");var oO=Ln.Namespace,ih=Ln.Root,os=Ln.Enum,oo=Ln.Type,ao=Ln.Field,ZG=Ln.MapField,Jm=Ln.OneOf,rh=Ln.Service,Zm=Ln.Method;ih.fromDescriptor=function(e){typeof e.length=="number"&&(e=He.FileDescriptorSet.decode(e));var t=new ih;if(e.file)for(var i,r,s=0,o;s<e.file.length;++s){if(r=t,(i=e.file[s]).package&&i.package.length&&(r=t.define(i.package)),i.name&&i.name.length&&t.files.push(r.filename=i.name),i.messageType)for(o=0;o<i.messageType.length;++o)r.add(oo.fromDescriptor(i.messageType[o],i.syntax));if(i.enumType)for(o=0;o<i.enumType.length;++o)r.add(os.fromDescriptor(i.enumType[o]));if(i.extension)for(o=0;o<i.extension.length;++o)r.add(ao.fromDescriptor(i.extension[o]));if(i.service)for(o=0;o<i.service.length;++o)r.add(rh.fromDescriptor(i.service[o]));var a=fc(i.options,He.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)r.setOption(l[o],a[l[o]])}}return t};ih.prototype.toDescriptor=function(e){var t=He.FileDescriptorSet.create();return aO(this,t.file,e),t};function aO(n,e,t){var i=He.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(i.syntax=t),n instanceof ih||(i.package=n.fullName.substring(1));for(var r=0,s;r<n.nestedArray.length;++r)(s=n._nestedArray[r])instanceof oo?i.messageType.push(s.toDescriptor(t)):s instanceof os?i.enumType.push(s.toDescriptor()):s instanceof ao?i.extension.push(s.toDescriptor(t)):s instanceof rh?i.service.push(s.toDescriptor()):s instanceof oO&&aO(s,e,t);i.options=pc(n.options,He.FileOptions),i.messageType.length+i.enumType.length+i.extension.length+i.service.length&&e.push(i)}var e8=0;oo.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=He.DescriptorProto.decode(e));var i=new oo(e.name.length?e.name:"Type"+e8++,fc(e.options,He.MessageOptions)),r;if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(Jm.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=ao.fromDescriptor(e.field[r],t);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(ao.fromDescriptor(e.extension[r],t));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(oo.fromDescriptor(e.nestedType[r],t)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(os.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(i.extensions=[],r=0;r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i};oo.prototype.toDescriptor=function(e){var t=He.DescriptorProto.create({name:this.name}),i;for(i=0;i<this.fieldsArray.length;++i){var r;if(t.field.push(r=this._fieldsArray[i].toDescriptor(e)),this._fieldsArray[i]instanceof ZG){var s=Eb(this._fieldsArray[i].keyType,this._fieldsArray[i].resolvedKeyType),o=Eb(this._fieldsArray[i].type,this._fieldsArray[i].resolvedType),a=o===11||o===14?this._fieldsArray[i].resolvedType&&lO(this.parent,this._fieldsArray[i].resolvedType)||this._fieldsArray[i].type:void 0;t.nestedType.push(He.DescriptorProto.create({name:r.typeName,field:[He.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),He.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:He.MessageOptions.create({mapEntry:!0})}))}}for(i=0;i<this.oneofsArray.length;++i)t.oneofDecl.push(this._oneofsArray[i].toDescriptor());for(i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof ao?t.field.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof oo?t.nestedType.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof os&&t.enumType.push(this._nestedArray[i].toDescriptor());if(this.extensions)for(i=0;i<this.extensions.length;++i)t.extensionRange.push(He.DescriptorProto.ExtensionRange.create({start:this.extensions[i][0],end:this.extensions[i][1]}));if(this.reserved)for(i=0;i<this.reserved.length;++i)typeof this.reserved[i]=="string"?t.reservedName.push(this.reserved[i]):t.reservedRange.push(He.DescriptorProto.ReservedRange.create({start:this.reserved[i][0],end:this.reserved[i][1]}));return t.options=pc(this.options,He.MessageOptions),t};var t8=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;ao.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=He.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var i;e.typeName&&e.typeName.length?i=e.typeName:i=o8(e.type);var r;switch(e.label){case 1:r=void 0;break;case 2:r="required";break;case 3:r="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new ao(e.name.length?e.name:"field"+e.number,e.number,i,r,s);if(o.options=fc(e.options,He.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=t8.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return a8(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};ao.prototype.toDescriptor=function(e){var t=He.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Ln.util.ucFirst(this.name),t.label=3;else{switch(t.type=Eb(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?lO(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=pc(this.options,He.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=He.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=He.FieldOptions.create())).packed=!0),t};var n8=0;os.fromDescriptor=function(e){typeof e.length=="number"&&(e=He.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var i=0;i<e.value.length;++i){var r=e.value[i].name,s=e.value[i].number||0;t[r&&r.length?r:"NAME"+s]=s}return new os(e.name&&e.name.length?e.name:"Enum"+n8++,t,fc(e.options,He.EnumOptions))};os.prototype.toDescriptor=function(){for(var e=[],t=0,i=Object.keys(this.values);t<i.length;++t)e.push(He.EnumValueDescriptorProto.create({name:i[t],number:this.values[i[t]]}));return He.EnumDescriptorProto.create({name:this.name,value:e,options:pc(this.options,He.EnumOptions)})};var i8=0;Jm.fromDescriptor=function(e){return typeof e.length=="number"&&(e=He.OneofDescriptorProto.decode(e)),new Jm(e.name&&e.name.length?e.name:"oneof"+i8++)};Jm.prototype.toDescriptor=function(){return He.OneofDescriptorProto.create({name:this.name})};var r8=0;rh.fromDescriptor=function(e){typeof e.length=="number"&&(e=He.ServiceDescriptorProto.decode(e));var t=new rh(e.name&&e.name.length?e.name:"Service"+r8++,fc(e.options,He.ServiceOptions));if(e.method)for(var i=0;i<e.method.length;++i)t.add(Zm.fromDescriptor(e.method[i]));return t};rh.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return He.ServiceDescriptorProto.create({name:this.name,method:e,options:pc(this.options,He.ServiceOptions)})};var s8=0;Zm.fromDescriptor=function(e){return typeof e.length=="number"&&(e=He.MethodDescriptorProto.decode(e)),new Zm(e.name&&e.name.length?e.name:"Method"+s8++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,fc(e.options,He.MethodOptions))};Zm.prototype.toDescriptor=function(){return He.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:pc(this.options,He.MethodOptions)})};function o8(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function a8(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Eb(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof os)return 14;if(e instanceof oo)return e.group?10:11;throw Error("illegal type: "+n)}function fc(n,e){if(n){for(var t=[],i=0,r,s,o;i<e.fieldsArray.length;++i)(s=(r=e._fieldsArray[i]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],r.resolvedType instanceof os&&typeof o=="number"&&r.resolvedType.valuesById[o]!==void 0&&(o=r.resolvedType.valuesById[o]),t.push(l8(s),o));return t.length?Ln.util.toObject(t):void 0}}function pc(n,e){if(n){for(var t=[],i=0,r=Object.keys(n),s,o;i<r.length;++i)if(o=n[s=r[i]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Ln.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Ln.util.toObject(t)):void 0}}function lO(n,e){var t=n.fullName.split("."),i=e.fullName.split("."),r=0,s=0,o=i.length-1;if(!(n instanceof ih)&&e instanceof oO)for(;r<t.length&&s<o&&t[r]===i[s];){var a=e.lookup(t[r++],!0);if(a!==null&&a!==e)break;++s}else for(;r<t.length&&s<o&&t[r]===i[s];++r,++s);return i.slice(s).join(".")}function l8(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var dO=j((jhe,c8)=>{c8.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var hO=j((Ghe,u8)=>{u8.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var fO=j((Hhe,d8)=>{d8.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var yO=j(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.addCommonProtos=lo.loadProtosWithOptionsSync=lo.loadProtosWithOptions=void 0;var pO=Ce("fs"),mO=Ce("path"),mc=Xm();function gO(n,e){let t=n.resolvePath;n.resolvePath=(i,r)=>{if(mO.isAbsolute(r))return r;for(let s of e){let o=mO.join(s,r);try{return pO.accessSync(o,pO.constants.R_OK),o}catch{continue}}return process.emitWarning(`${r} not found in any of the include paths ${e}`),t(i,r)}}function h8(n,e){return B(this,null,function*(){let t=new mc.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));gO(t,e.includeDirs)}let i=yield t.load(n,e);return i.resolveAll(),i})}lo.loadProtosWithOptions=h8;function f8(n,e){let t=new mc.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");gO(t,e.includeDirs)}let i=t.loadSync(n,e);return i.resolveAll(),i}lo.loadProtosWithOptionsSync=f8;function p8(){let n=dO(),e=bb(),t=hO(),i=fO();mc.common("api",n.nested.google.nested.protobuf.nested),mc.common("descriptor",e.nested.google.nested.protobuf.nested),mc.common("source_context",t.nested.google.nested.protobuf.nested),mc.common("type",i.nested.google.nested.protobuf.nested)}lo.addCommonProtos=p8});var wO=j((_O,Cb)=>{"use strict";var vO=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(y,w,F){this.low=y|0,this.high=w|0,this.unsigned=!!F}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function i(y){return(y&&y.__isLong__)===!0}function r(y){var w=Math.clz32(y&-y);return y?31-w:w}t.isLong=i;var s={},o={};function a(y,w){var F,Q,z;return w?(y>>>=0,(z=0<=y&&y<256)&&(Q=o[y],Q)?Q:(F=c(y,0,!0),z&&(o[y]=F),F)):(y|=0,(z=-128<=y&&y<128)&&(Q=s[y],Q)?Q:(F=c(y,y<0?-1:0,!1),z&&(s[y]=F),F))}t.fromInt=a;function l(y,w){if(isNaN(y))return w?M:b;if(w){if(y<0)return M;if(y>=S)return T}else{if(y<=-I)return A;if(y+1>=I)return x}return y<0?l(-y,w).neg():c(y%_|0,y/_|0,w)}t.fromNumber=l;function c(y,w,F){return new t(y,w,F)}t.fromBits=c;var u=Math.pow;function d(y,w,F){if(y.length===0)throw Error("empty string");if(typeof w=="number"?(F=w,w=!1):w=!!w,y==="NaN"||y==="Infinity"||y==="+Infinity"||y==="-Infinity")return w?M:b;if(F=F||10,F<2||36<F)throw RangeError("radix");var Q;if((Q=y.indexOf("-"))>0)throw Error("interior hyphen");if(Q===0)return d(y.substring(1),w,F).neg();for(var z=l(u(F,8)),V=b,ne=0;ne<y.length;ne+=8){var ue=Math.min(8,y.length-ne),W=parseInt(y.substring(ne,ne+ue),F);if(ue<8){var ee=l(u(F,ue));V=V.mul(ee).add(l(W))}else V=V.mul(z),V=V.add(l(W))}return V.unsigned=w,V}t.fromString=d;function h(y,w){return typeof y=="number"?l(y,w):typeof y=="string"?d(y,w):c(y.low,y.high,typeof w=="boolean"?w:y.unsigned)}t.fromValue=h;var f=65536,g=1<<24,_=f*f,S=_*_,I=S/2,E=a(g),b=a(0);t.ZERO=b;var M=a(0,!0);t.UZERO=M;var N=a(1);t.ONE=N;var U=a(1,!0);t.UONE=U;var R=a(-1);t.NEG_ONE=R;var x=c(-1,2147483647,!1);t.MAX_VALUE=x;var T=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=T;var A=c(0,-2147483648,!1);t.MIN_VALUE=A;var C=t.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*_+(this.low>>>0):this.high*_+(this.low>>>0)},C.toString=function(w){if(w=w||10,w<2||36<w)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(A)){var F=l(w),Q=this.div(F),z=Q.mul(F).sub(this);return Q.toString(w)+z.toInt().toString(w)}else return"-"+this.neg().toString(w);for(var V=l(u(w,6),this.unsigned),ne=this,ue="";;){var W=ne.div(V),ee=ne.sub(W.mul(V)).toInt()>>>0,re=ee.toString(w);if(ne=W,ne.isZero())return re+ue;for(;re.length<6;)re="0"+re;ue=""+re+ue}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var w=this.high!=0?this.high:this.low,F=31;F>0&&!(w&1<<F);F--);return this.high!=0?F+33:F+1},C.isZero=function(){return this.high===0&&this.low===0},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return(this.low&1)===1},C.isEven=function(){return(this.low&1)===0},C.equals=function(w){return i(w)||(w=h(w)),this.unsigned!==w.unsigned&&this.high>>>31===1&&w.high>>>31===1?!1:this.high===w.high&&this.low===w.low},C.eq=C.equals,C.notEquals=function(w){return!this.eq(w)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(w){return this.comp(w)<0},C.lt=C.lessThan,C.lessThanOrEqual=function(w){return this.comp(w)<=0},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(w){return this.comp(w)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(w){return this.comp(w)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(w){if(i(w)||(w=h(w)),this.eq(w))return 0;var F=this.isNegative(),Q=w.isNegative();return F&&!Q?-1:!F&&Q?1:this.unsigned?w.high>>>0>this.high>>>0||w.high===this.high&&w.low>>>0>this.low>>>0?-1:1:this.sub(w).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(N)},C.neg=C.negate,C.add=function(w){i(w)||(w=h(w));var F=this.high>>>16,Q=this.high&65535,z=this.low>>>16,V=this.low&65535,ne=w.high>>>16,ue=w.high&65535,W=w.low>>>16,ee=w.low&65535,re=0,Le=0,ae=0,Ae=0;return Ae+=V+ee,ae+=Ae>>>16,Ae&=65535,ae+=z+W,Le+=ae>>>16,ae&=65535,Le+=Q+ue,re+=Le>>>16,Le&=65535,re+=F+ne,re&=65535,c(ae<<16|Ae,re<<16|Le,this.unsigned)},C.subtract=function(w){return i(w)||(w=h(w)),this.add(w.neg())},C.sub=C.subtract,C.multiply=function(w){if(this.isZero())return this;if(i(w)||(w=h(w)),e){var F=e.mul(this.low,this.high,w.low,w.high);return c(F,e.get_high(),this.unsigned)}if(w.isZero())return this.unsigned?M:b;if(this.eq(A))return w.isOdd()?A:b;if(w.eq(A))return this.isOdd()?A:b;if(this.isNegative())return w.isNegative()?this.neg().mul(w.neg()):this.neg().mul(w).neg();if(w.isNegative())return this.mul(w.neg()).neg();if(this.lt(E)&&w.lt(E))return l(this.toNumber()*w.toNumber(),this.unsigned);var Q=this.high>>>16,z=this.high&65535,V=this.low>>>16,ne=this.low&65535,ue=w.high>>>16,W=w.high&65535,ee=w.low>>>16,re=w.low&65535,Le=0,ae=0,Ae=0,Ot=0;return Ot+=ne*re,Ae+=Ot>>>16,Ot&=65535,Ae+=V*re,ae+=Ae>>>16,Ae&=65535,Ae+=ne*ee,ae+=Ae>>>16,Ae&=65535,ae+=z*re,Le+=ae>>>16,ae&=65535,ae+=V*ee,Le+=ae>>>16,ae&=65535,ae+=ne*W,Le+=ae>>>16,ae&=65535,Le+=Q*re+z*ee+V*W+ne*ue,Le&=65535,c(Ae<<16|Ot,Le<<16|ae,this.unsigned)},C.mul=C.multiply,C.divide=function(w){if(i(w)||(w=h(w)),w.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&w.low===-1&&w.high===-1)return this;var F=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,w.low,w.high);return c(F,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?M:b;var Q,z,V;if(this.unsigned){if(w.unsigned||(w=w.toUnsigned()),w.gt(this))return M;if(w.gt(this.shru(1)))return U;V=M}else{if(this.eq(A)){if(w.eq(N)||w.eq(R))return A;if(w.eq(A))return N;var ne=this.shr(1);return Q=ne.div(w).shl(1),Q.eq(b)?w.isNegative()?N:R:(z=this.sub(w.mul(Q)),V=Q.add(z.div(w)),V)}else if(w.eq(A))return this.unsigned?M:b;if(this.isNegative())return w.isNegative()?this.neg().div(w.neg()):this.neg().div(w).neg();if(w.isNegative())return this.div(w.neg()).neg();V=b}for(z=this;z.gte(w);){Q=Math.max(1,Math.floor(z.toNumber()/w.toNumber()));for(var ue=Math.ceil(Math.log(Q)/Math.LN2),W=ue<=48?1:u(2,ue-48),ee=l(Q),re=ee.mul(w);re.isNegative()||re.gt(z);)Q-=W,ee=l(Q,this.unsigned),re=ee.mul(w);ee.isZero()&&(ee=N),V=V.add(ee),z=z.sub(re)}return V},C.div=C.divide,C.modulo=function(w){if(i(w)||(w=h(w)),e){var F=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,w.low,w.high);return c(F,e.get_high(),this.unsigned)}return this.sub(this.div(w).mul(w))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return c(~this.low,~this.high,this.unsigned)},C.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},C.clz=C.countLeadingZeros,C.countTrailingZeros=function(){return this.low?r(this.low):r(this.high)+32},C.ctz=C.countTrailingZeros,C.and=function(w){return i(w)||(w=h(w)),c(this.low&w.low,this.high&w.high,this.unsigned)},C.or=function(w){return i(w)||(w=h(w)),c(this.low|w.low,this.high|w.high,this.unsigned)},C.xor=function(w){return i(w)||(w=h(w)),c(this.low^w.low,this.high^w.high,this.unsigned)},C.shiftLeft=function(w){return i(w)&&(w=w.toInt()),(w&=63)===0?this:w<32?c(this.low<<w,this.high<<w|this.low>>>32-w,this.unsigned):c(0,this.low<<w-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(w){return i(w)&&(w=w.toInt()),(w&=63)===0?this:w<32?c(this.low>>>w|this.high<<32-w,this.high>>w,this.unsigned):c(this.high>>w-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(w){return i(w)&&(w=w.toInt()),(w&=63)===0?this:w<32?c(this.low>>>w|this.high<<32-w,this.high>>>w,this.unsigned):w===32?c(this.high,0,this.unsigned):c(this.high>>>w-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.rotateLeft=function(w){var F;return i(w)&&(w=w.toInt()),(w&=63)===0?this:w===32?c(this.high,this.low,this.unsigned):w<32?(F=32-w,c(this.low<<w|this.high>>>F,this.high<<w|this.low>>>F,this.unsigned)):(w-=32,F=32-w,c(this.high<<w|this.low>>>F,this.low<<w|this.high>>>F,this.unsigned))},C.rotl=C.rotateLeft,C.rotateRight=function(w){var F;return i(w)&&(w=w.toInt()),(w&=63)===0?this:w===32?c(this.high,this.low,this.unsigned):w<32?(F=32-w,c(this.high<<F|this.low>>>w,this.low<<F|this.high>>>w,this.unsigned)):(w-=32,F=32-w,c(this.low<<F|this.high>>>w,this.high<<F|this.low>>>w,this.unsigned))},C.rotr=C.rotateRight,C.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},C.toBytes=function(w){return w?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var w=this.high,F=this.low;return[F&255,F>>>8&255,F>>>16&255,F>>>24,w&255,w>>>8&255,w>>>16&255,w>>>24]},C.toBytesBE=function(){var w=this.high,F=this.low;return[w>>>24,w>>>16&255,w>>>8&255,w&255,F>>>24,F>>>16&255,F>>>8&255,F&255]},t.fromBytes=function(w,F,Q){return Q?t.fromBytesLE(w,F):t.fromBytesBE(w,F)},t.fromBytesLE=function(w,F){return new t(w[0]|w[1]<<8|w[2]<<16|w[3]<<24,w[4]|w[5]<<8|w[6]<<16|w[7]<<24,F)},t.fromBytesBE=function(w,F){return new t(w[4]<<24|w[5]<<16|w[6]<<8|w[7],w[0]<<24|w[1]<<16|w[2]<<8|w[3],F)};var P=t;return n.default=P,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return vO}):typeof Cb=="object"&&typeof _O=="object"&&(Cb.exports=vO)});var kb=j(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.loadFileDescriptorSetFromObject=rn.loadFileDescriptorSetFromBuffer=rn.fromJSON=rn.loadSync=rn.load=rn.IdempotencyLevel=rn.isAnyExtension=rn.Long=void 0;var m8=a2(),Nr=Xm(),xb=uO(),Ib=yO(),g8=wO();rn.Long=g8;function y8(n){return"@type"in n&&typeof n["@type"]=="string"}rn.isAnyExtension=y8;var EO;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(EO=rn.IdempotencyLevel||(rn.IdempotencyLevel={}));var CO={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function v8(n,e){return n===""?e:n+"."+e}function _8(n){return n instanceof Nr.Service||n instanceof Nr.Type||n instanceof Nr.Enum}function w8(n){return n instanceof Nr.Namespace||n instanceof Nr.Root}function TO(n,e){let t=v8(e,n.name);return _8(n)?[[t,n]]:w8(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(i=>TO(n.nested[i],t)).reduce((i,r)=>i.concat(r),[]):[]}function SO(n,e){return function(i){return n.toObject(n.decode(i),e)}}function bO(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let i=n.fromObject(t);return n.encode(i).finish()}}function S8(n){return(n||[]).reduce((e,t)=>{for(let[i,r]of Object.entries(t))switch(i){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[i]=r}return e},{deprecated:!1,idempotency_level:EO.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function b8(n,e,t,i){let r=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:bO(r),requestDeserialize:SO(r,t),responseSerialize:bO(s),responseDeserialize:SO(s,t),originalName:m8(n.name),requestType:Tb(r,i),responseType:Tb(s,i),options:S8(n.parsedOptions)}}function E8(n,e,t,i){let r={};for(let s of n.methodsArray)r[s.name]=b8(s,e,t,i);return r}function Tb(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,CO),fileDescriptorProtos:e}}function C8(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,CO),fileDescriptorProtos:e}}function T8(n,e,t,i){if(n instanceof Nr.Service)return E8(n,e,t,i);if(n instanceof Nr.Type)return Tb(n,i);if(n instanceof Nr.Enum)return C8(n,i);throw new Error("Type mismatch in reflection object handling")}function eg(n,e){let t={};n.resolveAll();let r=n.toDescriptor("proto3").file.map(s=>Buffer.from(xb.FileDescriptorProto.encode(s).finish()));for(let[s,o]of TO(n,""))t[s]=T8(o,s,e,r);return t}function xO(n,e){e=e||{};let t=Nr.Root.fromDescriptor(n);return t.resolveAll(),eg(t,e)}function x8(n,e){return(0,Ib.loadProtosWithOptions)(n,e).then(t=>eg(t,e))}rn.load=x8;function I8(n,e){let t=(0,Ib.loadProtosWithOptionsSync)(n,e);return eg(t,e)}rn.loadSync=I8;function k8(n,e){e=e||{};let t=Nr.Root.fromJSON(n);return t.resolveAll(),eg(t,e)}rn.fromJSON=k8;function A8(n,e){let t=xb.FileDescriptorSet.decode(n);return xO(t,e)}rn.loadFileDescriptorSetFromBuffer=A8;function D8(n,e){let t=xb.FileDescriptorSet.fromObject(n);return xO(t,e)}rn.loadFileDescriptorSetFromObject=D8;(0,Ib.addCommonProtos)()});var Ia=j(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.setup=xt.getChannelzServiceDefinition=xt.getChannelzHandlers=xt.unregisterChannelzRef=xt.registerChannelzSocket=xt.registerChannelzServer=xt.registerChannelzSubchannel=xt.registerChannelzChannel=xt.ChannelzCallTracker=xt.ChannelzChildrenTracker=xt.ChannelzTrace=void 0;var IO=Ce("net"),sh=Ri(),ah=it(),P8=xr(),R8=Sm(),M8=TS();function Ab(n){return{channel_id:n.id,name:n.name}}function Mb(n){return{subchannel_id:n.id,name:n.name}}function O8(n){return{server_id:n.id}}function ng(n){return{socket_id:n.id,name:n.name}}var kO=32,Db=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,i){let r=new Date;this.events.push({description:t,severity:e,timestamp:r,childChannel:i?.kind==="channel"?i:void 0,childSubchannel:i?.kind==="subchannel"?i:void 0}),this.events.length>=kO*2&&(this.events=this.events.slice(kO)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:as(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:as(e.timestamp),channel_ref:e.childChannel?Ab(e.childChannel):null,subchannel_ref:e.childSubchannel?Mb(e.childSubchannel):null}))}}};xt.ChannelzTrace=Db;var Pb=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,i,r;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(i=this.subchannelChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(r=this.socketChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:r}of this.channelChildren.values())e.push(r);let t=[];for(let{ref:r}of this.subchannelChildren.values())t.push(r);let i=[];for(let{ref:r}of this.socketChildren.values())i.push(r);return{channels:e,subchannels:t,sockets:i}}};xt.ChannelzChildrenTracker=Pb;var Rb=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};xt.ChannelzCallTracker=Rb;var N8=1;function ig(){return N8++}var oh=[],Ob=[],co=[],Nb=[];function L8(n,e,t){let i=ig(),r={id:i,name:n,kind:"channel"};return t&&(oh[i]={ref:r,getInfo:e}),r}xt.registerChannelzChannel=L8;function F8(n,e,t){let i=ig(),r={id:i,name:n,kind:"subchannel"};return t&&(Ob[i]={ref:r,getInfo:e}),r}xt.registerChannelzSubchannel=F8;function B8(n,e){let t=ig(),i={id:t,kind:"server"};return e&&(co[t]={ref:i,getInfo:n}),i}xt.registerChannelzServer=B8;function U8(n,e,t){let i=ig(),r={id:i,name:n,kind:"socket"};return t&&(Nb[i]={ref:r,getInfo:e}),r}xt.registerChannelzSocket=U8;function q8(n){switch(n.kind){case"channel":delete oh[n.id];return;case"subchannel":delete Ob[n.id];return;case"server":delete co[n.id];return;case"socket":delete Nb[n.id];return}}xt.unregisterChannelzRef=q8;function z8(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function AO(n){if(n==="")return[];let e=n.split(":").map(i=>z8(i));return[].concat(...e)}function V8(n){if((0,IO.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,IO.isIPv6)(n)){let e,t,i=n.indexOf("::");i===-1?(e=n,t=""):(e=n.substring(0,i),t=n.substring(i+2));let r=Buffer.from(AO(e)),s=Buffer.from(AO(t)),o=Buffer.alloc(16-r.length-s.length,0);return Buffer.concat([r,o,s])}else return null}function PO(n){switch(n){case sh.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case sh.ConnectivityState.IDLE:return{state:"IDLE"};case sh.ConnectivityState.READY:return{state:"READY"};case sh.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case sh.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function as(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function RO(n){let e=n.getInfo();return{ref:Ab(n.ref),data:{target:e.target,state:PO(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:as(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Ab(t)),subchannel_ref:e.children.subchannels.map(t=>Mb(t))}}function $8(n,e){let t=Number.parseInt(n.request.channel_id),i=oh[t];if(i===void 0){e({code:ah.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:RO(i)})}function j8(n,e){let t=Number.parseInt(n.request.max_results),i=[],r=Number.parseInt(n.request.start_channel_id);for(;r<oh.length;r++){let s=oh[r];if(s!==void 0&&(i.push(RO(s)),i.length>=t))break}e(null,{channel:i,end:r>=co.length})}function MO(n){let e=n.getInfo();return{ref:O8(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:as(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>ng(t))}}function G8(n,e){let t=Number.parseInt(n.request.server_id),i=co[t];if(i===void 0){e({code:ah.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:MO(i)})}function H8(n,e){let t=Number.parseInt(n.request.max_results),i=[],r=Number.parseInt(n.request.start_server_id);for(;r<co.length;r++){let s=co[r];if(s!==void 0&&(i.push(MO(s)),i.length>=t))break}e(null,{server:i,end:r>=co.length})}function W8(n,e){let t=Number.parseInt(n.request.subchannel_id),i=Ob[t];if(i===void 0){e({code:ah.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let r=i.getInfo(),s={ref:Mb(i.ref),data:{target:r.target,state:PO(r.state),calls_started:r.callTracker.callsStarted,calls_succeeded:r.callTracker.callsSucceeded,calls_failed:r.callTracker.callsFailed,last_call_started_timestamp:as(r.callTracker.lastCallStartedTimestamp),trace:r.trace.getTraceMessage()},socket_ref:r.children.sockets.map(o=>ng(o))};e(null,{subchannel:s})}function DO(n){var e;return(0,P8.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=V8(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function K8(n,e){var t,i,r,s,o;let a=Number.parseInt(n.request.socket_id),l=Nb[a];if(l===void 0){e({code:ah.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(i=c.security.cipherSuiteOtherName)!==null&&i!==void 0?i:void 0,local_certificate:(r=c.security.localCertificate)!==null&&r!==void 0?r:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:ng(l.ref),local:c.localAddress?DO(c.localAddress):null,remote:c.remoteAddress?DO(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:as(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:as(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:as(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:as(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function Y8(n,e){let t=Number.parseInt(n.request.server_id),i=co[t];if(i===void 0){e({code:ah.Status.NOT_FOUND,details:"No server data found for id "+t});return}let r=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=i.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=r&&(l.push(ng(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function OO(){return{GetChannel:$8,GetTopChannels:j8,GetServer:G8,GetServers:H8,GetSubchannel:W8,GetSocket:K8,GetServerSockets:Y8}}xt.getChannelzHandlers=OO;var tg=null;function NO(){if(tg)return tg;let n=kb().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return tg=(0,M8.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,tg}xt.getChannelzServiceDefinition=NO;function Q8(){(0,R8.registerAdminService)(NO,OO)}xt.setup=Q8});var LO=j(sg=>{"use strict";Object.defineProperty(sg,"__esModule",{value:!0});sg.Subchannel=void 0;var mt=Ri(),X8=qd(),Lb=Ft(),rg=it(),J8=di(),Z8=xr(),gc=Ia(),eH="subchannel",tH=~(1<<31),Fb=class{constructor(e,t,i,r,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=i,this.credentials=r,this.connector=s,this.connectivityState=mt.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new gc.ChannelzCallTracker,this.childrenTracker=new gc.ChannelzChildrenTracker,this.streamTracker=new gc.ChannelzCallTracker;let a={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new X8.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,Z8.subchannelAddressToString)(t),this.keepaliveTime=(o=i["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,i["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new gc.ChannelzTrace,this.channelzRef=(0,gc.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(i,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Lb.trace(rg.LogVerbosity.DEBUG,eH,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Lb.trace(rg.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([mt.ConnectivityState.TRANSIENT_FAILURE],mt.ConnectivityState.CONNECTING):this.transitionToState([mt.ConnectivityState.TRANSIENT_FAILURE],mt.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,tH);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([mt.ConnectivityState.CONNECTING],mt.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(i=>{this.transitionToState([mt.ConnectivityState.READY],mt.ConnectivityState.IDLE),i&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Lb.log(rg.LogVerbosity.ERROR,`Connection to ${(0,J8.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([mt.ConnectivityState.CONNECTING],mt.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,i){var r,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(mt.ConnectivityState[this.connectivityState]+" -> "+mt.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+mt.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case mt.ConnectivityState.READY:this.stopBackoff();break;case mt.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case mt.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(r=this.transport)===null||r===void 0||r.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case mt.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,i);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,gc.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([mt.ConnectivityState.CONNECTING,mt.ConnectivityState.READY],mt.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,i,r){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===rg.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,i,r,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([mt.ConnectivityState.IDLE],mt.ConnectivityState.CONNECTING)||this.connectivityState===mt.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([mt.ConnectivityState.TRANSIENT_FAILURE],mt.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};sg.Subchannel=Fb});var zb=j(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.setup=fo.DEFAULT_PORT=void 0;var FO=Cr(),UO=Ce("dns"),qO=Ce("util"),nH=Jw(),Bb=it(),Ub=Kn(),iH=Ft(),rH=it(),uo=di(),BO=Ce("net"),sH=qd(),oH="dns_resolver";function ho(n){iH.trace(rH.LogVerbosity.DEBUG,oH,n)}fo.DEFAULT_PORT=443;var aH=3e4,lH=qO.promisify(UO.resolveTxt),cH=qO.promisify(UO.lookup);function uH(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(i=>i.length));t++)for(let i of n)t<i.length&&e.push(i[t]);return e}var qb=class{constructor(e,t,i){var r,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,ho("Resolver constructed for target "+(0,uo.uriToString)(e));let a=(0,uo.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,BO.isIPv4)(a.host)||(0,BO.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(r=a.port)!==null&&r!==void 0?r:fo.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:fo.DEFAULT_PORT),this.percentage=Math.random()*100,i["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Bb.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,uo.uriToString)(this.target)}`,metadata:new Ub.Metadata};let l={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoff=new sH.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=i["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:aH,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(ho("Returning IP address for target "+(0,uo.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)ho("Failed to parse DNS address "+(0,uo.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Bb.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,uo.uriToString)(this.target)}`,metadata:new Ub.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;ho("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=cH(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let i=t.filter(o=>o.family===4),r=t.filter(o=>o.family===6);this.latestLookupResult=uH(r,i).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(ho("Resolved addresses for target "+(0,uo.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(ho("Resolution error for target "+(0,uo.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=lH(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,nH.extractAndSelectServiceConfig)(t,this.percentage)}catch(i){this.latestServiceConfigError={code:Bb.Status.UNAVAILABLE,details:`Parsing service config failed with error ${i.message}`,metadata:new Ub.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?ho('resolution update delayed by "min time between resolutions" rate limit'):ho("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function dH(){(0,FO.registerResolver)("dns",qb),(0,FO.registerDefaultScheme)("dns")}fo.setup=dH});var Vb=j(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.getProxiedConnection=_c.mapProxyName=void 0;var lh=Ft(),yc=it(),hH=Cr(),fH=Ce("http"),pH=Ce("tls"),mH=Ft(),zO=xr(),vc=di(),gH=Ce("url"),yH=zb(),vH="proxy";function po(n){mH.trace(yc.LogVerbosity.DEBUG,vH,n)}function _H(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new gH.URL(n)}catch{return(0,lh.log)(yc.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,lh.log)(yc.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let i=null;t.username&&(t.password?((0,lh.log)(yc.LogVerbosity.INFO,"userinfo found in proxy URI"),i=`${t.username}:${t.password}`):i=t.username);let r=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${r}:${s}`};return i&&(o.creds=i),po("Proxy server "+o.address+" set by environment variable "+e),o}function wH(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(po("No proxy server list set by environment variable "+e),n.split(",")):[]}function SH(n,e){var t;let i={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return i;let r=_H();if(!r.address)return i;let s=(0,vc.splitHostPort)(n.path);if(!s)return i;let o=s.host;for(let l of wH())if(l===o)return po("Not using proxy for target in no_proxy list: "+(0,vc.uriToString)(n)),i;let a={"grpc.http_connect_target":(0,vc.uriToString)(n)};return r.creds&&(a["grpc.http_connect_creds"]=r.creds),{target:{scheme:"dns",path:r.address},extraOptions:a}}_c.mapProxyName=SH;function bH(n,e,t){var i;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let r=e["grpc.http_connect_target"],s=(0,vc.parseUri)(r);if(s===null)return Promise.resolve({});let o=(0,vc.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(i=o.port)!==null&&i!==void 0?i:yH.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,zO.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,zO.subchannelAddressToString)(n);return po("Using proxy "+u+" to connect to "+l.path),new Promise((d,h)=>{let f=fH.request(l);f.once("connect",(g,_,S)=>{var I;if(f.removeAllListeners(),_.removeAllListeners(),g.statusCode===200)if(po("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let E=(0,hH.getDefaultAuthority)(s),b=(0,vc.splitHostPort)(E),M=(I=b?.host)!==null&&I!==void 0?I:E,N=pH.connect(Object.assign({host:M,servername:M,socket:_},t),()=>{po("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:N,realTarget:s})});N.on("error",U=>{po("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+U.message),h()})}else po("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:_,realTarget:s});else(0,lh.log)(yc.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+g.statusCode),h()}),f.once("error",g=>{f.removeAllListeners(),(0,lh.log)(yc.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+g.message),h()}),f.end()})}_c.getProxiedConnection=bH});var jb=j(og=>{"use strict";Object.defineProperty(og,"__esModule",{value:!0});og.StreamDecoder=void 0;var ls=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(ls||{}),$b=class{constructor(e){this.maxReadMessageLength=e,this.readState=ls.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,i,r=[];for(;t<e.length;)switch(this.readState){case ls.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=ls.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case ls.READING_SIZE:if(i=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+i),this.readSizeRemaining-=i,t+=i,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=ls.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=ls.NO_DATA,r.push(s)}}break;case ls.READING_MESSAGE:if(i=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+i)),this.readMessageRemaining-=i,t+=i,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=ls.NO_DATA,r.push(o)}break;default:throw new Error("Unexpected read state")}return r}};og.StreamDecoder=$b});var VO=j(ag=>{"use strict";Object.defineProperty(ag,"__esModule",{value:!0});ag.Http2SubchannelCall=void 0;var cs=Ce("http2"),EH=Ce("os"),rt=it(),mo=Kn(),CH=jb(),TH=Ft(),xH=it(),IH="subchannel_call";function kH(n){for(let[e,t]of Object.entries(EH.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Gb=class{constructor(e,t,i,r,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=i,this.transport=r,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=rt.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=r.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:rt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new CH.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let d of Object.keys(l))u+="		"+d+": "+l[d]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=rt.Status.INTERNAL;break;case 401:this.mappedStatusCode=rt.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=rt.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=rt.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=rt.Status.UNAVAILABLE;break;default:this.mappedStatusCode=rt.Status.UNKNOWN}if(c&cs.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let d;try{d=mo.Metadata.fromHttp2Headers(l)}catch(h){this.endCall({code:rt.Status.UNKNOWN,details:h.message,metadata:new mo.Metadata});return}this.listener.onReceiveMetadata(d)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(rt.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===rt.Status.OK)return;let c,u="";switch(e.rstCode){case cs.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=rt.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case cs.constants.NGHTTP2_REFUSED_STREAM:c=rt.Status.UNAVAILABLE,u="Stream refused by server";break;case cs.constants.NGHTTP2_CANCEL:c=rt.Status.CANCELLED,u="Call cancelled";break;case cs.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=rt.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case cs.constants.NGHTTP2_INADEQUATE_SECURITY:c=rt.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case cs.constants.NGHTTP2_INTERNAL_ERROR:c=rt.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=rt.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=rt.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new mo.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+kH(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:rt.Status.UNAVAILABLE,details:"Connection dropped",metadata:new mo.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){TH.trace(xH.LogVerbosity.DEBUG,IH,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===rt.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==rt.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let i;try{i=mo.Metadata.fromHttp2Headers(e)}catch{i=new mo.Metadata}let r=i.getMap(),s=this.mappedStatusCode;if(s===rt.Status.UNKNOWN&&typeof r["grpc-status"]=="string"){let l=Number(r["grpc-status"]);l in rt.Status&&(s=l,this.trace("received status code "+l+" from server")),i.remove("grpc-status")}let o="";if(typeof r["grpc-message"]=="string"){try{o=decodeURI(r["grpc-message"])}catch{o=r["grpc-message"]}i.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:i};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===rt.Status.OK?t=cs.constants.NGHTTP2_NO_ERROR:t=cs.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new mo.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==rt.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let i=r=>{process.nextTick(()=>{var s;let o=rt.Status.UNAVAILABLE;r?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=rt.Status.INTERNAL),r&&this.cancelWithStatus(o,`Write error: ${r.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,i)}catch(r){this.endCall({code:rt.Status.UNAVAILABLE,details:`Write failed with error ${r.message}`,metadata:new mo.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};ag.Http2SubchannelCall=Gb});var Hb=j(lg=>{"use strict";Object.defineProperty(lg,"__esModule",{value:!0});lg.getNextCallNumber=void 0;var AH=0;function DH(){return AH++}lg.getNextCallNumber=DH});var GO=j(ug=>{"use strict";Object.defineProperty(ug,"__esModule",{value:!0});ug.Http2SubchannelConnector=void 0;var Xb=Ce("http2"),$O=Ce("tls"),Wb=Ia(),ch=it(),PH=Vb(),Sc=Ft(),jO=Cr(),cg=xr(),wc=di(),RH=Ce("net"),MH=VO(),OH=Hb(),Kb="transport",NH="transport_flowctrl",LH=Ow().version,{HTTP2_HEADER_AUTHORITY:FH,HTTP2_HEADER_CONTENT_TYPE:BH,HTTP2_HEADER_METHOD:UH,HTTP2_HEADER_PATH:qH,HTTP2_HEADER_TE:zH,HTTP2_HEADER_USER_AGENT:VH}=Xb.constants,$H=2e4,jH=Buffer.from("too_many_pings","ascii"),Yb=class{constructor(e,t,i,r){this.session=e,this.options=i,this.remoteName=r,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=$H,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Wb.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,cg.subchannelAddressToString)(t),i["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Wb.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[i["grpc.primary_user_agent"],`grpc-node-js/${LH}`,i["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in i&&(this.keepaliveTimeMs=i["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in i&&(this.keepaliveTimeoutMs=i["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in i?this.keepaliveWithoutCalls=i["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Xb.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(jH)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Sc.isTracerEnabled(Kb)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,i;let r=this.session.socket,s=r.remoteAddress?(0,cg.stringToSubchannelAddress)(r.remoteAddress,r.remotePort):null,o=r.localAddress?(0,cg.stringToSubchannelAddress)(r.localAddress,r.localPort):null,a;if(this.session.encrypted){let c=r,u=c.getCipher(),d=c.getCertificate(),h=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:h&&"raw"in h?h.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(i=this.session.state.remoteWindowSize)!==null&&i!==void 0?i:null}}trace(e){Sc.trace(ch.LogVerbosity.DEBUG,Kb,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Sc.trace(ch.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Sc.trace(ch.LogVerbosity.DEBUG,NH,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Sc.trace(ch.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((i,r,s)=>{i&&(this.keepaliveTrace("Ping failed with error "+i.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,i,r,s){let o=e.toHttp2Headers();o[FH]=t,o[VH]=this.userAgent,o[BH]="application/grpc",o[UH]="POST",o[qH]=i,o[zH]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new MH.Http2SubchannelCall(a,l,r,this,(0,OH.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,Wb.unregisterChannelzRef)(this.channelzRef)}},Qb=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Sc.trace(ch.LogVerbosity.DEBUG,Kb,(0,wc.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,i,r){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;r.realTarget?(u=(0,wc.uriToString)(r.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,wc.uriToString)(r.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,cg.subchannelAddressToString)(e)));let d=(0,jO.getDefaultAuthority)((a=r.realTarget)!==null&&a!==void 0?a:this.channelTarget),h=t._getConnectionOptions()||{};h.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in i?h.maxSessionMemory=i["grpc-node.max_session_memory"]:h.maxSessionMemory=Number.MAX_SAFE_INTEGER;let f="http://";if("secureContext"in h){if(f="https://",i["grpc.ssl_target_name_override"]){let S=i["grpc.ssl_target_name_override"];h.checkServerIdentity=(I,E)=>(0,$O.checkServerIdentity)(S,E),h.servername=S}else{let S=(c=(l=(0,wc.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";h.servername=S}r.socket&&(h.createConnection=(S,I)=>r.socket)}else h.createConnection=(S,I)=>r.socket?r.socket:RH.connect(e);h=Object.assign(Object.assign(Object.assign({},h),e),{enableTrace:i["grpc-node.tls_enable_trace"]===1});let g=Xb.connect(f+d,h);this.session=g;let _="Failed to connect";g.unref(),g.once("connect",()=>{g.removeAllListeners(),s(new Yb(g,e,i,u)),this.session=null}),g.once("close",()=>{this.session=null,setImmediate(()=>{o(`${_} (${new Date().toISOString()})`)})}),g.once("error",S=>{_=S.message,this.trace("connection failed with error "+_)})})}connect(e,t,i){var r,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],i["grpc.ssl_target_name_override"]){let a=i["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,$O.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in i){let a=(0,jO.getDefaultAuthority)((r=(0,wc.parseUri)(i["grpc.http_connect_target"]))!==null&&r!==void 0?r:{path:"localhost"}),l=(0,wc.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}i["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,PH.getProxiedConnection)(e,i,o).then(a=>this.createSession(e,t,i,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};ug.Http2SubchannelConnector=Qb});var HO=j(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});bc.getSubchannelPool=bc.SubchannelPool=void 0;var GH=AR(),HH=LO(),WH=xr(),KH=di(),YH=GO(),QH=1e4,uh=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},QH),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,i,r){this.ensureCleanupTask();let s=(0,KH.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,WH.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,GH.channelOptionsEqual)(i,l.channelArguments)&&r._equals(l.channelCredentials))return l.subchannel}let o=new HH.Subchannel(e,t,i,r,new YH.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:i,channelCredentials:r,subchannel:o}),o.ref(),o}};bc.SubchannelPool=uh;var XH=new uh;function JH(n){return n?XH:new uh}bc.getSubchannelPool=JH});var Zb=j(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.FilterStackFactory=Ec.FilterStack=void 0;var dg=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMessage(t);return t}receiveMessage(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Ec.FilterStack=dg;var Jb=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new dg(this.factories.map(e=>e.createFilter()))}};Ec.FilterStackFactory=Jb});var eE=j(hg=>{"use strict";Object.defineProperty(hg,"__esModule",{value:!0});hg.CompressionAlgorithms=void 0;var WO=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(WO||(hg.CompressionAlgorithms=WO={}))});var nE=j(fg=>{"use strict";Object.defineProperty(fg,"__esModule",{value:!0});fg.BaseFilter=void 0;var tE=class{sendMetadata(e){return B(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return B(this,null,function*(){return e})}receiveMessage(e){return B(this,null,function*(){return e})}receiveTrailers(e){return e}};fg.BaseFilter=tE});var QO=j(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});Tc.CompressionFilterFactory=Tc.CompressionFilter=void 0;var pg=Ce("zlib"),YO=eE(),mg=it(),ZH=nE(),eW=Ft(),tW=n=>typeof n=="number"&&typeof YO.CompressionAlgorithms[n]=="string",Cc=class{writeMessage(e,t){return B(this,null,function*(){let i=e;t&&(i=yield this.compressMessage(i));let r=Buffer.allocUnsafe(i.length+5);return r.writeUInt8(t?1:0,0),r.writeUInt32BE(i.length,1),i.copy(r,5),r})}readMessage(e){return B(this,null,function*(){let t=e.readUInt8(0)===1,i=e.slice(5);return t&&(i=yield this.decompressMessage(i)),i})}},ka=class extends Cc{compressMessage(e){return B(this,null,function*(){return e})}writeMessage(e,t){return B(this,null,function*(){let i=Buffer.allocUnsafe(e.length+5);return i.writeUInt8(0,0),i.writeUInt32BE(e.length,1),e.copy(i,5),i})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},iE=class extends Cc{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,i)=>{pg.deflate(e,(r,s)=>{r?i(r):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{let r=0,s=[],o=pg.createInflate();o.on("data",a=>{s.push(a),r+=a.byteLength,this.maxRecvMessageLength!==-1&&r>this.maxRecvMessageLength&&(o.destroy(),i({code:mg.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},rE=class extends Cc{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,i)=>{pg.gzip(e,(r,s)=>{r?i(r):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{let r=0,s=[],o=pg.createGunzip();o.on("data",a=>{s.push(a),r+=a.byteLength,this.maxRecvMessageLength!==-1&&r>this.maxRecvMessageLength&&(o.destroy(),i({code:mg.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},sE=class extends Cc{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function KO(n,e){switch(n){case"identity":return new ka;case"deflate":return new iE(e);case"gzip":return new rE(e);default:return new sE(n)}}var gg=class extends ZH.BaseFilter{constructor(e,t){var i,r;super(),this.sharedFilterConfig=t,this.sendCompression=new ka,this.receiveCompression=new ka,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(i=e["grpc.max_receive_message_length"])!==null&&i!==void 0?i:mg.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(tW(s)){let o=YO.CompressionAlgorithms[s],a=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=KO(this.currentCompressionAlgorithm,-1))}else eW.log(mg.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return B(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let r=t[0];typeof r=="string"&&(this.receiveCompression=KO(r,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let i=e.get("grpc-accept-encoding")[0];return i&&(this.sharedFilterConfig.serverSupportedEncodingHeader=i,i.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new ka,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return B(this,null,function*(){var t;let i=yield e,r;return this.sendCompression instanceof ka?r=!1:r=(((t=i.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(i.message,r),flags:i.flags}})}receiveMessage(e){return B(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Tc.CompressionFilter=gg;var oE=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new gg(this.options,this.sharedFilterConfig)}};Tc.CompressionFilterFactory=oE});var yg=j(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.deadlineToString=Lr.getRelativeTimeout=Lr.getDeadlineTimeoutString=Lr.minDeadline=void 0;function nW(...n){let e=1/0;for(let t of n){let i=t instanceof Date?t.getTime():t;i<e&&(e=i)}return e}Lr.minDeadline=nW;var iW=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function rW(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[i,r]of iW){let s=t/r;if(s<1e8)return String(Math.ceil(s))+i}throw new Error("Deadline is too far in the future")}Lr.getDeadlineTimeoutString=rW;var sW=2147483647;function oW(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),i=e-t;return i<0?0:i>sW?1/0:i}Lr.getRelativeTimeout=oW;function aW(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Lr.deadlineToString=aW});var _g=j(vg=>{"use strict";Object.defineProperty(vg,"__esModule",{value:!0});vg.restrictControlPlaneStatusCode=void 0;var Fr=it(),lW=[Fr.Status.OK,Fr.Status.INVALID_ARGUMENT,Fr.Status.NOT_FOUND,Fr.Status.ALREADY_EXISTS,Fr.Status.FAILED_PRECONDITION,Fr.Status.ABORTED,Fr.Status.OUT_OF_RANGE,Fr.Status.DATA_LOSS];function cW(n,e){return lW.includes(n)?{code:Fr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Fr.Status[n]} ${e}`}:{code:n,details:e}}vg.restrictControlPlaneStatusCode=cW});var JO=j(bg=>{"use strict";Object.defineProperty(bg,"__esModule",{value:!0});bg.LoadBalancingCall=void 0;var XO=Ri(),wg=it(),uW=yg(),Sg=Kn(),dh=Js(),dW=di(),hW=Ft(),aE=_g(),fW=Ce("http2"),pW="load_balancing_call",lE=class{constructor(e,t,i,r,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=i,this.host=r,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=(c=(l=(0,dW.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){hW.trace(wg.LogVerbosity.DEBUG,pW,"["+this.callNumber+"] "+e)}outputStatus(e,t){var i,r;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(i=this.listener)===null||i===void 0||i.onReceiveStatus(s),(r=this.onCallEnded)===null||r===void 0||r.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let i=this.channel.doPick(this.metadata,this.callConfig.pickInformation),r=i.subchannel?"("+i.subchannel.getChannelzRef().id+") "+i.subchannel.getAddress():""+i.subchannel;switch(this.trace("Pick result: "+dh.PickResultType[i.pickResultType]+" subchannel: "+r+" status: "+((e=i.status)===null||e===void 0?void 0:e.code)+" "+((t=i.status)===null||t===void 0?void 0:t.details)),i.pickResultType){case dh.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:wg.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Sg.Metadata},"PROCESSED"),i.subchannel.getConnectivityState()!==XO.ConnectivityState.READY){this.trace("Picked subchannel "+r+" has state "+XO.ConnectivityState[i.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,uW.getDeadlineTimeoutString)(this.deadline));try{this.child=i.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:h=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(h)},onReceiveMessage:h=>{this.trace("Received message"),this.listener.onReceiveMessage(h)},onReceiveStatus:h=>{this.trace("Received status"),h.rstCode===fW.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(h,"REFUSED"):this.outputStatus(h,"PROCESSED")}})}catch(h){this.trace("Failed to start call on picked subchannel "+r+" with error "+h.message),this.outputStatus({code:wg.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+h.message,metadata:new Sg.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=i.onCallStarted)===null||u===void 0||u.call(i),this.onCallEnded=i.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,aE.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:wg.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new Sg.Metadata},"PROCESSED")});break;case dh.PickResultType.DROP:let{code:s,details:o}=(0,aE.restrictControlPlaneStatusCode)(i.status.code,i.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:i.status.metadata},"DROP")});break;case dh.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,aE.restrictControlPlaneStatusCode)(i.status.code,i.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:i.status.metadata},"PROCESSED")})}break;case dh.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Sg.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};bg.LoadBalancingCall=lE});var eN=j(Cg=>{"use strict";Object.defineProperty(Cg,"__esModule",{value:!0});Cg.ResolvingCall=void 0;var xc=it(),Eg=yg(),ZO=Kn(),mW=Ft(),gW=_g(),yW="resolving_call",cE=class{constructor(e,t,i,r,s,o){this.channel=e,this.method=t,this.filterStackFactory=r,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=i.deadline,this.host=i.host,i.parentCall&&(i.flags&xc.Propagate.CANCELLATION&&i.parentCall.on("cancelled",()=>{this.cancelWithStatus(xc.Status.CANCELLED,"Cancelled by parent call")}),i.flags&xc.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+i.parentCall.getDeadline()),this.deadline=(0,Eg.minDeadline)(this.deadline,i.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){mW.trace(xc.LogVerbosity.DEBUG,yW,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Eg.deadlineToString)(this.deadline));let e=(0,Eg.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(xc.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(i=>i(t)),process.nextTick(()=>{var i;(i=this.listener)===null||i===void 0||i.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let i=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(r=>{this.writeFilterPending=!1,i.sendMessageWithContext(e,r.message),this.pendingHalfClose&&i.halfClose()},r=>{this.cancelWithStatus(r.code,r.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==xc.Status.OK){let{code:i,details:r}=(0,gW.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:i,details:r,metadata:new ZO.Metadata});return}if(t.methodConfig.timeout){let i=new Date;i.setSeconds(i.getSeconds()+t.methodConfig.timeout.seconds),i.setMilliseconds(i.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Eg.minDeadline)(this.deadline,i),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(i=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(i,{onReceiveMetadata:r=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(r))},onReceiveMessage:r=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(r).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:r=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=r:this.outputStatus(r)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},i=>{this.outputStatus(i)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ZO.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Cg.ResolvingCall=cE});var tN=j(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});go.RetryingCall=go.MessageBufferTracker=go.RetryThrottler=void 0;var Tg=it(),vW=Kn(),_W=Ft(),wW="retrying_call",dE=class{constructor(e,t,i){this.maxTokens=e,this.tokenRatio=t,i?this.tokens=i.tokens*(e/i.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};go.RetryThrottler=dE;var hE=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var i;let r=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;return this.limitPerCall-r<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,r+e),this.totalAllocated+=e,!0)}free(e,t){var i;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let r=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;if(r<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${r}`);this.allocatedPerCall.set(t,r-e)}freeAll(e){var t;let i=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<i)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${i} > total allocated ${this.totalAllocated}`);this.totalAllocated-=i,this.allocatedPerCall.delete(e)}};go.MessageBufferTracker=hE;var uE="grpc-previous-rpc-attempts",fE=class{constructor(e,t,i,r,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=i,this.host=r,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){_W.trace(Tg.LogVerbosity.DEBUG,wW,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new vW.Metadata});for(let{call:i}of this.underlyingCalls)i.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let i=this.getBufferEntry(t);i.allocated&&this.bufferTracker.free(i.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Tg.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[i,r]of this.underlyingCalls.entries())r.state==="ACTIVE"&&r.nextMessageToSend>e&&(e=r.nextMessageToSend,t=i);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(i=>i===t||i.toString().toLowerCase()===Tg.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let i=Math.random()*this.nextRetryBackoffSec*1e3,r=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,r),i}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let i=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(i.maxAttempts,5)){t(!1);return}let r;if(e===null)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,i){var r,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((r=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&r!==void 0?r:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(i===null)a=0;else if(i<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=i;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(i,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var i;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Tg.Status.OK){(i=this.retryThrottler)===null||i===void 0||i.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let r=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,r):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,r);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,i;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let r=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(r.maxAttempts,5))return;let s=(e=r.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(i=(t=this.hedgingTimer).unref)===null||i===void 0||i.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let i=this.attempts-1,r=this.initialMetadata.clone();i>0&&r.set(uE,`${i}`);let s=!1;e.start(r,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,i>0&&o.set(uE,`${i}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&i>0&&o.metadata.set(uE,`${i}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,i;let r=this.underlyingCalls[e],s=r.nextMessageToSend;(i=(t=this.getBufferEntry(s)).callback)===null||i===void 0||i.call(t),this.clearSentMessages(),r.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let i=this.getBufferEntry(t.nextMessageToSend);switch(i.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:r=>{this.handleChildWriteCompleted(e)}},i.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var i;this.trace("write() called with message of length "+t.length);let r={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:r,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(i=e.callback)===null||i===void 0||i.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};go.RetryingCall=fE});var Ig=j(xg=>{"use strict";Object.defineProperty(xg,"__esModule",{value:!0});xg.BaseSubchannelWrapper=void 0;var pE=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};xg.BaseSubchannelWrapper=pE});var rN=j(Dg=>{"use strict";Object.defineProperty(Dg,"__esModule",{value:!0});Dg.InternalChannel=void 0;var SW=hm(),bW=kR(),EW=HO(),nN=Js(),hh=it(),CW=Zb(),TW=QO(),iN=Cr(),mE=Ft(),xW=Vb(),kg=di(),Br=Ri(),fh=Ia(),IW=JO(),kW=yg(),AW=eN(),gE=Hb(),DW=_g(),yE=tN(),PW=Ig(),RW=2147483647,MW=1e3,OW=30*60*1e3,Ag=new Map,NW=1<<24,LW=1<<20,vE=class extends PW.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(i,r,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},_E=class{constructor(e,t,i){var r,s,o,a,l,c,u,d;if(this.credentials=t,this.options=i,this.connectivityState=Br.ConnectivityState.IDLE,this.currentPicker=new nN.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new fh.ChannelzCallTracker,this.childrenTracker=new fh.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof SW.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let h=(0,kg.parseUri)(e);if(h===null)throw new Error(`Could not parse target name "${e}"`);let f=(0,iN.mapUriDefaultScheme)(h);if(f===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},RW),(s=(r=this.callRefTimer).unref)===null||s===void 0||s.call(r),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new fh.ChannelzTrace,this.channelzRef=(0,fh.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,iN.getDefaultAuthority)(f);let g=(0,xW.mapProxyName)(f,i);this.target=g.target,this.options=Object.assign({},this.options,g.extraOptions),this.subchannelPool=(0,EW.getSubchannelPool)(((o=i["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new yE.MessageBufferTracker((a=i["grpc.retry_buffer_size"])!==null&&a!==void 0?a:NW,(l=i["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:LW),this.keepaliveTime=(c=i["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=i["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:OW,MW);let _={createSubchannel:(I,E)=>{let b=this.subchannelPool.getOrCreateSubchannel(this.target,I,Object.assign({},this.options,E),this.credentials);b.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",b.getChannelzRef());let M=new vE(b,this);return this.wrappedSubchannels.add(M),M},updateState:(I,E)=>{this.currentPicker=E;let b=this.pickQueue.slice();this.pickQueue=[],b.length>0&&this.callRefTimerUnref();for(let M of b)M.doPick();this.updateState(I)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:I=>{this.channelzEnabled&&this.childrenTracker.refChild(I)},removeChannelzChild:I=>{this.channelzEnabled&&this.childrenTracker.unrefChild(I)}};this.resolvingLoadBalancer=new bW.ResolvingLoadBalancer(this.target,_,i,(I,E)=>{I.retryThrottling?Ag.set(this.getTarget(),new yE.RetryThrottler(I.retryThrottling.maxTokens,I.retryThrottling.tokenRatio,Ag.get(this.getTarget()))):Ag.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=E,this.currentResolutionError=null,process.nextTick(()=>{let b=this.configSelectionQueue;this.configSelectionQueue=[],b.length>0&&this.callRefTimerUnref();for(let M of b)M.getConfig()})},I=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+I.code+' and details "'+I.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,DW.restrictControlPlaneStatusCode)(I.code,I.details)),{metadata:I.metadata}));let E=this.configSelectionQueue;this.configSelectionQueue=[],E.length>0&&this.callRefTimerUnref();for(let b of E)b.reportResolverError(I)}),this.filterStackFactory=new CW.FilterStackFactory([new TW.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(i,void 0,2));let S=new Error;(0,mE.trace)(hh.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=S.stack)===null||d===void 0?void 0:d.substring(S.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,mE.trace)(t??hh.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,kg.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,i,r;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(r=(i=this.callRefTimer).ref)===null||r===void 0||r.call(i))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(i=>i===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,mE.trace)(hh.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,kg.uriToString)(this.target)+" "+Br.ConnectivityState[this.connectivityState]+" -> "+Br.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Br.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let i of t)e!==i.currentState&&(i.timer&&clearTimeout(i.timer),this.removeConnectivityStateWatcher(i),i.callback());e!==Br.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Br.ConnectivityState.IDLE),this.currentPicker=new nN.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,i;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(i=(t=this.idleTimer).unref)===null||i===void 0||i.call(t)}maybeStartIdleTimer(){this.connectivityState!==Br.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===hh.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,i,r,s){let o=(0,gE.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new IW.LoadBalancingCall(this,e,t,i,r,s,o)}createRetryingCall(e,t,i,r,s){let o=(0,gE.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new yE.RetryingCall(this,e,t,i,r,s,o,this.retryBufferTracker,Ag.get(this.getTarget()))}createInnerCall(e,t,i,r,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,i,r,s):this.createRetryingCall(e,t,i,r,s)}createResolvingCall(e,t,i,r,s){let o=(0,gE.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,kW.deadlineToString)(t));let a={deadline:t,flags:s??hh.Propagate.DEFAULTS,host:i??this.defaultAuthority,parentCall:r},l=new AW.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Br.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,fh.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,kg.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,i){if(this.connectivityState===Br.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let r=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(i,new Error("Deadline passed without connectivity state change"));return}r=setTimeout(()=>{this.removeConnectivityStateWatcher(s),i(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:i,timer:r};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,i,r,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Br.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,i,r,s)}};Dg.InternalChannel=_E});var ES=j(Pg=>{"use strict";Object.defineProperty(Pg,"__esModule",{value:!0});Pg.ChannelImplementation=void 0;var FW=hm(),BW=rN(),wE=class{constructor(e,t,i){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof FW.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new BW.InternalChannel(e,t,i)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,i){this.internalChannel.watchConnectivityState(e,t,i)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,i,r,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,i,r,s)}};Pg.ChannelImplementation=wE});var fN=j(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});zi.Http2ServerCallStream=zi.ServerDuplexStreamImpl=zi.ServerWritableStreamImpl=zi.ServerReadableStreamImpl=zi.ServerUnaryCallImpl=void 0;var uN=Ce("events"),Ic=Ce("http2"),EE=Ce("stream"),sN=Ce("zlib"),wt=it(),CE=Kn(),UW=jb(),dN=Ft(),mh=om(),hN="server_call";function ph(n){dN.trace(wt.LogVerbosity.DEBUG,hN,n)}var qW="grpc-accept-encoding",zW="grpc-encoding",oN="grpc-message",aN="grpc-status",lN="grpc-timeout",VW=/(\d{1,8})\s*([HMSmun])/,$W={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},jW={[qW]:"identity,deflate,gzip",[zW]:"identity"},cN={[Ic.constants.HTTP2_HEADER_STATUS]:Ic.constants.HTTP_STATUS_OK,[Ic.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},GW={waitForTrailers:!0},SE=class extends uN.EventEmitter{constructor(e,t,i){super(),this.call=e,this.metadata=t,this.request=i,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};zi.ServerUnaryCallImpl=SE;var Rg=class extends EE.Readable{constructor(e,t,i,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=i,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,r)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};zi.ServerReadableStreamImpl=Rg;var gh=class extends EE.Writable{constructor(e,t,i,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=i,this.request=r,this.cancelled=!1,this.trailingMetadata=new CE.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,i){try{let r=this.call.serializeMessage(e);if(!this.call.write(r)){this.call.once("drain",i);return}}catch(r){this.emit("error",{details:(0,mh.getErrorMessage)(r),code:wt.Status.INTERNAL})}i()}_final(e){this.call.sendStatus({code:wt.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};zi.ServerWritableStreamImpl=gh;var kc=class extends EE.Duplex{constructor(e,t,i,r,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=i,this.deserialize=r,this.cancelled=!1,this.trailingMetadata=new CE.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};zi.ServerDuplexStreamImpl=kc;kc.prototype._read=Rg.prototype._read;kc.prototype._write=gh.prototype._write;kc.prototype._final=gh.prototype._final;var bE=class extends uN.EventEmitter{constructor(e,t,i){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=wt.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=wt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",r=>{}),this.stream.once("close",()=>{var r;ph("Request to method "+((r=this.handler)===null||r===void 0?void 0:r.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:wt.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in i&&(this.maxSendMessageSize=i["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in i&&(this.maxReceiveMessageSize=i["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let i=e.subarray(5);if(t==="identity")return i;if(t==="deflate"||t==="gzip"){let r;return t==="deflate"?r=sN.createInflate():r=sN.createGunzip(),new Promise((s,o)=>{let a=0,l=[];r.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(r.destroy(),o({code:wt.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),r.on("end",()=>{s(Buffer.concat(l))}),r.write(i),r.end()})}else return Promise.reject({code:wt.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,i=Object.assign(Object.assign(Object.assign({},cN),jW),t);this.stream.respond(i,GW)}receiveMetadata(e){let t=CE.Metadata.fromHttp2Headers(e);dN.isTracerEnabled(hN)&&ph("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let i=t.get(lN);if(i.length>0){let r=i[0].toString().match(VW);if(r===null){let a=new Error("Invalid deadline");return a.code=wt.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+r[1]*$W[r[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(HW,s,this),t.remove(lN)}return t.remove(Ic.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Ic.constants.HTTP2_HEADER_TE),t.remove(Ic.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,i)=>{let{stream:r}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){r.removeListener("data",c),r.removeListener("end",u),r.removeListener("error",u),i({code:wt.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(r.removeListener("data",c),r.removeListener("end",u),r.removeListener("error",u),d!==void 0){i({code:wt.Status.INTERNAL,details:d.message});return}if(s===0){i({code:wt.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let h=Buffer.concat(a,s),g=h.readUInt8(0)===1?e:"identity",_=o.getDecompressedMessage(h,g);if(Buffer.isBuffer(_)){t(o.deserializeMessageWithInternalError(_));return}_.then(S=>t(o.deserializeMessageWithInternalError(S)),S=>i(S.code?S:{code:wt.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return B(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,mh.getErrorMessage)(t),code:wt.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),i=t.byteLength,r=Buffer.allocUnsafe(i+5);return r.writeUInt8(0,0),r.writeUInt32BE(i,1),t.copy(r,5),r}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,i,r){return B(this,null,function*(){if(!this.checkCancelled()){if(i===void 0&&(i=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&i&&(e.metadata=i),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:wt.Status.OK,details:"OK",metadata:i})}catch(s){this.sendError({details:(0,mh.getErrorMessage)(s),code:wt.Status.INTERNAL})}}})}sendStatus(e){var t,i;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===wt.Status.OK),!this.checkCancelled())if(ph("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+wt.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var r;let s=Object.assign({[aN]:e.code,[oN]:encodeURI(e.details)},(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let r=Object.assign(Object.assign({[aN]:e.code,[oN]:encodeURI(e.details)},cN),(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.respond(r,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:wt.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:wt.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let i=new UW.StreamDecoder(this.maxReceiveMessageSize),r=!1,s=!1,o=!1,a=()=>B(this,null,function*(){!o&&r&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>B(this,null,function*(){let c;try{c=i.write(l)}catch(u){this.sendError({code:wt.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let h=u.readUInt8(0)===1?t:"identity",f;try{f=yield this.getDecompressedMessage(u,h)}catch(g){this.sendError(g);return}if(!f)return;yield this.pushOrBufferMessage(e,f)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>B(this,null,function*(){r=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),i=e.push(t);if(t===null||i===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return B(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return B(this,null,function*(){if(t===null){ph("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}ph("Received message of length "+t.length),this.isPushPending=!0;try{let i=yield this.deserializeMessage(t);this.canPush?e.push(i)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(i)}catch(i){this.bufferedMessages.length=0;let r=(0,mh.getErrorCode)(i);(r===null||r<wt.Status.OK||r>wt.Status.UNAUTHENTICATED)&&(r=wt.Status.INTERNAL),e.emit("error",{details:(0,mh.getErrorMessage)(i),code:r})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};zi.Http2ServerCallStream=bE;function HW(n){let e=new Error("Deadline exceeded");e.code=wt.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var IE=j(Mg=>{"use strict";Object.defineProperty(Mg,"__esModule",{value:!0});Mg.ServerCredentials=void 0;var pN=Ww(),yh=class{static createInsecure(){return new TE}static createSsl(e,t,i=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof i!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let r=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);r.push(a.cert_chain),s.push(a.private_key)}return new xE({ca:e||(0,pN.getDefaultRootsData)()||void 0,cert:r,key:s,requestCert:i,ciphers:pN.CIPHER_SUITES})}};Mg.ServerCredentials=yh;var TE=class extends yh{_isSecure(){return!1}_getSettings(){return null}},xE=class extends yh{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var yN=j(Lg=>{"use strict";Object.defineProperty(Lg,"__esModule",{value:!0});Lg.Server=void 0;var yo=Ce("http2"),us=it(),Aa=fN(),WW=IE(),mN=Cr(),Og=Ft(),or=xr(),KW=di(),Xn=Ia(),Ng=~(1<<31),YW=~(1<<31),QW=2e4,{HTTP2_HEADER_PATH:gN}=yo.constants,XW="server";function JW(){}function kE(n){return{code:us.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function ZW(n,e){let t=kE(e);switch(n){case"unary":return(i,r)=>{r(t,null)};case"clientStream":return(i,r)=>{r(t,null)};case"serverStream":return i=>{i.emit("error",t)};case"bidi":return i=>{i.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var AE=class{constructor(e){var t,i,r,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Xn.ChannelzTrace,this.callTracker=new Xn.ChannelzCallTracker,this.listenerChildrenTracker=new Xn.ChannelzChildrenTracker,this.sessionChildrenTracker=new Xn.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Xn.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Ng,this.maxConnectionAgeGraceMs=(i=this.options["grpc.max_connection_age_grace_ms"])!==null&&i!==void 0?i:Ng,this.keepaliveTimeMs=(r=this.options["grpc.keepalive_time_ms"])!==null&&r!==void 0?r:YW,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:QW,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,i,r;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,or.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,or.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,h=d.getCipher(),f=d.getCertificate(),g=d.getPeerCertificate();c={cipherSuiteStandardName:(t=h.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:h.standardName?null:h.name,localCertificate:f&&"raw"in f?f.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(i=e.state.localWindowSize)!==null&&i!==void 0?i:null,remoteFlowControlWindow:(r=e.state.remoteWindowSize)!==null&&r!==void 0?r:null}}}trace(e){Og.trace(us.LogVerbosity.DEBUG,XW,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let i=Object.keys(e);if(i.length===0)throw new Error("Cannot add an empty service to a server");i.forEach(r=>{let s=e[r],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[r],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=ZW(o,r),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(i=>{let r=e[i];this.unregister(r.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,i){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof WW.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof i!="function")throw new TypeError("callback must be a function");let r=(0,KW.parseUri)(e);if(r===null)throw new Error(`Could not parse port "${e}"`);let s=(0,mN.mapUriDefaultScheme)(r);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(f,g)=>{process.nextTick(()=>i(f,g))},l=()=>{let f;if(t._isSecure()){let g=Object.assign(o,t._getSettings());g.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,f=yo.createSecureServer(g),f.on("secureConnection",_=>{_.on("error",S=>{this.trace("An incoming TLS connection closed with error: "+S.message)})})}else f=yo.createServer(o);return f.setTimeout(0,JW),this._setupHandlers(f),f},c=(f,g,_)=>f.length===0?Promise.resolve({port:g,count:_}):Promise.all(f.map(S=>{this.trace("Attempting to bind "+(0,or.subchannelAddressToString)(S));let I;(0,or.isTcpSubchannelAddress)(S)?I={host:S.host,port:g}:I=S;let E=l();return new Promise((b,M)=>{let N=U=>{this.trace("Failed to bind "+(0,or.subchannelAddressToString)(S)+" with error "+U.message),b(U)};E.once("error",N),E.listen(I,()=>{if(this.shutdown){E.close(),b(new Error("bindAsync failed because server is shutdown"));return}let U=E.address(),R;typeof U=="string"?R={path:U}:R={host:U.address,port:U.port};let x=(0,Xn.registerChannelzSocket)((0,or.subchannelAddressToString)(R),()=>({localAddress:R,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(x),this.http2ServerList.push({server:E,channelzRef:x}),this.trace("Successfully bound "+(0,or.subchannelAddressToString)(R)),b("port"in R?R.port:g),E.removeListener("error",N)})})})).then(S=>{let I=0;for(let E of S)if(typeof E=="number"&&(I+=1,E!==g))throw new Error("Invalid state: multiple port numbers added from single address");return{port:g,count:I+_}}),u=f=>{if(f.length===0)return Promise.resolve({port:0,count:0});let g=f[0],_=l();return new Promise((S,I)=>{let E=b=>{this.trace("Failed to bind "+(0,or.subchannelAddressToString)(g)+" with error "+b.message),S(u(f.slice(1)))};_.once("error",E),_.listen(g,()=>{if(this.shutdown){_.close(),S({port:0,count:0});return}let b=_.address(),M={host:b.address,port:b.port},N=(0,Xn.registerChannelzSocket)((0,or.subchannelAddressToString)(M),()=>({localAddress:M,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(N),this.http2ServerList.push({server:_,channelzRef:N}),this.trace("Successfully bound "+(0,or.subchannelAddressToString)(M)),S(c(f.slice(1),b.port,1)),_.removeListener("error",E)})})},d={onSuccessfulResolution:(f,g,_)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),f.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let S;(0,or.isTcpSubchannelAddress)(f[0])?f[0].port===0?S=u(f):S=c(f,f[0].port,0):S=c(f,1,0),S.then(I=>{if(I.count===0){let E=`No address added out of total ${f.length} resolved`;Og.log(us.LogVerbosity.ERROR,E),a(new Error(E),0)}else I.count<f.length&&Og.log(us.LogVerbosity.INFO,`WARNING Only ${I.count} addresses added out of total ${f.length} resolved`),a(null,I.port)},I=>{let E=`No address added out of total ${f.length} resolved`;Og.log(us.LogVerbosity.ERROR,E),a(new Error(E),0)})},onError:f=>{a(new Error(f.details),0)}};(0,mN.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Xn.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(yo.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Xn.unregisterChannelzRef)(this.channelzRef)}register(e,t,i,r,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:i,deserialize:r,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Xn.unregisterChannelzRef)(this.channelzRef),e(s)},i=0;function r(){i--,i===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(i++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Xn.unregisterChannelzRef)(o)),r()}));this.sessions.forEach((s,o)=>{o.closed||(i+=1,o.close(r))}),i===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let i=t[yo.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof i!="string"||!i.startsWith("application/grpc")?(e.respond({[yo.constants.HTTP2_HEADER_STATUS]:yo.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,i=null){let r=new Aa.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=us.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed()),r.sendError(e)}_channelzHandler(e,t){let i=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),i?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed();return}let r=t[gN],s=this._retrieveHandler(r);if(!s){this._respondWithError(kE(r),e,i);return}let o=new Aa.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===us.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),i&&(o.once("streamEnd",a=>{a?i.streamTracker.addCallSucceeded():i.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{i.messagesSent+=1,i.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{i.messagesReceived+=1,i.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed(),o.sendError({code:us.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let i=t[gN],r=this._retrieveHandler(i);if(!r){this._respondWithError(kE(i),e,null);return}let s=new Aa.Http2ServerCallStream(e,r,this.options);this._runHandlerForCall(s,r,t)||s.sendError({code:us.Status.INTERNAL,details:`Unknown handler type: ${r.type}`})}_runHandlerForCall(e,t,i){var r;let s=e.receiveMetadata(i),o=(r=s.get("grpc-encoding")[0])!==null&&r!==void 0?r:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")e7(e,t,s,o);else if(a==="clientStream")t7(e,t,s,o);else if(a==="serverStream")n7(e,t,s,o);else if(a==="bidi")i7(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),i="null";t&&(typeof t=="string"?i=t:i=t.address+":"+t.port),this.serverAddressString=i;let r=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",r.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,Xn.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),h={ref:d,streamTracker:new Xn.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,h);let f=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+f),this.sessionChildrenTracker.refChild(d));let g=null,_=null,S=!1;if(this.maxConnectionAgeMs!==Ng){let E=this.maxConnectionAgeMs/10,b=Math.random()*E*2-E;g=(l=(a=setTimeout(()=>{var M,N;S=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+f);try{s.goaway(yo.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Ng&&(_=(N=(M=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||N===void 0?void 0:N.call(M))},this.maxConnectionAgeMs+b)).unref)===null||l===void 0?void 0:l.call(a)}let I=(u=(c=setInterval(()=>{var E,b;let M=(b=(E=setTimeout(()=>{S=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+f),s.close()},this.keepaliveTimeoutMs)).unref)===null||b===void 0?void 0:b.call(E);try{s.ping((N,U,R)=>{clearTimeout(M)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(S||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+f),this.sessionChildrenTracker.unrefChild(d),(0,Xn.unregisterChannelzRef)(d)),g&&clearTimeout(g),_&&clearTimeout(_),I&&clearTimeout(I),this.sessions.delete(s)})})}};Lg.Server=AE;function e7(n,e,t,i){return B(this,null,function*(){try{let r=yield n.receiveUnaryMessage(i);if(r===void 0||n.cancelled)return;let s=new Aa.ServerUnaryCallImpl(n,t,r);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(r){n.sendError(r)}})}function t7(n,e,t,i){let r=new Aa.ServerReadableStreamImpl(n,t,e.deserialize,i);function s(o,a,l,c){r.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(r.on("error",s),e.func(r,s))}function n7(n,e,t,i){return B(this,null,function*(){try{let r=yield n.receiveUnaryMessage(i);if(r===void 0||n.cancelled)return;let s=new Aa.ServerWritableStreamImpl(n,t,e.serialize,r);e.func(s)}catch(r){n.sendError(r)}})}function i7(n,e,t,i){let r=new Aa.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,i);n.cancelled||e.func(r)}});var vN=j(Fg=>{"use strict";Object.defineProperty(Fg,"__esModule",{value:!0});Fg.StatusBuilder=void 0;var DE=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Fg.StatusBuilder=DE});var PE=j(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.isDuration=vo.durationToMs=vo.msToDuration=void 0;function r7(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}vo.msToDuration=r7;function s7(n){return n.seconds*1e3+n.nanos/1e6|0}vo.durationToMs=s7;function o7(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}vo.isDuration=o7});var UE=j(_o=>{"use strict";var RE;Object.defineProperty(_o,"__esModule",{value:!0});_o.setup=_o.OutlierDetectionLoadBalancer=_o.OutlierDetectionLoadBalancingConfig=void 0;var Ug=Ri(),wN=it(),Da=PE(),SN=qE(),bN=Ks(),a7=_m(),l7=Js(),_N=xr(),c7=Ig(),u7=Ft(),d7="outlier_detection";function gn(n){u7.trace(wN.LogVerbosity.DEBUG,d7,n)}var BE="outlier_detection",h7=((RE=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&RE!==void 0?RE:"true")==="true",f7={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},p7={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Ac(n,e,t,i){if(e in n&&typeof n[e]!==t){let r=i?`${i}.${e}`:e;throw new Error(`outlier detection config ${r} parse error: expected ${t}, got ${typeof n[e]}`)}}function ME(n,e,t){let i=t?`${t}.${e}`:e;if(e in n){if(!(0,Da.isDuration)(n[e]))throw new Error(`outlier detection config ${i} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${i} parse error: values out of range for non-negative Duaration`)}}function Bg(n,e,t){let i=t?`${t}.${e}`:e;if(Ac(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${i} parse error: value out of range for percentage (0-100)`)}var vh=class n{constructor(e,t,i,r,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=i??3e5,this.maxEjectionPercent=r??10,this.successRateEjection=s?Object.assign(Object.assign({},f7),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},p7),o):null}getLoadBalancerName(){return BE}toJsonObject(){return{interval:(0,Da.msToDuration)(this.intervalMs),base_ejection_time:(0,Da.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Da.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(ME(e,"interval"),ME(e,"base_ejection_time"),ME(e,"max_ejection_time"),Bg(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Ac(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Bg(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Ac(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Ac(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Bg(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Bg(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Ac(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Ac(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Da.durationToMs)(e.interval):null,e.base_ejection_time?(0,Da.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Da.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(bN.validateLoadBalancingConfig))}};_o.OutlierDetectionLoadBalancingConfig=vh;var NE=class extends c7.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((i,r,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,r,s,o)})}getConnectivityState(){return this.ejected?Ug.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Ug.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Ug.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function OE(){return{success:0,failure:0}}var LE=class{constructor(){this.activeBucket=OE(),this.inactiveBucket=OE()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=OE()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},FE=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===l7.PickResultType.COMPLETE){let i=t.subchannel,r=i.getMapEntry();if(r){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===wN.Status.OK?r.counter.addSuccess():r.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel()})}else return t}},qg=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new a7.ChildLoadBalancerHandler((0,SN.createChildChannelControlHelper)(e,{createSubchannel:(t,i)=>{let r=e.createSubchannel(t,i),s=this.addressMap.get((0,_N.subchannelAddressToString)(t)),o=new NE(r,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,i)=>{t===Ug.ConnectivityState.READY?e.updateState(t,new FE(i,this.isCountingEnabled())):e.updateState(t,i)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;gn("Running success rate check");let i=t.request_volume,r=0,s=[];for(let[d,h]of this.addressMap){let f=h.counter.getLastSuccesses(),g=h.counter.getLastFailures();gn("Stats for "+d+": successes="+f+" failures="+g+" targetRequestVolume="+i),f+g>=i&&(r+=1,s.push(f/(f+g)))}if(gn("Found "+r+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),r<t.minimum_hosts)return;let o=s.reduce((d,h)=>d+h)/s.length,a=0;for(let d of s){let h=d-o;a+=h*h}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);gn("stdev="+c+" ejectionThreshold="+u);for(let[d,h]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let f=h.counter.getLastSuccesses(),g=h.counter.getLastFailures();if(f+g<i)continue;let _=f/(f+g);if(gn("Checking candidate "+d+" successRate="+_),_<u){let S=Math.random()*100;gn("Candidate "+d+" randomNumber="+S+" enforcement_percentage="+t.enforcement_percentage),S<t.enforcement_percentage&&(gn("Ejecting candidate "+d),this.eject(h,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;gn("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let i=0;for(let r of this.addressMap.values()){let s=r.counter.getLastSuccesses(),o=r.counter.getLastFailures();s+o>=t.request_volume&&(i+=1)}if(!(i<t.minimum_hosts))for(let[r,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(gn("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;gn("Candidate "+r+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(gn("Ejecting candidate "+r),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let i of e.subchannelWrappers)i.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,i;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(i=(t=this.ejectionTimer).unref)===null||i===void 0||i.call(t)}runChecks(){let e=new Date;if(gn("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,i]of this.addressMap.entries())if(i.currentEjectionTimestamp===null)i.ejectionTimeMultiplier>0&&(i.ejectionTimeMultiplier-=1);else{let r=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(i.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(r*i.ejectionTimeMultiplier,Math.max(r,s))),o<new Date&&(gn("Unejecting "+t),this.uneject(i))}}}updateAddressList(e,t,i){if(!(t instanceof vh))return;let r=new Set;for(let o of e)r.add((0,_N.subchannelAddressToString)(o));for(let o of r)this.addressMap.has(o)||(gn("Adding map entry for "+o),this.addressMap.set(o,{counter:new LE,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())r.has(o)||(gn("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,bN.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,i),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){gn("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else gn("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{gn("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return BE}};_o.OutlierDetectionLoadBalancer=qg;function m7(){h7&&(0,SN.registerLoadBalancerType)(BE,qg,vh)}_o.setup=m7});var qE=j(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.OutlierDetectionLoadBalancingConfig=Oe.BaseSubchannelWrapper=Oe.registerAdminService=Oe.FilterStackFactory=Oe.BaseFilter=Oe.PickResultType=Oe.QueuePicker=Oe.UnavailablePicker=Oe.ChildLoadBalancerHandler=Oe.subchannelAddressToString=Oe.validateLoadBalancingConfig=Oe.getFirstUsableConfig=Oe.registerLoadBalancerType=Oe.createChildChannelControlHelper=Oe.BackoffTimeout=Oe.durationToMs=Oe.uriToString=Oe.createResolver=Oe.registerResolver=Oe.log=Oe.trace=void 0;var EN=Ft();Object.defineProperty(Oe,"trace",{enumerable:!0,get:function(){return EN.trace}});Object.defineProperty(Oe,"log",{enumerable:!0,get:function(){return EN.log}});var CN=Cr();Object.defineProperty(Oe,"registerResolver",{enumerable:!0,get:function(){return CN.registerResolver}});Object.defineProperty(Oe,"createResolver",{enumerable:!0,get:function(){return CN.createResolver}});var g7=di();Object.defineProperty(Oe,"uriToString",{enumerable:!0,get:function(){return g7.uriToString}});var y7=PE();Object.defineProperty(Oe,"durationToMs",{enumerable:!0,get:function(){return y7.durationToMs}});var v7=qd();Object.defineProperty(Oe,"BackoffTimeout",{enumerable:!0,get:function(){return v7.BackoffTimeout}});var zg=Ks();Object.defineProperty(Oe,"createChildChannelControlHelper",{enumerable:!0,get:function(){return zg.createChildChannelControlHelper}});Object.defineProperty(Oe,"registerLoadBalancerType",{enumerable:!0,get:function(){return zg.registerLoadBalancerType}});Object.defineProperty(Oe,"getFirstUsableConfig",{enumerable:!0,get:function(){return zg.getFirstUsableConfig}});Object.defineProperty(Oe,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return zg.validateLoadBalancingConfig}});var _7=xr();Object.defineProperty(Oe,"subchannelAddressToString",{enumerable:!0,get:function(){return _7.subchannelAddressToString}});var w7=_m();Object.defineProperty(Oe,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return w7.ChildLoadBalancerHandler}});var zE=Js();Object.defineProperty(Oe,"UnavailablePicker",{enumerable:!0,get:function(){return zE.UnavailablePicker}});Object.defineProperty(Oe,"QueuePicker",{enumerable:!0,get:function(){return zE.QueuePicker}});Object.defineProperty(Oe,"PickResultType",{enumerable:!0,get:function(){return zE.PickResultType}});var S7=nE();Object.defineProperty(Oe,"BaseFilter",{enumerable:!0,get:function(){return S7.BaseFilter}});var b7=Zb();Object.defineProperty(Oe,"FilterStackFactory",{enumerable:!0,get:function(){return b7.FilterStackFactory}});var E7=Sm();Object.defineProperty(Oe,"registerAdminService",{enumerable:!0,get:function(){return E7.registerAdminService}});var C7=Ig();Object.defineProperty(Oe,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return C7.BaseSubchannelWrapper}});var T7=UE();Object.defineProperty(Oe,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return T7.OutlierDetectionLoadBalancingConfig}})});var TN=j(Vg=>{"use strict";Object.defineProperty(Vg,"__esModule",{value:!0});Vg.setup=void 0;var x7=Cr(),VE=class{constructor(e,t,i){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let r;e.authority===""?r="/"+e.path:r=e.path,this.addresses=[{path:r}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function I7(){(0,x7.registerResolver)("unix",VE)}Vg.setup=I7});var DN=j(Gg=>{"use strict";Object.defineProperty(Gg,"__esModule",{value:!0});Gg.setup=void 0;var xN=Ce("net"),$g=it(),$E=Kn(),IN=Cr(),kN=di(),k7=Ft(),A7="ip_resolver";function AN(n){k7.trace($g.LogVerbosity.DEBUG,A7,n)}var jE="ipv4",GE="ipv6",D7=443,jg=class{constructor(e,t,i){var r;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,AN("Resolver constructed for target "+(0,kN.uriToString)(e));let s=[];if(!(e.scheme===jE||e.scheme===GE)){this.error={code:$g.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new $E.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,kN.splitHostPort)(a);if(l===null){this.error={code:$g.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new $E.Metadata};return}if(e.scheme===jE&&!(0,xN.isIPv4)(l.host)||e.scheme===GE&&!(0,xN.isIPv6)(l.host)){this.error={code:$g.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new $E.Metadata};return}s.push({host:l.host,port:(r=l.port)!==null&&r!==void 0?r:D7})}this.addresses=s,AN("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function P7(){(0,IN.registerResolver)(jE,jg),(0,IN.registerResolver)(GE,jg)}Gg.setup=P7});var MN=j(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.setup=Ur.PickFirstLoadBalancer=Ur.shuffled=Ur.PickFirstLoadBalancingConfig=void 0;var PN=Ks(),In=Ri(),Hg=Js(),R7=Ft(),M7=it(),O7="pick_first";function HE(n){R7.trace(M7.LogVerbosity.DEBUG,O7,n)}var _h="pick_first",N7=250,wh=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return _h}toJsonObject(){return{[_h]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};Ur.PickFirstLoadBalancingConfig=wh;var WE=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Hg.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function RN(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let i=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[i],e[i]=r}return e}Ur.shuffled=RN;var Wg=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=In.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,i,r,s,o)=>{this.onSubchannelStateUpdate(t,i,r,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(In.ConnectivityState.READY,new WE(this.currentPick)):this.children.length===0?this.updateState(In.ConnectivityState.IDLE,new Hg.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(In.ConnectivityState.TRANSIENT_FAILURE,new Hg.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(In.ConnectivityState.CONNECTING,new Hg.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,i,r){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){i!==In.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){i===In.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),i===In.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,r&&(this.lastError=r),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,i]of this.children.entries())if(t>=e){let r=i.subchannel.getConnectivityState();if(r===In.ConnectivityState.IDLE||r===In.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,i;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===In.ConnectivityState.IDLE&&(HE("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var r;(r=this.children[e])===null||r===void 0||r.subchannel.startConnecting()})),this.connectionDelayTimeout=(i=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},N7)).unref)===null||i===void 0?void 0:i.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(HE("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){HE(In.ConnectivityState[this.currentState]+" -> "+In.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(i=>({subchannel:this.channelControlHelper.createSubchannel(i,{}),hasReportedTransientFailure:!1}));for(let{subchannel:i}of t)i.ref(),this.channelControlHelper.addChannelzChild(i.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:i}of this.children)if(i.addConnectivityStateListener(this.subchannelStateListener),i.getConnectivityState()===In.ConnectivityState.READY){this.pickSubchannel(i);return}for(let i of this.children)i.subchannel.getConnectivityState()===In.ConnectivityState.TRANSIENT_FAILURE&&(i.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof wh&&(t.getShuffleAddressList()&&(e=RN(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===In.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return _h}};Ur.PickFirstLoadBalancer=Wg;function L7(){(0,PN.registerLoadBalancerType)(_h,Wg,wh),(0,PN.registerDefaultLoadBalancerType)(_h)}Ur.setup=L7});var NN=j(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.setup=Dc.RoundRobinLoadBalancer=void 0;var F7=Ks(),kn=Ri(),Kg=Js(),B7=xr(),U7=Ft(),q7=it(),z7="round_robin";function ON(n){U7.trace(q7.LogVerbosity.DEBUG,z7,n)}var Yg="round_robin",KE=class n{getLoadBalancerName(){return Yg}constructor(){}toJsonObject(){return{[Yg]:{}}}static createFromJson(e){return new n}},YE=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Kg.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Qg=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=kn.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,i,r,s,o)=>{this.calculateAndUpdateState(),(r===kn.ConnectivityState.TRANSIENT_FAILURE||r===kn.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(kn.ConnectivityState.READY)>0){let e=this.subchannels.filter(i=>i.getConnectivityState()===kn.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(kn.ConnectivityState.READY,new YE(e,t))}else this.countSubchannelsWithState(kn.ConnectivityState.CONNECTING)>0?this.updateState(kn.ConnectivityState.CONNECTING,new Kg.QueuePicker(this)):this.countSubchannelsWithState(kn.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(kn.ConnectivityState.TRANSIENT_FAILURE,new Kg.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(kn.ConnectivityState.IDLE,new Kg.QueuePicker(this))}updateState(e,t){ON(kn.ConnectivityState[this.currentState]+" -> "+kn.ConnectivityState[e]),e===kn.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),ON("Connect to address list "+e.map(i=>(0,B7.subchannelAddressToString)(i))),this.subchannels=e.map(i=>this.channelControlHelper.createSubchannel(i,{}));for(let i of this.subchannels){i.ref(),i.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(i.getChannelzRef());let r=i.getConnectivityState();(r===kn.ConnectivityState.IDLE||r===kn.ConnectivityState.TRANSIENT_FAILURE)&&i.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Yg}};Dc.RoundRobinLoadBalancer=Qg;function V7(){(0,F7.registerLoadBalancerType)(Yg,Qg,KE)}Dc.setup=V7});var UN=j(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.experimental=ge.addAdminServicesToServer=ge.getChannelzHandlers=ge.getChannelzServiceDefinition=ge.InterceptorConfigurationError=ge.InterceptingCall=ge.RequesterBuilder=ge.ListenerBuilder=ge.StatusBuilder=ge.getClientChannel=ge.ServerCredentials=ge.Server=ge.setLogVerbosity=ge.setLogger=ge.load=ge.loadObject=ge.CallCredentials=ge.ChannelCredentials=ge.waitForClientReady=ge.closeClient=ge.Channel=ge.makeGenericClientConstructor=ge.makeClientConstructor=ge.loadPackageDefinition=ge.Client=ge.compressionAlgorithms=ge.propagate=ge.connectivityState=ge.status=ge.logVerbosity=ge.Metadata=ge.credentials=void 0;var Xg=Gw();Object.defineProperty(ge,"CallCredentials",{enumerable:!0,get:function(){return Xg.CallCredentials}});var $7=ES();Object.defineProperty(ge,"Channel",{enumerable:!0,get:function(){return $7.ChannelImplementation}});var j7=eE();Object.defineProperty(ge,"compressionAlgorithms",{enumerable:!0,get:function(){return j7.CompressionAlgorithms}});var G7=Ri();Object.defineProperty(ge,"connectivityState",{enumerable:!0,get:function(){return G7.ConnectivityState}});var Jg=hm();Object.defineProperty(ge,"ChannelCredentials",{enumerable:!0,get:function(){return Jg.ChannelCredentials}});var LN=bS();Object.defineProperty(ge,"Client",{enumerable:!0,get:function(){return LN.Client}});var QE=it();Object.defineProperty(ge,"logVerbosity",{enumerable:!0,get:function(){return QE.LogVerbosity}});Object.defineProperty(ge,"status",{enumerable:!0,get:function(){return QE.Status}});Object.defineProperty(ge,"propagate",{enumerable:!0,get:function(){return QE.Propagate}});var FN=Ft(),XE=TS();Object.defineProperty(ge,"loadPackageDefinition",{enumerable:!0,get:function(){return XE.loadPackageDefinition}});Object.defineProperty(ge,"makeClientConstructor",{enumerable:!0,get:function(){return XE.makeClientConstructor}});Object.defineProperty(ge,"makeGenericClientConstructor",{enumerable:!0,get:function(){return XE.makeClientConstructor}});var H7=Kn();Object.defineProperty(ge,"Metadata",{enumerable:!0,get:function(){return H7.Metadata}});var W7=yN();Object.defineProperty(ge,"Server",{enumerable:!0,get:function(){return W7.Server}});var K7=IE();Object.defineProperty(ge,"ServerCredentials",{enumerable:!0,get:function(){return K7.ServerCredentials}});var Y7=vN();Object.defineProperty(ge,"StatusBuilder",{enumerable:!0,get:function(){return Y7.StatusBuilder}});ge.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,i)=>t.compose(i),n),combineCallCredentials:(n,...e)=>e.reduce((t,i)=>t.compose(i),n),createInsecure:Jg.ChannelCredentials.createInsecure,createSsl:Jg.ChannelCredentials.createSsl,createFromSecureContext:Jg.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Xg.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Xg.CallCredentials.createFromGoogleCredential,createEmpty:Xg.CallCredentials.createEmpty};var Q7=n=>n.close();ge.closeClient=Q7;var X7=(n,e,t)=>n.waitForReady(e,t);ge.waitForClientReady=X7;var J7=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};ge.loadObject=J7;var Z7=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};ge.load=Z7;var eK=n=>{FN.setLogger(n)};ge.setLogger=eK;var tK=n=>{FN.setLoggerVerbosity(n)};ge.setLogVerbosity=tK;var nK=n=>LN.Client.prototype.getChannel.call(n);ge.getClientChannel=nK;var Zg=_S();Object.defineProperty(ge,"ListenerBuilder",{enumerable:!0,get:function(){return Zg.ListenerBuilder}});Object.defineProperty(ge,"RequesterBuilder",{enumerable:!0,get:function(){return Zg.RequesterBuilder}});Object.defineProperty(ge,"InterceptingCall",{enumerable:!0,get:function(){return Zg.InterceptingCall}});Object.defineProperty(ge,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Zg.InterceptorConfigurationError}});var BN=Ia();Object.defineProperty(ge,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return BN.getChannelzServiceDefinition}});Object.defineProperty(ge,"getChannelzHandlers",{enumerable:!0,get:function(){return BN.getChannelzHandlers}});var iK=Sm();Object.defineProperty(ge,"addAdminServicesToServer",{enumerable:!0,get:function(){return iK.addAdminServicesToServer}});var rK=qE();ge.experimental=rK;var sK=zb(),oK=TN(),aK=DN(),lK=MN(),cK=NN(),uK=UE(),dK=Ia();sK.setup(),oK.setup(),aK.setup(),lK.setup(),cK.setup(),uK.setup(),dK.setup()});var na=class extends Error{};na.prototype.name="InvalidTokenError";function YU(n){return decodeURIComponent(atob(n).replace(/(.)/g,(e,t)=>{let i=t.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function QU(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return YU(e)}catch{return atob(e)}}function UI(n,e){if(typeof n!="string")throw new na("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,i=n.split(".")[t];if(typeof i!="string")throw new na(`Invalid token specified: missing part #${t+1}`);let r;try{r=QU(i)}catch(s){throw new na(`Invalid token specified: invalid base64 for part #${t+1} (${s.message})`)}try{return JSON.parse(r)}catch(s){throw new na(`Invalid token specified: invalid json for part #${t+1} (${s.message})`)}}var si=(()=>{let e=class e{constructor(){this._HttpClient=H($n),this._Router=H(Et),this.userData=null}setHeaders(){let i=localStorage.getItem("S&MToken");if(!i)throw new Error("No token found");return new mI({Authorization:`Bearer ${i}`})}signUp(i){return this._HttpClient.post(`${te.socialAppUrl}users/signup`,i)}signIn(i){return this._HttpClient.post(`${te.socialAppUrl}users/signin`,i)}changePassword(i){return this._HttpClient.patch(`${te.socialAppUrl}users/change-password`,i)}uploadProfilePhoto(i){return this._HttpClient.put(`${te.socialAppUrl}users/upload-photo`,i)}GetLoggedUserData(){return this._HttpClient.get(`${te.socialAppUrl}users/profile-data`,{headers:this.setHeaders()})}decodeUserData(){localStorage.getItem("S&MToken")!==null&&(this.userData=UI(localStorage.getItem("S&MToken")),console.log("userData: ",this.userData))}logOut(){localStorage.removeItem("S&MToken"),this.userData=null,window.location.href="/login"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var XU=()=>["m/movies","popular"],JU=()=>["m/movies","now_playing"],ZU=()=>["m/movies","upcoming"],e5=()=>["m/movies","top_rated"],t5=()=>["m/tvshows","popular"],n5=()=>["m/tvshows","airing_today"],i5=()=>["m/tvshows","on_the_air"],r5=()=>["m/tvshows","top_rated"],s5=()=>["m/people","popular"],o5=()=>["m/people","trending"],qI=(()=>{let e=class e{constructor(){this._AuthenticationService=H(si)}logout(){}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-navbar"]],standalone:!0,features:[he],decls:68,vars:20,consts:[[1,"flex","items-center","p-4","bg-gray-900","shadow-lg","relative","z-20","w-full"],[1,"text-yellow-500","text-3xl","font-extrabold","flex","items-center","rounded-full","w-20","h-20","crp"],["routerLink","home"],["src","assets/images/h_Egypt_logo2.jpeg","alt","logo",1,"w-full","rounded-full"],[1,"flex","gap-8","items-center","text-white","text-sm","ms-5"],[1,"relative"],[1,"hover:text-yellow-500","transition-colors","cursor-pointer"],[1,"fa-solid","fa-clapperboard","mr-2"],[1,"dropdown-menu","absolute","opacity-0","invisible","transition-all","duration-300","ease-in-out","bg-gray-800","text-white","text-base","rounded-lg","shadow-lg","mt-2","p-4","space-y-2"],[1,"hover:text-yellow-500",3,"routerLink"],[1,"fa-solid","fa-tv","mr-2"],[1,"fa-solid","fa-users","mr-2"],[1,"hover:text-yellow-500","capitalize",3,"routerLink"],[1,"fa-solid","fa-user-circle","mr-2"],["routerLink","/m/watchlist",1,"hover:text-yellow-500"],["routerLink","/m/favourites",1,"hover:text-yellow-500"],[1,"hover:text-yellow-500"],[1,"hover:text-red-500","transition-colors","cursor-pointer",3,"click"],[1,"fa-solid","fa-right-from-bracket","mr-2"]],template:function(r,s){r&1&&(p(0,"nav",0)(1,"div",1)(2,"a",2),L(3,"img",3),m()(),p(4,"ul",4)(5,"li",5)(6,"a",6),L(7,"i",7),D(8,"Movies "),m(),p(9,"ul",8)(10,"li")(11,"a",9),D(12,"Popular"),m()(),p(13,"li")(14,"a",9),D(15,"Now Playing"),m()(),p(16,"li")(17,"a",9),D(18,"Upcoming"),m()(),p(19,"li")(20,"a",9),D(21,"Top Rated"),m()()()(),p(22,"li",5)(23,"a",6),L(24,"i",10),D(25,"TV Shows "),m(),p(26,"ul",8)(27,"li")(28,"a",9),D(29,"Popular"),m()(),p(30,"li")(31,"a",9),D(32,"Airing Today"),m()(),p(33,"li")(34,"a",9),D(35,"on TV"),m()(),p(36,"li")(37,"a",9),D(38,"Top Rated"),m()()()(),p(39,"li")(40,"a",6),L(41,"i",11),D(42,"people "),m(),p(43,"ul",8)(44,"li")(45,"a",9),D(46,"Popular"),m()(),p(47,"li")(48,"a",12),D(49,"trending"),m()()()(),p(50,"li",5)(51,"a",6),L(52,"i",13),D(53,"User "),m(),p(54,"ul",8)(55,"li")(56,"a",14),D(57,"Watchlist"),m()(),p(58,"li")(59,"a",15),D(60,"Favorites"),m()(),p(61,"li")(62,"a",16),D(63,"Settings"),m()(),p(64,"li")(65,"a",17),oe("click",function(){return s._AuthenticationService.logOut()}),L(66,"i",18),D(67,"Logout "),m()()()()()()),r&2&&(v(11),k("routerLink",Ki(10,XU)),v(3),k("routerLink",Ki(11,JU)),v(3),k("routerLink",Ki(12,ZU)),v(3),k("routerLink",Ki(13,e5)),v(8),k("routerLink",Ki(14,t5)),v(3),k("routerLink",Ki(15,n5)),v(3),k("routerLink",Ki(16,i5)),v(3),k("routerLink",Ki(17,r5)),v(8),k("routerLink",Ki(18,s5)),v(3),k("routerLink",Ki(19,o5)))},dependencies:[Ye],styles:["nav[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(17 24 39 / var(--tw-bg-opacity));--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}ul[_ngcontent-%COMP%]{display:flex;align-items:center;gap:2rem;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity));font-size:small}li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}li[_ngcontent-%COMP%]{position:relative}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{position:absolute;margin-top:.5rem;border-radius:.5rem;--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity));padding:1rem;font-size:1rem;line-height:1.5rem;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity));--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{--tw-text-opacity: 1;color:rgb(194 120 3 / var(--tw-text-opacity))}nav[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:all .3s ease;top:100%;left:0;padding:10px;border-radius:8px;z-index:999}nav[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover   ul[_ngcontent-%COMP%]{opacity:1;visibility:visible}.dropdown-menu[_ngcontent-%COMP%]{padding:10px;display:block}"]});let n=e;return n})();var zI=(()=>{let e=class e{constructor(i){this.platformId=i}loadFlowbite(i){_l(this.platformId)&&import("./chunk-NT6Y5EKC.mjs").then(r=>{i(r)})}};e.\u0275fac=function(r){return new(r||e)(be(bn))},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var VI=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-footer"]],standalone:!0,features:[he],decls:20,vars:0,consts:[[1,"bg-white","rounded-lg","shadow","m-4","dark:bg-gray-800","py-20"],[1,"w-full","mx-auto","max-w-screen-xl","p-4","md:flex","md:items-center","md:justify-between"],[1,"text-sm","text-gray-500","sm:text-center","dark:text-gray-400"],[1,"hover:underline"],[1,"flex","flex-wrap","items-center","mt-3","text-sm","font-medium","text-gray-500","dark:text-gray-400","sm:mt-0"],[1,"hover:underline","me-4","md:me-6"]],template:function(r,s){r&1&&(p(0,"footer",0)(1,"div",1)(2,"span",2),D(3,"\xA9 2023 "),p(4,"a",3),D(5,"CinemaX\u2122"),m(),D(6,". All Rights Reserved. "),m(),p(7,"ul",4)(8,"li")(9,"a",5),D(10,"About"),m()(),p(11,"li")(12,"a",5),D(13,"Privacy Policy"),m()(),p(14,"li")(15,"a",5),D(16,"Licensing"),m()(),p(17,"li")(18,"a",3),D(19,"Contact"),m()()()()())}});let n=e;return n})();var $I=(()=>{let e=class e{constructor(){this.title="moviesdb",this._FlowbiteService=H(zI)}ngOnInit(){this._FlowbiteService.loadFlowbite(i=>{})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-root"]],standalone:!0,features:[he],decls:2,vars:0,consts:[[1,"bg-main"]],template:function(r,s){r&1&&(p(0,"div",0),L(1,"router-outlet"),m())},dependencies:[mr],styles:['.bg-main[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#fff,#f0f0f0);background-size:cover;background-blend-mode:normal;position:relative}.bg-main[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:url(https://www.transparenttextures.com/patterns/asfalt.png) repeat;opacity:.1;pointer-events:none}']});let n=e;return n})();var a5="firebase",l5="10.13.2";Yi(a5,l5,"app");var Ds=new uI("ANGULARFIRE2_VERSION");var c5=(n,e)=>{let t=e?[e]:FI(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},Zr=class{constructor(){return c5(u5)}},u5="app-check";function Ky(){}var Yf=class{zone;delegate;constructor(e,t=Bx){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,i)}},Yy=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ky,{},Ky,Ky)),t.pipe(Nu({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},bl=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Yf(Zone.current)),this.insideAngular=t.run(()=>new Yf(Zone.current,fl)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(be(Vn))};static \u0275prov=at({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function d5(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function zt(n){return h5(d5())(n)}function h5(n){return function(t){return t=t.lift(new Yy(n.ngZone)),t.pipe(pl(n.outsideAngular),Jo(n.insideAngular))}}var f5="firebase",p5="10.13.2";dn.registerVersion(f5,p5,"app-compat");var m5=["ngOnDestroy"],GI=(n,e,t,i={})=>new Proxy(n,{get:(r,s)=>t.runOutsideAngular(()=>{if(n[s])return i?.spy?.get&&i.spy.get(s,n[s]),n[s];if(m5.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return i?.spy?.apply&&i.spy.apply(s,c,d),d})})})});var Qf=class{constructor(e){return e}},Ps=new ln("angularfire2.app.options"),Rs=new ln("angularfire2.app.name");function ia(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||i;let o=dn.apps.filter(a=>a&&a.name===r.name)[0]||e.runOutsideAngular(()=>dn.initializeApp(n,r));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;g5("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Qf(o)}var g5=(n,...e)=>{Vy()&&typeof console<"u"&&console[n](...e)},y5={provide:Qf,useFactory:ia,deps:[Ps,Vn,[new Wx,Rs]]},HI=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:Ps,useValue:t},{provide:Rs,useValue:i}]}}constructor(t){dn.registerVersion("angularfire",Ds.full,"core"),dn.registerVersion("angularfire",Ds.full,"app-compat"),dn.registerVersion("angular",dI.full,t.toString())}static \u0275fac=function(i){return new(i||n)(be(bn))};static \u0275mod=xs({type:n});static \u0275inj=Ts({providers:[y5]})}return n})();function El(n,e,t,i,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return v5(r,o)||(jI("error",`${e} was already initialized on the ${t} Firebase App with different settings.${_5?" You may need to reload as Firebase is not HMR aware.":""}`),jI("warn",{is:r,was:o})),s;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,r]),a}}function v5(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var _5=typeof module<"u"&&!!module.hot,jI=(n,...e)=>{Vy()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var w5=new Map,S5={activated:!1,tokenObservers:[]},b5={initialized:!1,enabled:!1};function Qi(n){return w5.get(n)||Object.assign({},S5)}function ZI(){return b5}var E5="https://content-firebaseappcheck.googleapis.com/v1";var C5="exchangeDebugToken",WI={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Qce=24*60*60*1e3;var Jy=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return B(this,null,function*(){this.stop();try{this.pending=new un,this.pending.promise.catch(t=>{}),yield T5(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new un,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function T5(n){return new Promise(e=>{setTimeout(e,n)})}var x5={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Ms=new PI("appCheck","AppCheck",x5);function ek(n){if(!Qi(n).activated)throw Ms.create("use-before-activation",{appName:n.name})}function tk(i,r){return B(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(f){throw Ms.create("fetch-network-error",{originalErrorMessage:f?.message})}if(l.status!==200)throw Ms.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(f){throw Ms.create("fetch-parse-error",{originalErrorMessage:f?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Ms.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function nk(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${E5}/projects/${t}/apps/${i}:${C5}?key=${r}`,body:{debug_token:e}}}var I5="firebase-app-check-database",k5=1,Zy="firebase-app-check-store";var Xf=null;function A5(){return Xf||(Xf=new Promise((n,e)=>{try{let t=indexedDB.open(I5,k5);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Ms.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(Zy,{keyPath:"compositeKey"})}}}catch(t){e(Ms.create("storage-open",{originalErrorMessage:t?.message}))}}),Xf)}function D5(n,e){return P5(R5(n),e)}function P5(n,e){return B(this,null,function*(){let i=(yield A5()).transaction(Zy,"readwrite"),s=i.objectStore(Zy).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},i.onerror=l=>{var c;a(Ms.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function R5(n){return`${n.options.appId}-${n.name}`}var ev=new As("@firebase/app-check");function Xy(n,e){return Nf()?D5(n,e).catch(t=>{ev.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function ik(){return ZI().enabled}function rk(){return B(this,null,function*(){let n=ZI();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var M5={error:"UNKNOWN_ERROR"};function O5(n){return Mf.encodeString(JSON.stringify(n),!1)}function tv(n,e=!1){return B(this,null,function*(){let t=n.app;ek(t);let i=Qi(t),r=i.token,s;if(r&&!Vu(r)&&(i.token=void 0,r=void 0),!r){let l=yield i.cachedTokenPromise;l&&(Vu(l)?r=l:yield Xy(t,void 0))}if(!e&&r&&Vu(r))return{token:r.token};let o=!1;if(ik()){i.exchangeTokenPromise||(i.exchangeTokenPromise=tk(nk(t,yield rk()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let l=yield i.exchangeTokenPromise;return yield Xy(t,l),i.token=l,{token:l.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=yield Qi(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?ev.warn(l.message):ev.error(l),s=l}let a;return r?s?Vu(r)?a={token:r.token,internalError:s}:a=YI(s):(a={token:r.token},i.token=r,yield Xy(t,r)):a=YI(s),o&&B5(t,a),a})}function N5(n){return B(this,null,function*(){let e=n.app;ek(e);let{provider:t}=Qi(e);if(ik()){let i=yield rk(),{token:r}=yield tk(nk(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function L5(n,e,t,i){let{app:r}=n,s=Qi(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Vu(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),KI(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>KI(n))}function sk(n,e){let t=Qi(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function KI(n){let{app:e}=n,t=Qi(e),i=t.tokenRefresher;i||(i=F5(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function F5(n){let{app:e}=n;return new Jy(()=>B(this,null,function*(){let t=Qi(e),i;if(t.token?i=yield tv(n,!0):i=yield tv(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=Qi(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},WI.RETRIAL_MIN_WAIT,WI.RETRIAL_MAX_WAIT)}function B5(n,e){let t=Qi(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function Vu(n){return n.expireTimeMillis-Date.now()>0}function YI(n){return{token:O5(M5),error:n}}var nv=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Qi(this.app);for(let t of e)sk(this.app,t.next);return Promise.resolve()}};function U5(n,e){return new nv(n,e)}function q5(n){return{getToken:e=>tv(n,e),getLimitedUseToken:()=>N5(n),addTokenListener:e=>L5(n,"INTERNAL",e),removeTokenListener:e=>sk(n.app,e)}}var z5="@firebase/app-check",V5="0.8.8";var $5="app-check",QI="app-check-internal";function j5(){ta(new ri($5,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return U5(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(QI).initialize()})),ta(new ri(QI,n=>{let e=n.getProvider("app-check").getImmediate();return q5(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Yi(z5,V5)}j5();var G5=["localhost","0.0.0.0","127.0.0.1"],lue=typeof window<"u"&&G5.includes(window.location.hostname);var $u=new ln("angularfire2.auth.use-emulator"),ju=new ln("angularfire2.auth.settings"),Gu=new ln("angularfire2.auth.tenant-id"),Hu=new ln("angularfire2.auth.langugage-code"),Wu=new ln("angularfire2.auth.use-device-language"),Ku=new ln("angularfire.auth.persistence"),Yu=(n,e,t,i,r,s,o,a)=>El(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),i&&(l.tenantId=i),l.languageCode=r,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,i,r,s,o,a]),Jf=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,r,s,o,a,l,c,u,d,h,f){let g=new Fx,_=yi(void 0).pipe(Jo(o.outsideAngular),Xr(()=>s.runOutsideAngular(()=>import("./chunk-ZLOPIX5R.mjs"))),vt(()=>ia(t,s,i)),vt(S=>Yu(S,s,a,c,u,d,l,h)),qy({bufferSize:1,refCount:!1}));if(Rf(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=yi(null);else{_.pipe(zx()).subscribe();let S=_.pipe(Xr(b=>b.getRedirectResult().then(M=>M,()=>null)),zt,qy({bufferSize:1,refCount:!1})),I=_.pipe(Xr(b=>new Es(M=>({unsubscribe:s.runOutsideAngular(()=>b.onAuthStateChanged(N=>M.next(N),N=>M.error(N),()=>M.complete()))})))),E=_.pipe(Xr(b=>new Es(M=>({unsubscribe:s.runOutsideAngular(()=>b.onIdTokenChanged(N=>M.next(N),N=>M.error(N),()=>M.complete()))}))));this.authState=S.pipe(zy(I),pl(o.outsideAngular),Jo(o.insideAngular)),this.user=S.pipe(zy(E),pl(o.outsideAngular),Jo(o.insideAngular)),this.idToken=this.user.pipe(Xr(b=>b?Cs(b.getIdToken()):yi(null))),this.idTokenResult=this.user.pipe(Xr(b=>b?Cs(b.getIdTokenResult()):yi(null))),this.credential=Ou(S,g,this.authState.pipe(Zo(b=>!b))).pipe(vt(b=>b?.user?b:null),pl(o.outsideAngular),Jo(o.insideAngular))}return GI(this,_,s,{spy:{apply:(S,I,E)=>{(S.startsWith("signIn")||S.startsWith("createUser"))&&E.then(b=>g.next(b))}}})}static \u0275fac=function(i){return new(i||n)(be(Ps),be(Rs,8),be(bn),be(Vn),be(bl),be($u,8),be(ju,8),be(Gu,8),be(Hu,8),be(Wu,8),be(Ku,8),be(Zr,8))};static \u0275prov=at({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var wD=By(zA(),1);var gp="5",SD="v",bD="s",ED="r",CD="f",TD=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,xD="ls",ID="p",Gv="ac",kD="websocket",AD="long_polling";var Hv=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Yt(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Lf(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Wv=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ti(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var DD=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Hv(e)}}catch{}return new Wv},fa=DD("localStorage"),Kv=DD("sessionStorage");var Pl=new As("@firebase/database"),PD=function(){let n=1;return function(){return n++}}(),RD=function(n){let e=LI(n),t=new NI;t.update(e);let i=t.digest();return Mf.encodeByteArray(i)},Dd=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Dd.apply(null,i):typeof i=="object"?e+=Yt(i):e+=i,e+=" "}return e},pa=null,VA=!0,MD=function(n,e){ie(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Pl.logLevel=xi.VERBOSE,pa=Pl.log.bind(Pl),e&&Kv.set("logging_enabled",!0)):typeof n=="function"?pa=n:(pa=null,Kv.remove("logging_enabled"))},hn=function(...n){if(VA===!0&&(VA=!1,pa===null&&Kv.get("logging_enabled")===!0&&MD(!0)),pa){let e=Dd.apply(null,n);pa(e)}},Pd=function(n){return function(...e){hn(n,...e)}},Yv=function(...n){let e="FIREBASE INTERNAL ERROR: "+Dd(...n);Pl.error(e)},Sr=function(...n){let e=`FIREBASE FATAL ERROR: ${Dd(...n)}`;throw Pl.error(e),new Error(e)},Cn=function(...n){let e="FIREBASE WARNING: "+Dd(...n);Pl.warn(e)},Zq=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Cn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},zp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ez=function(n){if(gr()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Us="[MIN_NAME]",es="[MAX_NAME]",ga=function(n,e){if(n===e)return 0;if(n===Us||e===es)return-1;if(e===Us||n===es)return 1;{let t=$A(n),i=$A(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},tz=function(n,e){return n===e?0:n<e?-1:1},od=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Yt(e))},Y_=function(n){if(typeof n!="object"||n===null)return Yt(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=Yt(e[i]),t+=":",t+=Y_(n[e[i]]);return t+="}",t},OD=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function fn(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var ND=function(n){ie(!zp(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,l;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(r?1:0),c.reverse();let u=c.join(""),d="";for(l=0;l<64;l+=8){let h=parseInt(u.substr(l,8),2).toString(16);h.length===1&&(h="0"+h),d=d+h}return d.toLowerCase()},nz=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},iz=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function rz(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var sz=new RegExp("^-?(0*)\\d{1,10}$"),oz=-2147483648,az=2147483647,$A=function(n){if(sz.test(n)){let e=Number(n);if(e>=oz&&e<=az)return e}return null},ql=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Cn("Exception was thrown by user callback.",t),e},Math.floor(0))}},lz=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ud=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var yp=class{constructor(e,t,i,r,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=fa.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&fa.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function cz(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function LD(n,e,t){ie(typeof e=="string","typeof type must == string"),ie(typeof t=="object","typeof params must == object");let i;if(e===kD)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===AD)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);cz(n)&&(t.ns=n.namespace);let r=[];return fn(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var Qv=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Ti(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return kI(this.counters_)}};var Bv={},Uv={};function Q_(n){let e=n.toString();return Bv[e]||(Bv[e]=new Qv),Bv[e]}function uz(n,e){let t=n.toString();return Uv[t]||(Uv[t]=e()),Uv[t]}var X_="";function J_(n){X_=n}var dz=16384,hz=45e3,md=null;typeof MozWebSocket<"u"?md=MozWebSocket:typeof WebSocket<"u"&&(md=WebSocket);function fz(n){md=n}var Al=(()=>{class n{constructor(t,i,r,s,o,a,l){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Pd(this.connId),this.stats_=Q_(i),this.connURL=n.connectionURL_(i,a,l,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[SD]=gp,!gr()&&typeof location<"u"&&location.hostname&&TD.test(location.hostname)&&(a[ED]=CD),i&&(a[bD]=i),r&&(a[xD]=r),s&&(a[Gv]=s),o&&(a[ID]=o),LD(t,kD,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,fa.set("previous_websocket_failure",!0);try{let r;if(gr()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${gp}/${X_}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new md(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&md!==null&&!n.forceDisallow_}static previouslyFailed(){return fa.isInMemoryStorage||fa.get("previous_websocket_failure")===!0}markConnectionHealthy(){fa.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=Lf(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(ie(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=Yt(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=OD(i,dz);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(hz))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),jA="@firebase/database",GA="1.0.8";var Xv=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){Cn(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Jv=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(hn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Cn(e)}},dd=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Zv=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&ql(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var HA="start",pz="close",mz="pLPCommand",gz="pRTLPCB",FD="id",BD="pw",UD="ser",yz="cb",vz="seg",_z="ts",wz="d",Sz="dframe",qD=1870,zD=30,bz=qD-zD,Ez=25e3,Cz=3e4,gd=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Pd(e),this.stats_=Q_(t),this.urlFn=l=>(this.appCheckToken&&(l[Gv]=this.appCheckToken),LD(t,AD,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Zv(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Cz)),ez(()=>{if(this.isClosed_)return;this.scriptTagHolder=new e_((...s)=>{let[o,a,l,c,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===HA)this.id=a,this.password=l;else if(o===pz)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[HA]="t",i[UD]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[yz]=this.scriptTagHolder.uniqueCallbackIdentifier),i[SD]=gp,this.transportSessionId&&(i[bD]=this.transportSessionId),this.lastSessionId&&(i[xD]=this.lastSessionId),this.applicationId&&(i[ID]=this.applicationId),this.appCheckToken&&(i[Gv]=this.appCheckToken),typeof location<"u"&&location.hostname&&TD.test(location.hostname)&&(i[ED]=CD);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return gr()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!nz()&&!iz()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Yt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=II(t),r=OD(i,bz);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(gr())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Sz]="t",i[FD]=e,i[BD]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Yt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},e_=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,gr())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=PD(),window[mz+this.uniqueCallbackIdentifier]=e,window[gz+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";</script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){hn("frame writing exception"),a.stack&&hn(a.stack),hn(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||hn("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[FD]=this.myID,e[BD]=this.myPW,e[UD]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+zD+i.length<=qD;){let o=this.pendingSegs.shift();i=i+"&"+vz+r+"="+o.seg+"&"+_z+r+"="+o.ts+"&"+wz+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(Ez)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){gr()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{hn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var VD=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[gd,Al]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let i=Al&&Al.isAvailable(),r=i&&!Al.previouslyFailed();if(t.webSocketOnly&&(i||Cn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Al];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Tz=6e4,xz=5e3,Iz=10*1024,kz=100*1024,qv="t",WA="d",Az="s",KA="r",Dz="e",YA="o",QA="a",XA="n",JA="p",Pz="h",t_=class{constructor(e,t,i,r,s,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Pd("c:"+this.id+":"),this.transportManager_=new VD(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ud(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>kz?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Iz?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(qv in e){let t=e[qv];t===QA?this.upgradeIfSecondaryHealthy_():t===KA?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===YA&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=od("t",e),i=od("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:JA,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:QA,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:XA,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=od("t",e),i=od("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=od(qv,e);if(WA in e){let i=e[WA];if(t===Pz){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===XA){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Az?this.onConnectionShutdown_(i):t===KA?this.onReset_(i):t===Dz?Yv("Server Error: "+i):t===YA?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Yv("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),gp!==i&&Cn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ud(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Tz))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ud(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(xz))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:JA,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(fa.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var vp=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var _p=class{constructor(e){this.allowedEvents_=e,this.listeners_={},ie(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){ie(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var wp=class n extends _p{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!$y()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return ie(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var ZA=32,eD=768,tt=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function et(){return new tt("")}function Ve(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function qs(n){return n.pieces_.length-n.pieceNum_}function ct(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new tt(n.pieces_,e)}function Z_(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Rz(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function yd(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function $D(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new tt(e,0)}function Tt(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof tt)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new tt(t,0)}function $e(n){return n.pieceNum_>=n.pieces_.length}function Rn(n,e){let t=Ve(n),i=Ve(e);if(t===null)return e;if(t===i)return Rn(ct(n),ct(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Mz(n,e){let t=yd(n,0),i=yd(e,0);for(let r=0;r<t.length&&r<i.length;r++){let s=ga(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function ew(n,e){if(qs(n)!==qs(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function ki(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(qs(n)>qs(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var n_=class{constructor(e,t){this.errorPrefix_=t,this.parts_=yd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=zu(this.parts_[i]);jD(this)}};function Oz(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=zu(e),jD(n)}function Nz(n){let e=n.parts_.pop();n.byteLength_-=zu(e),n.parts_.length>0&&(n.byteLength_-=1)}function jD(n){if(n.byteLength_>eD)throw new Error(n.errorPrefix_+"has a key path longer than "+eD+" bytes ("+n.byteLength_+").");if(n.parts_.length>ZA)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ZA+") or object contains a cycle "+ha(n))}function ha(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var i_=class n extends _p{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(e){return ie(e==="visible","Unknown event type: "+e),[this.visible_]}};var ad=1e3,Lz=60*5*1e3,tD=30*1e3,Fz=1.3,Bz=3e4,Uz="server_kill",nD=3,tw=(()=>{class n extends vp{constructor(t,i,r,s,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Pd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ad,this.maxReconnectDelay_=Lz,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!gr())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");i_.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&wp.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(Yt(o)),ie(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new un,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),ie(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ie(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&Ti(t,"w")){let r=ks(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();Cn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||MI(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=tD)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=RI(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),ie(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Yt(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):Yv("Unrecognized action received from server: "+Yt(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){ie(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ad,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=ad,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Bz&&(this.reconnectDelay_=ad),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Fz)}this.onConnectStatus_(!1)}establishConnection_(){return B(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,r())},u=function(h){ie(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:u};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,f]=yield Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?hn("getToken() completed but was canceled"):(hn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new t_(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,g=>{Cn(g+" ("+this.repoInfo_.toString()+")"),this.interrupt(Uz)},o))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&Cn(h),c())}}})}interrupt(t){hn("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){hn("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ff(this.interruptReasons_)&&(this.reconnectDelay_=ad,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>Y_(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new tt(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){hn("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=nD&&(this.reconnectDelay_=tD,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){hn("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=nD&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";gr()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+X_.replace(/\./g,"-")]=1,$y()?t["framework.cordova"]=1:AI()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=wp.getInstance().currentlyOnline();return Ff(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),Ge=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Rl=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new Ge(Us,e),r=new Ge(Us,t);return this.compare(i,r)!==0}minPost(){return Ge.MIN}};var mp,Sp=class extends Rl{static get __EMPTY_NODE(){return mp}static set __EMPTY_NODE(e){mp=e}compare(e,t){return ga(e.name,t.name)}isDefinedOn(e){throw wl("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ge.MIN}maxPost(){return new Ge(es,mp)}makePost(e,t){return ie(typeof e=="string","KeyIndex indexValue must always be a string."),new Ge(e,mp)}toString(){return".key"}},wr=new Sp;var Dl=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Xi=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??Ai.EMPTY_NODE,this.right=o??Ai.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ai.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return Ai.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),r_=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new Xi(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Ai=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Xi.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Xi.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Dl(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Dl(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Dl(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Dl(this.root_,null,this.comparator_,!0,e)}};Ai.EMPTY_NODE=new r_;function qz(n,e){return ga(n.name,e.name)}function nw(n,e){return ga(n,e)}var s_;function zz(n){s_=n}var GD=function(n){return typeof n=="number"?"number:"+ND(n):"string:"+n},HD=function(n){if(n.isLeafNode()){let e=n.val();ie(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ti(e,".sv"),"Priority must be a string or number.")}else ie(n===s_||n.isEmpty(),"priority of unexpected type.");ie(n===s_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var iD,Ml=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,ie(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),HD(this.priorityNode_)}static set __childrenNodeConstructor(t){iD=t}static get __childrenNodeConstructor(){return iD}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return $e(t)?this:Ve(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=Ve(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(ie(r!==".priority"||qs(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(ct(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+GD(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=ND(this.value_):t+=this.value_,this.lazyHash_=RD(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(ie(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return ie(s>=0,"Unknown leaf type: "+i),ie(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),WD,KD;function Vz(n){WD=n}function $z(n){KD=n}var o_=class extends Rl{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?ga(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ge.MIN}maxPost(){return new Ge(es,new Ml("[PRIORITY-POST]",KD))}makePost(e,t){let i=WD(e);return new Ge(t,new Ml("[PRIORITY-POST]",i))}toString(){return".priority"}},ft=new o_;var jz=Math.log(2),a_=class{constructor(e){let t=s=>parseInt(Math.log(s)/jz,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},bp=function(n,e,t,i){n.sort(e);let r=function(l,c){let u=c-l,d,h;if(u===0)return null;if(u===1)return d=n[l],h=t?t(d):d,new Xi(h,d.node,Xi.BLACK,null,null);{let f=parseInt(u/2,10)+l,g=r(l,f),_=r(f+1,c);return d=n[f],h=t?t(d):d,new Xi(h,d.node,Xi.BLACK,g,_)}},s=function(l){let c=null,u=null,d=n.length,h=function(g,_){let S=d-g,I=d;d-=g;let E=r(S+1,I),b=n[S],M=t?t(b):b;f(new Xi(M,b.node,_,null,E))},f=function(g){c?(c.left=g,c=g):(u=g,c=g)};for(let g=0;g<l.count;++g){let _=l.nextBitIsOne(),S=Math.pow(2,l.count-(g+1));_?h(S,Xi.BLACK):(h(S,Xi.BLACK),h(S,Xi.RED))}return u},o=new a_(n.length),a=s(o);return new Ai(i||e,a)};var zv,kl={},Ol=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return ie(kl&&ft,"ChildrenNode.ts has not been loaded"),zv=zv||new n({".priority":kl},{".priority":ft}),zv}get(e){let t=ks(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ai?t:null}hasIndex(e){return Ti(this.indexSet_,e.toString())}addIndex(e,t){ie(e!==wr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(Ge.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=bp(i,e.getCompare()):a=kl;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let i=qu(this.indexes_,(r,s)=>{let o=ks(this.indexSet_,s);if(ie(o,"Missing index implementation for "+s),r===kl)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(Ge.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),bp(a,o.getCompare())}else return kl;else{let a=t.get(e.name),l=r;return a&&(l=l.remove(new Ge(e.name,a))),l.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=qu(this.indexes_,r=>{if(r===kl)return r;{let s=t.get(e.name);return s?r.remove(new Ge(e.name,s)):r}});return new n(i,this.indexSet_)}};var ld,Fe=(()=>{class n{constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&HD(this.priorityNode_),this.children_.isEmpty()&&ie(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ld||(ld=new n(new Ai(nw),null,Ol.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ld}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?ld:i}}getChild(t){let i=Ve(t);return i===null?this:this.getImmediateChild(i).getChild(ct(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(ie(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new Ge(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?ld:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=Ve(t);if(r===null)return i;{ie(Ve(t)!==".priority"||qs(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(ct(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(ft,(a,l)=>{i[a]=l.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let l in i)a[l]=i[l];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+GD(this.getPriority().val())+":"),this.forEachChild(ft,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":RD(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new Ge(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new Ge(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new Ge(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,Ge.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,Ge.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Rd?-1:0}withIndex(t){if(t===wr||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===wr||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(ft),s=i.getIterator(ft),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===wr?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),l_=class extends Fe{constructor(){super(new Ai(nw),Fe.EMPTY_NODE,Ol.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Fe.EMPTY_NODE}isEmpty(){return!1}},Rd=new l_;Object.defineProperties(Ge,{MIN:{value:new Ge(Us,Fe.EMPTY_NODE)},MAX:{value:new Ge(es,Rd)}});Sp.__EMPTY_NODE=Fe.EMPTY_NODE;Ml.__childrenNodeConstructor=Fe;zz(Rd);$z(Rd);var Gz=!0;function Pt(n,e=null){if(n===null)return Fe.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),ie(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Ml(t,Pt(e))}if(!(n instanceof Array)&&Gz){let t=[],i=!1;if(fn(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=Pt(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new Ge(o,l)))}}),t.length===0)return Fe.EMPTY_NODE;let s=bp(t,qz,o=>o.name,nw);if(i){let o=bp(t,ft.getCompare());return new Fe(s,Pt(e),new Ol({".priority":o},{".priority":ft}))}else return new Fe(s,Pt(e),Ol.Default)}else{let t=Fe.EMPTY_NODE;return fn(n,(i,r)=>{if(Ti(n,i)&&i.substring(0,1)!=="."){let s=Pt(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(Pt(e))}}Vz(Pt);var vd=class extends Rl{constructor(e){super(),this.indexPath_=e,ie(!$e(e)&&Ve(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?ga(e.name,t.name):s}makePost(e,t){let i=Pt(e),r=Fe.EMPTY_NODE.updateChild(this.indexPath_,i);return new Ge(t,r)}maxPost(){let e=Fe.EMPTY_NODE.updateChild(this.indexPath_,Rd);return new Ge(es,e)}toString(){return yd(this.indexPath_,0).join("/")}};var c_=class extends Rl{compare(e,t){let i=e.node.compareTo(t.node);return i===0?ga(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ge.MIN}maxPost(){return Ge.MAX}makePost(e,t){let i=Pt(e);return new Ge(t,i)}toString(){return".value"}},iw=new c_;function YD(n){return{type:"value",snapshotNode:n}}function Nl(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function _d(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function wd(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Hz(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Sd=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){ie(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(_d(t,a)):ie(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Nl(t,i)):o.trackChildChange(wd(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(ft,(r,s)=>{t.hasChild(r)||i.trackChildChange(_d(r,s))}),t.isLeafNode()||t.forEachChild(ft,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(wd(r,s,o))}else i.trackChildChange(Nl(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Fe.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Ep=class n{constructor(e){this.indexedFilter_=new Sd(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new Ge(t,i))||(i=Fe.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=Fe.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Fe.EMPTY_NODE);let s=this;return t.forEachChild(ft,(o,a)=>{s.matches(new Ge(o,a))||(r=r.updateImmediateChild(o,Fe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var u_=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Ep(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new Ge(t,i))||(i=Fe.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=Fe.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=Fe.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(Fe.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,Fe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let d=this.index_.getCompare();o=(h,f)=>d(f,h)}else o=this.index_.getCompare();let a=e;ie(a.numChildren()===this.limit_,"");let l=new Ge(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let d=a.getImmediateChild(t),h=r.getChildAfterChild(this.index_,c,this.reverse_);for(;h!=null&&(h.name===t||a.hasChild(h.name));)h=r.getChildAfterChild(this.index_,h,this.reverse_);let f=h==null?1:o(h,l);if(u&&!i.isEmpty()&&f>=0)return s?.trackChildChange(wd(t,i,d)),a.updateImmediateChild(t,i);{s?.trackChildChange(_d(t,d));let _=a.updateImmediateChild(t,Fe.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(s?.trackChildChange(Nl(h.name,h.node)),_.updateImmediateChild(h.name,h.node)):_}}else return i.isEmpty()?e:u&&o(c,l)>=0?(s!=null&&(s.trackChildChange(_d(c.name,c.node)),s.trackChildChange(Nl(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,Fe.EMPTY_NODE)):e}};var bd=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ft}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ie(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ie(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Us}hasEnd(){return this.endSet_}getIndexEndValue(){return ie(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ie(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:es}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ie(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ft}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Wz(n){return n.loadsAllData()?new Sd(n.getIndex()):n.hasLimit()?new u_(n):new Ep(n)}function Kz(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Yz(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function d_(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Qz(n,e,t){let i;return n.index_===wr||t?i=d_(n,e,t):i=d_(n,e,es),i.startAfterSet_=!0,i}function h_(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function Xz(n,e,t){let i;return n.index_===wr||t?i=h_(n,e,t):i=h_(n,e,Us),i.endBeforeSet_=!0,i}function Vp(n,e){let t=n.copy();return t.index_=e,t}function rD(n){let e={};if(n.isDefault())return e;let t;if(n.index_===ft?t="$priority":n.index_===iw?t="$value":n.index_===wr?t="$key":(ie(n.index_ instanceof vd,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Yt(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=Yt(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+Yt(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=Yt(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+Yt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function sD(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ft&&(e.i=n.index_.toString()),e}var f_=class n extends vp{constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Pd("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(ie(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let l=rD(e._queryParams);this.restRequest_(s+".json",l,(c,u)=>{let d=u;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(s,d,!1,i),ks(this.listens_,o)===a){let h;c?c===401?h="permission_denied":h="rest_error:"+c:h="ok",r(h,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=rD(e._queryParams),i=e._path.toString(),r=new un;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+OI(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Lf(a.responseText)}catch{Cn("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&Cn("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var p_=class{constructor(){this.rootNode_=Fe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Cp(){return{value:null,children:new Map}}function zl(n,e,t){if($e(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=Ve(e);n.children.has(i)||n.children.set(i,Cp());let r=n.children.get(i);e=ct(e),zl(r,e,t)}}function m_(n,e){if($e(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(ft,(i,r)=>{zl(n,new tt(i),r)}),m_(n,e)}}else if(n.children.size>0){let t=Ve(e);return e=ct(e),n.children.has(t)&&m_(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function g_(n,e,t){n.value!==null?t(e,n.value):Jz(n,(i,r)=>{let s=new tt(e.toString()+"/"+i);g_(r,s,t)})}function Jz(n,e){n.children.forEach((t,i)=>{e(i,t)})}var y_=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&fn(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var oD=10*1e3,Zz=30*1e3,e6=5*60*1e3,v_=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new y_(e);let i=oD+(Zz-oD)*Math.random();ud(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;fn(e,(r,s)=>{s>0&&Ti(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),ud(this.reportStats_.bind(this),Math.floor(Math.random()*2*e6))}};var _r=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(_r||{});function rw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function sw(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ow(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var __=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=_r.ACK_USER_WRITE,this.source=rw()}operationForChild(e){if($e(this.path)){if(this.affectedTree.value!=null)return ie(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new tt(e));return new n(et(),t,this.revert)}}else return ie(Ve(this.path)===e,"operationForChild called for unrelated child."),new n(ct(this.path),this.affectedTree,this.revert)}};var Tp=class n{constructor(e,t){this.source=e,this.path=t,this.type=_r.LISTEN_COMPLETE}operationForChild(e){return $e(this.path)?new n(this.source,et()):new n(this.source,ct(this.path))}};var Ll=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=_r.OVERWRITE}operationForChild(e){return $e(this.path)?new n(this.source,et(),this.snap.getImmediateChild(e)):new n(this.source,ct(this.path),this.snap)}};var Ed=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=_r.MERGE}operationForChild(e){if($e(this.path)){let t=this.children.subtree(new tt(e));return t.isEmpty()?null:t.value?new Ll(this.source,et(),t.value):new n(this.source,et(),t)}else return ie(Ve(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,ct(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var br=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if($e(e))return this.isFullyInitialized()&&!this.filtered_;let t=Ve(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var w_=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function t6(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Hz(o.childName,o.snapshotNode))}),cd(n,r,"child_removed",e,i,t),cd(n,r,"child_added",e,i,t),cd(n,r,"child_moved",s,i,t),cd(n,r,"child_changed",e,i,t),cd(n,r,"value",e,i,t),r}function cd(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,l)=>i6(n,a,l)),o.forEach(a=>{let l=n6(n,a,s);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function n6(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function i6(n,e,t){if(e.childName==null||t.childName==null)throw wl("Should only compare child_ events.");let i=new Ge(e.childName,e.snapshotNode),r=new Ge(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function $p(n,e){return{eventCache:n,serverCache:e}}function hd(n,e,t,i){return $p(new br(e,t,i),n.serverCache)}function QD(n,e,t,i){return $p(n.eventCache,new br(e,t,i))}function xp(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ma(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Vv,r6=()=>(Vv||(Vv=new Ai(tz)),Vv),Mn=class n{constructor(e,t=r6()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return fn(e,(i,r)=>{t=t.set(new tt(i),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:et(),value:this.value};if($e(e))return null;{let i=Ve(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(ct(e),t);return s!=null?{path:Tt(new tt(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if($e(e))return this;{let t=Ve(e),i=this.children.get(t);return i!==null?i.subtree(ct(e)):new n(null)}}set(e,t){if($e(e))return new n(t,this.children);{let i=Ve(e),s=(this.children.get(i)||new n(null)).set(ct(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if($e(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=Ve(e),i=this.children.get(t);if(i){let r=i.remove(ct(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if($e(e))return this.value;{let t=Ve(e),i=this.children.get(t);return i?i.get(ct(e)):null}}setTree(e,t){if($e(e))return t;{let i=Ve(e),s=(this.children.get(i)||new n(null)).setTree(ct(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(et(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(Tt(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,et(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if($e(e))return null;{let s=Ve(e),o=this.children.get(s);return o?o.findOnPath_(ct(e),Tt(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,et(),t)}foreachOnPath_(e,t,i){if($e(e))return this;{this.value&&i(t,this.value);let r=Ve(e),s=this.children.get(r);return s?s.foreachOnPath_(ct(e),Tt(t,r),i):new n(null)}}foreach(e){this.foreach_(et(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(Tt(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var Ji=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new Mn(null))}};function fd(n,e,t){if($e(e))return new Ji(new Mn(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=Rn(r,e);return s=s.updateChild(o,t),new Ji(n.writeTree_.set(r,s))}else{let r=new Mn(t),s=n.writeTree_.setTree(e,r);return new Ji(s)}}}function S_(n,e,t){let i=n;return fn(t,(r,s)=>{i=fd(i,Tt(e,r),s)}),i}function aD(n,e){if($e(e))return Ji.empty();{let t=n.writeTree_.setTree(e,new Mn(null));return new Ji(t)}}function b_(n,e){return ya(n,e)!=null}function ya(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Rn(t.path,e)):null}function lD(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ft,(i,r)=>{e.push(new Ge(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new Ge(i,r.value))}),e}function Fs(n,e){if($e(e))return n;{let t=ya(n,e);return t!=null?new Ji(new Mn(t)):new Ji(n.writeTree_.subtree(e))}}function E_(n){return n.writeTree_.isEmpty()}function Fl(n,e){return XD(et(),n.writeTree_,e)}function XD(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(ie(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=XD(Tt(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(Tt(n,".priority"),i)),t}}function jp(n,e){return tP(e,n)}function s6(n,e,t,i,r){ie(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=fd(n.visibleWrites,e,t)),n.lastWriteId=i}function o6(n,e,t,i){ie(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=S_(n.visibleWrites,e,t),n.lastWriteId=i}function a6(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function l6(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);ie(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&c6(a,i.path)?r=!1:ki(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return u6(n),!0;if(i.snap)n.visibleWrites=aD(n.visibleWrites,i.path);else{let a=i.children;fn(a,l=>{n.visibleWrites=aD(n.visibleWrites,Tt(i.path,l))})}return!0}else return!1}function c6(n,e){if(n.snap)return ki(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&ki(Tt(n.path,t),e))return!0;return!1}function u6(n){n.visibleWrites=JD(n.allWrites,d6,et()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function d6(n){return n.visible}function JD(n,e,t){let i=Ji.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)ki(t,o)?(a=Rn(t,o),i=fd(i,a,s.snap)):ki(o,t)&&(a=Rn(o,t),i=fd(i,et(),s.snap.getChild(a)));else if(s.children){if(ki(t,o))a=Rn(t,o),i=S_(i,a,s.children);else if(ki(o,t))if(a=Rn(o,t),$e(a))i=S_(i,et(),s.children);else{let l=ks(s.children,Ve(a));if(l){let c=l.getChild(ct(a));i=fd(i,et(),c)}}}else throw wl("WriteRecord should have .snap or .children")}}return i}function ZD(n,e,t,i,r){if(!i&&!r){let s=ya(n.visibleWrites,e);if(s!=null)return s;{let o=Fs(n.visibleWrites,e);if(E_(o))return t;if(t==null&&!b_(o,et()))return null;{let a=t||Fe.EMPTY_NODE;return Fl(o,a)}}}else{let s=Fs(n.visibleWrites,e);if(!r&&E_(s))return t;if(!r&&t==null&&!b_(s,et()))return null;{let o=function(c){return(c.visible||r)&&(!i||!~i.indexOf(c.writeId))&&(ki(c.path,e)||ki(e,c.path))},a=JD(n.allWrites,o,e),l=t||Fe.EMPTY_NODE;return Fl(a,l)}}}function h6(n,e,t){let i=Fe.EMPTY_NODE,r=ya(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(ft,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=Fs(n.visibleWrites,e);return t.forEachChild(ft,(o,a)=>{let l=Fl(Fs(s,new tt(o)),a);i=i.updateImmediateChild(o,l)}),lD(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=Fs(n.visibleWrites,e);return lD(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function f6(n,e,t,i,r){ie(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=Tt(e,t);if(b_(n.visibleWrites,s))return null;{let o=Fs(n.visibleWrites,s);return E_(o)?r.getChild(t):Fl(o,r.getChild(t))}}function p6(n,e,t,i){let r=Tt(e,t),s=ya(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=Fs(n.visibleWrites,r);return Fl(o,i.getNode().getImmediateChild(t))}else return null}function m6(n,e){return ya(n.visibleWrites,e)}function g6(n,e,t,i,r,s,o){let a,l=Fs(n.visibleWrites,e),c=ya(l,et());if(c!=null)a=c;else if(t!=null)a=Fl(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],d=o.getCompare(),h=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),f=h.getNext();for(;f&&u.length<r;)d(f,i)!==0&&u.push(f),f=h.getNext();return u}else return[]}function y6(){return{visibleWrites:Ji.empty(),allWrites:[],lastWriteId:-1}}function Ip(n,e,t,i){return ZD(n.writeTree,n.treePath,e,t,i)}function aw(n,e){return h6(n.writeTree,n.treePath,e)}function cD(n,e,t,i){return f6(n.writeTree,n.treePath,e,t,i)}function kp(n,e){return m6(n.writeTree,Tt(n.treePath,e))}function v6(n,e,t,i,r,s){return g6(n.writeTree,n.treePath,e,t,i,r,s)}function lw(n,e,t){return p6(n.writeTree,n.treePath,e,t)}function eP(n,e){return tP(Tt(n.treePath,e),n.writeTree)}function tP(n,e){return{treePath:n,writeTree:e}}var C_=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;ie(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),ie(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,wd(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,_d(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,Nl(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,wd(i,e.snapshotNode,r.oldSnap));else throw wl("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var T_=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},nP=new T_,Cd=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new br(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return lw(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ma(this.viewCache_),s=v6(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function _6(n){return{filter:n}}function w6(n,e){ie(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),ie(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function S6(n,e,t,i,r){let s=new C_,o,a;if(t.type===_r.OVERWRITE){let c=t;c.source.fromUser?o=x_(n,e,c.path,c.snap,i,r,s):(ie(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!$e(c.path),o=Ap(n,e,c.path,c.snap,i,r,a,s))}else if(t.type===_r.MERGE){let c=t;c.source.fromUser?o=E6(n,e,c.path,c.children,i,r,s):(ie(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=I_(n,e,c.path,c.children,i,r,a,s))}else if(t.type===_r.ACK_USER_WRITE){let c=t;c.revert?o=x6(n,e,c.path,i,r,s):o=C6(n,e,c.path,c.affectedTree,i,r,s)}else if(t.type===_r.LISTEN_COMPLETE)o=T6(n,e,t.path,i,s);else throw wl("Unknown operation type: "+t.type);let l=s.getChanges();return b6(e,o,l),{viewCache:o,changes:l}}function b6(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=xp(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(YD(xp(e)))}}function iP(n,e,t,i,r,s){let o=e.eventCache;if(kp(i,t)!=null)return e;{let a,l;if($e(t))if(ie(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=ma(e),u=c instanceof Fe?c:Fe.EMPTY_NODE,d=aw(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{let c=Ip(i,ma(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=Ve(t);if(c===".priority"){ie(qs(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let d=cD(i,t,u,l);d!=null?a=n.filter.updatePriority(u,d):a=o.getNode()}else{let u=ct(t),d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let h=cD(i,t,o.getNode(),l);h!=null?d=o.getNode().getImmediateChild(c).updateChild(u,h):d=o.getNode().getImmediateChild(c)}else d=lw(i,c,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),c,d,u,r,s):a=o.getNode()}}return hd(e,a,o.isFullyInitialized()||$e(t),n.filter.filtersNodes())}}function Ap(n,e,t,i,r,s,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if($e(t))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){let f=l.getNode().updateChild(t,i);c=u.updateFullNode(l.getNode(),f,null)}else{let f=Ve(t);if(!l.isCompleteForPath(t)&&qs(t)>1)return e;let g=ct(t),S=l.getNode().getImmediateChild(f).updateChild(g,i);f===".priority"?c=u.updatePriority(l.getNode(),S):c=u.updateChild(l.getNode(),f,S,g,nP,null)}let d=QD(e,c,l.isFullyInitialized()||$e(t),u.filtersNodes()),h=new Cd(r,d,s);return iP(n,d,t,r,h,a)}function x_(n,e,t,i,r,s,o){let a=e.eventCache,l,c,u=new Cd(r,e,s);if($e(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=hd(e,c,!0,n.filter.filtersNodes());else{let d=Ve(t);if(d===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),i),l=hd(e,c,a.isFullyInitialized(),a.isFiltered());else{let h=ct(t),f=a.getNode().getImmediateChild(d),g;if($e(h))g=i;else{let _=u.getCompleteChild(d);_!=null?Z_(h)===".priority"&&_.getChild($D(h)).isEmpty()?g=_:g=_.updateChild(h,i):g=Fe.EMPTY_NODE}if(f.equals(g))l=e;else{let _=n.filter.updateChild(a.getNode(),d,g,h,u,o);l=hd(e,_,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function uD(n,e){return n.eventCache.isCompleteForChild(e)}function E6(n,e,t,i,r,s,o){let a=e;return i.foreach((l,c)=>{let u=Tt(t,l);uD(e,Ve(u))&&(a=x_(n,a,u,c,r,s,o))}),i.foreach((l,c)=>{let u=Tt(t,l);uD(e,Ve(u))||(a=x_(n,a,u,c,r,s,o))}),a}function dD(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function I_(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;$e(t)?c=i:c=new Mn(null).setTree(t,i);let u=e.serverCache.getNode();return c.children.inorderTraversal((d,h)=>{if(u.hasChild(d)){let f=e.serverCache.getNode().getImmediateChild(d),g=dD(n,f,h);l=Ap(n,l,new tt(d),g,r,s,o,a)}}),c.children.inorderTraversal((d,h)=>{let f=!e.serverCache.isCompleteForChild(d)&&h.value===null;if(!u.hasChild(d)&&!f){let g=e.serverCache.getNode().getImmediateChild(d),_=dD(n,g,h);l=Ap(n,l,new tt(d),_,r,s,o,a)}}),l}function C6(n,e,t,i,r,s,o){if(kp(r,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if($e(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Ap(n,e,t,l.getNode().getChild(t),r,s,a,o);if($e(t)){let c=new Mn(null);return l.getNode().forEachChild(wr,(u,d)=>{c=c.set(new tt(u),d)}),I_(n,e,t,c,r,s,a,o)}else return e}else{let c=new Mn(null);return i.foreach((u,d)=>{let h=Tt(t,u);l.isCompleteForPath(h)&&(c=c.set(u,l.getNode().getChild(h)))}),I_(n,e,t,c,r,s,a,o)}}function T6(n,e,t,i,r){let s=e.serverCache,o=QD(e,s.getNode(),s.isFullyInitialized()||$e(t),s.isFiltered());return iP(n,o,t,i,nP,r)}function x6(n,e,t,i,r,s){let o;if(kp(i,t)!=null)return e;{let a=new Cd(i,e,r),l=e.eventCache.getNode(),c;if($e(t)||Ve(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Ip(i,ma(e));else{let d=e.serverCache.getNode();ie(d instanceof Fe,"serverChildren would be complete if leaf node"),u=aw(i,d)}u=u,c=n.filter.updateFullNode(l,u,s)}else{let u=Ve(t),d=lw(i,u,e.serverCache);d==null&&e.serverCache.isCompleteForChild(u)&&(d=l.getImmediateChild(u)),d!=null?c=n.filter.updateChild(l,u,d,ct(t),a,s):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,Fe.EMPTY_NODE,ct(t),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Ip(i,ma(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||kp(i,et())!=null,hd(e,c,o,n.filter.filtersNodes())}}var k_=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new Sd(i.getIndex()),s=Wz(i);this.processor_=_6(s);let o=t.serverCache,a=t.eventCache,l=r.updateFullNode(Fe.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(Fe.EMPTY_NODE,a.getNode(),null),u=new br(l,o.isFullyInitialized(),r.filtersNodes()),d=new br(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=$p(d,u),this.eventGenerator_=new w_(this.query_)}get query(){return this.query_}};function I6(n){return n.viewCache_.serverCache.getNode()}function k6(n){return xp(n.viewCache_)}function A6(n,e){let t=ma(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!$e(e)&&!t.getImmediateChild(Ve(e)).isEmpty())?t.getChild(e):null}function hD(n){return n.eventRegistrations_.length===0}function D6(n,e){n.eventRegistrations_.push(e)}function fD(n,e,t){let i=[];if(t){ie(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function pD(n,e,t,i){e.type===_r.MERGE&&e.source.queryId!==null&&(ie(ma(n.viewCache_),"We should always have a full cache before handling merges"),ie(xp(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=S6(n.processor_,r,e,t,i);return w6(n.processor_,s.viewCache),ie(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,rP(n,s.changes,s.viewCache.eventCache.getNode(),null)}function P6(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ft,(s,o)=>{i.push(Nl(s,o))}),t.isFullyInitialized()&&i.push(YD(t.getNode())),rP(n,i,t.getNode(),e)}function rP(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return t6(n.eventGenerator_,e,t,r)}var Dp,Pp=class{constructor(){this.views=new Map}};function R6(n){ie(!Dp,"__referenceConstructor has already been defined"),Dp=n}function M6(){return ie(Dp,"Reference.ts has not been loaded"),Dp}function O6(n){return n.views.size===0}function cw(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return ie(s!=null,"SyncTree gave us an op for an invalid query."),pD(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(pD(o,e,t,i));return s}}function sP(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Ip(t,r?i:null),l=!1;a?l=!0:i instanceof Fe?(a=aw(t,i),l=!1):(a=Fe.EMPTY_NODE,l=!1);let c=$p(new br(a,l,!1),new br(i,r,!1));return new k_(e,c)}return o}function N6(n,e,t,i,r,s){let o=sP(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),D6(o,t),P6(o,t)}function L6(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=zs(n);if(r==="default")for(let[l,c]of n.views.entries())o=o.concat(fD(c,t,i)),hD(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{let l=n.views.get(r);l&&(o=o.concat(fD(l,t,i)),hD(l)&&(n.views.delete(r),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!zs(n)&&s.push(new(M6())(e._repo,e._path)),{removed:s,events:o}}function oP(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Bs(n,e){let t=null;for(let i of n.views.values())t=t||A6(i,e);return t}function aP(n,e){if(e._queryParams.loadsAllData())return Gp(n);{let i=e._queryIdentifier;return n.views.get(i)}}function lP(n,e){return aP(n,e)!=null}function zs(n){return Gp(n)!=null}function Gp(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Rp;function F6(n){ie(!Rp,"__referenceConstructor has already been defined"),Rp=n}function B6(){return ie(Rp,"Reference.ts has not been loaded"),Rp}var U6=1,Mp=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Mn(null),this.pendingWriteTree_=y6(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function uw(n,e,t,i,r){return s6(n.pendingWriteTree_,e,t,i,r),r?Vl(n,new Ll(rw(),e,t)):[]}function q6(n,e,t,i){o6(n.pendingWriteTree_,e,t,i);let r=Mn.fromObject(t);return Vl(n,new Ed(rw(),e,r))}function Ls(n,e,t=!1){let i=a6(n.pendingWriteTree_,e);if(l6(n.pendingWriteTree_,e)){let s=new Mn(null);return i.snap!=null?s=s.set(et(),!0):fn(i.children,o=>{s=s.set(new tt(o),!0)}),Vl(n,new __(i.path,s,t))}else return[]}function Md(n,e,t){return Vl(n,new Ll(sw(),e,t))}function z6(n,e,t){let i=Mn.fromObject(t);return Vl(n,new Ed(sw(),e,i))}function V6(n,e){return Vl(n,new Tp(sw(),e))}function $6(n,e,t){let i=dw(n,t);if(i){let r=hw(i),s=r.path,o=r.queryId,a=Rn(s,e),l=new Tp(ow(o),a);return fw(n,s,l)}else return[]}function Op(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||lP(o,e))){let l=L6(o,e,t,i);O6(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=l.removed;if(a=l.events,!r){let u=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(s,(h,f)=>zs(f));if(u&&!d){let h=n.syncPointTree_.subtree(s);if(!h.isEmpty()){let f=H6(h);for(let g=0;g<f.length;++g){let _=f[g],S=_.query,I=hP(n,_);n.listenProvider_.startListening(pd(S),Td(n,S),I.hashFn,I.onComplete)}}}!d&&c.length>0&&!i&&(u?n.listenProvider_.stopListening(pd(e),null):c.forEach(h=>{let f=n.queryToTagMap.get(Wp(h));n.listenProvider_.stopListening(pd(h),f)}))}W6(n,c)}return a}function cP(n,e,t,i){let r=dw(n,i);if(r!=null){let s=hw(r),o=s.path,a=s.queryId,l=Rn(o,e),c=new Ll(ow(a),l,t);return fw(n,o,c)}else return[]}function j6(n,e,t,i){let r=dw(n,i);if(r){let s=hw(r),o=s.path,a=s.queryId,l=Rn(o,e),c=Mn.fromObject(t),u=new Ed(ow(a),l,c);return fw(n,o,u)}else return[]}function A_(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(h,f)=>{let g=Rn(h,r);s=s||Bs(f,g),o=o||zs(f)});let a=n.syncPointTree_.get(r);a?(o=o||zs(a),s=s||Bs(a,et())):(a=new Pp,n.syncPointTree_=n.syncPointTree_.set(r,a));let l;s!=null?l=!0:(l=!1,s=Fe.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((f,g)=>{let _=Bs(g,et());_&&(s=s.updateImmediateChild(f,_))}));let c=lP(a,e);if(!c&&!e._queryParams.loadsAllData()){let h=Wp(e);ie(!n.queryToTagMap.has(h),"View does not exist, but we have a tag");let f=K6();n.queryToTagMap.set(h,f),n.tagToQueryMap.set(f,h)}let u=jp(n.pendingWriteTree_,r),d=N6(a,e,t,u,s,l);if(!c&&!o&&!i){let h=aP(a,e);d=d.concat(Y6(n,e,h))}return d}function Hp(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=Rn(o,e),c=Bs(a,l);if(c)return c});return ZD(r,e,s,t,!0)}function G6(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let d=Rn(c,t);i=i||Bs(u,d)});let r=n.syncPointTree_.get(t);r?i=i||Bs(r,et()):(r=new Pp,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new br(i,!0,!1):null,a=jp(n.pendingWriteTree_,e._path),l=sP(r,e,a,s?o.getNode():Fe.EMPTY_NODE,s);return k6(l)}function Vl(n,e){return uP(e,n.syncPointTree_,null,jp(n.pendingWriteTree_,et()))}function uP(n,e,t,i){if($e(n.path))return dP(n,e,t,i);{let r=e.get(et());t==null&&r!=null&&(t=Bs(r,et()));let s=[],o=Ve(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=eP(i,o);s=s.concat(uP(a,l,c,u))}return r&&(s=s.concat(cw(r,n,i,t))),s}}function dP(n,e,t,i){let r=e.get(et());t==null&&r!=null&&(t=Bs(r,et()));let s=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=eP(i,o),u=n.operationForChild(o);u&&(s=s.concat(dP(u,a,l,c)))}),r&&(s=s.concat(cw(r,n,i,t))),s}function hP(n,e){let t=e.query,i=Td(n,t);return{hashFn:()=>(I6(e)||Fe.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?$6(n,t._path,i):V6(n,t._path);{let s=rz(r,t);return Op(n,t,null,s)}}}}function Td(n,e){let t=Wp(e);return n.queryToTagMap.get(t)}function Wp(n){return n._path.toString()+"$"+n._queryIdentifier}function dw(n,e){return n.tagToQueryMap.get(e)}function hw(n){let e=n.indexOf("$");return ie(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new tt(n.substr(0,e))}}function fw(n,e,t){let i=n.syncPointTree_.get(e);ie(i,"Missing sync point for query tag that we're tracking");let r=jp(n.pendingWriteTree_,e);return cw(i,t,r,null)}function H6(n){return n.fold((e,t,i)=>{if(t&&zs(t))return[Gp(t)];{let r=[];return t&&(r=oP(t)),fn(i,(s,o)=>{r=r.concat(o)}),r}})}function pd(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(B6())(n._repo,n._path):n}function W6(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=Wp(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function K6(){return U6++}function Y6(n,e,t){let i=e._path,r=Td(n,e),s=hP(n,t),o=n.listenProvider_.startListening(pd(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)ie(!zs(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,d)=>{if(!$e(c)&&u&&zs(u))return[Gp(u).query];{let h=[];return u&&(h=h.concat(oP(u).map(f=>f.query))),fn(d,(f,g)=>{h=h.concat(g)}),h}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(pd(u),Td(n,u))}}return o}var D_=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},P_=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=Tt(this.path_,e);return new n(this.syncTree_,t)}node(){return Hp(this.syncTree_,this.path_)}},Q6=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},mD=function(n,e,t){if(!n||typeof n!="object")return n;if(ie(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return X6(n[".sv"],e,t);if(typeof n[".sv"]=="object")return J6(n[".sv"],e);ie(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},X6=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:ie(!1,"Unexpected server value: "+n)}},J6=function(n,e,t){n.hasOwnProperty("increment")||ie(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&ie(!1,"Unexpected increment value: "+i);let r=e.node();if(ie(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},fP=function(n,e,t,i){return mw(e,new P_(t,n),i)},pw=function(n,e,t){return mw(n,new D_(e),t)};function mw(n,e,t){let i=n.getPriority().val(),r=mD(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=mD(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new Ml(a,Pt(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new Ml(r))),o.forEachChild(ft,(a,l)=>{let c=mw(l,e.getImmediateChild(a),t);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}var xd=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function Kp(n,e){let t=e instanceof tt?e:new tt(e),i=n,r=Ve(t);for(;r!==null;){let s=ks(i.node.children,r)||{children:{},childCount:0};i=new xd(r,i,s),t=ct(t),r=Ve(t)}return i}function va(n){return n.node.value}function gw(n,e){n.node.value=e,R_(n)}function pP(n){return n.node.childCount>0}function Z6(n){return va(n)===void 0&&!pP(n)}function Yp(n,e){fn(n.node.children,(t,i)=>{e(new xd(t,n,i))})}function mP(n,e,t,i){t&&!i&&e(n),Yp(n,r=>{mP(r,e,!0,i)}),t&&i&&e(n)}function eV(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Od(n){return new tt(n.parent===null?n.name:Od(n.parent)+"/"+n.name)}function R_(n){n.parent!==null&&tV(n.parent,n.name,n)}function tV(n,e,t){let i=Z6(t),r=Ti(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,R_(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,R_(n))}var nV=/[\[\].#$\/\u0000-\u001F\u007F]/,iV=/[\[\].#$\u0000-\u001F\u007F]/,$v=10*1024*1024,Qp=function(n){return typeof n=="string"&&n.length!==0&&!nV.test(n)},gP=function(n){return typeof n=="string"&&n.length!==0&&!iV.test(n)},rV=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),gP(n)},Id=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!zp(n)||n&&typeof n=="object"&&Ti(n,".sv")},Er=function(n,e,t,i){i&&e===void 0||Nd(Gn(n,"value"),e,t)},Nd=function(n,e,t){let i=t instanceof tt?new n_(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ha(i));if(typeof e=="function")throw new Error(n+"contains a function "+ha(i)+" with contents = "+e.toString());if(zp(e))throw new Error(n+"contains "+e.toString()+" "+ha(i));if(typeof e=="string"&&e.length>$v/3&&zu(e)>$v)throw new Error(n+"contains a string greater than "+$v+" utf8 bytes "+ha(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(fn(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Qp(o)))throw new Error(n+" contains an invalid key ("+o+") "+ha(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Oz(i,o),Nd(n,a,i),Nz(i)}),r&&s)throw new Error(n+' contains ".value" child '+ha(i)+" in addition to actual children.")}},sV=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let s=yd(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Qp(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Mz);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&ki(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},yP=function(n,e,t,i){if(i&&e===void 0)return;let r=Gn(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");let s=[];fn(e,(o,a)=>{let l=new tt(o);if(Nd(r,a,Tt(t,l)),Z_(l)===".priority"&&!Id(a))throw new Error(r+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),sV(r,s)},yw=function(n,e,t){if(!(t&&e===void 0)){if(zp(e))throw new Error(Gn(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Id(e))throw new Error(Gn(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ld=function(n,e,t,i){if(!(i&&t===void 0)&&!Qp(t))throw new Error(Gn(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},$l=function(n,e,t,i){if(!(i&&t===void 0)&&!gP(t))throw new Error(Gn(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},oV=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),$l(n,e,t,i)},ai=function(n,e){if(Ve(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},vP=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Qp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!rV(t))throw new Error(Gn(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var M_=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Xp(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!ew(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function _P(n,e,t){Xp(n,t),wP(n,i=>ew(i,e))}function li(n,e,t){Xp(n,t),wP(n,i=>ki(i,e)||ki(e,i))}function wP(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(aV(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function aV(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();pa&&hn("event: "+t.toString()),ql(i)}}}var SP="repo_interrupt",lV=25,O_=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new M_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Cp(),this.transactionQueueTree_=new xd,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function cV(n,e,t){if(n.stats_=Q_(n.repoInfo_),n.forceRestClient_||lz())n.server_=new f_(n.repoInfo_,(i,r,s,o)=>{gD(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>yD(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Yt(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new tw(n.repoInfo_,e,(i,r,s,o)=>{gD(n,i,r,s,o)},i=>{yD(n,i)},i=>{uV(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=uz(n.repoInfo_,()=>new v_(n.stats_,n.server_)),n.infoData_=new p_,n.infoSyncTree_=new Mp({startListening:(i,r,s,o)=>{let a=[],l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=Md(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),vw(n,"connected",!1),n.serverSyncTree_=new Mp({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,l)=>{let c=o(a,l);li(n.eventQueue_,i._path,c)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function bP(n){let t=n.infoData_.getNode(new tt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Fd(n){return Q6({timestamp:bP(n)})}function gD(n,e,t,i,r){n.dataUpdateCount++;let s=new tt(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let l=qu(t,c=>Pt(c));o=j6(n.serverSyncTree_,s,l,r)}else{let l=Pt(t);o=cP(n.serverSyncTree_,s,l,r)}else if(i){let l=qu(t,c=>Pt(c));o=z6(n.serverSyncTree_,s,l)}else{let l=Pt(t);o=Md(n.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=Bl(n,s)),li(n.eventQueue_,a,o)}function yD(n,e){vw(n,"connected",e),e===!1&&fV(n)}function uV(n,e){fn(e,(t,i)=>{vw(n,t,i)})}function vw(n,e,t){let i=new tt("/.info/"+e),r=Pt(t);n.infoData_.updateSnapshot(i,r);let s=Md(n.infoSyncTree_,i,r);li(n.eventQueue_,i,s)}function Jp(n){return n.nextWriteId_++}function dV(n,e,t){let i=G6(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=Pt(r).withIndex(e._queryParams.getIndex());A_(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Md(n.serverSyncTree_,e._path,s);else{let a=Td(n.serverSyncTree_,e);o=cP(n.serverSyncTree_,e._path,s,a)}return li(n.eventQueue_,e._path,o),Op(n.serverSyncTree_,e,t,null,!0),s},r=>(jl(n,"get for query "+Yt(e)+" failed: "+r),Promise.reject(new Error(r))))}function _w(n,e,t,i,r){jl(n,"set",{path:e.toString(),value:t,priority:i});let s=Fd(n),o=Pt(t,i),a=Hp(n.serverSyncTree_,e),l=pw(o,a,s),c=Jp(n),u=uw(n.serverSyncTree_,e,l,c,!0);Xp(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(h,f)=>{let g=h==="ok";g||Cn("set at "+e+" failed: "+h);let _=Ls(n.serverSyncTree_,c,!g);li(n.eventQueue_,e,_),Vs(n,r,h,f)});let d=Sw(n,e);Bl(n,d),li(n.eventQueue_,d,[])}function hV(n,e,t,i){jl(n,"update",{path:e.toString(),value:t});let r=!0,s=Fd(n),o={};if(fn(t,(a,l)=>{r=!1,o[a]=fP(Tt(e,a),Pt(l),n.serverSyncTree_,s)}),r)hn("update() called with empty data.  Don't do anything."),Vs(n,i,"ok",void 0);else{let a=Jp(n),l=q6(n.serverSyncTree_,e,o,a);Xp(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let d=c==="ok";d||Cn("update at "+e+" failed: "+c);let h=Ls(n.serverSyncTree_,a,!d),f=h.length>0?Bl(n,e):e;li(n.eventQueue_,f,h),Vs(n,i,c,u)}),fn(t,c=>{let u=Sw(n,Tt(e,c));Bl(n,u)}),li(n.eventQueue_,e,[])}}function fV(n){jl(n,"onDisconnectEvents");let e=Fd(n),t=Cp();g_(n.onDisconnect_,et(),(r,s)=>{let o=fP(r,s,n.serverSyncTree_,e);zl(t,r,o)});let i=[];g_(t,et(),(r,s)=>{i=i.concat(Md(n.serverSyncTree_,r,s));let o=Sw(n,r);Bl(n,o)}),n.onDisconnect_=Cp(),li(n.eventQueue_,et(),i)}function pV(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,r)=>{i==="ok"&&m_(n.onDisconnect_,e),Vs(n,t,i,r)})}function vD(n,e,t,i){let r=Pt(t);n.server_.onDisconnectPut(e.toString(),r.val(!0),(s,o)=>{s==="ok"&&zl(n.onDisconnect_,e,r),Vs(n,i,s,o)})}function mV(n,e,t,i,r){let s=Pt(t,i);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&zl(n.onDisconnect_,e,s),Vs(n,r,o,a)})}function gV(n,e,t,i){if(Ff(t)){hn("onDisconnect().update() called with empty data.  Don't do anything."),Vs(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(r,s)=>{r==="ok"&&fn(t,(o,a)=>{let l=Pt(a);zl(n.onDisconnect_,Tt(e,o),l)}),Vs(n,i,r,s)})}function yV(n,e,t){let i;Ve(e._path)===".info"?i=A_(n.infoSyncTree_,e,t):i=A_(n.serverSyncTree_,e,t),_P(n.eventQueue_,e._path,i)}function N_(n,e,t){let i;Ve(e._path)===".info"?i=Op(n.infoSyncTree_,e,t):i=Op(n.serverSyncTree_,e,t),_P(n.eventQueue_,e._path,i)}function EP(n){n.persistentConnection_&&n.persistentConnection_.interrupt(SP)}function vV(n){n.persistentConnection_&&n.persistentConnection_.resume(SP)}function jl(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),hn(t,...e)}function Vs(n,e,t,i){e&&ql(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function _V(n,e,t,i,r,s){jl(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:PD(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=ww(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Nd("transaction failed: Data returned ",l,o.path),o.status=0;let c=Kp(n.transactionQueueTree_,e),u=va(c)||[];u.push(o),gw(c,u);let d;typeof l=="object"&&l!==null&&Ti(l,".priority")?(d=ks(l,".priority"),ie(Id(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):d=(Hp(n.serverSyncTree_,e)||Fe.EMPTY_NODE).getPriority().val();let h=Fd(n),f=Pt(l,d),g=pw(f,a,h);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=g,o.currentWriteId=Jp(n);let _=uw(n.serverSyncTree_,e,g,o.currentWriteId,o.applyLocally);li(n.eventQueue_,e,_),Zp(n,n.transactionQueueTree_)}}function ww(n,e,t){return Hp(n.serverSyncTree_,e,t)||Fe.EMPTY_NODE}function Zp(n,e=n.transactionQueueTree_){if(e||em(n,e),va(e)){let t=TP(n,e);ie(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&wV(n,Od(e),t)}else pP(e)&&Yp(e,t=>{Zp(n,t)})}function wV(n,e,t){let i=t.map(c=>c.currentWriteId),r=ww(n,e,i),s=r,o=r.hash();for(let c=0;c<t.length;c++){let u=t[c];ie(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let d=Rn(e,u.path);s=s.updateChild(d,u.currentOutputSnapshotRaw)}let a=s.val(!0),l=e;n.server_.put(l.toString(),a,c=>{jl(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let d=[];for(let h=0;h<t.length;h++)t[h].status=2,u=u.concat(Ls(n.serverSyncTree_,t[h].currentWriteId)),t[h].onComplete&&d.push(()=>t[h].onComplete(null,!0,t[h].currentOutputSnapshotResolved)),t[h].unwatcher();em(n,Kp(n.transactionQueueTree_,e)),Zp(n,n.transactionQueueTree_),li(n.eventQueue_,e,u);for(let h=0;h<d.length;h++)ql(d[h])}else{if(c==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{Cn("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=c}Bl(n,e)}},o)}function Bl(n,e){let t=CP(n,e),i=Od(t),r=TP(n,t);return SV(n,r,i),i}function SV(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=Rn(t,l.path),u=!1,d;if(ie(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,d=l.abortReason,r=r.concat(Ls(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=lV)u=!0,d="maxretry",r=r.concat(Ls(n.serverSyncTree_,l.currentWriteId,!0));else{let h=ww(n,l.path,o);l.currentInputSnapshot=h;let f=e[a].update(h.val());if(f!==void 0){Nd("transaction failed: Data returned ",f,l.path);let g=Pt(f);typeof f=="object"&&f!=null&&Ti(f,".priority")||(g=g.updatePriority(h.getPriority()));let S=l.currentWriteId,I=Fd(n),E=pw(g,h,I);l.currentOutputSnapshotRaw=g,l.currentOutputSnapshotResolved=E,l.currentWriteId=Jp(n),o.splice(o.indexOf(S),1),r=r.concat(uw(n.serverSyncTree_,l.path,E,l.currentWriteId,l.applyLocally)),r=r.concat(Ls(n.serverSyncTree_,S,!0))}else u=!0,d="nodata",r=r.concat(Ls(n.serverSyncTree_,l.currentWriteId,!0))}li(n.eventQueue_,t,r),r=[],u&&(e[a].status=2,function(h){setTimeout(h,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(d),!1,null))))}em(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)ql(i[a]);Zp(n,n.transactionQueueTree_)}function CP(n,e){let t,i=n.transactionQueueTree_;for(t=Ve(e);t!==null&&va(i)===void 0;)i=Kp(i,t),e=ct(e),t=Ve(e);return i}function TP(n,e){let t=[];return xP(n,e,t),t.sort((i,r)=>i.order-r.order),t}function xP(n,e,t){let i=va(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);Yp(e,r=>{xP(n,r,t)})}function em(n,e){let t=va(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,gw(e,t.length>0?t:void 0)}Yp(e,i=>{em(n,i)})}function Sw(n,e){let t=Od(CP(n,e)),i=Kp(n.transactionQueueTree_,e);return eV(i,r=>{jv(n,r)}),jv(n,i),mP(i,r=>{jv(n,r)}),t}function jv(n,e){let t=va(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(ie(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(ie(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Ls(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?gw(e,void 0):t.length=s+1,li(n.eventQueue_,Od(e),r);for(let o=0;o<i.length;o++)ql(i[o])}}function bV(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function EV(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Cn(`Invalid query segment '${t}' in query '${n}'`)}return e}var L_=function(n,e){let t=CV(n),i=t.namespace;t.domain==="firebase.com"&&Sr(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&Sr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Zq();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new yp(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new tt(t.pathString)}},CV=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(u,d)),u<d&&(r=bV(n.substring(u,d)));let h=EV(n.substring(Math.min(n.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let f=e.slice(0,c);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{let g=e.indexOf(".");i=e.substring(0,g).toLowerCase(),t=e.substring(g+1),s=i}"ns"in h&&(s=h.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var _D="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",TV=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=_D.charAt(t%64),t=Math.floor(t/64);ie(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=_D.charAt(e[r]);return ie(o.length===20,"nextPushId: Length should be 20."),o}}();var Np=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Yt(this.snapshot.exportVal())}},Lp=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var kd=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return ie(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Fp=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new un;return pV(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){ai("OnDisconnect.remove",this._path);let e=new un;return vD(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){ai("OnDisconnect.set",this._path),Er("OnDisconnect.set",e,this._path,!1);let t=new un;return vD(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){ai("OnDisconnect.setWithPriority",this._path),Er("OnDisconnect.setWithPriority",e,this._path,!1),yw("OnDisconnect.setWithPriority",t,!1);let i=new un;return mV(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){ai("OnDisconnect.update",this._path),yP("OnDisconnect.update",e,this._path,!1);let t=new un;return gV(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var On=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return $e(this._path)?null:Z_(this._path)}get ref(){return new ci(this._repo,this._path)}get _queryIdentifier(){let e=sD(this._queryParams),t=Y_(e);return t==="{}"?"default":t}get _queryObject(){return sD(this._queryParams)}isEqual(e){if(e=We(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=ew(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Rz(this._path)}};function tm(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function js(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===wr){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Us)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==es)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===ft){if(e!=null&&!Id(e)||t!=null&&!Id(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(ie(n.getIndex()instanceof vd||n.getIndex()===iw,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function nm(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var ci=class n extends On{constructor(e,t){super(e,t,new bd,!1)}get parent(){let e=$D(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Ul=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new tt(e),i=$s(this.ref,e);return new n(this._node.getChild(t),i,ft)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,$s(this.ref,i),ft)))}hasChild(e){let t=new tt(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function bw(n,e){return n=We(n),n._checkNotDeleted("ref"),e!==void 0?$s(n._root,e):n._root}function Ew(n,e){n=We(n),n._checkNotDeleted("refFromURL");let t=L_(e,n._repo.repoInfo_.nodeAdmin);vP("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&Sr("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),bw(n,t.path.toString())}function $s(n,e){return n=We(n),Ve(n._path)===null?oV("child","path",e,!1):$l("child","path",e,!1),new ci(n._repo,Tt(n._path,e))}function IP(n,e){n=We(n),ai("push",n._path),Er("push",e,n._path,!0);let t=bP(n._repo),i=TV(t),r=$s(n,i),s=$s(n,i),o;return e!=null?o=im(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function kP(n){return ai("remove",n._path),im(n,null)}function im(n,e){n=We(n),ai("set",n._path),Er("set",e,n._path,!1);let t=new un;return _w(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function AP(n,e){n=We(n),ai("setPriority",n._path),yw("setPriority",e,!1);let t=new un;return _w(n._repo,Tt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function DP(n,e,t){if(ai("setWithPriority",n._path),Er("setWithPriority",e,n._path,!1),yw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new un;return _w(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function PP(n,e){yP("update",e,n._path,!1);let t=new un;return hV(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function RP(n){n=We(n);let e=new kd(()=>{}),t=new Ad(e);return dV(n._repo,n,t).then(i=>new Ul(i,new ci(n._repo,n._path),n._queryParams.getIndex()))}var Ad=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Np("value",this,new Ul(e.snapshotNode,new ci(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Lp(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Bp=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Lp(this,e,t):null}createEvent(e,t){ie(e.childName!=null,"Child events should have a childName.");let i=$s(new ci(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Np(e.type,this,new Ul(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Bd(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let l=t,c=(u,d)=>{N_(n._repo,n,a),l(u,d)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new kd(t,s||void 0),a=e==="value"?new Ad(o):new Bp(e,o);return yV(n._repo,n,a),()=>N_(n._repo,n,a)}function rm(n,e,t,i){return Bd(n,"value",e,t,i)}function Cw(n,e,t,i){return Bd(n,"child_added",e,t,i)}function Tw(n,e,t,i){return Bd(n,"child_changed",e,t,i)}function xw(n,e,t,i){return Bd(n,"child_moved",e,t,i)}function Iw(n,e,t,i){return Bd(n,"child_removed",e,t,i)}function kw(n,e,t){let i=null,r=t?new kd(t):null;e==="value"?i=new Ad(r):e&&(i=new Bp(e,r)),N_(n._repo,n,i)}var ui=class{},Up=class extends ui{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Er("endAt",this._value,e._path,!0);let t=h_(e._queryParams,this._value,this._key);if(nm(t),js(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new On(e._repo,e._path,t,e._orderByCalled)}};function MP(n,e){return Ld("endAt","key",e,!0),new Up(n,e)}var F_=class extends ui{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Er("endBefore",this._value,e._path,!1);let t=Xz(e._queryParams,this._value,this._key);if(nm(t),js(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new On(e._repo,e._path,t,e._orderByCalled)}};function OP(n,e){return Ld("endBefore","key",e,!0),new F_(n,e)}var qp=class extends ui{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Er("startAt",this._value,e._path,!0);let t=d_(e._queryParams,this._value,this._key);if(nm(t),js(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new On(e._repo,e._path,t,e._orderByCalled)}};function NP(n=null,e){return Ld("startAt","key",e,!0),new qp(n,e)}var B_=class extends ui{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Er("startAfter",this._value,e._path,!1);let t=Qz(e._queryParams,this._value,this._key);if(nm(t),js(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new On(e._repo,e._path,t,e._orderByCalled)}};function LP(n,e){return Ld("startAfter","key",e,!0),new B_(n,e)}var U_=class extends ui{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new On(e._repo,e._path,Kz(e._queryParams,this._limit),e._orderByCalled)}};function FP(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new U_(n)}var q_=class extends ui{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new On(e._repo,e._path,Yz(e._queryParams,this._limit),e._orderByCalled)}};function BP(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new q_(n)}var z_=class extends ui{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){tm(e,"orderByChild");let t=new tt(this._path);if($e(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new vd(t),r=Vp(e._queryParams,i);return js(r),new On(e._repo,e._path,r,!0)}};function UP(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return $l("orderByChild","path",n,!1),new z_(n)}var V_=class extends ui{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){tm(e,"orderByKey");let t=Vp(e._queryParams,wr);return js(t),new On(e._repo,e._path,t,!0)}};function qP(){return new V_}var $_=class extends ui{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){tm(e,"orderByPriority");let t=Vp(e._queryParams,ft);return js(t),new On(e._repo,e._path,t,!0)}};function zP(){return new $_}var j_=class extends ui{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){tm(e,"orderByValue");let t=Vp(e._queryParams,iw);return js(t),new On(e._repo,e._path,t,!0)}};function VP(){return new j_}var G_=class extends ui{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Er("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Up(this._value,this._key)._apply(new qp(this._value,this._key)._apply(e))}};function $P(n,e){return Ld("equalTo","key",e,!0),new G_(n,e)}function Di(n,...e){let t=We(n);for(let i of e)t=i._apply(t);return t}R6(ci);F6(ci);var xV="FIREBASE_DATABASE_EMULATOR_HOST",H_={},IV=!1;function kV(n,e,t,i){n.repoInfo_=new yp(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function Aw(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||Sr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),hn("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=L_(s,r),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[xV]),c?(l=!0,s=`http://${c}?ns=${a.namespace}`,o=L_(s,r),a=o.repoInfo):l=!o.repoInfo.secure;let u=r&&l?new dd(dd.OWNER):new Jv(n.name,n.options,e);vP("Invalid Firebase Database URL",o),$e(o.path)||Sr("Database URL must point to the root of a Firebase Database (not including a child path).");let d=DV(a,n,u,new Xv(n.name,t));return new W_(d,n)}function AV(n,e){let t=H_[e];(!t||t[n.key]!==n)&&Sr(`Database ${e}(${n.repoInfo_}) has already been deleted.`),EP(n),delete t[n.key]}function DV(n,e,t,i){let r=H_[e.name];r||(r={},H_[e.name]=r);let s=r[n.toURLString()];return s&&Sr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new O_(n,IV,t,i),r[n.toURLString()]=s,s}var W_=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(cV(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ci(this._repo,et())),this._rootInternal}_delete(){return this._rootInternal!==null&&(AV(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Sr("Cannot call "+e+" on a deleted database.")}};function jP(){VD.IS_TRANSPORT_INITIALIZED&&Cn("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function GP(){jP(),gd.forceDisallow()}function HP(){jP(),Al.forceDisallow(),gd.forceAllow()}function WP(n,e,t,i={}){n=We(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Sr("Cannot call useEmulator() after instance has already been initialized.");let r=n._repoInternal,s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&Sr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new dd(dd.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:Of(i.mockUserToken,n.app.options.projectId);s=new dd(o)}kV(r,e,t,s)}function KP(n){n=We(n),n._checkNotDeleted("goOffline"),EP(n._repo)}function YP(n){n=We(n),n._checkNotDeleted("goOnline"),vV(n._repo)}function QP(n,e){MD(n,e)}function PV(n){J_(Uf),ta(new ri("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Aw(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Yi(jA,GA,n),Yi(jA,GA,"esm2017")}var RV={".sv":"timestamp"};function XP(){return RV}function JP(n){return{".sv":{increment:n}}}var K_=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function ZP(n,e,t){var i;if(n=We(n),ai("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let r=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,s=new un,o=(l,c,u)=>{let d=null;l?s.reject(l):(d=new Ul(u,new ci(n._repo,n._path),ft),s.resolve(new K_(c,d)))},a=rm(n,()=>{});return _V(n._repo,n._path,e,o,a,r),s.promise}tw.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};tw.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};fz(wD.default.Client);PV("node");var MV="@firebase/database-compat",OV="1.0.8";var NV=new As("@firebase/database-compat"),eR=function(n){let e="FIREBASE WARNING: "+n;NV.warn(e)};var LV=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(Gn(n,e)+"must be a boolean.")},FV=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Gn(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Dw=class{constructor(e){this._delegate=e}cancel(e){Ie("OnDisconnect.cancel",0,1,arguments.length),nn("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){Ie("OnDisconnect.remove",0,1,arguments.length),nn("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){Ie("OnDisconnect.set",1,2,arguments.length),nn("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){Ie("OnDisconnect.setWithPriority",2,3,arguments.length),nn("OnDisconnect.setWithPriority","onComplete",i,!0);let r=this._delegate.setWithPriority(e,t);return i&&r.then(()=>i(null),s=>i(s)),r}update(e,t){if(Ie("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,eR("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}nn("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),r=>t(r)),i}};var Pw=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Ie("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var _a=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return Ie("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Ie("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Ie("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Ie("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Ie("DataSnapshot.child",0,1,arguments.length),e=String(e),$l("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return Ie("DataSnapshot.hasChild",1,1,arguments.length),$l("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Ie("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return Ie("DataSnapshot.forEach",1,1,arguments.length),nn("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return Ie("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Ie("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Ie("DataSnapshot.ref",0,0,arguments.length),new ts(this._database,this._delegate.ref)}get ref(){return this.getRef()}},sm=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,r){var s;Ie("Query.on",2,4,arguments.length),nn("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,r),a=(c,u)=>{t.call(o.context,new _a(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return rm(this._delegate,a,l),t;case"child_added":return Cw(this._delegate,a,l),t;case"child_removed":return Iw(this._delegate,a,l),t;case"child_changed":return Tw(this._delegate,a,l),t;case"child_moved":return xw(this._delegate,a,l),t;default:throw new Error(Gn("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(Ie("Query.off",0,3,arguments.length),FV("Query.off",e,!0),nn("Query.off","callback",t,!0),Hy("Query.off","context",i,!0),t){let r=()=>{};r.userCallback=t,r.context=i,kw(this._delegate,e,r)}else kw(this._delegate,e)}get(){return RP(this._delegate).then(e=>new _a(this.database,e))}once(e,t,i,r){Ie("Query.once",1,4,arguments.length),nn("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",i,r),o=new un,a=(c,u)=>{let d=new _a(this.database,c);t&&t.call(s.context,d,u),o.resolve(d)};a.userCallback=t,a.context=s.context;let l=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":rm(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Cw(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":Iw(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Tw(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":xw(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(Gn("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return Ie("Query.limitToFirst",1,1,arguments.length),new n(this.database,Di(this._delegate,FP(e)))}limitToLast(e){return Ie("Query.limitToLast",1,1,arguments.length),new n(this.database,Di(this._delegate,BP(e)))}orderByChild(e){return Ie("Query.orderByChild",1,1,arguments.length),new n(this.database,Di(this._delegate,UP(e)))}orderByKey(){return Ie("Query.orderByKey",0,0,arguments.length),new n(this.database,Di(this._delegate,qP()))}orderByPriority(){return Ie("Query.orderByPriority",0,0,arguments.length),new n(this.database,Di(this._delegate,zP()))}orderByValue(){return Ie("Query.orderByValue",0,0,arguments.length),new n(this.database,Di(this._delegate,VP()))}startAt(e=null,t){return Ie("Query.startAt",0,2,arguments.length),new n(this.database,Di(this._delegate,NP(e,t)))}startAfter(e=null,t){return Ie("Query.startAfter",0,2,arguments.length),new n(this.database,Di(this._delegate,LP(e,t)))}endAt(e=null,t){return Ie("Query.endAt",0,2,arguments.length),new n(this.database,Di(this._delegate,MP(e,t)))}endBefore(e=null,t){return Ie("Query.endBefore",0,2,arguments.length),new n(this.database,Di(this._delegate,OP(e,t)))}equalTo(e,t){return Ie("Query.equalTo",1,2,arguments.length),new n(this.database,Di(this._delegate,$P(e,t)))}toString(){return Ie("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Ie("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Ie("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let r={cancel:void 0,context:void 0};if(t&&i)r.cancel=t,nn(e,"cancel",r.cancel,!0),r.context=i,Hy(e,"context",r.context,!0);else if(t)if(typeof t=="object"&&t!==null)r.context=t;else if(typeof t=="function")r.cancel=t;else throw new Error(Gn(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return r}get ref(){return new ts(this.database,new ci(this._delegate._repo,this._delegate._path))}},ts=class n extends sm{constructor(e,t){super(e,new On(t._repo,t._path,new bd,!1)),this.database=e,this._delegate=t}getKey(){return Ie("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Ie("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,$s(this._delegate,e))}getParent(){Ie("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return Ie("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){Ie("Reference.set",1,2,arguments.length),nn("Reference.set","onComplete",t,!0);let i=im(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}update(e,t){if(Ie("Reference.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,eR("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ai("Reference.update",this._delegate._path),nn("Reference.update","onComplete",t,!0);let i=PP(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){Ie("Reference.setWithPriority",2,3,arguments.length),nn("Reference.setWithPriority","onComplete",i,!0);let r=DP(this._delegate,e,t);return i&&r.then(()=>i(null),s=>i(s)),r}remove(e){Ie("Reference.remove",0,1,arguments.length),nn("Reference.remove","onComplete",e,!0);let t=kP(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){Ie("Reference.transaction",1,3,arguments.length),nn("Reference.transaction","transactionUpdate",e,!1),nn("Reference.transaction","onComplete",t,!0),LV("Reference.transaction","applyLocally",i,!0);let r=ZP(this._delegate,e,{applyLocally:i}).then(s=>new Pw(s.committed,new _a(this.database,s.snapshot)));return t&&r.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),r}setPriority(e,t){Ie("Reference.setPriority",1,2,arguments.length),nn("Reference.setPriority","onComplete",t,!0);let i=AP(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}push(e,t){Ie("Reference.push",0,2,arguments.length),nn("Reference.push","onComplete",t,!0);let i=IP(this._delegate,e),r=i.then(o=>new n(this.database,o));t&&r.then(()=>t(null),o=>t(o));let s=new n(this.database,i);return s.then=r.then.bind(r),s.catch=r.catch.bind(r,void 0),s}onDisconnect(){return ai("Reference.onDisconnect",this._delegate._path),new Dw(new Fp(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var wa=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:GP,forceLongPolling:HP}}useEmulator(e,t,i={}){WP(this._delegate,e,t,i)}ref(e){if(Ie("database.ref",0,1,arguments.length),e instanceof ts){let t=Ew(this._delegate,e.toString());return new ts(this,t)}else{let t=bw(this._delegate,e);return new ts(this,t)}}refFromURL(e){Ie("database.refFromURL",1,1,arguments.length);let i=Ew(this._delegate,e);return new ts(this,i)}goOffline(){return Ie("database.goOffline",0,0,arguments.length),KP(this._delegate)}goOnline(){return Ie("database.goOnline",0,0,arguments.length),YP(this._delegate)}};wa.ServerValue={TIMESTAMP:XP(),increment:n=>JP(n)};function BV({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:r,namespace:s,nodeAdmin:o=!1}){J_(t);let a=new Wy("database-standalone"),l=new Bf("auth-internal",a);l.setComponent(new ri("auth-internal",()=>i,"PRIVATE"));let c;return r&&(c=new Bf("app-check-internal",a),c.setComponent(new ri("app-check-internal",()=>r,"PRIVATE"))),{instance:new wa(Aw(n,l,c,e,o),n),namespace:s}}var UV=Object.freeze({__proto__:null,initStandalone:BV});var qV=wa.ServerValue;function zV(n){n.INTERNAL.registerComponent(new ri("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new wa(r,i)},"PUBLIC").setServiceProps({Reference:ts,Query:sm,Database:wa,DataSnapshot:_a,enableLogging:QP,INTERNAL:UV,ServerValue:qV}).setMultipleInstances(!0)),n.registerVersion(MV,OV,"node")}zV(dn);function Ud(n,e,t="on",i=fl){return new Es(r=>{let s=null;return s=n[t](e,(o,a)=>{i.schedule(()=>{r.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>r.complete())},o=>{i.schedule(()=>r.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(vt(r=>{let{snapshot:s,prevKey:o}=r,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),Vx())}function VV(n){return typeof n=="string"}function $V(n){return typeof n.exportVal=="function"}function sR(n){return n==null}function oR(n){return typeof n.set=="function"}function tR(n,e){return oR(e)?e:n.ref(e)}function aR(n,e){if(VV(n))return e.stringCase();if(oR(n))return e.firebaseCase();if($V(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function lR(n){return(sR(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function cR(n,e,t){e=lR(e);let i=e.map(r=>Ud(n,r,"on",t));return Ou(...i)}function jV(n,e,t){let i=cR(n,e).pipe(ea((r,s)=>[...r,s],[]));return HV(n,i,t)}function GV(n,e){return Ud(n,"value","on",e).pipe(vt(t=>{let i;return t.payload.forEach(r=>(i=r.key,!1)),{data:t,lastKeyToLoad:i}}))}function HV(n,e,t){return GV(n,t).pipe(Gx(e),vt(([r,s])=>{let o=r.lastKeyToLoad,a=s.map(l=>l.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),$x(r=>r.loadedKeys.indexOf(r.lastKeyToLoad)===-1),vt(r=>r.actions))}function nR(n,e){return function(i,r){return aR(i,{stringCase:()=>n.child(i)[e](r),firebaseCase:()=>i[e](r),snapshotCase:()=>i.ref[e](r)})}}function WV(n){return function(t){return t?aR(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function KV(n,e,t){return Ud(n,"value","once",t).pipe(Xr(i=>{let r=[yi(i)];return e.forEach(s=>r.push(Ud(n,s,"on",t))),Ou(...r).pipe(ea(QV,[]))}),Ef())}function uR(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function YV(n,e){if(sR(e))return 0;{let t=uR(n,e);return t===-1?n.length:t+1}}function QV(n,e){let{payload:t,prevKey:i,key:r}=e,s=uR(n,r),o=YV(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==i&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===r?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function iR(n,e,t){return e=lR(e),KV(n,e,t)}function XV(n,e){let t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:nR(i,"update"),set:nR(i,"set"),push:r=>i.push(r),remove:WV(i),snapshotChanges(r){return iR(n,r,t).pipe(zt)},stateChanges(r){return cR(n,r,t).pipe(zt)},auditTrail(r){return jV(n,r,t).pipe(zt)},valueChanges(r,s){return iR(n,r,t).pipe(vt(a=>a.map(l=>s&&s.idField?Sn(ht({},l.payload.val()),{[s.idField]:l.key}):l.payload.val())),zt)}}}function rR(n,e){return function(){return Ud(n,"value","on",e)}}function JV(n,e){return{query:n,snapshotChanges(){return rR(n,e.schedulers.outsideAngular)().pipe(zt)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return rR(n,e.schedulers.outsideAngular)().pipe(zt,vt(i=>i.payload.exists()?i.payload.val():null))}}}var ZV=new ln("angularfire2.realtimeDatabaseURL"),e$=new ln("angularfire2.database.use-emulator"),Rw=(()=>{class n{schedulers;database;constructor(t,i,r,s,o,a,l,c,u,d,h,f,g,_,S){this.schedulers=a;let I=l,E=ia(t,o,i);c&&Yu(E,o,u,h,f,g,d,_),this.database=El(`${E.name}.database.${r}`,"AngularFireDatabase",E.name,()=>{let b=o.runOutsideAngular(()=>E.database(r||void 0));return I&&b.useEmulator(...I),b},[I])}list(t,i){let r=this.schedulers.ngZone.runOutsideAngular(()=>tR(this.database,t)),s=r;return i&&(s=i(r)),XV(s,this)}object(t){let i=this.schedulers.ngZone.runOutsideAngular(()=>tR(this.database,t));return JV(i,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(be(Ps),be(Rs,8),be(ZV,8),be(bn),be(Vn),be(bl),be(e$,8),be(Jf,8),be($u,8),be(ju,8),be(Gu,8),be(Hu,8),be(Wu,8),be(Ku,8),be(Zr,8))};static \u0275prov=at({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),dR=(()=>{class n{constructor(){dn.registerVersion("angularfire",Ds.full,"rtdb-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=xs({type:n});static \u0275inj=Ts({providers:[Rw]})}return n})();import{inspect as hK,TextEncoder as fK,TextDecoder as pK}from"util";import{randomBytes as mK}from"crypto";var hR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fR={};var Gs,Mw;(function(){var n;function e(R,x){function T(){}T.prototype=x.prototype,R.D=x.prototype,R.prototype=new T,R.prototype.constructor=R,R.C=function(A,C,P){for(var y=Array(arguments.length-2),w=2;w<arguments.length;w++)y[w-2]=arguments[w];return x.prototype[C].apply(A,y)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(R,x,T){T||(T=0);var A=Array(16);if(typeof x=="string")for(var C=0;16>C;++C)A[C]=x.charCodeAt(T++)|x.charCodeAt(T++)<<8|x.charCodeAt(T++)<<16|x.charCodeAt(T++)<<24;else for(C=0;16>C;++C)A[C]=x[T++]|x[T++]<<8|x[T++]<<16|x[T++]<<24;x=R.g[0],T=R.g[1],C=R.g[2];var P=R.g[3],y=x+(P^T&(C^P))+A[0]+3614090360&4294967295;x=T+(y<<7&4294967295|y>>>25),y=P+(C^x&(T^C))+A[1]+3905402710&4294967295,P=x+(y<<12&4294967295|y>>>20),y=C+(T^P&(x^T))+A[2]+606105819&4294967295,C=P+(y<<17&4294967295|y>>>15),y=T+(x^C&(P^x))+A[3]+3250441966&4294967295,T=C+(y<<22&4294967295|y>>>10),y=x+(P^T&(C^P))+A[4]+4118548399&4294967295,x=T+(y<<7&4294967295|y>>>25),y=P+(C^x&(T^C))+A[5]+1200080426&4294967295,P=x+(y<<12&4294967295|y>>>20),y=C+(T^P&(x^T))+A[6]+2821735955&4294967295,C=P+(y<<17&4294967295|y>>>15),y=T+(x^C&(P^x))+A[7]+4249261313&4294967295,T=C+(y<<22&4294967295|y>>>10),y=x+(P^T&(C^P))+A[8]+1770035416&4294967295,x=T+(y<<7&4294967295|y>>>25),y=P+(C^x&(T^C))+A[9]+2336552879&4294967295,P=x+(y<<12&4294967295|y>>>20),y=C+(T^P&(x^T))+A[10]+4294925233&4294967295,C=P+(y<<17&4294967295|y>>>15),y=T+(x^C&(P^x))+A[11]+2304563134&4294967295,T=C+(y<<22&4294967295|y>>>10),y=x+(P^T&(C^P))+A[12]+1804603682&4294967295,x=T+(y<<7&4294967295|y>>>25),y=P+(C^x&(T^C))+A[13]+4254626195&4294967295,P=x+(y<<12&4294967295|y>>>20),y=C+(T^P&(x^T))+A[14]+2792965006&4294967295,C=P+(y<<17&4294967295|y>>>15),y=T+(x^C&(P^x))+A[15]+1236535329&4294967295,T=C+(y<<22&4294967295|y>>>10),y=x+(C^P&(T^C))+A[1]+4129170786&4294967295,x=T+(y<<5&4294967295|y>>>27),y=P+(T^C&(x^T))+A[6]+3225465664&4294967295,P=x+(y<<9&4294967295|y>>>23),y=C+(x^T&(P^x))+A[11]+643717713&4294967295,C=P+(y<<14&4294967295|y>>>18),y=T+(P^x&(C^P))+A[0]+3921069994&4294967295,T=C+(y<<20&4294967295|y>>>12),y=x+(C^P&(T^C))+A[5]+3593408605&4294967295,x=T+(y<<5&4294967295|y>>>27),y=P+(T^C&(x^T))+A[10]+38016083&4294967295,P=x+(y<<9&4294967295|y>>>23),y=C+(x^T&(P^x))+A[15]+3634488961&4294967295,C=P+(y<<14&4294967295|y>>>18),y=T+(P^x&(C^P))+A[4]+3889429448&4294967295,T=C+(y<<20&4294967295|y>>>12),y=x+(C^P&(T^C))+A[9]+568446438&4294967295,x=T+(y<<5&4294967295|y>>>27),y=P+(T^C&(x^T))+A[14]+3275163606&4294967295,P=x+(y<<9&4294967295|y>>>23),y=C+(x^T&(P^x))+A[3]+4107603335&4294967295,C=P+(y<<14&4294967295|y>>>18),y=T+(P^x&(C^P))+A[8]+1163531501&4294967295,T=C+(y<<20&4294967295|y>>>12),y=x+(C^P&(T^C))+A[13]+2850285829&4294967295,x=T+(y<<5&4294967295|y>>>27),y=P+(T^C&(x^T))+A[2]+4243563512&4294967295,P=x+(y<<9&4294967295|y>>>23),y=C+(x^T&(P^x))+A[7]+1735328473&4294967295,C=P+(y<<14&4294967295|y>>>18),y=T+(P^x&(C^P))+A[12]+2368359562&4294967295,T=C+(y<<20&4294967295|y>>>12),y=x+(T^C^P)+A[5]+4294588738&4294967295,x=T+(y<<4&4294967295|y>>>28),y=P+(x^T^C)+A[8]+2272392833&4294967295,P=x+(y<<11&4294967295|y>>>21),y=C+(P^x^T)+A[11]+1839030562&4294967295,C=P+(y<<16&4294967295|y>>>16),y=T+(C^P^x)+A[14]+4259657740&4294967295,T=C+(y<<23&4294967295|y>>>9),y=x+(T^C^P)+A[1]+2763975236&4294967295,x=T+(y<<4&4294967295|y>>>28),y=P+(x^T^C)+A[4]+1272893353&4294967295,P=x+(y<<11&4294967295|y>>>21),y=C+(P^x^T)+A[7]+4139469664&4294967295,C=P+(y<<16&4294967295|y>>>16),y=T+(C^P^x)+A[10]+3200236656&4294967295,T=C+(y<<23&4294967295|y>>>9),y=x+(T^C^P)+A[13]+681279174&4294967295,x=T+(y<<4&4294967295|y>>>28),y=P+(x^T^C)+A[0]+3936430074&4294967295,P=x+(y<<11&4294967295|y>>>21),y=C+(P^x^T)+A[3]+3572445317&4294967295,C=P+(y<<16&4294967295|y>>>16),y=T+(C^P^x)+A[6]+76029189&4294967295,T=C+(y<<23&4294967295|y>>>9),y=x+(T^C^P)+A[9]+3654602809&4294967295,x=T+(y<<4&4294967295|y>>>28),y=P+(x^T^C)+A[12]+3873151461&4294967295,P=x+(y<<11&4294967295|y>>>21),y=C+(P^x^T)+A[15]+530742520&4294967295,C=P+(y<<16&4294967295|y>>>16),y=T+(C^P^x)+A[2]+3299628645&4294967295,T=C+(y<<23&4294967295|y>>>9),y=x+(C^(T|~P))+A[0]+4096336452&4294967295,x=T+(y<<6&4294967295|y>>>26),y=P+(T^(x|~C))+A[7]+1126891415&4294967295,P=x+(y<<10&4294967295|y>>>22),y=C+(x^(P|~T))+A[14]+2878612391&4294967295,C=P+(y<<15&4294967295|y>>>17),y=T+(P^(C|~x))+A[5]+4237533241&4294967295,T=C+(y<<21&4294967295|y>>>11),y=x+(C^(T|~P))+A[12]+1700485571&4294967295,x=T+(y<<6&4294967295|y>>>26),y=P+(T^(x|~C))+A[3]+2399980690&4294967295,P=x+(y<<10&4294967295|y>>>22),y=C+(x^(P|~T))+A[10]+4293915773&4294967295,C=P+(y<<15&4294967295|y>>>17),y=T+(P^(C|~x))+A[1]+2240044497&4294967295,T=C+(y<<21&4294967295|y>>>11),y=x+(C^(T|~P))+A[8]+1873313359&4294967295,x=T+(y<<6&4294967295|y>>>26),y=P+(T^(x|~C))+A[15]+4264355552&4294967295,P=x+(y<<10&4294967295|y>>>22),y=C+(x^(P|~T))+A[6]+2734768916&4294967295,C=P+(y<<15&4294967295|y>>>17),y=T+(P^(C|~x))+A[13]+1309151649&4294967295,T=C+(y<<21&4294967295|y>>>11),y=x+(C^(T|~P))+A[4]+4149444226&4294967295,x=T+(y<<6&4294967295|y>>>26),y=P+(T^(x|~C))+A[11]+3174756917&4294967295,P=x+(y<<10&4294967295|y>>>22),y=C+(x^(P|~T))+A[2]+718787259&4294967295,C=P+(y<<15&4294967295|y>>>17),y=T+(P^(C|~x))+A[9]+3951481745&4294967295,R.g[0]=R.g[0]+x&4294967295,R.g[1]=R.g[1]+(C+(y<<21&4294967295|y>>>11))&4294967295,R.g[2]=R.g[2]+C&4294967295,R.g[3]=R.g[3]+P&4294967295}i.prototype.u=function(R,x){x===void 0&&(x=R.length);for(var T=x-this.blockSize,A=this.B,C=this.h,P=0;P<x;){if(C==0)for(;P<=T;)r(this,R,P),P+=this.blockSize;if(typeof R=="string"){for(;P<x;)if(A[C++]=R.charCodeAt(P++),C==this.blockSize){r(this,A),C=0;break}}else for(;P<x;)if(A[C++]=R[P++],C==this.blockSize){r(this,A),C=0;break}}this.h=C,this.o+=x},i.prototype.v=function(){var R=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);R[0]=128;for(var x=1;x<R.length-8;++x)R[x]=0;var T=8*this.o;for(x=R.length-8;x<R.length;++x)R[x]=T&255,T/=256;for(this.u(R),R=Array(16),x=T=0;4>x;++x)for(var A=0;32>A;A+=8)R[T++]=this.g[x]>>>A&255;return R};function s(R,x){var T=a;return Object.prototype.hasOwnProperty.call(T,R)?T[R]:T[R]=x(R)}function o(R,x){this.h=x;for(var T=[],A=!0,C=R.length-1;0<=C;C--){var P=R[C]|0;A&&P==x||(T[C]=P,A=!1)}this.g=T}var a={};function l(R){return-128<=R&&128>R?s(R,function(x){return new o([x|0],0>x?-1:0)}):new o([R|0],0>R?-1:0)}function c(R){if(isNaN(R)||!isFinite(R))return d;if(0>R)return S(c(-R));for(var x=[],T=1,A=0;R>=T;A++)x[A]=R/T|0,T*=4294967296;return new o(x,0)}function u(R,x){if(R.length==0)throw Error("number format error: empty string");if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(R.charAt(0)=="-")return S(u(R.substring(1),x));if(0<=R.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=c(Math.pow(x,8)),A=d,C=0;C<R.length;C+=8){var P=Math.min(8,R.length-C),y=parseInt(R.substring(C,C+P),x);8>P?(P=c(Math.pow(x,P)),A=A.j(P).add(c(y))):(A=A.j(T),A=A.add(c(y)))}return A}var d=l(0),h=l(1),f=l(16777216);n=o.prototype,n.m=function(){if(_(this))return-S(this).m();for(var R=0,x=1,T=0;T<this.g.length;T++){var A=this.i(T);R+=(0<=A?A:4294967296+A)*x,x*=4294967296}return R},n.toString=function(R){if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(g(this))return"0";if(_(this))return"-"+S(this).toString(R);for(var x=c(Math.pow(R,6)),T=this,A="";;){var C=M(T,x).g;T=I(T,C.j(x));var P=((0<T.g.length?T.g[0]:T.h)>>>0).toString(R);if(T=C,g(T))return P+A;for(;6>P.length;)P="0"+P;A=P+A}},n.i=function(R){return 0>R?0:R<this.g.length?this.g[R]:this.h};function g(R){if(R.h!=0)return!1;for(var x=0;x<R.g.length;x++)if(R.g[x]!=0)return!1;return!0}function _(R){return R.h==-1}n.l=function(R){return R=I(this,R),_(R)?-1:g(R)?0:1};function S(R){for(var x=R.g.length,T=[],A=0;A<x;A++)T[A]=~R.g[A];return new o(T,~R.h).add(h)}n.abs=function(){return _(this)?S(this):this},n.add=function(R){for(var x=Math.max(this.g.length,R.g.length),T=[],A=0,C=0;C<=x;C++){var P=A+(this.i(C)&65535)+(R.i(C)&65535),y=(P>>>16)+(this.i(C)>>>16)+(R.i(C)>>>16);A=y>>>16,P&=65535,y&=65535,T[C]=y<<16|P}return new o(T,T[T.length-1]&-2147483648?-1:0)};function I(R,x){return R.add(S(x))}n.j=function(R){if(g(this)||g(R))return d;if(_(this))return _(R)?S(this).j(S(R)):S(S(this).j(R));if(_(R))return S(this.j(S(R)));if(0>this.l(f)&&0>R.l(f))return c(this.m()*R.m());for(var x=this.g.length+R.g.length,T=[],A=0;A<2*x;A++)T[A]=0;for(A=0;A<this.g.length;A++)for(var C=0;C<R.g.length;C++){var P=this.i(A)>>>16,y=this.i(A)&65535,w=R.i(C)>>>16,F=R.i(C)&65535;T[2*A+2*C]+=y*F,E(T,2*A+2*C),T[2*A+2*C+1]+=P*F,E(T,2*A+2*C+1),T[2*A+2*C+1]+=y*w,E(T,2*A+2*C+1),T[2*A+2*C+2]+=P*w,E(T,2*A+2*C+2)}for(A=0;A<x;A++)T[A]=T[2*A+1]<<16|T[2*A];for(A=x;A<2*x;A++)T[A]=0;return new o(T,0)};function E(R,x){for(;(R[x]&65535)!=R[x];)R[x+1]+=R[x]>>>16,R[x]&=65535,x++}function b(R,x){this.g=R,this.h=x}function M(R,x){if(g(x))throw Error("division by zero");if(g(R))return new b(d,d);if(_(R))return x=M(S(R),x),new b(S(x.g),S(x.h));if(_(x))return x=M(R,S(x)),new b(S(x.g),x.h);if(30<R.g.length){if(_(R)||_(x))throw Error("slowDivide_ only works with positive integers.");for(var T=h,A=x;0>=A.l(R);)T=N(T),A=N(A);var C=U(T,1),P=U(A,1);for(A=U(A,2),T=U(T,2);!g(A);){var y=P.add(A);0>=y.l(R)&&(C=C.add(T),P=y),A=U(A,1),T=U(T,1)}return x=I(R,C.j(x)),new b(C,x)}for(C=d;0<=R.l(x);){for(T=Math.max(1,Math.floor(R.m()/x.m())),A=Math.ceil(Math.log(T)/Math.LN2),A=48>=A?1:Math.pow(2,A-48),P=c(T),y=P.j(x);_(y)||0<y.l(R);)T-=A,P=c(T),y=P.j(x);g(P)&&(P=h),C=C.add(P),R=I(R,y)}return new b(C,R)}n.A=function(R){return M(this,R).h},n.and=function(R){for(var x=Math.max(this.g.length,R.g.length),T=[],A=0;A<x;A++)T[A]=this.i(A)&R.i(A);return new o(T,this.h&R.h)},n.or=function(R){for(var x=Math.max(this.g.length,R.g.length),T=[],A=0;A<x;A++)T[A]=this.i(A)|R.i(A);return new o(T,this.h|R.h)},n.xor=function(R){for(var x=Math.max(this.g.length,R.g.length),T=[],A=0;A<x;A++)T[A]=this.i(A)^R.i(A);return new o(T,this.h^R.h)};function N(R){for(var x=R.g.length+1,T=[],A=0;A<x;A++)T[A]=R.i(A)<<1|R.i(A-1)>>>31;return new o(T,R.h)}function U(R,x){var T=x>>5;x%=32;for(var A=R.g.length-T,C=[],P=0;P<A;P++)C[P]=0<x?R.i(P+T)>>>x|R.i(P+T+1)<<32-x:R.i(P+T);return new o(C,R.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,Mw=fR.Md5=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,Gs=fR.Integer=o}).apply(typeof hR<"u"?hR:typeof self<"u"?self:typeof window<"u"?window:{});var qa=By(UN(),1),QL=By(kb(),1);var qN="@firebase/firestore",zN="4.7.2";var Zt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Zt.UNAUTHENTICATED=new Zt(null);Zt.GOOGLE_CREDENTIALS=new Zt("google-credentials-uid");Zt.FIRST_PARTY=new Zt("first-party-uid");Zt.MOCK_USER=new Zt("mock-user");var gK="10.13.2";var du=gK;function yK(n){du=n}function vK(n){return hK(n,{depth:100})}var Io=new As("@firebase/firestore");function Bc(){return Io.logLevel}function XL(n){Io.setLogLevel(n)}function Z(n,...e){if(Io.logLevel<=xi.DEBUG){let t=e.map(cT);Io.debug(`Firestore (${du}): ${n}`,...t)}}function Rt(n,...e){if(Io.logLevel<=xi.ERROR){let t=e.map(cT);Io.error(`Firestore (${du}): ${n}`,...t)}}function $i(n,...e){if(Io.logLevel<=xi.WARN){let t=e.map(cT);Io.warn(`Firestore (${du}): ${n}`,...t)}}function cT(n){if(typeof n=="string")return n;try{return vK(n)}catch{return n}}function fe(n="Unexpected state"){let e=`FIRESTORE (${du}) INTERNAL ASSERTION FAILED: `+n;throw Rt(e),new Error(e)}function _e(n,e){n||fe()}function JL(n,e){n||fe()}function ce(n,e){return n}var G={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Y=class extends DI{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var jt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var u0=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},l1=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Zt.UNAUTHENTICATED))}shutdown(){}},c1=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},u1=class{constructor(e){this.authProvider=e,this.currentUser=Zt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.tokenCounter,r=l=>this.tokenCounter!==i?(i=this.tokenCounter,t(l)):Promise.resolve(),s=new jt;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new jt,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>B(this,null,function*(){yield l.promise,yield r(this.currentUser)}))},a=l=>{Z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(Z("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new jt)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.tokenCounter!==e?(Z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(_e(typeof i.accessToken=="string"),new u0(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return _e(e===null||typeof e=="string"),new Zt(e)}},d1=class{constructor(e,t,i){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=i,this.type="FirstParty",this.user=Zt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},h1=class{constructor(e,t,i){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=i}getToken(){return Promise.resolve(new d1(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(Zt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},f1=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},p1=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let i=s=>{s.error!=null&&Z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,Z("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{Z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?r(s):Z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(_e(typeof t.token=="string"),this.latestAppCheckToken=t.token,new f1(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function _K(n){if(!n)return new l1;switch(n.type){case"firstParty":return new h1(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Y(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function wK(n){return mK(n)}var d0=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="",r=20;for(;i.length<r;){let s=wK(40);for(let o=0;o<s.length;++o)i.length<r&&s[o]<t&&(i+=e.charAt(s[o]%e.length))}return i}};function Ne(n,e){return n<e?-1:n>e?1:0}function za(n,e,t){return n.length!==e.length?!1:n.every((i,r)=>t(i,e[r]))}function ZL(n){return n+"\0"}var VN=-62135596800,$N=1e6,Mt=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Y(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Y(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<VN)throw new Y(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Y(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor((e-t*1e3)*$N);return new n(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/$N}_compareTo(e){return this.seconds===e.seconds?Ne(this.nanoseconds,e.nanoseconds):Ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-VN,t=String(e).padStart(12,"0"),i=String(this.nanoseconds).padStart(9,"0");return t+"."+i}};var Te=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Mt(0,0))}static max(){return new n(new Mt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var jN="__name__",h0=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&fe(),i===void 0?i=e.length-t:i>e.length-t&&fe(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Xe=class n extends h0{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new Y(G.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},SK=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ht=class n extends h0{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return SK.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===jN}static keyField(){return new n([jN])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new Y(G.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new Y(G.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[r+1];if(!(l==="\\"||l==="."||l==="`"))throw new Y(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else a==="`"?(o=!o,r++):a==="."&&!o?(s(),r++):(i+=a,r++)}if(s(),o)throw new Y(G.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var le=class n{constructor(e){this.path=e}static fromPath(e){return new n(Xe.fromString(e))}static fromName(e){return new n(Xe.fromString(e).popFirst(5))}static empty(){return new n(Xe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Xe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Xe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new Xe(e.slice()))}};var Wc=-1,bK=0,m1=(()=>{class n{constructor(t,i,r,s){this.indexId=t,this.collectionGroup=i,this.fields=r,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function uT(n){return n.fields.find(e=>e.kind===2)}function Va(n){return n.fields.filter(e=>e.kind!==2)}function EK(n){let e=Va(n);return e.length===0?0:e[e.length-1].kind}function CK(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var jc=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Mh=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(bK,ji.min())}};function eF(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=Te.fromTimestamp(i===1e9?new Mt(t+1,0):new Mt(t,i));return new ji(r,le.empty(),e)}function tF(n){return new ji(n.readTime,n.key,Wc)}var ji=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(Te.min(),le.empty(),Wc)}static max(){return new n(Te.max(),le.empty(),Wc)}};function dT(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=le.comparator(n.documentKey,e.documentKey),t!==0)?t:Ne(n.largestBatchId,e.largestBatchId)}var nF="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",f0=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Bo(n){return B(this,null,function*(){if(n.code===G.FAILED_PRECONDITION&&n.message===nF)Z("LocalStore","Unexpectedly lost primary lease");else throw n})}var $=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&fe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},l=>i(l))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&i(o)},u=>r(u))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};var pi="SimpleDb",TK=3,p0=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new jt,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new Ua(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=i=>{let r=hT(i.target.error);this.completionDeferred.reject(new Ua(e,r))}}static open(e,t,i,r){try{return new n(t,e.transaction(r,i))}catch(s){throw new Ua(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(Z(pi,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new y1(t)}},ko=class n{constructor(e,t,i){this.name=e,this.version=t,this.schemaConverter=i,n.getIOSVersion(Uu())===12.2&&Rt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Z(pi,"Removing database:",e),Ra(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Nf())return!1;if(n.isMockPersistence())return!0;let e=Uu(),t=n.getIOSVersion(e),i=0<t&&t<10,r=iF(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}ensureDb(e){return B(this,null,function*(){return this.db||(Z(pi,"Opening database:",this.name),this.db=yield new Promise((t,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{i(new Ua(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new Y(G.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new Y(G.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new Ua(e,o))},r.onupgradeneeded=s=>{Z(pi,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,r.transaction,s.oldVersion,this.version).next(()=>{Z(pi,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){return B(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=p0.open(this.db,e,s?"readonly":"readwrite",i),l=r(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),$.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<TK;if(Z(pi,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function iF(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var g1=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return Ra(this.dbCursor.delete())}},Ua=class extends Y{constructor(e,t){super(G.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Uo(n){return n.name==="IndexedDbTransactionError"}var y1=class{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(Z(pi,"PUT",this.store.name,e,t),i=this.store.put(t,e)):(Z(pi,"PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Ra(i)}add(e){Z(pi,"ADD",this.store.name,e,e);let t=this.store.add(e);return Ra(t)}get(e){let t=this.store.get(e);return Ra(t).next(i=>(i===void 0&&(i=null),Z(pi,"GET",this.store.name,e,i),i))}delete(e){Z(pi,"DELETE",this.store.name,e);let t=this.store.delete(e);return Ra(t)}count(){Z(pi,"COUNT",this.store.name);let e=this.store.count();return Ra(e)}loadAll(e,t){let i=this.options(e,t),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(i.range);return new $((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(i),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let i=this.store.getAll(e,t===null?void 0:t);return new $((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}deleteAll(e,t){Z(pi,"DELETE ALL",this.store.name);let i=this.options(e,t);i.keysOnly=!1;let r=this.cursor(i);return this.iterateCursor(r,(s,o,a)=>a.delete())}iterate(e,t){let i;t?i=e:(i={},t=e);let r=this.cursor(i);return this.iterateCursor(r,t)}iterateSerial(e){let t=this.cursor({});return new $((i,r)=>{t.onerror=s=>{let o=hT(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){i();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():i()})}})}iterateCursor(e,t){let i=[];return new $((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){r();return}let l=new g1(a),c=t(a.primaryKey,a.value,l);if(c instanceof $){let u=c.catch(d=>(l.done(),$.reject(d)));i.push(u)}l.isDone?r():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>$.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let i=this.store.index(e.index);return e.keysOnly?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function Ra(n){return new $((e,t)=>{n.onsuccess=i=>{let r=i.target.result;e(r)},n.onerror=i=>{let r=hT(i.target.error);t(r)}})}var GN=!1;function hT(n){let e=ko.getIOSVersion(Uu());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let i=new Y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return GN||(GN=!0,setTimeout(()=>{throw i},0)),i}}return n}var Ih="IndexBackfiller",xK=15*1e3,IK=60*1e3,kK=50,v1=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(xK)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){Z(Ih,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>B(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();Z(Ih,`Documents written: ${t}`)}catch(t){Uo(t)?Z(Ih,"Ignoring IndexedDB error during index backfill: ",t):yield Bo(t)}yield this.schedule(IK)}))}},_1=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return B(this,arguments,function*(e=kK){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let i=new Set,r=t,s=!0;return $.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||i.has(o))s=!1;else return Z(Ih,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,r).next(a=>{r-=a,i.add(o)})})).next(()=>t-r)}writeEntriesForCollectionGroup(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(r,s)).next(a=>(Z(Ih,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let i=e;return t.changes.forEach((r,s)=>{let o=tF(s);dT(o,i)>0&&(i=o)}),new ji(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}};var mi=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.setPreviousValue(r),this.writeNewSequenceNumber=r=>i.writeSequenceNumber(r))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Gc="",w1="",rF="",sF="";function Bn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=HN(e)),e=AK(n.get(t),e);return HN(e)}function AK(n,e){let t=e,i=n.length;for(let r=0;r<i;r++){let s=n.charAt(r);switch(s){case"\0":t+=Gc+rF;break;case Gc:t+=Gc+sF;break;default:t+=s}}return t}function HN(n){return n+Gc+w1}function zr(n){let e=n.length;if(_e(e>=2),e===2)return _e(n.charAt(0)===Gc&&n.charAt(1)===w1),Xe.emptyPath();let t=e-2,i=[],r="";for(let s=0;s<e;){let o=n.indexOf(Gc,s);switch((o<0||o>t)&&fe(),n.charAt(o+1)){case w1:let l=n.substring(s,o),c;r.length===0?c=l:(r+=l,c=r,r=""),i.push(c);break;case rF:r+=n.substring(s,o),r+="\0";break;case sF:r+=n.substring(s,o+1);break;default:fe()}s=o+2}return new Xe(i)}var Ma="remoteDocuments";var of="owner",Pc="owner",af="mutationQueues",DK="userId",ar="mutations",oF="batchId",Fa="userMutationsIndex",aF=["userId","batchId"];function PK(n){return[n]}function r0(n,e){return[n,Bn(e)]}function lF(n,e,t){return[n,Bn(e),t]}var RK={},hu="documentMutations",ny="remoteDocumentsV14",MK=["prefixPath","collectionGroup","readTime","documentId"],s0="documentKeyIndex",OK=["prefixPath","collectionGroup","documentId"],cF="collectionGroupIndex",NK=["collectionGroup","readTime","prefixPath","documentId"],lf="remoteDocumentGlobal",S1="remoteDocumentGlobalKey",fu="targets",LK="targetId",uF="queryTargetsIndex",FK=["canonicalId","targetId"],pu="targetDocuments",BK=["targetId","path"],fT="documentTargetsIndex",UK=["path","targetId"],m0="targetGlobalKey",tl="targetGlobal",Oh="collectionParents",qK=["collectionId","parent"],Kc="clientMetadata",zK="clientId",iy="bundles",VK="bundleId",ry="namedQueries",$K="name",pT="indexConfiguration",jK="indexId",b1="collectionGroupIndex",GK="collectionGroup",sy="indexState",HK=["indexId","uid"],dF="sequenceNumberIndex",WK=["uid","sequenceNumber"],oy="indexEntries",KK=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],hF="documentKeyIndex",YK=["indexId","uid","orderedDocumentKey"],ay="documentOverlays",QK=["userId","collectionPath","documentId"],E1="collectionPathOverlayIndex",XK=["userId","collectionPath","largestBatchId"],fF="collectionGroupOverlayIndex",JK=["userId","collectionGroup","largestBatchId"],mT="globals",ZK="name",eY=[af,ar,hu,Ma,fu,of,tl,pu],tY=eY,nY=[...tY,Kc],iY=[...nY,lf],rY=[...iY,Oh],pF=[...rY,iy,ry],sY=[...pF,ay],mF=[af,ar,hu,ny,fu,of,tl,pu,Kc,lf,Oh,iy,ry,ay],gF=mF,gT=[...gF,pT,sy,oy],oY=gT,aY=[...gT,mT];function lY(n){if(n===17)return aY;if(n===16)return oY;if(n===15)return gT;if(n===14)return gF;if(n===13)return mF;if(n===12)return sY;if(n===11)return pF;fe()}var Nh=class extends f0{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function sn(n,e){let t=ce(n);return ko.getStore(t.simpleDbTransaction,e)}function WN(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function nl(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function yF(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var St=class n{constructor(e,t){this.comparator=e,this.root=t||kh.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,kh.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,kh.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vc(this.root,e,this.comparator,!0)}},Vc=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},kh=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,i){let r,s=this;if(i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),i(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw fe();let t=this.left.check();if(t!==this.right.check())throw fe();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),C1=class{constructor(){this.size=0}get key(){throw fe()}get value(){throw fe()}get color(){throw fe()}get left(){throw fe()}get right(){throw fe()}copy(e,t,i,r,s){return this}insert(e,t,i){return new kh(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};kh.EMPTY=new C1;var ut=class n{constructor(e){this.comparator=e,this.data=new St(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(t!==void 0?i=this.data.getIteratorFrom(t):i=this.data.getIterator();i.hasNext();){let r=i.getNext();if(!e(r.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new g0(this.data.getIterator())}getIteratorFrom(e){return new g0(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},g0=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function cY(n,e,t,i,r){let s=n.getIterator(),o=e.getIterator(),a=Rc(s),l=Rc(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(i(l),l=Rc(o)):u?(r(a),a=Rc(s)):(a=Rc(s),l=Rc(o))}}function Rc(n){return n.hasNext()?n.getNext():void 0}var gi=class n{constructor(e){this.fields=e,e.sort(Ht.comparator)}static empty(){return new n([])}unionWith(e){let t=new ut(Ht.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return za(this.fields,e.fields,(t,i)=>t.isEqual(i))}};function uY(n){return Buffer.from(n,"base64").toString("binary")}function dY(n){return Buffer.from(n,"binary").toString("base64")}function vF(){return!0}var Wt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=uY(e);return new n(t)}static fromUint8Array(e){let t=hY(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return dY(this.binaryString)}toUint8Array(){return fY(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return Ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Wt.EMPTY_BYTE_STRING=new Wt("");function hY(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function fY(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var pY=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hs(n){if(_e(!!n),typeof n=="string"){let e=0,t=pY.exec(n);if(_e(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}else{let e=It(n.seconds),t=It(n.nanos);return{seconds:e,nanos:t}}}function It(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ao(n){return typeof n=="string"?Wt.fromBase64String(n):Wt.fromUint8Array(n)}var _F="server_timestamp",wF="__type__",SF="__previous_value__",bF="__local_write_time__";function ly(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[wF])===null||t===void 0?void 0:t.stringValue)===_F}function mY(n,e){let t={fields:{[wF]:{stringValue:_F},[bF]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&ly(e)&&(e=yT(e)),e&&(t.fields[SF]=e),{mapValue:t}}function yT(n){let e=n.mapValue.fields[SF];return ly(e)?yT(e):e}function Lh(n){let e=hs(n.mapValue.fields[bF].timestampValue);return new Mt(e.seconds,e.nanos)}var T1=class{constructor(e,t,i,r,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},KN="(default)",Do=class n{constructor(e,t){this.projectId=e,this.database=t||KN}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===KN}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function gY(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new Y(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Do(n.options.projectId,e)}var xo=-1;function cf(n){return n==null}function Fh(n){return n===0&&1/n===-1/0}function EF(n){return typeof n=="number"&&Number.isInteger(n)&&!Fh(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var vT="__type__",CF="__max__",Co={mapValue:{fields:{__type__:{stringValue:CF}}}},_T="__vector__",Yc="value",o0={nullValue:"NULL_VALUE"};function $a(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ly(n)?4:xF(n)?9007199254740991:cy(n)?10:11:fe()}function lr(n,e){if(n===e)return!0;let t=$a(n),i=$a(e);if(t!==i)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Lh(n).isEqual(Lh(e));case 3:return yY(n,e);case 5:return n.stringValue===e.stringValue;case 6:return _Y(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return vY(n,e);case 2:return wY(n,e);case 9:return za(n.arrayValue.values||[],e.arrayValue.values||[],lr);case 10:case 11:return SY(n,e);case 9007199254740991:return!0;default:return fe()}}function yY(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=hs(n.timestampValue),i=hs(e.timestampValue);return t.seconds===i.seconds&&t.nanos===i.nanos}function vY(n,e){return It(n.geoPointValue.latitude)===It(e.geoPointValue.latitude)&&It(n.geoPointValue.longitude)===It(e.geoPointValue.longitude)}function _Y(n,e){return Ao(n.bytesValue).isEqual(Ao(e.bytesValue))}function wY(n,e){if("integerValue"in n&&"integerValue"in e)return It(n.integerValue)===It(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=It(n.doubleValue),i=It(e.doubleValue);return t===i?Fh(t)===Fh(i):isNaN(t)&&isNaN(i)}return!1}function SY(n,e){let t=n.mapValue.fields||{},i=e.mapValue.fields||{};if(WN(t)!==WN(i))return!1;for(let r in t)if(t.hasOwnProperty(r)&&(i[r]===void 0||!lr(t[r],i[r])))return!1;return!0}function Bh(n,e){return(n.values||[]).find(t=>lr(t,e))!==void 0}function Po(n,e){if(n===e)return 0;let t=$a(n),i=$a(e);if(t!==i)return Ne(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ne(n.booleanValue,e.booleanValue);case 2:return bY(n,e);case 3:return YN(n.timestampValue,e.timestampValue);case 4:return YN(Lh(n),Lh(e));case 5:return Ne(n.stringValue,e.stringValue);case 6:return TY(n.bytesValue,e.bytesValue);case 7:return EY(n.referenceValue,e.referenceValue);case 8:return CY(n.geoPointValue,e.geoPointValue);case 9:return TF(n.arrayValue,e.arrayValue);case 10:return xY(n.mapValue,e.mapValue);case 11:return IY(n.mapValue,e.mapValue);default:throw fe()}}function bY(n,e){let t=It(n.integerValue||n.doubleValue),i=It(e.integerValue||e.doubleValue);return t<i?-1:t>i?1:t===i?0:isNaN(t)?isNaN(i)?0:-1:1}function YN(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ne(n,e);let t=hs(n),i=hs(e),r=Ne(t.seconds,i.seconds);return r!==0?r:Ne(t.nanos,i.nanos)}function EY(n,e){let t=n.split("/"),i=e.split("/");for(let r=0;r<t.length&&r<i.length;r++){let s=Ne(t[r],i[r]);if(s!==0)return s}return Ne(t.length,i.length)}function CY(n,e){let t=Ne(It(n.latitude),It(e.latitude));return t!==0?t:Ne(It(n.longitude),It(e.longitude))}function TY(n,e){let t=Ao(n),i=Ao(e);return t.compareTo(i)}function TF(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=Po(t[r],i[r]);if(s)return s}return Ne(t.length,i.length)}function xY(n,e){var t,i,r,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Yc])===null||t===void 0?void 0:t.arrayValue,c=(i=a[Yc])===null||i===void 0?void 0:i.arrayValue,u=Ne(((r=l?.values)===null||r===void 0?void 0:r.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:TF(l,c)}function IY(n,e){if(n===Co.mapValue&&e===Co.mapValue)return 0;if(n===Co.mapValue)return 1;if(e===Co.mapValue)return-1;let t=n.fields||{},i=Object.keys(t),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let o=0;o<i.length&&o<s.length;++o){let a=Ne(i[o],s[o]);if(a!==0)return a;let l=Po(t[i[o]],r[s[o]]);if(l!==0)return l}return Ne(i.length,s.length)}function Qc(n){return wT(n)}function wT(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?AY(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?kY(n.bytesValue):"referenceValue"in n?PY(n.referenceValue):"geoPointValue"in n?DY(n.geoPointValue):"arrayValue"in n?MY(n.arrayValue):"mapValue"in n?RY(n.mapValue):fe()}function kY(n){return Ao(n).toBase64()}function AY(n){let e=hs(n);return`time(${e.seconds},${e.nanos})`}function DY(n){return`geo(${n.latitude},${n.longitude})`}function PY(n){return le.fromName(n).toString()}function RY(n){let e=Object.keys(n.fields||{}).sort(),t="{",i=!0;for(let r of e)i?i=!1:t+=",",t+=`${r}:${wT(n.fields[r])}`;return t+"}"}function MY(n){let e="[",t=!0;for(let i of n.values||[])t?t=!1:e+=",",e+=wT(i);return e+"]"}function ja(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function x1(n){return!!n&&"integerValue"in n}function OY(n){return!!n&&"doubleValue"in n}function NY(n){return x1(n)||OY(n)}function Uh(n){return!!n&&"arrayValue"in n}function QN(n){return!!n&&"nullValue"in n}function XN(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function a0(n){return!!n&&"mapValue"in n}function cy(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[vT])===null||t===void 0?void 0:t.stringValue)===_T}function Ah(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return nl(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Ah(i)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ah(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function xF(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===CF}var IF={mapValue:{fields:{[vT]:{stringValue:_T},[Yc]:{arrayValue:{}}}}};function LY(n){return"nullValue"in n?o0:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ja(Do.empty(),le.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?cy(n)?IF:{mapValue:{}}:fe()}function FY(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ja(Do.empty(),le.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?IF:"mapValue"in n?cy(n)?{mapValue:{}}:Co:fe()}function JN(n,e){let t=Po(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ZN(n,e){let t=Po(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var An=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!a0(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let i=this.getFieldsMap(e.popLast());i[e.lastSegment()]=Ah(t)}setAll(e){let t=Ht.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=Ah(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());a0(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return lr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];(!a0(r)||!r.mapValue.fields)&&(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){nl(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(Ah(this.value))}};function kF(n){let e=[];return nl(n.fields,(t,i)=>{let r=new Ht([t]);if(a0(i)){let o=kF(i.mapValue).fields;if(o.length===0)e.push(r);else for(let a of o)e.push(r.child(a))}else e.push(r)}),new gi(e)}var Jt=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,Te.min(),Te.min(),Te.min(),An.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,Te.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,Te.min(),Te.min(),An.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Te.min(),Te.min(),An.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(Te.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=An.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=An.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function BY(n,e,t){let i=e.data.field(n),r=t.data.field(n);return i!==null&&r!==null?Po(i,r):fe()}var Gr=class{constructor(e,t){this.position=e,this.inclusive=t}};function AF(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField())i=le.comparator(le.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);i=Po(o,a)}if(s.dir==="desc"&&(i=i*-1),i!==0)break}return i}function UY(n,e,t){let i=AF(n,e,t);return n.inclusive?i>=0:i>0}function qY(n,e,t){let i=AF(n,e,t);return n.inclusive?i<=0:i<0}function eL(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let i=n.position[t],r=e.position[t];if(!lr(i,r))return!1}return!0}var Ga=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function zY(n){return n.field.canonicalString()+n.dir}function VY(n){return`${n.field.canonicalString()} (${n.dir})`}function $Y(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var y0=class{},Ke=class n extends y0{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new A1(e,t,i):t==="array-contains"?new R1(e,i):t==="in"?new v0(e,i):t==="not-in"?new M1(e,i):t==="array-contains-any"?new O1(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new D1(e,i):new P1(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Po(t,this.value)):t!==null&&$a(this.value)===$a(t)&&this.matchesComparison(Po(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return fe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},st=class n extends y0{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return Xc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function Xc(n){return n.op==="and"}function I1(n){return n.op==="or"}function ST(n){return DF(n)&&Xc(n)}function DF(n){for(let e of n.filters)if(e instanceof st)return!1;return!0}function k1(n){if(n instanceof Ke)return n.field.canonicalString()+n.op.toString()+Qc(n.value);if(ST(n))return n.filters.map(e=>k1(e)).join(",");{let e=n.filters.map(t=>k1(t)).join(",");return`${n.op}(${e})`}}function PF(n,e){if(n instanceof Ke)return jY(n,e);if(n instanceof st)return GY(n,e);fe()}function jY(n,e){return e instanceof Ke&&n.op===e.op&&n.field.isEqual(e.field)&&lr(n.value,e.value)}function GY(n,e){return e instanceof st&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((i,r,s)=>i&&PF(r,e.filters[s]),!0):!1}function RF(n,e){let t=n.filters.concat(e);return st.create(t,n.op)}function MF(n){return n instanceof Ke?WY(n):n instanceof st?HY(n):"Filter"}function HY(n){return n.op.toString()+" {"+n.getFilters().map(MF).join(" ,")+"}"}function WY(n){return`${n.field.canonicalString()} ${n.op} ${Qc(n.value)}`}var A1=class extends Ke{constructor(e,t,i){super(e,t,i),this.key=le.fromName(i.referenceValue)}matches(e){let t=le.comparator(e.key,this.key);return this.matchesComparison(t)}},D1=class extends Ke{constructor(e,t){super(e,"in",t),this.keys=OF("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},P1=class extends Ke{constructor(e,t){super(e,"not-in",t),this.keys=OF("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function OF(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>le.fromName(i.referenceValue))}var R1=class extends Ke{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Uh(t)&&Bh(t.arrayValue,this.value)}},v0=class extends Ke{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Bh(this.value.arrayValue,t)}},M1=class extends Ke{constructor(e,t){super(e,"not-in",t)}matches(e){if(Bh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Bh(this.value.arrayValue,t)}},O1=class extends Ke{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Uh(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(i=>Bh(this.value.arrayValue,i))}};var N1=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function L1(n,e=null,t=[],i=[],r=null,s=null,o=null){return new N1(n,e,t,i,r,s,o)}function Ha(n){let e=ce(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>k1(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>zY(i)).join(","),cf(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Qc(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Qc(i)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function KY(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>MF(t)).join(", ")}]`),cf(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>VY(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Qc(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Qc(t)).join(",")),`Target(${e})`}function uf(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!$Y(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!PF(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!eL(n.startAt,e.startAt)?!1:eL(n.endAt,e.endAt)}function _0(n){return le.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function uy(n,e){return n.filters.filter(t=>t instanceof Ke&&t.field.isEqual(e))}function YY(n,e){let t=uT(e);if(t===void 0)return null;for(let i of uy(n,t.fieldPath))switch(i.op){case"array-contains-any":return i.value.arrayValue.values||[];case"array-contains":return[i.value]}return null}function QY(n,e){let t=new Map;for(let i of Va(e))for(let r of uy(n,i.fieldPath))switch(r.op){case"==":case"in":t.set(i.fieldPath.canonicalString(),r.value);break;case"not-in":case"!=":return t.set(i.fieldPath.canonicalString(),r.value),Array.from(t.values())}return null}function XY(n,e){let t=[],i=!0;for(let r of Va(e)){let s=r.kind===0?NF(n,r.fieldPath,n.startAt):LF(n,r.fieldPath,n.startAt);t.push(s.value),i&&(i=s.inclusive)}return new Gr(t,i)}function JY(n,e){let t=[],i=!0;for(let r of Va(e)){let s=r.kind===0?LF(n,r.fieldPath,n.endAt):NF(n,r.fieldPath,n.endAt);t.push(s.value),i&&(i=s.inclusive)}return new Gr(t,i)}function NF(n,e,t){let i=o0,r=!0;for(let s of uy(n,e)){let o=o0,a=!0;switch(s.op){case"<":case"<=":o=LY(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=o0;break}JN({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];JN({value:i,inclusive:r},{value:a,inclusive:t.inclusive})<0&&(i=a,r=t.inclusive);break}}return{value:i,inclusive:r}}function LF(n,e,t){let i=Co,r=!0;for(let s of uy(n,e)){let o=Co,a=!0;switch(s.op){case">=":case">":o=FY(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Co;break}ZN({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];ZN({value:i,inclusive:r},{value:a,inclusive:t.inclusive})>0&&(i=a,r=t.inclusive);break}}return{value:i,inclusive:r}}function ZY(n){let e=new ut(Ht.comparator),t=!1;for(let i of n.filters)for(let r of i.getFlattenedFilters())r.field.isKeyField()||(r.op==="array-contains"||r.op==="array-contains-any"?t=!0:e=e.add(r.field));for(let i of n.orderBy)i.field.isKeyField()||(e=e.add(i.field));return e.size+(t?1:0)}function eQ(n){return n.limit!==null}var cr=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function FF(n,e,t,i,r,s,o,a){return new cr(n,e,t,i,r,s,o,a)}function mu(n){return new cr(n)}function tQ(n,e){return new cr(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function tL(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function nQ(n){let e=new ut(Ht.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(r=>{r.isInequality()&&(e=e.add(r.field))})}),e}function iQ(n){return new cr(Xe.emptyPath(),n)}function rQ(n){return le.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function bT(n){return n.collectionGroup!==null}function Jc(n){let e=ce(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";nQ(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Ga(s,i))}),t.has(Ht.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Ga(Ht.keyField(),i))}return e.memoizedNormalizedOrderBy}function Un(n){let e=ce(n);return e.memoizedTarget||(e.memoizedTarget=sQ(e,Jc(n))),e.memoizedTarget}function sQ(n,e){if(n.limitType==="F")return L1(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Ga(r.field,s)});let t=n.endAt?new Gr(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Gr(n.startAt.position,n.startAt.inclusive):null;return L1(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function ET(n,e){let t=n.filters.concat([e]);return new cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function oQ(n,e){let t=n.explicitOrderBy.concat([e]);return new cr(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function w0(n,e,t){return new cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function aQ(n,e){return new cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function lQ(n,e){return new cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function df(n,e){return uf(Un(n),Un(e))&&n.limitType===e.limitType}function BF(n){return`${Ha(Un(n))}|lt:${n.limitType}`}function Uc(n){return`Query(target=${KY(Un(n))}; limitType=${n.limitType})`}function hf(n,e){return e.isFoundDocument()&&cQ(n,e)&&uQ(n,e)&&dQ(n,e)&&hQ(n,e)}function cQ(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):le.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function uQ(n,e){for(let t of Jc(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function dQ(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function hQ(n,e){return!(n.startAt&&!qY(n.startAt,Jc(n),e)||n.endAt&&!UY(n.endAt,Jc(n),e))}function UF(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function qF(n){return(e,t)=>{let i=!1;for(let r of Jc(n)){let s=fQ(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function fQ(n,e,t){let i=n.field.isKeyField()?le.comparator(e.key,t.key):BY(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return fe()}}var Hr=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0){this.inner[i]=[[e,t]],this.innerSize++;return}for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e)){r[s]=[e,t];return}r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){nl(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return yF(this.inner)}size(){return this.innerSize}};var pQ=new St(le.comparator);function Jn(){return pQ}var zF=new St(le.comparator);function Th(...n){let e=zF;for(let t of n)e=e.insert(t.key,t);return e}function mQ(){return qh()}function VF(n){let e=zF;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Vr(){return qh()}function $F(){return qh()}function qh(){return new Hr(n=>n.toString(),(n,e)=>n.isEqual(e))}var gQ=new St(le.comparator);function yQ(){return gQ}var vQ=new ut(le.comparator);function Be(...n){let e=vQ;for(let t of n)e=e.add(t);return e}var _Q=new ut(Ne);function CT(){return _Q}function TT(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Fh(e)?"-0":e}}function jF(n){return{integerValue:""+n}}function GF(n,e){return EF(e)?jF(e):TT(n,e)}var Zc=class{constructor(){this._=void 0}};function wQ(n,e,t){return n instanceof Ro?mY(t,e):n instanceof fs?WF(n,e):n instanceof ps?KF(n,e):EQ(n,e)}function SQ(n,e,t){return n instanceof fs?WF(n,e):n instanceof ps?KF(n,e):t}function HF(n,e){return n instanceof Mo?NY(e)?e:{integerValue:0}:null}function bQ(n,e){return n instanceof fs&&e instanceof fs||n instanceof ps&&e instanceof ps?za(n.elements,e.elements,lr):n instanceof Mo&&e instanceof Mo?lr(n.operand,e.operand):n instanceof Ro&&e instanceof Ro}var Ro=class extends Zc{},fs=class extends Zc{constructor(e){super(),this.elements=e}};function WF(n,e){let t=YF(e);for(let i of n.elements)t.some(r=>lr(r,i))||t.push(i);return{arrayValue:{values:t}}}var ps=class extends Zc{constructor(e){super(),this.elements=e}};function KF(n,e){let t=YF(e);for(let i of n.elements)t=t.filter(r=>!lr(r,i));return{arrayValue:{values:t}}}var Mo=class extends Zc{constructor(e,t){super(),this.serializer=e,this.operand=t}};function EQ(n,e){let t=HF(n,e),i=nL(t)+nL(n.operand);return x1(t)&&x1(n.operand)?jF(i):TT(n.serializer,i)}function nL(n){return It(n.integerValue||n.doubleValue)}function YF(n){return Uh(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Wa=class{constructor(e,t){this.field=e,this.transform=t}};function CQ(n,e){return n.field.isEqual(e.field)&&bQ(n.transform,e.transform)}function TQ(n,e){return n===void 0&&e===void 0?!0:n&&e?za(n,e,(t,i)=>CQ(t,i)):!1}var F1=class{constructor(e,t){this.version=e,this.transformResults=t}},Bt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function dy(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var eu=class{};function QF(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new No(n.key,Bt.none()):new Oo(n.key,n.data,Bt.none());{let t=n.data,i=An.empty(),r=new ut(Ht.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new ur(n.key,i,new gi(r.toArray()),Bt.none())}}function xQ(n,e,t){n instanceof Oo?kQ(n,e,t):n instanceof ur?DQ(n,e,t):RQ(n,e,t)}function Dh(n,e,t,i){return n instanceof Oo?AQ(n,e,t,i):n instanceof ur?PQ(n,e,t,i):MQ(n,e,t)}function IQ(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=HF(i.transform,r||null);s!=null&&(t===null&&(t=An.empty()),t.set(i.field,s))}return t||null}function iL(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!TQ(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Oo=class extends eu{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}};function kQ(n,e,t){let i=n.value.clone(),r=JF(n.fieldTransforms,e,t.transformResults);i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function AQ(n,e,t,i){if(!dy(n.precondition,e))return t;let r=n.value.clone(),s=ZF(n.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}var ur=class extends eu{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function DQ(n,e,t){if(!dy(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let i=JF(n.fieldTransforms,e,t.transformResults),r=e.data;r.setAll(XF(n)),r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function PQ(n,e,t,i){if(!dy(n.precondition,e))return t;let r=ZF(n.fieldTransforms,i,e),s=e.data;return s.setAll(XF(n)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function XF(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function JF(n,e,t){let i=new Map;_e(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,SQ(o,a,t[r]))}return i}function ZF(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,wQ(s,o,e))}return i}var No=class extends eu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function RQ(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function MQ(n,e,t){return dy(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var zh=class extends eu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Vh=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];if(s.key.isEqual(e.key)){let o=i[r];xQ(s,e,o)}}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=Dh(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=Dh(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=$F();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let l=QF(o,a);l!==null&&i.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(Te.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Be())}isEqual(e){return this.batchId===e.batchId&&za(this.mutations,e.mutations,(t,i)=>iL(t,i))&&za(this.baseMutations,e.baseMutations,(t,i)=>iL(t,i))}},B1=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){_e(e.mutations.length===i.length);let r=yQ(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var $h=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var U1=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var yn=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(yn||{});function e3(n){switch(n){case G.OK:return fe();case G.CANCELLED:case G.UNKNOWN:case G.DEADLINE_EXCEEDED:case G.RESOURCE_EXHAUSTED:case G.INTERNAL:case G.UNAVAILABLE:case G.UNAUTHENTICATED:return!1;case G.INVALID_ARGUMENT:case G.NOT_FOUND:case G.ALREADY_EXISTS:case G.PERMISSION_DENIED:case G.FAILED_PRECONDITION:case G.ABORTED:case G.OUT_OF_RANGE:case G.UNIMPLEMENTED:case G.DATA_LOSS:return!0;default:return fe()}}function OQ(n){return e3(n)&&n!==G.ABORTED}function l0(n){if(n===void 0)return Rt("GRPC error has no .code"),G.UNKNOWN;switch(n){case yn.OK:return G.OK;case yn.CANCELLED:return G.CANCELLED;case yn.UNKNOWN:return G.UNKNOWN;case yn.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case yn.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case yn.INTERNAL:return G.INTERNAL;case yn.UNAVAILABLE:return G.UNAVAILABLE;case yn.UNAUTHENTICATED:return G.UNAUTHENTICATED;case yn.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case yn.NOT_FOUND:return G.NOT_FOUND;case yn.ALREADY_EXISTS:return G.ALREADY_EXISTS;case yn.PERMISSION_DENIED:return G.PERMISSION_DENIED;case yn.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case yn.ABORTED:return G.ABORTED;case yn.OUT_OF_RANGE:return G.OUT_OF_RANGE;case yn.UNIMPLEMENTED:return G.UNIMPLEMENTED;case yn.DATA_LOSS:return G.DATA_LOSS;default:return fe()}}var q1=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var JE=null;function t3(){return new fK}function NQ(){return new pK("utf-8")}var LQ=new Gs([4294967295,4294967295],0);function rL(n){let e=t3().encode(n),t=new Mw;return t.update(e),new Uint8Array(t.digest())}function sL(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Gs([t,i],0),a=new Gs([r,s],0);return[o,a]}var z1=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Ba(`Invalid padding: ${t}`);if(i<0)throw new Ba(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Ba(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Ba(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Gs.fromNumber(this.bitCount)}getBitIndex(e,t,i){let r=e.add(t.multiply(Gs.fromNumber(i)));return r.compare(LQ)===1&&(r=new Gs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],i=e%8;return(t&1<<i)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=rL(e),[i,r]=sL(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(i,r,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,i){let r=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=rL(e),[i,r]=sL(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(i,r,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},Ba=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var jh=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,Gh.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(Te.min(),r,new St(Ne),Jn(),Be())}},Gh=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,Be(),Be(),Be())}};var Hc=class{constructor(e,t,i,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=i,this.newDoc=r}},S0=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},b0=class{constructor(e,t,i=Wt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},E0=class{constructor(){this.pendingResponses=0,this.documentChanges=aL(),this._resumeToken=Wt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Be(),t=Be(),i=Be();return this.documentChanges.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:fe()}}),new Gh(this._resumeToken,this._current,e,t,i)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=aL()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,_e(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},FQ="WatchChangeAggregator",V1=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Jn(),this.pendingDocumentTargetMapping=oL(),this.pendingTargetResets=new St(Ne)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let i=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&i.updateResumeToken(e.resumeToken);break;case 1:i.recordTargetResponse(),i.isPending||i.clearPendingChanges(),i.updateResumeToken(e.resumeToken);break;case 2:i.recordTargetResponse(),i.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(i.markCurrent(),i.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),i.updateResumeToken(e.resumeToken));break;default:fe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((i,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,i=e.existenceFilter.count,r=this.targetDataForActiveTarget(t);if(r){let s=r.target;if(_0(s))if(i===0){let o=new le(s.path);this.removeDocumentFromTarget(t,o,Jt.newNoDocument(o,Te.min()))}else _e(i===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==i){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}JE?.notifyOnExistenceFilterMismatch(BQ(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o;try{o=Ao(i).toUint8Array()}catch(l){if(l instanceof q1)return $i("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new z1(o,r,s)}catch(l){return l instanceof Ba?$i("BloomFilter error: ",l):$i("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,i){let r=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return r===i-s?0:2}filterRemovedDocuments(e,t){let i=this.metadataProvider.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),r++)}),r}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&_0(a.target)){let l=new le(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Jt.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let i=Be();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(i=i.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let r=new jh(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,i);return this.pendingDocumentUpdates=Jn(),this.pendingDocumentTargetMapping=oL(),this.pendingTargetResets=new St(Ne),r}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let i=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,i),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,i){if(!this.isActiveTarget(e))return;let r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),i&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,i))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let i=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new E0,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new ut(Ne),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||Z(FQ,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new E0),this.metadataProvider.getRemoteKeysForTarget(e).forEach(i=>{this.removeDocumentFromTarget(e,i,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function oL(){return new St(le.comparator)}function aL(){return new St(le.comparator)}function BQ(n,e,t,i,r){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},h=e.unchangedNames;return h&&(d.bloomFilter={applied:r===0,hashCount:(s=h?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=h?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=h?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:f=>{var g;return(g=i?.mightContain(f))!==null&&g!==void 0?g:!1}}),d}var UQ=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),qQ=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),zQ=(()=>{let n={};return n.and="AND",n.or="OR",n})();var $1=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function VQ(n){let e=n.code===void 0?G.UNKNOWN:l0(n.code);return new Y(e,n.message||"")}function j1(n,e){return n.useProto3Json||cf(e)?e:{value:e}}function $Q(n){let e;return typeof n=="object"?e=n.value:e=n,cf(e)?null:e}function tu(n,e){if(n.useProto3Json){let i=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+e.nanoseconds).slice(-9);return`${i}.${r}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function jQ(n){let e=hs(n);return new Mt(e.seconds,e.nanos)}function n3(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function GQ(n,e){return n.useProto3Json?(_e(e===void 0||typeof e=="string"),Wt.fromBase64String(e||"")):(_e(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Wt.fromUint8Array(e||new Uint8Array))}function HQ(n,e){return tu(n,e.toTimestamp())}function Gt(n){return _e(!!n),Te.fromTimestamp(jQ(n))}function xT(n,e){return G1(n,e).canonicalString()}function G1(n,e){let t=WQ(n).child("documents");return e===void 0?t:t.child(e)}function i3(n){let e=Xe.fromString(n);return _e(f3(e)),e}function Hh(n,e){return xT(n.databaseId,e.path)}function $r(n,e){let t=i3(e);if(t.get(1)!==n.databaseId.projectId)throw new Y(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Y(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new le(o3(t))}function r3(n,e){return xT(n.databaseId,e)}function s3(n){let e=i3(n);return e.length===4?Xe.emptyPath():o3(e)}function H1(n){return new Xe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function WQ(n){return new Xe(["projects",n.projectId,"databases",n.database])}function o3(n){return _e(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function lL(n,e,t){return{name:Hh(n,e),fields:t.value.mapValue.fields}}function KQ(n,e){return{name:Hh(n,e.key),fields:e.data.value.mapValue.fields,updateTime:tu(n,e.version.toTimestamp()),createTime:tu(n,e.createTime.toTimestamp())}}function a3(n,e,t){let i=$r(n,e.name),r=Gt(e.updateTime),s=e.createTime?Gt(e.createTime):Te.min(),o=new An({mapValue:{fields:e.fields}}),a=Jt.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function YQ(n,e){_e(!!e.found),e.found.name,e.found.updateTime;let t=$r(n,e.found.name),i=Gt(e.found.updateTime),r=e.found.createTime?Gt(e.found.createTime):Te.min(),s=new An({mapValue:{fields:e.found.fields}});return Jt.newFoundDocument(t,i,r,s)}function QQ(n,e){_e(!!e.missing),_e(!!e.readTime);let t=$r(n,e.missing),i=Gt(e.readTime);return Jt.newNoDocument(t,i)}function XQ(n,e){return"found"in e?YQ(n,e):"missing"in e?QQ(n,e):fe()}function JQ(n,e){let t;if("targetChange"in e){e.targetChange;let i=ZQ(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=GQ(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&VQ(o);t=new b0(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=$r(n,i.document.name),s=Gt(i.document.updateTime),o=i.document.createTime?Gt(i.document.createTime):Te.min(),a=new An({mapValue:{fields:i.document.fields}}),l=Jt.newFoundDocument(r,s,o,a),c=i.targetIds||[],u=i.removedTargetIds||[];t=new Hc(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=$r(n,i.document),s=i.readTime?Gt(i.readTime):Te.min(),o=Jt.newNoDocument(r,s),a=i.removedTargetIds||[];t=new Hc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=$r(n,i.document),s=i.removedTargetIds||[];t=new Hc([],s,r,null)}else if("filter"in e){e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new U1(r,s),a=i.targetId;t=new S0(a,o)}else return fe();return t}function ZQ(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:fe()}function eX(n){if(!("targetChange"in n))return Te.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Te.min():Gt(e.readTime)}function Wh(n,e){let t;if(e instanceof Oo)t={update:lL(n,e.key,e.value)};else if(e instanceof No)t={delete:Hh(n,e.key)};else if(e instanceof ur)t={update:lL(n,e.key,e.data),updateMask:MX(e.fieldMask)};else if(e instanceof zh)t={verify:Hh(n,e.key)};else return fe();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>sX(n,i))),e.precondition.isNone||(t.currentDocument=tX(n,e.precondition)),t}function W1(n,e){let t=e.currentDocument?nX(e.currentDocument):Bt.none(),i=e.updateTransforms?e.updateTransforms.map(r=>oX(n,r)):[];if(e.update){e.update.name;let r=$r(n,e.update.name),s=new An({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=OX(e.updateMask);return new ur(r,s,o,t,i)}else return new Oo(r,s,t,i)}else if(e.delete){let r=$r(n,e.delete);return new No(r,t)}else if(e.verify){let r=$r(n,e.verify);return new zh(r,t)}else return fe()}function tX(n,e){return e.updateTime!==void 0?{updateTime:HQ(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:fe()}function nX(n){return n.updateTime!==void 0?Bt.updateTime(Gt(n.updateTime)):n.exists!==void 0?Bt.exists(n.exists):Bt.none()}function iX(n,e){let t=n.updateTime?Gt(n.updateTime):Gt(e);return t.isEqual(Te.min())&&(t=Gt(e)),new F1(t,n.transformResults||[])}function rX(n,e){return n&&n.length>0?(_e(e!==void 0),n.map(t=>iX(t,e))):[]}function sX(n,e){let t=e.transform;if(t instanceof Ro)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof fs)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof ps)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Mo)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw fe()}function oX(n,e){let t=null;if("setToServerValue"in e)_e(e.setToServerValue==="REQUEST_TIME"),t=new Ro;else if("appendMissingElements"in e){let r=e.appendMissingElements.values||[];t=new fs(r)}else if("removeAllFromArray"in e){let r=e.removeAllFromArray.values||[];t=new ps(r)}else"increment"in e?t=new Mo(n,e.increment):fe();let i=Ht.fromServerFormat(e.fieldPath);return new Wa(i,t)}function l3(n,e){return{documents:[r3(n,e.path)]}}function aX(n){let e=n.documents.length;_e(e===1);let t=n.documents[0];return Un(mu(s3(t)))}function c3(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=r3(n,r);let s=hX(e.filters);s&&(t.structuredQuery.where=s);let o=pX(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=j1(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=gX(e.startAt)),e.endAt&&(t.structuredQuery.endAt=yX(e.endAt)),{queryTarget:t,parent:r}}function u3(n){let e=s3(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){_e(i===1);let u=t.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=fX(t.where));let o=[];t.orderBy&&(o=mX(t.orderBy));let a=null;t.limit&&(a=$Q(t.limit));let l=null;t.startAt&&(l=vX(t.startAt));let c=null;return t.endAt&&(c=_X(t.endAt)),FF(e,r,o,s,a,"F",l,c)}function lX(n){return Un(u3(n))}function cX(n,e){let t=uX(e.purpose);return t==null?null:{"goog-listen-tags":t}}function uX(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fe()}}function dX(n,e){let t,i=e.target;if(_0(i)?t={documents:l3(n,i)}:t={query:c3(n,i).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=n3(n,e.resumeToken);let r=j1(n,e.expectedCount);r!==null&&(t.expectedCount=r)}else if(e.snapshotVersion.compareTo(Te.min())>0){t.readTime=tu(n,e.snapshotVersion.toTimestamp());let r=j1(n,e.expectedCount);r!==null&&(t.expectedCount=r)}return t}function hX(n){if(n.length!==0)return h3(st.create(n,"and"))}function fX(n){let e=d3(n);return e instanceof st&&ST(e)?e.getFilters():[e]}function d3(n){return n.unaryFilter!==void 0?DX(n):n.fieldFilter!==void 0?PX(n):n.compositeFilter!==void 0?RX(n):fe()}function pX(n){if(n.length!==0)return n.map(e=>xX(e))}function mX(n){return n.map(e=>IX(e))}function gX(n){return{before:n.inclusive,values:n.position}}function yX(n){return{before:!n.inclusive,values:n.position}}function vX(n){let e=!!n.before,t=n.values||[];return new Gr(t,e)}function _X(n){let e=!n.before,t=n.values||[];return new Gr(t,e)}function wX(n){return UQ[n]}function SX(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function bX(n){return qQ[n]}function EX(n){return zQ[n]}function CX(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fe();default:return fe()}}function TX(n){switch(n){case"AND":return"and";case"OR":return"or";default:return fe()}}function qc(n){return{fieldPath:n.canonicalString()}}function $c(n){return Ht.fromServerFormat(n.fieldPath)}function xX(n){return{field:qc(n.field),direction:wX(n.dir)}}function IX(n){return new Ga($c(n.field),SX(n.direction))}function h3(n){return n instanceof Ke?AX(n):n instanceof st?kX(n):fe()}function kX(n){let e=n.getFilters().map(t=>h3(t));return e.length===1?e[0]:{compositeFilter:{op:EX(n.op),filters:e}}}function AX(n){if(n.op==="=="){if(XN(n.value))return{unaryFilter:{field:qc(n.field),op:"IS_NAN"}};if(QN(n.value))return{unaryFilter:{field:qc(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(XN(n.value))return{unaryFilter:{field:qc(n.field),op:"IS_NOT_NAN"}};if(QN(n.value))return{unaryFilter:{field:qc(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qc(n.field),op:bX(n.op),value:n.value}}}function DX(n){switch(n.unaryFilter.op){case"IS_NAN":let e=$c(n.unaryFilter.field);return Ke.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=$c(n.unaryFilter.field);return Ke.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=$c(n.unaryFilter.field);return Ke.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=$c(n.unaryFilter.field);return Ke.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fe();default:return fe()}}function PX(n){return Ke.create($c(n.fieldFilter.field),CX(n.fieldFilter.op),n.fieldFilter.value)}function RX(n){return st.create(n.compositeFilter.filters.map(e=>d3(e)),TX(n.compositeFilter.op))}function MX(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function OX(n){let e=n.fieldPaths||[];return new gi(e.map(t=>Ht.fromServerFormat(t)))}function f3(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var nu=class n{constructor(e,t,i,r,s=Te.min(),o=Te.min(),a=Wt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var C0=class{constructor(e){this.remoteSerializer=e}};function NX(n,e){let t;if(e.document)t=a3(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let i=le.fromSegments(e.noDocument.path),r=Ya(e.noDocument.readTime);t=Jt.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let i=le.fromSegments(e.unknownDocument.path),r=Ya(e.unknownDocument.version);t=Jt.newUnknownDocument(i,r)}else return fe();return e.readTime&&t.setReadTime(LX(e.readTime)),t}function cL(n,e){let t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:hy(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=KQ(n.remoteSerializer,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Ka(e.version)};else if(e.isUnknownDocument())i.unknownDocument={path:t.path.toArray(),version:Ka(e.version)};else return fe();return i}function hy(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function LX(n){let e=new Mt(n[0],n[1]);return Te.fromTimestamp(e)}function Ka(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ya(n){let e=new Mt(n.seconds,n.nanoseconds);return Te.fromTimestamp(e)}function FX(n,e,t){let i=t.baseMutations.map(s=>Wh(n.remoteSerializer,s)),r=t.mutations.map(s=>Wh(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:i,mutations:r}}function Oa(n,e){let t=(e.baseMutations||[]).map(s=>W1(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let i=e.mutations.map(s=>W1(n.remoteSerializer,s)),r=Mt.fromMillis(e.localWriteTimeMs);return new Vh(e.batchId,r,t,i)}function xh(n){let e=Ya(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ya(n.lastLimboFreeSnapshotVersion):Te.min(),i;return BX(n.query)?i=aX(n.query):i=lX(n.query),new nu(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Wt.fromBase64String(n.resumeToken))}function p3(n,e){let t=Ka(e.snapshotVersion),i=Ka(e.lastLimboFreeSnapshotVersion),r;_0(e.target)?r=l3(n.remoteSerializer,e.target):r=c3(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ha(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function BX(n){return n.documents!==void 0}function UX(n){return{id:n.bundleId,createTime:Ya(n.createTime),version:n.version}}function qX(n){return{bundleId:n.id,createTime:Ka(Gt(n.createTime)),version:n.version}}function zX(n){return{name:n.name,query:IT(n.bundledQuery),readTime:Ya(n.readTime)}}function VX(n){return{name:n.name,readTime:Ka(Gt(n.readTime)),bundledQuery:n.bundledQuery}}function IT(n){let e=u3({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?w0(e,e.limit,"L"):e}function $X(n){return{name:n.name,query:IT(n.bundledQuery),readTime:Gt(n.readTime)}}function jX(n){return{id:n.id,version:n.version,createTime:Gt(n.createTime)}}function ZE(n,e){return new $h(e.largestBatchId,W1(n.remoteSerializer,e.overlayMutation))}function GX(n,e,t){let[i,r,s]=m3(e,t.mutation.key);return{userId:e,collectionPath:r,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:Wh(n.remoteSerializer,t.mutation)}}function m3(n,e){let t=e.path.lastSegment(),i=Bn(e.path.popLast());return[n,i,t]}function HX(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function WX(n,e){let t=e?new Mh(e.sequenceNumber,new ji(Ya(e.readTime),new le(zr(e.documentKey)),e.largestBatchId)):Mh.empty(),i=n.fields.map(([r,s])=>new jc(Ht.fromServerFormat(r),s));return new m1(n.indexId,n.collectionGroup,i,t)}function uL(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ka(i.readTime),documentKey:Bn(i.documentKey.path),largestBatchId:i.largestBatchId}}var K1=class{getBundleMetadata(e,t){return dL(e).get(t).next(i=>{if(i)return UX(i)})}saveBundleMetadata(e,t){return dL(e).put(qX(t))}getNamedQuery(e,t){return hL(e).get(t).next(i=>{if(i)return zX(i)})}saveNamedQuery(e,t){return hL(e).put(VX(t))}};function dL(n){return sn(n,iy)}function hL(n){return sn(n,ry)}var T0=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let i=t.uid||"";return new n(e,i)}getOverlay(e,t){return Sh(e).get(m3(this.userId,t)).next(i=>i?ZE(this.serializer,i):null)}getOverlays(e,t){let i=Vr();return $.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){let r=[];return i.forEach((s,o)=>{let a=new $h(t,o);r.push(this.saveOverlay(e,a))}),$.waitFor(r)}removeOverlaysForBatchId(e,t,i){let r=new Set;t.forEach(o=>r.add(Bn(o.getCollectionPath())));let s=[];return r.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(Sh(e).deleteAll(E1,a))}),$.waitFor(s)}getOverlaysForCollection(e,t,i){let r=Vr(),s=Bn(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Sh(e).loadAll(E1,o).next(a=>{for(let l of a){let c=ZE(this.serializer,l);r.set(c.getKey(),c)}return r})}getOverlaysForCollectionGroup(e,t,i,r){let s=Vr(),o,a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Sh(e).iterate({index:fF,range:a},(l,c,u)=>{let d=ZE(this.serializer,c);s.size()<r||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Sh(e).put(GX(this.serializer,this.userId,t))}};function Sh(n){return sn(n,ay)}var Y1=class{globalsStore(e){return sn(e,mT)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(i=>{let r=i?.value;return r?Wt.fromUint8Array(r):Wt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var KX=5,YX=10,QX=13,e1=15,XX=20,JX=25,ZX=30,eJ=37,tJ=45,nJ=50,iJ=53,rJ=55,sJ=60,oJ=2,ds=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,KX);else if("booleanValue"in e)this.writeValueTypeLabel(t,YX),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,e1),t.writeNumber(It(e.integerValue));else if("doubleValue"in e){let i=It(e.doubleValue);isNaN(i)?this.writeValueTypeLabel(t,QX):(this.writeValueTypeLabel(t,e1),Fh(i)?t.writeNumber(0):t.writeNumber(i))}else if("timestampValue"in e){let i=e.timestampValue;this.writeValueTypeLabel(t,XX),typeof i=="string"&&(i=hs(i)),t.writeString(`${i.seconds||""}`),t.writeNumber(i.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,ZX),t.writeBytes(Ao(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.writeValueTypeLabel(t,tJ),t.writeNumber(i.latitude||0),t.writeNumber(i.longitude||0)}else"mapValue"in e?xF(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):cy(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):fe()}writeIndexString(e,t){this.writeValueTypeLabel(t,JX),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let i=e.fields||{};this.writeValueTypeLabel(t,rJ);for(let r of Object.keys(i))this.writeIndexString(r,t),this.writeIndexValueAux(i[r],t)}writeIndexVector(e,t){var i,r;let s=e.fields||{};this.writeValueTypeLabel(t,iJ);let o=Yc,a=((r=(i=s[o].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.writeValueTypeLabel(t,e1),t.writeNumber(It(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let i=e.values||[];this.writeValueTypeLabel(t,nJ);for(let r of i)this.writeIndexValueAux(r,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,eJ),le.fromName(e).path.forEach(r=>{this.writeValueTypeLabel(t,sJ),this.writeUnlabeledIndexString(r,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(oJ)}};ds.INSTANCE=new ds;var fL="\uD800",pL="\uDBFF",Mc=0,mL=255,gL=1,Oc=255,yL=255,vL=0,aJ=64,lJ=8,cJ=1024;function uJ(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function dJ(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function hJ(n){let e=0;for(let t=0;t<8;++t){let i=dJ(n[t]&255);if(e+=i,i!==8)break}return e}function _L(n){let e=aJ-hJ(n);return Math.ceil(e/lJ)}var Q1=class{constructor(){this.buffer=new Uint8Array(cJ),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.writeByteAscending(i.value),i=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.writeByteDescending(i.value),i=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.writeByteAscending(i);else if(i<2048)this.writeByteAscending(960|i>>>6),this.writeByteAscending(128|63&i);else if(t<fL||pL<t)this.writeByteAscending(480|i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i);else{let r=t.codePointAt(0);this.writeByteAscending(240|r>>>18),this.writeByteAscending(128|63&r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.writeByteDescending(i);else if(i<2048)this.writeByteDescending(960|i>>>6),this.writeByteDescending(128|63&i);else if(t<fL||pL<t)this.writeByteDescending(480|i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i);else{let r=t.codePointAt(0);this.writeByteDescending(240|r>>>18),this.writeByteDescending(128|63&r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),i=_L(t);this.ensureAvailable(1+i),this.buffer[this.position++]=i&255;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=t[r]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),i=_L(t);this.ensureAvailable(1+i),this.buffer[this.position++]=~(i&255);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(t[r]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Oc),this.writeEscapedByteAscending(yL)}writeInfinityDescending(){this.writeEscapedByteDescending(Oc),this.writeEscapedByteDescending(yL)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=uJ(e),i=(t[0]&128)!==0;t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}writeByteAscending(e){let t=e&255;t===Mc?(this.writeEscapedByteAscending(Mc),this.writeEscapedByteAscending(mL)):t===Oc?(this.writeEscapedByteAscending(Oc),this.writeEscapedByteAscending(vL)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Mc?(this.writeEscapedByteDescending(Mc),this.writeEscapedByteDescending(mL)):t===Oc?(this.writeEscapedByteDescending(Oc),this.writeEscapedByteDescending(vL)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Mc),this.writeEscapedByteAscending(gL)}writeSeparatorDescending(){this.writeEscapedByteDescending(Mc),this.writeEscapedByteDescending(gL)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let i=this.buffer.length*2;i<t&&(i=t);let r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}},X1=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},J1=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},Na=class{constructor(){this.orderedCode=new Q1,this.ascending=new X1(this.orderedCode),this.descending=new J1(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var La=class n{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new n(this.indexId,this.documentKey,this.arrayValue,i)}};function wo(n,e){let t=n.indexId-e.indexId;return t!==0||(t=wL(n.arrayValue,e.arrayValue),t!==0)||(t=wL(n.directionalValue,e.directionalValue),t!==0)?t:le.comparator(n.documentKey,e.documentKey)}function wL(n,e){for(let t=0;t<n.length&&t<e.length;++t){let i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}var x0=class{constructor(e){this.inequalityFilters=new ut((t,i)=>Ht.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let i=t;i.isInequality()?this.inequalityFilters=this.inequalityFilters.add(i):this.equalityFilters.push(i)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(_e(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=uT(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let i=Va(e),r=new Set,s=0,o=0;for(;s<i.length&&this.hasMatchingEqualityFilter(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!r.has(a.field.canonicalString())){let l=i[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<i.length;++s){let a=i[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new ut(Ht.comparator),t=[];for(let i of this.equalityFilters){if(i.field.isKeyField())continue;if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new jc(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new jc(i.field,0))}}for(let i of this.orderBys)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new jc(i.field,i.dir==="asc"?0:1)));return new m1(m1.UNKNOWN_ID,this.collectionId,t,Mh.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function g3(n){var e,t;if(_e(n instanceof Ke||n instanceof st),n instanceof Ke)if(n instanceof v0){let r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Ke.create(n.field,"==",s)))||[];return st.create(r,"or")}else return n;let i=n.filters.map(r=>g3(r));return st.create(i,n.op)}function fJ(n){if(n.getFilters().length===0)return[];let e=Z1(g3(n));return _e(y3(e)),kT(e)||AT(e)?[e]:e.getFilters()}function kT(n){return n instanceof Ke}function AT(n){return n instanceof st&&ST(n)}function y3(n){return kT(n)||AT(n)||pJ(n)}function pJ(n){if(n instanceof st&&I1(n)){for(let e of n.getFilters())if(!kT(e)&&!AT(e))return!1;return!0}return!1}function Z1(n){if(_e(n instanceof Ke||n instanceof st),n instanceof Ke)return n;if(n.filters.length===1)return Z1(n.filters[0]);let e=n.filters.map(i=>Z1(i)),t=st.create(e,n.op);return t=I0(t),y3(t)?t:(_e(t instanceof st),_e(Xc(t)),_e(t.filters.length>1),t.filters.reduce((i,r)=>DT(i,r)))}function DT(n,e){_e(n instanceof Ke||n instanceof st),_e(e instanceof Ke||e instanceof st);let t;return n instanceof Ke?e instanceof Ke?t=mJ(n,e):t=SL(n,e):e instanceof Ke?t=SL(e,n):t=gJ(n,e),I0(t)}function mJ(n,e){return st.create([n,e],"and")}function gJ(n,e){if(_e(n.filters.length>0&&e.filters.length>0),Xc(n)&&Xc(e))return RF(n,e.getFilters());let t=I1(n)?n:e,i=I1(n)?e:n,r=t.filters.map(s=>DT(s,i));return st.create(r,"or")}function SL(n,e){if(Xc(e))return RF(e,n.getFilters());{let t=e.filters.map(i=>DT(n,i));return st.create(t,"or")}}function I0(n){if(_e(n instanceof Ke||n instanceof st),n instanceof Ke)return n;let e=n.getFilters();if(e.length===1)return I0(e[0]);if(DF(n))return n;let t=e.map(r=>I0(r)),i=[];return t.forEach(r=>{r instanceof Ke?i.push(r):r instanceof st&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:st.create(i,n.op)}var eC=class{constructor(){this.collectionParentIndex=new Kh}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),$.resolve()}getCollectionParents(e,t){return $.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return $.resolve()}deleteFieldIndex(e,t){return $.resolve()}deleteAllFieldIndexes(e){return $.resolve()}createTargetIndexes(e,t){return $.resolve()}getDocumentsMatchingTarget(e,t){return $.resolve(null)}getIndexType(e,t){return $.resolve(0)}getFieldIndexes(e,t){return $.resolve([])}getNextCollectionGroupToUpdate(e){return $.resolve(null)}getMinOffset(e,t){return $.resolve(ji.min())}getMinOffsetFromCollectionGroup(e,t){return $.resolve(ji.min())}updateCollectionGroup(e,t,i){return $.resolve()}updateIndexEntries(e,t){return $.resolve()}},Kh=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new ut(Xe.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new ut(Xe.comparator)).toArray()}};var bL="IndexedDbIndexManager",e0=new Uint8Array(0),tC=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Kh,this.targetToDnfSubTargets=new Hr(i=>Ha(i),(i,r)=>uf(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:i,parent:Bn(r)};return EL(e).put(s)}return $.resolve()}getCollectionParents(e,t){let i=[],r=IDBKeyRange.bound([t,""],[ZL(t),""],!1,!0);return EL(e).loadAll(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;i.push(zr(o.parent))}return i})}addFieldIndex(e,t){let i=bh(e),r=HX(t);delete r.indexId;let s=i.add(r);if(t.indexState){let o=Lc(e);return s.next(a=>{o.put(uL(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let i=bh(e),r=Lc(e),s=Nc(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=bh(e),i=Nc(e),r=Lc(e);return t.deleteAll().next(()=>i.deleteAll()).next(()=>r.deleteAll())}createTargetIndexes(e,t){return $.forEach(this.getSubTargets(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){let o=new x0(i).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let i=Nc(e),r=!0,s=new Map;return $.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=Be(),a=[];return $.forEach(s,(l,c)=>{Z(bL,`Using index ${CK(l)} to execute ${Ha(t)}`);let u=YY(c,l),d=QY(c,l),h=XY(c,l),f=JY(c,l),g=this.encodeBound(l,c,h),_=this.encodeBound(l,c,f),S=this.encodeValues(l,c,d),I=this.generateIndexRanges(l.indexId,u,g,h.inclusive,_,f.inclusive,S);return $.forEach(I,E=>i.loadFirst(E,t.limit).next(b=>{b.forEach(M=>{let N=le.fromSegments(M.documentKey);o.has(N)||(o=o.add(N),a.push(N))})}))}).next(()=>a)}else return $.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=fJ(st.create(e.filters,"and")).map(r=>L1(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,i,r,s,o,a){let l=(t!=null?t.length:1)*Math.max(i.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let h=t?this.encodeSingleElement(t[d/c]):e0,f=this.generateLowerBound(e,h,i[d%c],r),g=this.generateUpperBound(e,h,s[d%c],o),_=a.map(S=>this.generateLowerBound(e,h,S,!0));u.push(...this.createRange(f,g,_))}return u}generateLowerBound(e,t,i,r){let s=new La(e,le.empty(),t,i);return r?s:s.successor()}generateUpperBound(e,t,i,r){let s=new La(e,le.empty(),t,i);return r?s.successor():s}getFieldIndex(e,t){let i=new x0(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let a of s)i.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2,r=this.getSubTargets(t);return $.forEach(r,s=>this.getFieldIndex(e,s).next(o=>{o?i!==0&&o.fields.length<ZY(s)&&(i=1):i=0})).next(()=>eQ(t)&&r.length>1&&i===2?1:i)}encodeDirectionalElements(e,t){let i=new Na;for(let r of Va(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=i.forKind(r.kind);ds.INSTANCE.writeIndexValue(s,o)}return i.encodedBytes()}encodeSingleElement(e){let t=new Na;return ds.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let i=new Na;return ds.INSTANCE.writeIndexValue(ja(this.databaseId,t),i.forKind(EK(e))),i.encodedBytes()}encodeValues(e,t,i){if(i===null)return[];let r=[];r.push(new Na);let s=0;for(let o of Va(e)){let a=i[s++];for(let l of r)if(this.isInFilter(t,o.fieldPath)&&Uh(a))r=this.expandIndexValues(r,o,a);else{let c=l.forKind(o.kind);ds.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(r)}encodeBound(e,t,i){return this.encodeValues(e,t,i.position)}getEncodedBytes(e){let t=[];for(let i=0;i<e.length;++i)t[i]=e[i].encodedBytes();return t}expandIndexValues(e,t,i){let r=[...e],s=[];for(let o of i.arrayValue.values||[])for(let a of r){let l=new Na;l.seed(a.encodedBytes()),ds.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(i=>i instanceof Ke&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){let i=bh(e),r=Lc(e);return(t?i.loadAll(b1,IDBKeyRange.bound(t,t)):i.loadAll()).next(s=>{let o=[];return $.forEach(s,a=>r.get([a.indexId,this.uid]).next(l=>{o.push(WX(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{let s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:Ne(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){let r=bh(e),s=Lc(e);return this.getNextSequenceNumber(e).next(o=>r.loadAll(b1,IDBKeyRange.bound(t,t)).next(a=>$.forEach(a,l=>s.put(uL(l.indexId,this.uid,o,i)))))}updateIndexEntries(e,t){let i=new Map;return $.forEach(t,(r,s)=>{let o=i.get(r.collectionGroup);return(o?$.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(l=>(i.set(r.collectionGroup,l),$.forEach(l,c=>this.getExistingIndexEntries(e,r,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?$.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,i,r){return Nc(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(i,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,i,r){return Nc(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.encodeDirectionalKey(i,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,i){let r=Nc(e),s=new ut(wo);return r.iterate({index:hF,range:IDBKeyRange.only([i.indexId,this.uid,this.encodeDirectionalKey(i,t)])},(o,a)=>{s=s.add(new La(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let i=new ut(wo),r=this.encodeDirectionalElements(t,e);if(r==null)return i;let s=uT(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Uh(o))for(let a of o.arrayValue.values||[])i=i.add(new La(t.indexId,e.key,this.encodeSingleElement(a),r))}else i=i.add(new La(t.indexId,e.key,e0,r));return i}updateEntries(e,t,i,r,s){Z(bL,"Updating index entries for document '%s'",t.key);let o=[];return cY(r,s,wo,a=>{o.push(this.addIndexEntry(e,t,i,a))},a=>{o.push(this.deleteIndexEntry(e,t,i,a))}),$.waitFor(o)}getNextSequenceNumber(e){let t=1;return Lc(e).iterate({index:dF,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>wo(o,a)).filter((o,a,l)=>!a||wo(o,l[a-1])!==0);let r=[];r.push(e);for(let o of i){let a=wo(o,e),l=wo(o,t);if(a===0)r[0]=e.successor();else if(a>0&&l<0)r.push(o),r.push(o.successor());else if(l>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.isRangeMatchable(r[o],r[o+1]))return[];let a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,e0,[]],l=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,e0,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return wo(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(CL)}getMinOffset(e,t){return $.mapArray(this.getSubTargets(t),i=>this.getFieldIndex(e,i).next(r=>r||fe())).next(CL)}};function EL(n){return sn(n,Oh)}function Nc(n){return sn(n,oy)}function bh(n){return sn(n,pT)}function Lc(n){return sn(n,sy)}function CL(n){_e(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){let r=n[i].indexState.offset;dT(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new ji(e.readTime,e.documentKey,t)}function v3(n,e,t){let i=n.store(ar),r=n.store(hu),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=i.iterate({range:o},(u,d,h)=>(a++,h.delete()));s.push(l.next(()=>{_e(a===1)}));let c=[];for(let u of t.mutations){let d=lF(e,u.key.path,t.batchId);s.push(r.delete(d)),c.push(u.key)}return $.waitFor(s).next(()=>c)}function k0(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw fe();return JSON.stringify(e).length}var A0=class n{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.documentKeysByBatchId={}}static forUser(e,t,i,r){_e(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,i,r)}checkEmpty(e){let t=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return So(e).iterate({index:Fa,range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){let s=zc(e),o=So(e);return o.add({}).next(a=>{_e(typeof a=="number");let l=new Vh(a,t,i,r),c=FX(this.serializer,this.userId,l),u=[],d=new ut((h,f)=>Ne(h.canonicalString(),f.canonicalString()));for(let h of r){let f=lF(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),u.push(o.put(c)),u.push(s.put(f,RK))}return d.forEach(h=>{u.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),$.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return So(e).get(t).next(i=>i?(_e(i.userId===this.userId),Oa(this.serializer,i)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?$.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){let r=i.keys();return this.documentKeysByBatchId[t]=r,r}else return null})}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]),s=null;return So(e).iterate({index:Fa,range:r},(o,a,l)=>{a.userId===this.userId&&(_e(a.batchId>=i),s=Oa(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=xo;return So(e).iterate({index:Fa,range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,xo],[this.userId,Number.POSITIVE_INFINITY]);return So(e).loadAll(Fa,t).next(i=>i.map(r=>Oa(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let i=r0(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return zc(e).iterate({range:r},(o,a,l)=>{let[c,u,d]=o,h=zr(u);if(c!==this.userId||!t.path.isEqual(h)){l.done();return}return So(e).get(d).next(f=>{if(!f)throw fe();_e(f.userId===this.userId),s.push(Oa(this.serializer,f))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ut(Ne),r=[];return t.forEach(s=>{let o=r0(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=zc(e).iterate({range:a},(c,u,d)=>{let[h,f,g]=c,_=zr(f);if(h!==this.userId||!s.path.isEqual(_)){d.done();return}i=i.add(g)});r.push(l)}),$.waitFor(r).next(()=>this.lookupMutationBatches(e,i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=r0(this.userId,i),o=IDBKeyRange.lowerBound(s),a=new ut(Ne);return zc(e).iterate({range:o},(l,c,u)=>{let[d,h,f]=l,g=zr(h);if(d!==this.userId||!i.isPrefixOf(g)){u.done();return}g.length===r&&(a=a.add(f))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let i=[],r=[];return t.forEach(s=>{r.push(So(e).get(s).next(o=>{if(o===null)throw fe();_e(o.userId===this.userId),i.push(Oa(this.serializer,o))}))}),$.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return v3(e.simpleDbTransaction,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),$.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return $.resolve();let i=IDBKeyRange.lowerBound(PK(this.userId)),r=[];return zc(e).iterate({range:i},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=zr(s[1]);r.push(c)}}).next(()=>{_e(r.length===0)})})}containsKey(e,t){return _3(e,this.userId,t)}getMutationQueueMetadata(e){return w3(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:xo,lastStreamToken:""})}};function _3(n,e,t){let i=r0(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return zc(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,h]=a;u===e&&d===r&&(o=!0),c.done()}).next(()=>o)}function yJ(n,e){let t=!1;return w3(n).iterateSerial(i=>_3(n,i,e).next(r=>(r&&(t=!0),$.resolve(!r)))).next(()=>t)}function So(n){return sn(n,ar)}function zc(n){return sn(n,hu)}function w3(n){return sn(n,af)}var t1=2,iu=class n{constructor(e){this.lastId=e}next(){return this.lastId+=t1,this.lastId}static forTargetCache(){return new n(2-t1)}static forSyncEngine(){return new n(1-t1)}};var nC=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let i=new iu(t.highestTargetId);return t.highestTargetId=i.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>Te.fromTimestamp(new Mt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.retrieveMetadata(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.saveMetadata(e,r)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(i=>(i.targetCount+=1,this.updateMetadataFromTargetData(t,i),this.saveMetadata(e,i))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Fc(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(i=>(_e(i.targetCount>0),i.targetCount-=1,this.saveMetadata(e,i)))}removeTargets(e,t,i){let r=0,s=[];return Fc(e).iterate((o,a)=>{let l=xh(a);l.sequenceNumber<=t&&i.get(l.targetId)===null&&(r++,s.push(this.removeTargetData(e,l)))}).next(()=>$.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Fc(e).iterate((i,r)=>{let s=xh(r);t(s)})}retrieveMetadata(e){return TL(e).get(m0).next(t=>(_e(t!==null),t))}saveMetadata(e,t){return TL(e).put(m0,t)}saveTargetData(e,t){return Fc(e).put(p3(this.serializer,t))}updateMetadataFromTargetData(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let i=Ha(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),s=null;return Fc(e).iterate({range:r,index:uF},(o,a,l)=>{let c=xh(a);uf(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,i){let r=[],s=Eo(e);return t.forEach(o=>{let a=Bn(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),$.waitFor(r)}removeMatchingKeys(e,t,i){let r=Eo(e);return $.forEach(t,s=>{let o=Bn(s.path);return $.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){let i=Eo(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){let i=IDBKeyRange.bound([t],[t+1],!1,!0),r=Eo(e),s=Be();return r.iterate({range:i,keysOnly:!0},(o,a,l)=>{let c=zr(o[1]),u=new le(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let i=Bn(t.path),r=IDBKeyRange.bound([i],[ZL(i)],!1,!0),s=0;return Eo(e).iterate({index:fT,keysOnly:!0,range:r},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Fc(e).get(t).next(i=>i?xh(i):null)}};function Fc(n){return sn(n,fu)}function TL(n){return sn(n,tl)}function Eo(n){return sn(n,pu)}var xL={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ff=-1,S3=40*1024*1024,Vi=class n{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Vi.DEFAULT_COLLECTION_PERCENTILE=10;Vi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Vi.DEFAULT=new Vi(S3,Vi.DEFAULT_COLLECTION_PERCENTILE,Vi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Vi.DISABLED=new Vi(ff,0,0);var IL="LruGarbageCollector",kL=1*1024*1024,vJ=1*60*1e3,_J=5*60*1e3;function AL([n,e],[t,i]){let r=Ne(n,t);return r===0?Ne(e,i):r}var iC=class{constructor(e){this.maxElements=e,this.buffer=new ut(AL),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let i=this.buffer.last();AL(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}},rC=class{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==ff&&this.scheduleGC(vJ)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){Z(IL,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>B(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Uo(t)?Z(IL,"Ignoring IndexedDB error during garbage collection: ",t):yield Bo(t)}yield this.scheduleGC(_J)}))}},sC=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return $.resolve(mi.INVALID);let i=new iC(t);return this.delegate.forEachTarget(e,r=>i.addElement(r.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,r=>i.addElement(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.delegate.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===ff?(Z("LruGarbageCollector","Garbage collection skipped; disabled"),$.resolve(xL)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(Z("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xL):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let i,r,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(Z("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),r=this.params.maximumSequenceNumbersToCollect):r=d,o=Date.now(),this.nthSequenceNumber(e,r))).next(d=>(i=d,a=Date.now(),this.removeTargets(e,i,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,i))).next(d=>{if(c=Date.now(),Bc()<=xi.DEBUG){let h=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${r} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;Z("LruGarbageCollector",h)}return $.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:d})})}};function wJ(n,e){return new sC(n,e)}var oC=class{constructor(e,t){this.db=e,this.garbageCollector=wJ(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(i,r)=>t(r))}addReference(e,t,i){return t0(e,i)}removeReference(e,t,i){return t0(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return t0(e,t)}isPinned(e,t){return yJ(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,r.getEntry(e,l).next(()=>(r.removeEntry(l,Te.min()),Eo(e).delete(SJ(l))))});s.push(u)}}).next(()=>$.waitFor(s)).next(()=>r.apply(e)).next(()=>o)}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return t0(e,t)}forEachOrphanedDocument(e,t){let i=Eo(e),r=mi.INVALID,s;return i.iterate({index:fT},([o,a],{path:l,sequenceNumber:c})=>{o===0?(r!==mi.INVALID&&t(new le(zr(s)),r),r=c,s=l):r=mi.INVALID}).next(()=>{r!==mi.INVALID&&t(new le(zr(s)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function SJ(n){return[0,Bn(n.path)]}function bJ(n,e){return{targetId:0,path:Bn(n.path),sequenceNumber:e}}function t0(n,e){return Eo(n).put(bJ(e,n.currentSequenceNumber))}var D0=class{constructor(){this.changes=new Hr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?$.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var aC=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return Pa(e).put(i)}removeEntry(e,t,i){return Pa(e).delete(EJ(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.setMetadata(e,i)))}getEntry(e,t){let i=Jt.newInvalidDocument(t);return Pa(e).iterate({index:s0,range:IDBKeyRange.only(Eh(t))},(r,s)=>{i=this.maybeDecodeDocument(t,s)}).next(()=>i)}getSizedEntry(e,t){let i={size:0,document:Jt.newInvalidDocument(t)};return Pa(e).iterate({index:s0,range:IDBKeyRange.only(Eh(t))},(r,s)=>{i={document:this.maybeDecodeDocument(t,s),size:k0(s)}}).next(()=>i)}getEntries(e,t){let i=Jn();return this.forEachDbEntry(e,t,(r,s)=>{let o=this.maybeDecodeDocument(r,s);i=i.insert(r,o)}).next(()=>i)}getSizedEntries(e,t){let i=Jn(),r=new St(le.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);i=i.insert(s,a),r=r.insert(s,k0(o))}).next(()=>({documents:i,sizeMap:r}))}forEachDbEntry(e,t,i){if(t.isEmpty())return $.resolve();let r=new ut(RL);t.forEach(l=>r=r.add(l));let s=IDBKeyRange.bound(Eh(r.first()),Eh(r.last())),o=r.getIterator(),a=o.getNext();return Pa(e).iterate({index:s0,range:s},(l,c,u)=>{let d=le.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&RL(a,d)<0;)i(a,null),a=o.getNext();a&&a.isEqual(d)&&(i(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(Eh(a)):u.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),hy(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Pa(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Jn();for(let d of c){let h=this.maybeDecodeDocument(le.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(hf(t,h)||r.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,i,r){let s=Jn(),o=PL(t,i),a=PL(t,ji.max());return Pa(e).iterate({index:cF,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(le.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===r&&u.done()}).next(()=>s)}newChangeBuffer(e){return new lC(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return DL(e).get(S1).next(t=>(_e(!!t),t))}setMetadata(e,t){return DL(e).put(S1,t)}maybeDecodeDocument(e,t){if(t){let i=NX(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(Te.min())))return i}return Jt.newInvalidDocument(e)}};function b3(n){return new aC(n)}var lC=class extends D0{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new Hr(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){let t=[],i=0,r=new ut((s,o)=>Ne(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=cL(this.documentCache.serializer,o);r=r.add(s.path.popLast());let c=k0(l);i+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(i-=a.size,this.trackRemovals){let l=cL(this.documentCache.serializer,o.convertToNoDocument(Te.min()));t.push(this.documentCache.addEntry(e,s,l))}}),r.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,i)),$.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(i=>(this.documentStates.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:i,sizeMap:r})=>(r.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:i.get(s).readTime})}),i))}};function DL(n){return sn(n,lf)}function Pa(n){return sn(n,ny)}function Eh(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function EJ(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],hy(e),t[t.length-1]]}function PL(n,e){let t=e.documentKey.path.toArray();return[n,hy(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function RL(n,e){let t=n.path.toArray(),i=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=Ne(t[s],i[s]),r)return r;return r=Ne(t.length,i.length),r||(r=Ne(t[t.length-2],i[i.length-2]),r)?r:Ne(t[t.length-1],i[i.length-1])}var CJ=17;var cC=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var P0=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Dh(i.mutation,r,gi.empty(),Mt.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,Be()).next(()=>i))}getLocalViewOfDocuments(e,t,i=Be()){let r=Vr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=Th();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=Vr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,Be()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=Jn(),o=qh(),a=mQ();return t.forEach((l,c)=>{let u=i.get(c.key);r.has(c.key)&&(u===void 0||u.mutation instanceof ur)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Dh(u.mutation,c,u.mutation.getFieldMask(),Mt.now())):o.set(c.key,gi.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new cC(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let i=qh(),r=new St((o,a)=>o-a),s=Be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=i.get(l)||gi.empty();u=a.applyToLocalView(c,u),i.set(l,u);let d=(r.get(a.batchId)||Be()).add(l);r=r.insert(a.batchId,d)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=$F();u.forEach(h=>{if(!s.has(h)){let f=QF(t.get(h),i.get(h));f!==null&&d.set(h,f),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return $.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return rQ(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):bT(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):$.resolve(Vr()),a=Wc,l=s;return o.next(c=>$.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?$.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{l=l.insert(u,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Be())).next(u=>({batchId:a,changes:VF(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new le(t)).next(i=>{let r=Th();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=Th();return this.indexManager.getCollectionParents(e,s).next(a=>$.forEach(a,l=>{let c=tQ(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,i,r).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Jt.newInvalidDocument(u)))});let a=Th();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Dh(u.mutation,c,gi.empty(),Mt.now()),hf(t,c)&&(a=a.insert(l,c))}),a})}};var uC=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return $.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,jX(t)),$.resolve()}getNamedQuery(e,t){return $.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,$X(t)),$.resolve()}};var dC=class{constructor(){this.overlays=new St(le.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return $.resolve(this.overlays.get(t))}getOverlays(e,t){let i=Vr();return $.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.saveOverlay(e,t,s)}),$.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.overlayByBatchId.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(i)),$.resolve()}getOverlaysForCollection(e,t,i){let r=Vr(),s=t.length+1,o=new le(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return $.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new St((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let h=s.get(u.largestBatchId);h===null&&(h=Vr(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=Vr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=r)););return $.resolve(a)}saveOverlay(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.overlayByBatchId.get(r.largestBatchId).delete(i.key);this.overlayByBatchId.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new $h(t,i));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Be(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(i.key))}};var hC=class{constructor(){this.sessionToken=Wt.EMPTY_BYTE_STRING}getSessionToken(e){return $.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,$.resolve()}};var Yh=class{constructor(){this.refsByKey=new ut(Xt.compareByKey),this.refsByTarget=new ut(Xt.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let i=new Xt(e,t);this.refsByKey=this.refsByKey.add(i),this.refsByTarget=this.refsByTarget.add(i)}addReferences(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.removeRef(new Xt(e,t))}removeReferences(e,t){e.forEach(i=>this.removeReference(i,t))}removeReferencesForId(e){let t=new le(new Xe([])),i=new Xt(t,e),r=new Xt(t,e+1),s=[];return this.refsByTarget.forEachInRange([i,r],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new le(new Xe([])),i=new Xt(t,e),r=new Xt(t,e+1),s=Be();return this.refsByTarget.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Xt(e,0),i=this.refsByKey.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},Xt=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return le.comparator(e.key,t.key)||Ne(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return Ne(e.targetOrBatchId,t.targetOrBatchId)||le.comparator(e.key,t.key)}};var fC=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ut(Xt.compareByKey)}checkEmpty(e){return $.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Vh(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Xt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return $.resolve(o)}lookupMutationBatch(e,t){return $.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.indexOfBatchId(i),s=r<0?0:r;return $.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return $.resolve(this.mutationQueue.length===0?xo:this.nextBatchId-1)}getAllMutationBatches(e){return $.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new Xt(t,0),r=new Xt(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([i,r],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),$.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ut(Ne);return t.forEach(r=>{let s=new Xt(r,0),o=new Xt(r,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{i=i.add(a.targetOrBatchId)})}),$.resolve(this.findMutationBatches(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;le.isDocumentKey(s)||(s=s.child(""));let o=new Xt(new le(s),0),a=new ut(Ne);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return i.isPrefixOf(c)?(c.length===r&&(a=a.add(l.targetOrBatchId)),!0):!1},o),$.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(i=>{let r=this.findMutationBatch(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){let i=this.indexOfExistingBatchId(t.batchId,"removed");_e(i===0),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return $.forEach(t.mutations,s=>{let o=new Xt(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let i=new Xt(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(i);return $.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,$.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function TJ(){return new St(le.comparator)}var pC=class{constructor(e){this.sizer=e,this.docs=TJ(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.sizer(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return $.resolve(i?i.document.mutableCopy():Jt.newInvalidDocument(t))}getEntries(e,t){let i=Jn();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():Jt.newInvalidDocument(r))}),$.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=Jn(),o=t.path,a=new le(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||dT(tF(u),i)<=0||!r.has(u.key)&&!hf(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return $.resolve(s)}getAllFromCollectionGroup(e,t,i,r){fe()}forEachDocumentKey(e,t){return $.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new mC(this)}getSize(e){return $.resolve(this.size)}};function xJ(n){return new pC(n)}var mC=class extends D0{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.documentCache.addEntry(e,r)):this.documentCache.removeEntry(i)}),$.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var gC=class{constructor(e){this.persistence=e,this.targets=new Hr(t=>Ha(t),uf),this.lastRemoteSnapshotVersion=Te.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Yh,this.targetCount=0,this.targetIdGenerator=iu.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((i,r)=>t(r)),$.resolve()}getLastRemoteSnapshotVersion(e){return $.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),$.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),$.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new iu(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,$.resolve()}updateTargetData(e,t){return this.saveTargetData(t),$.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,$.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),$.waitFor(s).next(()=>r)}getTargetCount(e){return $.resolve(this.targetCount)}getTargetData(e,t){let i=this.targets.get(t)||null;return $.resolve(i)}addMatchingKeys(e,t,i){return this.references.addReferences(t,i),$.resolve()}removeMatchingKeys(e,t,i){this.references.removeReferences(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),$.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),$.resolve()}getMatchingKeysForTargetId(e,t){let i=this.references.referencesForId(t);return $.resolve(i)}containsKey(e,t){return $.resolve(this.references.containsKey(t))}};var IJ="MemoryPersistence",R0=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new mi(0),this._started=!1,this._started=!0,this.globalsCache=new hC,this.referenceDelegate=e(this),this.targetCache=new gC(this);let i=r=>this.referenceDelegate.documentSize(r);this.indexManager=new eC,this.remoteDocumentCache=xJ(i),this.serializer=new C0(t),this.bundleCache=new uC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dC,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.mutationQueues[e.toKey()];return i||(i=new fC(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=i),i}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,i){Z(IJ,"Starting transaction:",e);let r=new yC(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),i(r).next(s=>this.referenceDelegate.onTransactionCommitted(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return $.or(Object.values(this.mutationQueues).map(i=>()=>i.containsKey(e,t)))}},yC=class extends f0{constructor(e){super(),this.currentSequenceNumber=e}},M0=class n{constructor(e){this.persistence=e,this.localViewReferences=new Yh,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw fe()}addReference(e,t,i){return this.localViewReferences.addReference(i,t),this.orphanedDocuments.delete(i.toString()),$.resolve()}removeReference(e,t,i){return this.localViewReferences.removeReference(i,t),this.orphanedDocuments.add(i.toString()),$.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),$.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $.forEach(this.orphanedDocuments,r=>{let s=le.fromPath(r);return this.isReferenced(e,s).next(o=>{o||i.removeEntry(s,Te.min())})}).next(()=>(this._orphanedDocuments=null,i.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(i=>{i?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return $.or([()=>$.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var vC=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,i,r){let s=new p0("createOrUpgrade",t);i<1&&r>=1&&(AJ(e),DJ(e),ML(e),RJ(e));let o=$.resolve();return i<3&&r>=3&&(i!==0&&(NJ(e),ML(e)),o=o.next(()=>FJ(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>PJ(e,s))),o=o.next(()=>{BJ(e)})),i<5&&r>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),i<6&&r>=6&&(o=o.next(()=>(OJ(e),this.addDocumentGlobal(s)))),i<7&&r>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),i<8&&r>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),i<9&&r>=9&&(o=o.next(()=>{LJ(e)})),i<10&&r>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),i<11&&r>=11&&(o=o.next(()=>{UJ(e),qJ(e)})),i<12&&r>=12&&(o=o.next(()=>{VJ(e)})),i<13&&r>=13&&(o=o.next(()=>MJ(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(Ma))),i<14&&r>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),i<15&&r>=15&&(o=o.next(()=>zJ(e))),i<16&&r>=16&&(o=o.next(()=>{t.objectStore(sy).clear()}).next(()=>{t.objectStore(oy).clear()})),i<17&&r>=17&&(o=o.next(()=>{$J(e)})),o}addDocumentGlobal(e){let t=0;return e.store(Ma).iterate((i,r)=>{t+=k0(r)}).next(()=>{let i={byteSize:t};return e.store(lf).put(S1,i)})}removeAcknowledgedMutations(e){let t=e.store(af),i=e.store(ar);return t.loadAll().next(r=>$.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,xo],[s.userId,s.lastAcknowledgedBatchId]);return i.loadAll(Fa,o).next(a=>$.forEach(a,l=>{_e(l.userId===s.userId);let c=Oa(this.serializer,l);return v3(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(pu),i=e.store(Ma);return e.store(tl).get(m0).next(s=>{let o=l=>t.put({targetId:0,path:Bn(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return i.iterate((l,c)=>{let u=new Xe(l),d=kJ(u);a.push(t.get(d).next(h=>h?$.resolve():o(u)))}).next(()=>$.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Oh,{keyPath:qK});let i=t.store(Oh),r=new Kh,s=o=>{if(r.add(o)){let a=o.lastSegment(),l=o.popLast();return i.put({collectionId:a,parent:Bn(l)})}};return t.store(Ma).iterate({keysOnly:!0},(o,a)=>{let l=new Xe(o);return s(l.popLast())}).next(()=>t.store(hu).iterate({keysOnly:!0},([o,a,l],c)=>{let u=zr(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(fu);return t.iterate((i,r)=>{let s=xh(r),o=p3(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let i=t.store(Ma),r=[];return i.iterate((s,o)=>{let a=t.store(ny),l=jJ(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(c))}).next(()=>$.waitFor(r))}runOverlayMigration(e,t){let i=t.store(ar),r=b3(this.serializer),s=new R0(M0.factory,this.serializer.remoteSerializer);return i.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Be();Oa(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),$.forEach(a,(l,c)=>{let u=new Zt(c),d=T0.forUser(this.serializer,u),h=s.getIndexManager(u),f=A0.forUser(u,this.serializer,h,s.referenceDelegate);return new P0(r,f,d,h).recalculateAndSaveOverlaysForDocumentKeys(new Nh(t,mi.INVALID),l).next()})})}};function kJ(n){return[0,Bn(n)]}function AJ(n){n.createObjectStore(of)}function DJ(n){n.createObjectStore(af,{keyPath:DK}),n.createObjectStore(ar,{keyPath:oF,autoIncrement:!0}).createIndex(Fa,aF,{unique:!0}),n.createObjectStore(hu)}function PJ(n,e){return e.store(ar).loadAll().next(i=>{n.deleteObjectStore(ar),n.createObjectStore(ar,{keyPath:oF,autoIncrement:!0}).createIndex(Fa,aF,{unique:!0});let s=e.store(ar),o=i.map(a=>s.put(a));return $.waitFor(o)})}function RJ(n){n.createObjectStore(Ma)}function MJ(n){let e=n.createObjectStore(ny,{keyPath:MK});e.createIndex(s0,OK),e.createIndex(cF,NK)}function OJ(n){n.createObjectStore(lf)}function ML(n){n.createObjectStore(pu,{keyPath:BK}).createIndex(fT,UK,{unique:!0}),n.createObjectStore(fu,{keyPath:LK}).createIndex(uF,FK,{unique:!0}),n.createObjectStore(tl)}function NJ(n){n.deleteObjectStore(pu),n.deleteObjectStore(fu),n.deleteObjectStore(tl)}function LJ(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function FJ(n){let e=n.store(tl),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Te.min().toTimestamp(),targetCount:0};return e.put(m0,t)}function BJ(n){n.createObjectStore(Kc,{keyPath:zK})}function UJ(n){n.createObjectStore(iy,{keyPath:VK})}function qJ(n){n.createObjectStore(ry,{keyPath:$K})}function zJ(n){n.createObjectStore(pT,{keyPath:jK,autoIncrement:!0}).createIndex(b1,GK,{unique:!1}),n.createObjectStore(sy,{keyPath:HK}).createIndex(dF,WK,{unique:!1}),n.createObjectStore(oy,{keyPath:KK}).createIndex(hF,YK,{unique:!1})}function VJ(n){let e=n.createObjectStore(ay,{keyPath:QK});e.createIndex(E1,XK,{unique:!1}),e.createIndex(fF,JK,{unique:!1})}function $J(n){n.createObjectStore(mT,{keyPath:ZK})}function jJ(n){return n.document?new le(Xe.fromString(n.document.name).popFirst(5)):n.noDocument?le.fromSegments(n.noDocument.path):n.unknownDocument?le.fromSegments(n.unknownDocument.path):fe()}var bo="IndexedDbPersistence",n1=30*60*1e3,i1=5e3,GJ=4e3,r1="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",HJ="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",WJ="firestore_zombie",E3="main",_C=class n{constructor(e,t,i,r,s,o,a,l,c,u,d=CJ){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=h=>Promise.resolve(),!n.isAvailable())throw new Y(G.UNIMPLEMENTED,HJ);this.referenceDelegate=new oC(this,r),this.dbName=t+E3,this.serializer=new C0(l),this.simpleDb=new ko(this.dbName,this.schemaVersion,new vC(this.serializer)),this.globalsCache=new Y1,this.targetCache=new nC(this.referenceDelegate,this.serializer),this.remoteDocumentCache=b3(this.serializer),this.bundleCache=new K1,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Rt(bo,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Y(G.FAILED_PRECONDITION,r1);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new mi(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>B(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>B(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>B(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>n0(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(i=>{i||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(i=>this.isPrimary&&!i?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):i?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Uo(e))return Z(bo,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Z(bo,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return Ch(e).get(Pc).next(i=>$.resolve(this.isLocalClient(i)))}removeClientMetadata(e){return n0(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return B(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,n1)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let i=sn(t,Kc);return i.loadAll().next(r=>{let s=this.filterActiveClients(r,n1),o=r.filter(a=>s.indexOf(a)===-1);return $.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",GJ,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?$.resolve(!0):Ch(e).get(Pc).next(i=>{if(i!==null&&this.isWithinAge(i.leaseTimestampMs,i1)&&!this.isClientZombied(i.ownerId)){if(this.isLocalClient(i)&&this.networkEnabled)return!0;if(!this.isLocalClient(i)){if(!i.allowTabSynchronization)throw new Y(G.FAILED_PRECONDITION,r1);return!1}}return this.networkEnabled&&this.inForeground?!0:n0(e).loadAll().next(s=>this.filterActiveClients(s,i1).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(i=>(this.isPrimary!==i&&Z(bo,`Client ${i?"is":"is not"} eligible for a primary lease.`),i))}shutdown(){return B(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[of,Kc],e=>{let t=new Nh(e,mi.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(i=>this.isWithinAge(i.updateTimeMs,t)&&!this.isClientZombied(i.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>n0(e).loadAll().next(t=>this.filterActiveClients(t,n1).map(i=>i.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return A0.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new tC(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return T0.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,i){Z(bo,"Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=lY(this.schemaVersion),o;return this.simpleDb.runTransaction(e,r,s,a=>(o=new Nh(a,this.listenSequence?this.listenSequence.next():mi.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Rt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new Y(G.FAILED_PRECONDITION,nF);return i(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return Ch(e).get(Pc).next(i=>{if(i!==null&&this.isWithinAge(i.leaseTimestampMs,i1)&&!this.isClientZombied(i.ownerId)&&!this.isLocalClient(i)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!i.allowTabSynchronization))throw new Y(G.FAILED_PRECONDITION,r1)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ch(e).put(Pc,t)}static isAvailable(){return ko.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=Ch(e);return t.get(Pc).next(i=>this.isLocalClient(i)?(Z(bo,"Releasing primary lease."),t.delete(Pc)):$.resolve())}isWithinAge(e,t){let i=Date.now(),r=i-t,s=i;return e<r?!1:e>s?(Rt(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;jy()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let i=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return Z(bo,`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Rt(bo,"Failed to get zombied client id.",i),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Rt("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${WJ}_${this.persistenceKey}_${e}`}};function Ch(n){return sn(n,of)}function n0(n){return sn(n,Kc)}function PT(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function KJ(n){return B(this,null,function*(){if(!ko.isAvailable())return Promise.resolve();let e=n+E3;yield ko.delete(e)})}function YJ(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var RT="LocalStore",QJ=5*60*1e6,Qh=class{constructor(e,t,i,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new St(Ne),this.targetIdByTarget=new Hr(s=>Ha(s),uf),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(i)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new P0(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function C3(n,e,t,i){return new Qh(n,e,t,i)}function T3(n,e){return B(this,null,function*(){let t=ce(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],l=[],c=Be();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(r,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function XJ(n,e){let t=ce(n),i=Mt.now(),r=e.reduce((a,l)=>a.add(l.key),Be()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Jn(),c=Be();return t.remoteDocuments.getEntries(a,r).next(u=>{l=u,l.forEach((d,h)=>{h.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let h of e){let f=IQ(h,s.get(h.key).overlayedDocument);f!=null&&d.push(new ur(h.key,f,kF(f.value.mapValue),Bt.exists(!0)))}return t.mutationQueue.addMutationBatch(a,i,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:VF(s)}))}function JJ(n,e){let t=ce(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return lZ(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,ZJ(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function ZJ(n){let e=Be();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function eZ(n,e){let t=ce(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",i=>{let r;return t.mutationQueue.lookupMutationBatch(i,e).next(s=>(_e(s!==null),r=s.keys(),t.mutationQueue.removeMutationBatch(i,s))).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,r)).next(()=>t.localDocuments.getDocuments(i,r))})}function tZ(n){let e=ce(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function x3(n){let e=ce(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function nZ(n,e){let t=ce(n),i=e.snapshotVersion,r=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});r=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let h=r.get(d);if(!h)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let f=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?f=f.withResumeToken(Wt.EMPTY_BYTE_STRING,Te.min()).withLastLimboFreeSnapshotVersion(Te.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,i)),r=r.insert(d,f),iZ(h,f,u)&&a.push(t.targetCache.updateTargetData(s,f))});let l=Jn(),c=Be();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(I3(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!i.isEqual(Te.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(u)}return $.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=r,s))}function I3(n,e,t){let i=Be(),r=Be();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=Jn();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(Te.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Z(RT,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:r}})}function iZ(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=QJ?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function rZ(n,e){return B(this,null,function*(){let t=ce(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",i=>$.forEach(e,r=>$.forEach(r.addedKeys,s=>t.persistence.referenceDelegate.addReference(i,r.targetId,s)).next(()=>$.forEach(r.removedKeys,s=>t.persistence.referenceDelegate.removeReference(i,r.targetId,s)))))}catch(i){if(Uo(i))Z(RT,"Failed to update sequence numbers: "+i);else throw i}for(let i of e){let r=i.targetId;if(!i.fromCache){let s=t.targetDataByTarget.get(r),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(r,a)}}})}function sZ(n,e){let t=ce(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=xo),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function oZ(n,e){let t=ce(n);return t.persistence.runTransaction("read document","readonly",i=>t.localDocuments.getDocument(i,e))}function ru(n,e){let t=ce(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.targetCache.getTargetData(i,e).next(s=>s?(r=s,$.resolve(r)):t.targetCache.allocateTargetId(i).next(o=>(r=new nu(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.targetCache.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.targetDataByTarget.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(i.targetId,i),t.targetIdByTarget.set(e,i.targetId)),i})}function aZ(n,e,t){let i=ce(n),r=i.targetIdByTarget.get(t);return r!==void 0?$.resolve(i.targetDataByTarget.get(r)):i.targetCache.getTargetData(e,t)}function su(n,e,t){return B(this,null,function*(){let i=ce(n),r=i.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(Uo(o))Z(RT,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}i.targetDataByTarget=i.targetDataByTarget.remove(e),i.targetIdByTarget.delete(r.target)})}function fy(n,e,t){let i=ce(n),r=Te.min(),s=Be();return i.persistence.runTransaction("Execute query","readwrite",o=>aZ(i,o,Un(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>i.queryEngine.getDocumentsMatchingQuery(o,e,t?r:Te.min(),t?s:Be())).next(a=>(D3(i,UF(e),a),{documents:a,remoteKeys:s})))}function lZ(n,e,t,i){let r=t.batch,s=r.keys(),o=$.resolve();return s.forEach(a=>{o=o.next(()=>i.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);_e(c!==null),l.version.compareTo(c)<0&&(r.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),i.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,r))}function cZ(n,e){let t=ce(n),i=ce(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",r=>i.lookupMutationKeys(r,e).next(s=>s?t.localDocuments.getDocuments(r,s):$.resolve(null)))}function uZ(n,e){ce(ce(n,Qh).mutationQueue).removeCachedMutationKeys(e)}function dZ(n){return ce(ce(n,Qh).persistence).getActiveClients()}function k3(n,e){let t=ce(n),i=ce(t.targetCache),r=t.targetDataByTarget.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function A3(n,e){let t=ce(n),i=t.collectionGroupReadTime.get(e)||Te.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.remoteDocuments.getAllFromCollectionGroup(r,e,eF(i,Wc),Number.MAX_SAFE_INTEGER)).then(r=>(D3(t,e,r),r))}function D3(n,e,t){let i=n.collectionGroupReadTime.get(e)||Te.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.collectionGroupReadTime.set(e,i)}function hZ(n){return Un(mu(Xe.fromString(`__bundle__/docs/${n}`)))}function fZ(n,e,t,i){return B(this,null,function*(){let r=ce(n),s=Be(),o=Jn();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=r.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield ru(r,hZ(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",c=>I3(c,a,o).next(u=>(a.apply(c),u)).next(u=>r.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>r.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function pZ(n,e){let t=ce(n),i=Gt(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",r=>t.bundleCache.getBundleMetadata(r,e.id)).then(r=>!!r&&r.createTime.compareTo(i)>=0)}function mZ(n,e){let t=ce(n);return t.persistence.runTransaction("Save bundle","readwrite",i=>t.bundleCache.saveBundleMetadata(i,e))}function gZ(n,e){let t=ce(n);return t.persistence.runTransaction("Get named query","readonly",i=>t.bundleCache.getNamedQuery(i,e))}function yZ(i,r){return B(this,arguments,function*(n,e,t=Be()){let s=yield ru(n,Un(IT(e.bundledQuery))),o=ce(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Gt(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(Wt.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var wC=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var vZ=100;function _Z(){return jy()?8:iF(Uu())>0?6:4}var O0=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=vZ,this.relativeIndexReadCostPerDocument=_Z()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new wC;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,i,r){return i.documentReadCount<this.indexAutoCreationMinCollectionSize?(Bc()<=xi.DEBUG&&Z("QueryEngine","SDK will not create cache indexes for query:",Uc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),$.resolve()):(Bc()<=xi.DEBUG&&Z("QueryEngine","Query:",Uc(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.relativeIndexReadCostPerDocument*r?(Bc()<=xi.DEBUG&&Z("QueryEngine","The SDK decides to create cache indexes for query:",Uc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Un(t))):$.resolve())}performQueryUsingIndex(e,t){if(tL(t))return $.resolve(null);let i=Un(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=w0(t,null,"F"),i=Un(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=Be(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,w0(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,i,r){return tL(t)||r.isEqual(Te.min())?$.resolve(null):this.localDocumentsView.getDocuments(e,i).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,i,r)?$.resolve(null):(Bc()<=xi.DEBUG&&Z("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Uc(t)),this.appendRemainingResults(e,o,t,eF(r,Wc)).next(a=>a))})}applyQuery(e,t){let i=new ut(qF(e));return t.forEach((r,s)=>{hf(e,s)&&(i=i.add(s))}),i}needsRefill(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(r)>0:!1}executeFullCollectionScan(e,t,i){return Bc()<=xi.DEBUG&&Z("QueryEngine","Using full collection scan to execute query:",Uc(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,ji.min(),i)}appendRemainingResults(e,t,i,r){return this.localDocumentsView.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var P3="firestore_clients";function OL(n,e){return`${P3}_${n}_${e}`}var R3="firestore_mutations";function NL(n,e,t){let i=`${R3}_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}var M3="firestore_targets";function s1(n,e){return`${M3}_${n}_${e}`}var wZ="firestore_online_state";function SZ(n){return`${wZ}_${n}`}var bZ="firestore_bundle_loaded_v2";function EZ(n){return`${bZ}_${n}`}var CZ="firestore_sequence_number";function TZ(n){return`${CZ}_${n}`}var qr="SharedClientState",N0=class n{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static fromWebStorageEntry(e,t,i){let r=JSON.parse(i),s=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),o;return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(o=new Y(r.error.code,r.error.message))),s?new n(e,t,r.state,o):(Rt(qr,`Failed to parse mutation state for ID '${t}': ${i}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ph=class n{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static fromWebStorageEntry(e,t){let i=JSON.parse(t),r=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),s;return r&&i.error&&(r=typeof i.error.message=="string"&&typeof i.error.code=="string",r&&(s=new Y(i.error.code,i.error.message))),r?new n(e,i.state,s):(Rt(qr,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},L0=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let i=JSON.parse(t),r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=CT();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=EF(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new n(e,s):(Rt(qr,`Failed to parse client data for instance '${e}': ${t}`),null)}},SC=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Rt(qr,`Failed to parse online state: ${e}`),null)}},Xh=class{constructor(){this.activeTargetIds=CT()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Rh=class{constructor(e,t,i,r,s){this.window=e,this.queue=t,this.persistenceKey=i,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new St(Ne),this.started=!1,this.earlyEvents=[];let o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=OL(this.persistenceKey,this.localClientId),this.sequenceNumberKey=TZ(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Xh),this.clientStateKeyRe=new RegExp(`^${P3}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${R3}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${M3}_${o}_(\\d+)$`),this.onlineStateKey=SZ(this.persistenceKey),this.bundleLoadedKey=EZ(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return B(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let i of e){if(i===this.localClientId)continue;let r=this.getItem(OL(this.persistenceKey,i));if(r){let s=L0.fromWebStorageEntry(i,r);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let i=this.fromWebStorageOnlineState(t);i&&this.handleOnlineStateEvent(i)}for(let i of this.earlyEvents)this.handleWebStorageEvent(i);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,i){this.persistMutationState(e,t,i),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let i="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(s1(this.persistenceKey,e));if(r){let s=Ph.fromWebStorageEntry(e,r);s&&(i=s.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),i}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(s1(this.persistenceKey,e))}updateQueryState(e,t,i){this.persistQueryTargetState(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.removeMutationState(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return Z(qr,"READ",e,t),t}setItem(e,t){Z(qr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Z(qr,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(Z(qr,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Rt("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>B(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let i=this.fromWebStorageClientState(t.key,t.newValue);if(i)return this.handleClientStateEvent(i.clientId,i)}else{let i=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(i,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let i=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(i)return this.handleMutationBatchEvent(i)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(i)return this.handleQueryTargetEvent(i)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let i=this.fromWebStorageOnlineState(t.newValue);if(i)return this.handleOnlineStateEvent(i)}}else if(t.key===this.sequenceNumberKey){let i=xZ(t.newValue);i!==mi.INVALID&&this.sequenceNumberHandler(i)}else if(t.key===this.bundleLoadedKey){let i=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(i.map(r=>this.syncEngine.synchronizeWithChangedDocuments(r)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,i){let r=new N0(this.currentUser,e,t,i),s=NL(this.persistenceKey,this.currentUser,e);this.setItem(s,r.toWebStorageJSON())}removeMutationState(e){let t=NL(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,i){let r=s1(this.persistenceKey,e),s=new Ph(e,t,i);this.setItem(r,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let i=this.fromWebStorageClientStateKey(e);return L0.fromWebStorageEntry(i,t)}fromWebStorageMutationMetadata(e,t){let i=this.mutationBatchKeyRe.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return N0.fromWebStorageEntry(new Zt(s),r,t)}fromWebStorageQueryTargetMetadata(e,t){let i=this.queryTargetKeyRe.exec(e),r=Number(i[1]);return Ph.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return SC.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return B(this,null,function*(){if(e.user.uid!==this.currentUser.uid){Z(qr,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let i=t?this.activeClients.insert(e,t):this.activeClients.remove(e),r=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(i),o=[],a=[];return s.forEach(l=>{r.has(l)||o.push(l)}),r.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=i})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=CT();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}};function xZ(n){let e=mi.INVALID;if(n!=null)try{let t=JSON.parse(n);_e(typeof t=="number"),e=t}catch(t){Rt(qr,"Failed to read sequence number from WebStorage",t)}return e}var F0=class{constructor(){this.localState=new Xh,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,i){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Xh,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var bC=class{addCallback(e){}shutdown(){}};var EC=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var i0=null;function IZ(){return 268435456+Math.round(2147483648*Math.random())}function o1(){return i0===null?i0=IZ():i0++,"0x"+i0.toString(16)}function kZ(n){return new Promise((e,t)=>{n((i,r)=>{i?t(i):e(r)})})}var AZ="1.9.1",Fn="GrpcConnection",DZ=`gl-node/${process.versions.node} fire/${du} grpc/${AZ}`;function a1(n,e,t,i){_e(e===null||e.type==="OAuth");let r=new qa.Metadata;return e&&e.headers.forEach((s,o)=>r.set(o,s)),t&&t.headers.forEach((s,o)=>r.set(o,s)),i&&r.set("X-Firebase-GMPID",i),r.set("X-Goog-Api-Client",DZ),r.set("Google-Cloud-Resource-Prefix",n),r.set("x-goog-request-params",n),r}var CC=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){Z(Fn,"Creating Firestore stub.");let e=this.databaseInfo.ssl?qa.credentials.createSsl():qa.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,i,r,s){let o=o1(),a=this.ensureActiveStub(),l=a1(this.databasePath,r,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},i);return kZ(u=>(Z(Fn,`RPC '${e}' ${o} invoked with request:`,i),a[e](c,l,(d,h)=>{d?(Z(Fn,`RPC '${e}' ${o} failed with error:`,d),u(new Y(l0(d.code),d.message))):(Z(Fn,`RPC '${e}' ${o} completed with response:`,h),u(void 0,h))})))}invokeStreamingRPC(e,t,i,r,s,o){let a=o1(),l=[],c=new jt;Z(Fn,`RPC '${e}' ${a} invoked (streaming) with request:`,i);let u=this.ensureActiveStub(),d=a1(this.databasePath,r,s,this.databaseInfo.appId),h=Object.assign(Object.assign({},i),{database:this.databasePath}),f=u[e](h,d),g=!1;return f.on("data",_=>{Z(Fn,`RPC ${e} ${a} received result:`,_),l.push(_),o!==void 0&&l.length===o&&(g=!0,c.resolve(l))}),f.on("end",()=>{Z(Fn,`RPC '${e}' ${a} completed.`),g||(g=!0,c.resolve(l))}),f.on("error",_=>{Z(Fn,`RPC '${e}' ${a} failed with error:`,_);let S=l0(_.code);c.reject(new Y(S,_.message))}),c.promise}openStream(e,t,i){let r=o1(),s=this.ensureActiveStub(),o=a1(this.databasePath,t,i,this.databaseInfo.appId),a=s[e](o),l=!1,c=h=>{l||(l=!0,u.callOnClose(h),a.end())},u=new EC({sendFn:h=>{if(l)Z(Fn,`RPC '${e}' stream ${r} not sending because gRPC stream is closed:`,h);else{Z(Fn,`RPC '${e}' stream ${r} sending:`,h);try{a.write(h)}catch(f){throw Rt("Failure sending:",h),Rt("Error:",f),f}}},closeFn:()=>{Z(Fn,`RPC '${e}' stream ${r} closed locally via close().`),c()}}),d=!1;return a.on("data",h=>{l||(Z(Fn,`RPC '${e}' stream ${r} received:`,h),d||(u.callOnConnected(),d=!0),u.callOnMessage(h))}),a.on("end",()=>{Z(Fn,`RPC '${e}' stream ${r} ended.`),c()}),a.on("error",h=>{if(!l){$i(Fn,`RPC '${e}' stream ${r} error. Code:`,h.code,"Message:",h.message);let f=l0(h.code);c(new Y(f,h.message))}}),Z(Fn,`Opening RPC '${e}' stream ${r} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},O3={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},PZ={nested:O3},RZ=Object.freeze({__proto__:null,nested:O3,default:PZ});var MZ={longs:String,enums:String,defaults:!0,oneofs:!1};function OZ(){let n=QL.fromJSON(RZ,MZ);return qa.loadPackageDefinition(n)}function NZ(n){let e=OZ();return new CC(e,n)}function LZ(){return new bC}function N3(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function FZ(){return null}function pf(n){return new $1(n,!1)}var BZ="ExponentialBackoff",UZ=1e3,qZ=1.5,zZ=60*1e3,Jh=class{constructor(e,t,i=UZ,r=qZ,s=zZ){this.queue=e,this.timerId=t,this.initialDelayMs=i,this.backoffFactor=r,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),i=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-i);r>0&&Z(BZ,`Backing off for ${r} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,r,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var LL="PersistentStream",VZ=60*1e3,$Z=10*1e3,B0=class{constructor(e,t,i,r,s,o,a,l){this.queue=e,this.idleTimerId=i,this.healthTimerId=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Jh(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return B(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,VZ,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return B(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return B(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===G.RESOURCE_EXHAUSTED?(Rt(t.toString()),Rt("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===G.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.closeCount===t&&this.startStream(i,r)},i=>{e(()=>{let r=new Y(G.UNKNOWN,"Fetching auth token failed: "+i.message);return this.handleStreamClose(r)})})}startStream(e,t){let i=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{i(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{i(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,$Z,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(r=>{i(()=>this.handleStreamClose(r))}),this.stream.onMessage(r=>{i(()=>++this.responseCount===1?this.onFirst(r):this.onNext(r))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>B(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return Z(LL,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(Z(LL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},TC=class extends B0{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=JQ(this.serializer,e),i=eX(e);return this.listener.onWatchChange(t,i)}watch(e){let t={};t.database=H1(this.serializer),t.addTarget=dX(this.serializer,e);let i=cX(this.serializer,e);i&&(t.labels=i),this.sendRequest(t)}unwatch(e){let t={};t.database=H1(this.serializer),t.removeTarget=e,this.sendRequest(t)}},xC=class extends B0{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return _e(!!e.streamToken),this.lastStreamToken=e.streamToken,_e(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){_e(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=rX(e.writeResults,e.commitTime),i=Gt(e.commitTime);return this.listener.onMutationResult(i,t)}writeHandshake(){let e={};e.database=H1(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>Wh(this.serializer,i))};this.sendRequest(t)}};var IC=class{},kC=class extends IC{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new Y(G.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,i,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,G1(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Y(G.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,i,r,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,G1(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Y(G.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function jZ(n,e,t,i){return new kC(n,e,t,i)}function GZ(n,e){return B(this,null,function*(){let t=ce(n),i={writes:e.map(r=>Wh(t.serializer,r))};yield t.invokeRPC("Commit",t.serializer.databaseId,Xe.emptyPath(),i)})}function HZ(n,e){return B(this,null,function*(){let t=ce(n),i={documents:e.map(a=>Hh(t.serializer,a))},r=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,Xe.emptyPath(),i,e.length),s=new Map;r.forEach(a=>{let l=XQ(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());_e(!!l),o.push(l)}),o})}function WZ(n,e,t){let i=ce(n);return i.verifyInitialized(),new xC(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,t)}function KZ(n,e,t){let i=ce(n);return i.verifyInitialized(),new TC(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,t)}var YZ="OnlineStateTracker",FL=1,BL=10*1e3,AC=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",BL,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${BL/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=FL&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${FL} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Rt(t),this.shouldWarnClientIsOffline=!1):Z(YZ,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Qa="RemoteStore",QZ=10,DC=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{i.enqueueAndForget(()=>B(this,null,function*(){qo(this)&&(Z(Qa,"Restarting streams for network reachability change."),yield pee(this))}))}),this.onlineStateTracker=new AC(i,r)}};function XZ(n,e,t,i,r){return new DC(n,e,t,i,r)}function JZ(n){let e=ce(n);return e.offlineCauses.delete(0),mf(e)}function mf(n){return B(this,null,function*(){if(qo(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function ZZ(n){return B(this,null,function*(){let e=ce(n);e.offlineCauses.add(0),yield gu(e),e.onlineStateTracker.set("Offline")})}function gu(n){return B(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function eee(n){return B(this,null,function*(){let e=ce(n);Z(Qa,"RemoteStore shutting down."),e.offlineCauses.add(5),yield gu(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function py(n,e){let t=ce(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),NT(t)?OT(t):_u(t).isOpen()&&MT(t,e))}function yu(n,e){let t=ce(n),i=_u(t);t.listenTargets.delete(e),i.isOpen()&&L3(t,e),t.listenTargets.size===0&&(i.isOpen()?i.markIdle():qo(t)&&t.onlineStateTracker.set("Unknown"))}function MT(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Te.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}_u(n).watch(e)}function L3(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),_u(n).unwatch(e)}function OT(n){n.watchChangeAggregator=new V1({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),_u(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function NT(n){return qo(n)&&!_u(n).isStarted()&&n.listenTargets.size>0}function qo(n){return ce(n).offlineCauses.size===0}function F3(n){n.watchChangeAggregator=void 0}function tee(n){return B(this,null,function*(){n.onlineStateTracker.set("Online")})}function nee(n){return B(this,null,function*(){n.listenTargets.forEach((e,t)=>{MT(n,e)})})}function iee(n,e){return B(this,null,function*(){F3(n),NT(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),OT(n)):n.onlineStateTracker.set("Unknown")})}function ree(n,e,t){return B(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof b0&&e.state===2&&e.cause){try{yield oee(n,e)}catch(i){Z(Qa,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield U0(n,i)}return}if(e instanceof Hc?n.watchChangeAggregator.handleDocumentChange(e):e instanceof S0?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(Te.min()))try{let i=yield x3(n.localStore);t.compareTo(i)>=0&&(yield see(n,t))}catch(i){Z(Qa,"Failed to raise snapshot:",i),yield U0(n,i)}})}function U0(n,e,t){return B(this,null,function*(){if(Uo(e))n.offlineCauses.add(1),yield gu(n),n.onlineStateTracker.set("Offline"),t||(t=()=>x3(n.localStore)),n.asyncQueue.enqueueRetryable(()=>B(this,null,function*(){Z(Qa,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield mf(n)}));else throw e})}function B3(n,e){return e().catch(t=>U0(n,t,e))}function see(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((i,r)=>{if(i.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(r);s&&n.listenTargets.set(r,s.withResumeToken(i.resumeToken,e))}}),t.targetMismatches.forEach((i,r)=>{let s=n.listenTargets.get(i);if(!s)return;n.listenTargets.set(i,s.withResumeToken(Wt.EMPTY_BYTE_STRING,s.snapshotVersion)),L3(n,i);let o=new nu(s.target,i,r,s.sequenceNumber);MT(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function oee(n,e){return B(this,null,function*(){let t=e.cause;for(let i of e.targetIds)n.listenTargets.has(i)&&(yield n.remoteSyncer.rejectListen(i,t),n.listenTargets.delete(i),n.watchChangeAggregator.removeTarget(i))})}function vu(n){return B(this,null,function*(){let e=ce(n),t=zo(e),i=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:xo;for(;aee(e);)try{let r=yield sZ(e.localStore,i);if(r===null){e.writePipeline.length===0&&t.markIdle();break}else i=r.batchId,lee(e,r)}catch(r){yield U0(e,r)}U3(e)&&q3(e)})}function aee(n){return qo(n)&&n.writePipeline.length<QZ}function lee(n,e){n.writePipeline.push(e);let t=zo(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function U3(n){return qo(n)&&!zo(n).isStarted()&&n.writePipeline.length>0}function q3(n){zo(n).start()}function cee(n){return B(this,null,function*(){zo(n).writeHandshake()})}function uee(n){return B(this,null,function*(){let e=zo(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function dee(n,e,t){return B(this,null,function*(){let i=n.writePipeline.shift(),r=B1.from(i,e,t);yield B3(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield vu(n)})}function hee(n,e){return B(this,null,function*(){e&&zo(n).handshakeComplete&&(yield fee(n,e)),U3(n)&&q3(n)})}function fee(n,e){return B(this,null,function*(){if(OQ(e.code)){let t=n.writePipeline.shift();zo(n).inhibitBackoff(),yield B3(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield vu(n)}})}function pee(n){return B(this,null,function*(){let e=ce(n);e.offlineCauses.add(4),yield gu(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield mf(e)})}function UL(n,e){return B(this,null,function*(){let t=ce(n);t.asyncQueue.verifyOperationInProgress(),Z(Qa,"RemoteStore received new credentials");let i=qo(t);t.offlineCauses.add(3),yield gu(t),i&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield mf(t)})}function PC(n,e){return B(this,null,function*(){let t=ce(n);e?(t.offlineCauses.delete(2),yield mf(t)):e||(t.offlineCauses.add(2),yield gu(t),t.onlineStateTracker.set("Unknown"))})}function _u(n){return n.watchStream||(n.watchStream=KZ(n.datastore,n.asyncQueue,{onConnected:tee.bind(null,n),onOpen:nee.bind(null,n),onClose:iee.bind(null,n),onWatchChange:ree.bind(null,n)}),n.onNetworkStatusChange.push(e=>B(this,null,function*(){e?(n.watchStream.inhibitBackoff(),NT(n)?OT(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),F3(n))}))),n.watchStream}function zo(n){return n.writeStream||(n.writeStream=WZ(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:cee.bind(null,n),onClose:hee.bind(null,n),onHandshakeComplete:uee.bind(null,n),onMutationResult:dee.bind(null,n)}),n.onNetworkStatusChange.push(e=>B(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield vu(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(Z(Qa,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var mee="AsyncQueue",RC=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new jt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Y(G.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function wu(n,e){if(Rt(mee,`${e}: ${n}`),Uo(n))return new Y(G.UNAVAILABLE,`${e}: ${n}`);throw n}var q0=class n{constructor(e){e?this.comparator=(t,i)=>e(t,i)||le.comparator(t.key,i.key):this.comparator=(t,i)=>le.comparator(t.key,i.key),this.keyedMap=Th(),this.sortedSet=new St(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var z0=class{constructor(){this.changeMap=new St(le.comparator)}track(e){let t=e.doc.key,i=this.changeMap.get(t);if(!i){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&i.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&i.type!==1?this.changeMap=this.changeMap.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&i.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):fe()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,i)=>{e.push(i)}),e}},ou=class n{constructor(e,t,i,r,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,q0.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!df(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var MC=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function gee(){return new OC}var OC=class{constructor(){this.queries=z3(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){bee(this,new Y(G.ABORTED,"Firestore shutting down"))}};function z3(){return new Hr(n=>BF(n),df)}function LT(n,e){return B(this,null,function*(){let t=ce(n),i=3,r=e.query,s=t.queries.get(r);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2):(s=new MC,i=e.listensToRemoteStore()?0:1);try{switch(i){case 0:s.viewSnap=yield t.onListen(r,!0);break;case 1:s.viewSnap=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r);break;default:break}}catch(o){let a=wu(o,`Initialization of query '${Uc(e.query)}' failed`);e.onError(a);return}t.queries.set(r,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&BT(t)})}function FT(n,e){return B(this,null,function*(){let t=ce(n),i=e.query,r=3,s=t.queries.get(i);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?r=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function yee(n,e){let t=ce(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(r)&&(i=!0);o.viewSnap=r}}i&&BT(t)}function vee(n,e,t){let i=ce(n),r=i.queries.get(e);if(r)for(let s of r.listeners)s.onError(t);i.queries.delete(e)}function _ee(n,e){let t=ce(n);t.onlineState=e;let i=!1;t.queries.forEach((r,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(i=!0)}),i&&BT(t)}function wee(n,e){ce(n).snapshotsInSyncListeners.add(e),e.next()}function See(n,e){ce(n).snapshotsInSyncListeners.delete(e)}function bee(n,e){let t=ce(n),i=t.queries;t.queries=z3(),i.forEach((r,s)=>{for(let o of s.listeners)o.onError(e)})}function BT(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var V3=function(n){return n.Default="default",n.Cache="cache",n}(V3||{}),Zh=class{constructor(e,t,i){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=i||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new ou(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let i=t!=="Offline";return this.options.waitForSyncWhenOnline&&i?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=ou.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==V3.Cache}};var NC=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.addedKeys=i,this.removedKeys=r}static fromSnapshot(e,t){let i=Be(),r=Be();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key);break}return new n(e,t.fromCache,i,r)}};var V0=class{constructor(e){this.serializer=e}toDocumentKey(e){return $r(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?a3(this.serializer,e.document,!1):Jt.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Gt(e)}},LC=class{constructor(e,t,i){this.bundleMetadata=e,this.localStore=t,this.serializer=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=$3(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let i=Xe.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,i=new V0(this.serializer);for(let r of e)if(r.metadata.queries){let s=i.toDocumentKey(r.metadata.name);for(let o of r.metadata.queries){let a=(t.get(o)||Be()).add(s);t.set(o,a)}}return t}complete(){return B(this,null,function*(){let e=yield fZ(this.localStore,new V0(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let i of this.queries)yield yZ(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function $3(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function Eee(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var $0=class{constructor(e){this.key=e}},j0=class{constructor(e){this.key=e}},G0=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Be(),this.mutatedKeys=Be(),this.docComparator=qF(e),this.documentSet=new q0(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let i=t?t.changeSet:new z0,r=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,d)=>{let h=r.get(u),f=hf(this.query,d)?d:null,g=h?this.mutatedKeys.has(h.key):!1,_=f?f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations:!1,S=!1;h&&f?h.data.isEqual(f.data)?g!==_&&(i.track({type:3,doc:f}),S=!0):this.shouldWaitForSyncedDocument(h,f)||(i.track({type:2,doc:f}),S=!0,(l&&this.docComparator(f,l)>0||c&&this.docComparator(f,c)<0)&&(a=!0)):!h&&f?(i.track({type:0,doc:f}),S=!0):h&&!f&&(i.track({type:1,doc:h}),S=!0,(l||c)&&(a=!0)),S&&(f?(o=o.add(f),_?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{documentSet:o,changeSet:i,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,h)=>Cee(d.type,h.type)||this.docComparator(d.doc,h.doc)),this.applyTargetChange(i),r=r??!1;let a=t&&!r?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!r?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new ou(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,i?i.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new z0,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Be(),this.documentSet.forEach(i=>{this.shouldBeInLimbo(i.key)&&(this.limboDocuments=this.limboDocuments.add(i.key))});let t=[];return e.forEach(i=>{this.limboDocuments.has(i)||t.push(new j0(i))}),this.limboDocuments.forEach(i=>{e.has(i)||t.push(new $0(i))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Be();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return ou.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function Cee(n,e){let t=i=>{switch(i){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return fe()}};return t(n)-t(e)}var Vo="SyncEngine",FC=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},BC=class{constructor(e){this.key=e,this.receivedDocument=!1}},UC=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new Hr(a=>BF(a),df),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new St(le.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Yh,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=iu.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function Tee(n,e,t,i,r,s,o){let a=new UC(n,e,t,i,r,s);return o&&(a._isPrimaryClient=!0),a}function xee(n,e,t=!0){return B(this,null,function*(){let i=my(n),r,s=i.queryViewsByQuery.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.computeInitialSnapshot()):r=yield j3(i,e,t,!0),r})}function Iee(n,e){return B(this,null,function*(){let t=my(n);yield j3(t,e,!0,!1)})}function j3(n,e,t,i){return B(this,null,function*(){let r=yield ru(n.localStore,Un(e)),s=r.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return i&&(a=yield UT(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&py(n.remoteStore,r),a})}function UT(n,e,t,i,r){return B(this,null,function*(){n.applyDocChanges=(d,h,f)=>Bee(n,d,h,f);let s=yield fy(n.localStore,e,!0),o=new G0(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Gh.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),c=o.applyChanges(a,n.isPrimaryClient,l);VT(n,t,c.limboChanges);let u=new FC(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function kee(n,e,t){return B(this,null,function*(){let i=ce(n),r=i.queryViewsByQuery.get(e),s=i.queriesByTarget.get(r.targetId);if(s.length>1){i.queriesByTarget.set(r.targetId,s.filter(o=>!df(o,e))),i.queryViewsByQuery.delete(e);return}i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield su(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&yu(i.remoteStore,r.targetId),au(i,r.targetId)}).catch(Bo))):(au(i,r.targetId),yield su(i.localStore,r.targetId,!0))})}function Aee(n,e){return B(this,null,function*(){let t=ce(n),i=t.queryViewsByQuery.get(e),r=t.queriesByTarget.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),yu(t.remoteStore,i.targetId))})}function Dee(n,e,t){return B(this,null,function*(){let i=jT(n);try{let r=yield XJ(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),Lee(i,r.batchId,t),yield vs(i,r.changes),yield vu(i.remoteStore)}catch(r){let s=wu(r,"Failed to persist write");t.reject(s)}})}function G3(n,e){return B(this,null,function*(){let t=ce(n);try{let i=yield nZ(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(_e(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.receivedDocument=!0:r.modifiedDocuments.size>0?_e(o.receivedDocument):r.removedDocuments.size>0&&(_e(o.receivedDocument),o.receivedDocument=!1))}),yield vs(t,i,e)}catch(i){yield Bo(i)}})}function qL(n,e,t){let i=ce(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&r.push(a.snapshot)}),_ee(i.eventManager,e),r.length&&i.syncEngineListener.onWatchChange(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function Pee(n,e,t){return B(this,null,function*(){let i=ce(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.activeLimboResolutionsByTarget.get(e),s=r&&r.key;if(s){let o=new St(le.comparator);o=o.insert(s,Jt.newNoDocument(s,Te.min()));let a=Be().add(s),l=new jh(Te.min(),new Map,new St(Ne),o,a);yield G3(i,l),i.activeLimboTargetsByKey=i.activeLimboTargetsByKey.remove(s),i.activeLimboResolutionsByTarget.delete(e),$T(i)}else yield su(i.localStore,e,!1).then(()=>au(i,e,t)).catch(Bo)})}function Ree(n,e){return B(this,null,function*(){let t=ce(n),i=e.batch.batchId;try{let r=yield JJ(t.localStore,e);zT(t,i,null),qT(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield vs(t,r)}catch(r){yield Bo(r)}})}function Mee(n,e,t){return B(this,null,function*(){let i=ce(n);try{let r=yield eZ(i.localStore,e);zT(i,e,t),qT(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield vs(i,r)}catch(r){yield Bo(r)}})}function Oee(n,e){return B(this,null,function*(){let t=ce(n);qo(t.remoteStore)||Z(Vo,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let i=yield tZ(t.localStore);if(i===xo){e.resolve();return}let r=t.pendingWritesCallbacks.get(i)||[];r.push(e),t.pendingWritesCallbacks.set(i,r)}catch(i){let r=wu(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function qT(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function Nee(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(i=>{i.reject(new Y(G.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function Lee(n,e,t){let i=n.mutationUserCallbacks[n.currentUser.toKey()];i||(i=new St(Ne)),i=i.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=i}function zT(n,e,t){let i=ce(n),r=i.mutationUserCallbacks[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.mutationUserCallbacks[i.currentUser.toKey()]=r}}function au(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(i),t&&n.syncEngineListener.onWatchError(i,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(r=>{n.limboDocumentRefs.containsKey(r)||H3(n,r)})}function H3(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(yu(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),$T(n))}function VT(n,e,t){for(let i of t)i instanceof $0?(n.limboDocumentRefs.addReference(i.key,e),Fee(n,i)):i instanceof j0?(Z(Vo,"Document no longer in limbo: "+i.key),n.limboDocumentRefs.removeReference(i.key,e),n.limboDocumentRefs.containsKey(i.key)||H3(n,i.key)):fe()}function Fee(n,e){let t=e.key,i=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(i)&&(Z(Vo,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(i),$T(n))}function $T(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new le(Xe.fromString(e)),i=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(i,new BC(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,i),py(n.remoteStore,new nu(Un(mu(t.path)),i,"TargetPurposeLimboResolution",mi.INVALID))}}function vs(n,e,t){return B(this,null,function*(){let i=ce(n),r=[],s=[],o=[];i.queryViewsByQuery.isEmpty()||(i.queryViewsByQuery.forEach((a,l)=>{o.push(i.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&i.isPrimaryClient){let d=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;i.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){r.push(c);let d=NC.fromSnapshot(l.targetId,c);s.push(d)}}))}),yield Promise.all(o),i.syncEngineListener.onWatchChange(r),yield rZ(i.localStore,s))})}function Bee(n,e,t,i){return B(this,null,function*(){let r=e.view.computeDocChanges(t);r.needsRefill&&(r=yield fy(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,r)));let s=i&&i.targetChanges.get(e.targetId),o=i&&i.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(r,n.isPrimaryClient,s,o);return VT(n,e.targetId,a.limboChanges),a.snapshot})}function Uee(n,e){return B(this,null,function*(){let t=ce(n);if(!t.currentUser.isEqual(e)){Z(Vo,"User change. New user:",e.toKey());let r=yield T3(t.localStore,e);t.currentUser=e,Nee(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield vs(t,r.affectedDocuments)}})}function qee(n,e){let t=ce(n),i=t.activeLimboResolutionsByTarget.get(e);if(i&&i.receivedDocument)return Be().add(i.key);{let r=Be(),s=t.queriesByTarget.get(e);if(!s)return r;for(let o of s){let a=t.queryViewsByQuery.get(o);r=r.unionWith(a.view.syncedDocuments)}return r}}function zee(n,e){return B(this,null,function*(){let t=ce(n),i=yield fy(t.localStore,e.query,!0),r=e.view.synchronizeWithPersistedState(i);return t.isPrimaryClient&&VT(t,e.targetId,r.limboChanges),r})}function Vee(n,e){return B(this,null,function*(){let t=ce(n);return A3(t.localStore,e).then(i=>vs(t,i))})}function $ee(n,e,t,i){return B(this,null,function*(){let r=ce(n),s=yield cZ(r.localStore,e);if(s===null){Z(Vo,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield vu(r.remoteStore):t==="acknowledged"||t==="rejected"?(zT(r,e,i||null),qT(r,e),uZ(r.localStore,e)):fe(),yield vs(r,s)})}function jee(n,e){return B(this,null,function*(){let t=ce(n);if(my(t),jT(t),e===!0&&t._isPrimaryClient!==!0){let i=t.sharedClientState.getAllActiveQueryTargets(),r=yield zL(t,i.toArray());t._isPrimaryClient=!0,yield PC(t.remoteStore,!0);for(let s of r)py(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let i=[],r=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(au(t,o),su(t.localStore,o,!0))),yu(t.remoteStore,o)}),yield r,yield zL(t,i),Gee(t),t._isPrimaryClient=!1,yield PC(t.remoteStore,!1)}})}function Gee(n){let e=ce(n);e.activeLimboResolutionsByTarget.forEach((t,i)=>{yu(e.remoteStore,i)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new St(le.comparator)}function zL(n,e,t){return B(this,null,function*(){let i=ce(n),r=[],s=[];for(let o of e){let a,l=i.queriesByTarget.get(o);if(l&&l.length!==0){a=yield ru(i.localStore,Un(l[0]));for(let c of l){let u=i.queryViewsByQuery.get(c),d=yield zee(i,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield k3(i.localStore,o);a=yield ru(i.localStore,c),yield UT(i,W3(c),o,!1,a.resumeToken)}r.push(a)}return i.syncEngineListener.onWatchChange(s),r})}function W3(n){return FF(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Hee(n){let e=ce(n);return dZ(e.localStore)}function Wee(n,e,t,i){return B(this,null,function*(){let r=ce(n);if(r._isPrimaryClient){Z(Vo,"Ignoring unexpected query state notification.");return}let s=r.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield A3(r.localStore,UF(s[0])),a=jh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Wt.EMPTY_BYTE_STRING);yield vs(r,o,a);break}case"rejected":{yield su(r.localStore,e,!0),au(r,e,i);break}default:fe()}})}function Kee(n,e,t){return B(this,null,function*(){let i=my(n);if(i._isPrimaryClient){for(let r of e){if(i.queriesByTarget.has(r)&&i.sharedClientState.isActiveQueryTarget(r)){Z(Vo,"Adding an already active target "+r);continue}let o=yield k3(i.localStore,r),a=yield ru(i.localStore,o);yield UT(i,W3(o),a.targetId,!1,a.resumeToken),py(i.remoteStore,a)}for(let r of t)i.queriesByTarget.has(r)&&(yield su(i.localStore,r,!1).then(()=>{yu(i.remoteStore,r),au(i,r)}).catch(Bo))}})}function my(n){let e=ce(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=G3.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qee.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Pee.bind(null,e),e.syncEngineListener.onWatchChange=yee.bind(null,e.eventManager),e.syncEngineListener.onWatchError=vee.bind(null,e.eventManager),e}function jT(n){let e=ce(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ree.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Mee.bind(null,e),e}function Yee(n,e,t){let i=ce(n);Qee(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}function Qee(n,e,t){return B(this,null,function*(){try{let i=yield e.getMetadata();if(yield pZ(n.localStore,i))return yield e.close(),t._completeWith(Eee(i)),Promise.resolve(new Set);t._updateProgress($3(i));let s=new LC(i,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield vs(n,a.changedDocs,void 0),yield mZ(n.localStore,i),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(i){return $i(Vo,`Loading bundle failed with ${i}`),t._failWith(i),Promise.resolve(new Set)}})}var ef=class{constructor(){this.synchronizeTabs=!1}initialize(e){return B(this,null,function*(){this.serializer=pf(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return C3(this.persistence,new O0,e.initialUser,this.serializer)}createPersistence(e){return new R0(M0.factory,this.serializer)}createSharedClientState(e){return new F0}terminate(){return B(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var H0=class n extends ef{constructor(e,t,i){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(e){return B(this,null,function*(){yield Uy(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield jT(this.onlineComponentProvider.syncEngine),yield vu(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return C3(this.persistence,new O0,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let i=this.persistence.referenceDelegate.garbageCollector;return new rC(i,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let i=new _1(t,this.persistence);return new v1(e.asyncQueue,i)}createPersistence(e){let t=PT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Vi.withCacheSize(this.cacheSizeBytes):Vi.DEFAULT;return new _C(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,N3(),FZ(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new F0}},qC=class n extends H0{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return B(this,null,function*(){yield Uy(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Rh&&(this.sharedClientState.syncEngine={applyBatchState:$ee.bind(null,t),applyTargetState:Wee.bind(null,t),applyActiveTargetsChange:Kee.bind(null,t),getActiveClients:Hee.bind(null,t),synchronizeWithChangedDocuments:Vee.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(i=>B(this,null,function*(){yield jee(this.onlineComponentProvider.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=N3();if(!Rh.isAvailable(t))throw new Y(G.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let i=PT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Rh(t,e.asyncQueue,i,e.clientId,e.initialUser)}},tf=class{initialize(e,t){return B(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>qL(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Uee.bind(null,this.syncEngine),yield PC(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return gee()}createDatastore(e){let t=pf(e.databaseInfo.databaseId),i=NZ(e.databaseInfo);return jZ(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return XZ(this.localStore,this.datastore,e.asyncQueue,t=>qL(this.syncEngine,t,0),LZ())}createSyncEngine(e,t){return Tee(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return B(this,null,function*(){var e,t;yield eee(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};var Xee=10240;function Jee(n,e=Xee){let t=0;return{read(){return B(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return B(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function GT(n,e,t){if(!t)throw new Y(G.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function HT(n,e,t,i){if(e===!0&&i===!0)throw new Y(G.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function VL(n){if(!le.isDocumentKey(n))throw new Y(G.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function $L(n){if(le.isDocumentKey(n))throw new Y(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zee(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function gf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=ete(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":fe()}function ete(n){return n.constructor?n.constructor.name:null}function Je(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Y(G.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=gf(n);throw new Y(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function K3(n,e){if(e<=0)throw new Y(G.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function tte(n,e){if(!(n instanceof Uint8Array))throw new Y(G.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${gf(n)}`);return Jee(n,e)}var lu=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Rt("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var zC=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var VC=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new jt,this.buffer=new Uint8Array,this.textDecoder=NQ(),this.nextElementImpl().then(i=>{i&&i.isBundleMetadata()?this.metadata.resolve(i.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i?.payload)}`))},i=>this.metadata.reject(i))}close(){return this.reader.cancel()}getMetadata(){return B(this,null,function*(){return this.metadata.promise})}nextElement(){return B(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return B(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),i=Number(t);isNaN(i)&&this.raiseError(`length string (${t}) is not valid number`);let r=yield this.readJsonString(i);return new zC(JSON.parse(r),e.length+i)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return B(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return B(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return B(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function nte(n,e){return new VC(n,e)}var $C=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return B(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Y(G.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield HZ(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastTransactionError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new No(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return B(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{let r=le.fromPath(i);this.mutations.push(new zh(r,this.precondition(r)))}),yield GZ(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=Te.min();else throw fe();let i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new Y(G.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Te.min())?Bt.exists(!1):Bt.updateTime(t):Bt.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Te.min()))throw new Y(G.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Bt.updateTime(t)}else return Bt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var jC=class{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.attemptsRemaining=i.maxAttempts,this.backoff=new Jh(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>B(this,null,function*(){let e=new $C(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.handleTransactionError(r)}))}).catch(i=>{this.handleTransactionError(i)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return cf(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!e3(t)}return!1}};var Lo="FirestoreClient",ite=100,rte=11,ste=20,ote=22,GC=class{constructor(e,t,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Zt.UNAUTHENTICATED,this.clientId=d0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,s=>B(this,null,function*(){Z(Lo,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(i,s=>(Z(Lo,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:ite}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Y(G.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new jt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>B(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=wu(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function c0(n,e){return B(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),Z(Lo,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>B(this,null,function*(){i.isEqual(r)||(yield T3(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function HC(n,e){return B(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield WT(n);Z(Lo,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>UL(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>UL(e.remoteStore,r)),n._onlineComponents=e})}function Y3(n){return n.name==="FirebaseError"?n.code===G.FAILED_PRECONDITION||n.code===G.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===ote||n.code===ste||n.code===rte:!0}function WT(n){return B(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Z(Lo,"Using user provided OfflineComponentProvider");try{yield c0(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!Y3(t))throw t;$i("Error using user provided cache. Falling back to memory cache: "+t),yield c0(n,new ef)}}else Z(Lo,"Using default OfflineComponentProvider"),yield c0(n,new ef);return n._offlineComponents})}function gy(n){return B(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(Z(Lo,"Using user provided OnlineComponentProvider"),yield HC(n,n._uninitializedComponentsProvider._online)):(Z(Lo,"Using default OnlineComponentProvider"),yield HC(n,new tf))),n._onlineComponents})}function Q3(n){return WT(n).then(e=>e.persistence)}function KT(n){return WT(n).then(e=>e.localStore)}function X3(n){return gy(n).then(e=>e.remoteStore)}function YT(n){return gy(n).then(e=>e.syncEngine)}function ate(n){return gy(n).then(e=>e.datastore)}function cu(n){return B(this,null,function*(){let e=yield gy(n),t=e.eventManager;return t.onListen=xee.bind(null,e.syncEngine),t.onUnlisten=kee.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Iee.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Aee.bind(null,e.syncEngine),t})}function lte(n){return n.asyncQueue.enqueue(()=>B(this,null,function*(){let e=yield Q3(n),t=yield X3(n);return e.setNetworkEnabled(!0),JZ(t)}))}function cte(n){return n.asyncQueue.enqueue(()=>B(this,null,function*(){let e=yield Q3(n),t=yield X3(n);return e.setNetworkEnabled(!1),ZZ(t)}))}function ute(n){let e=new jt;return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let t=yield YT(n);return Oee(t,e)})),e.promise}function dte(n,e,t,i){let r=new lu(i),s=new Zh(e,r,t);return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let o=yield cu(n);return LT(o,s)})),()=>{r.mute(),n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let o=yield cu(n);return FT(o,s)}))}}function hte(n,e){let t=new jt;return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let i=yield KT(n);return yte(i,e,t)})),t.promise}function J3(n,e,t={}){let i=new jt;return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let r=yield cu(n);return vte(r,n.asyncQueue,e,t,i)})),i.promise}function fte(n,e){let t=new jt;return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let i=yield KT(n);return _te(i,e,t)})),t.promise}function Z3(n,e,t={}){let i=new jt;return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let r=yield cu(n);return wte(r,n.asyncQueue,e,t,i)})),i.promise}function pte(n,e){let t=new jt;return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let i=yield YT(n);return Dee(i,e,t)})),t.promise}function mte(n,e){let t=new lu(e);return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let i=yield cu(n);return wee(i,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let i=yield cu(n);return See(i,t)}))}}function gte(n,e,t){let i=new jt;return n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){let r=yield ate(n);new jC(n.asyncQueue,r,t,e,i).run()})),i.promise}function yte(n,e,t){return B(this,null,function*(){try{let i=yield oZ(n,e);i.isFoundDocument()?t.resolve(i):i.isNoDocument()?t.resolve(null):t.reject(new Y(G.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(i){let r=wu(i,`Failed to get document '${e} from cache`);t.reject(r)}})}function vte(n,e,t,i,r){let s=new lu({next:a=>{e.enqueueAndForget(()=>FT(n,o));let l=a.docs.has(t);!l&&a.fromCache?r.reject(new Y(G.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&i&&i.source==="server"?r.reject(new Y(G.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:a=>r.reject(a)}),o=new Zh(mu(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return LT(n,o)}function _te(n,e,t){return B(this,null,function*(){try{let i=yield fy(n,e,!0),r=new G0(e,i.remoteKeys),s=r.computeDocChanges(i.documents),o=r.applyChanges(s,!1);t.resolve(o.snapshot)}catch(i){let r=wu(i,`Failed to execute query '${e} against cache`);t.reject(r)}})}function wte(n,e,t,i,r){let s=new lu({next:a=>{e.enqueueAndForget(()=>FT(n,o)),a.fromCache&&i.source==="server"?r.reject(new Y(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(a)},error:a=>r.reject(a)}),o=new Zh(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return LT(n,o)}function Ste(n,e,t,i){let r=Ete(t,pf(e));n.asyncQueue.enqueueAndForget(()=>B(this,null,function*(){Yee(yield YT(n),r,i)}))}function bte(n,e){return n.asyncQueue.enqueue(()=>B(this,null,function*(){return gZ(yield KT(n),e)}))}function Ete(n,e){let t;return typeof n=="string"?t=t3().encode(n):t=n,nte(tte(t),e)}function Cte(n,e){return n.timeoutSeconds===e.timeoutSeconds}function e4(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Tte="ComponentProvider",jL=new Map;function xte(n){let e=jL.get(n);e&&(Z(Tte,"Removing Datastore"),jL.delete(n),e.terminate())}function Ite(n,e,t,i){return new T1(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,e4(i.experimentalLongPollingOptions),i.useFetchStreams)}var t4="firestore.googleapis.com",GL=!0,HL=5,WL=30,kte=!0,W0=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new Y(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=t4,this.ssl=GL}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:GL;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=S3;else{if(e.cacheSizeBytes!==ff&&e.cacheSizeBytes<kL)throw new Y(G.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${kL}`);this.cacheSizeBytes=e.cacheSizeBytes}HT("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=kte:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=e4((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),Ate(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&Cte(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function Ate(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new Y(G.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<HL)throw new Y(G.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${HL})`);if(n.timeoutSeconds>WL)throw new Y(G.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${WL})`)}}var Xa=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new W0({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Y(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new Y(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new W0(e),e.credentials!==void 0&&(this._authCredentials=_K(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return xte(this),Promise.resolve()}};function n4(n,e,t,i={}){var r;n=Je(n,Xa);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==t4&&s.host!==o&&$i("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,l;if(typeof i.mockUserToken=="string")a=i.mockUserToken,l=Zt.MOCK_USER;else{a=Of(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new Y(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Zt(c)}n._authCredentials=new c1(new u0(a,l))}}var wn=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},gt=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},jr=class n extends wn{constructor(e,t,i){super(e,t,mu(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new gt(this.firestore,null,new le(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function QT(n,e,...t){if(n=We(n),GT("collection","path",e),n instanceof Xa){let i=Xe.fromString(e,...t);return $L(i),new jr(n,null,i)}else{if(!(n instanceof gt)&&!(n instanceof jr))throw new Y(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(Xe.fromString(e,...t));return $L(i),new jr(n.firestore,null,i)}}function i4(n,e){if(n=Je(n,Xa),GT("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Y(G.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new wn(n,null,iQ(e))}function yf(n,e,...t){if(n=We(n),arguments.length===1&&(e=d0.newId()),GT("doc","path",e),n instanceof Xa){let i=Xe.fromString(e,...t);return VL(i),new gt(n,null,new le(i))}else{if(!(n instanceof gt)&&!(n instanceof jr))throw new Y(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(Xe.fromString(e,...t));return VL(i),new gt(n.firestore,n instanceof jr?n.converter:null,new le(i))}}function XT(n,e){return n=We(n),e=We(e),(n instanceof gt||n instanceof jr)&&(e instanceof gt||e instanceof jr)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function JT(n,e){return n=We(n),e=We(e),n instanceof wn&&e instanceof wn?n.firestore===e.firestore&&df(n._query,e._query)&&n.converter===e.converter:!1}var Dte="AsyncQueue",WC=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Jh(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new jt;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return B(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Uo(e))Z(Dte,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(i=>{this.failure=i,this.operationInProgress=!1;let r=Rte(i);throw Rt("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.operationInProgress=!1,i))));return this.tail=t,t}enqueueAfterDelay(e,t,i){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let r=RC.createAndSchedule(this,e,t,i,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(r),r}verifyNotFailed(){this.failure&&fe()}verifyOperationInProgress(){}drain(){return B(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function Pte(){return new WC}function Rte(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var KC=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new jt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var r4=ff,kt=class extends Xa{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=Pte(),this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||s4(this),this._firestoreClient.terminate()}};function on(n){return n._firestoreClient||s4(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function s4(n){var e,t,i;let r=n._freezeSettings(),s=Ite(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._firestoreClient=new GC(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}function o4(n,e){n=Je(n,kt),m4(n);let t=on(n);if(t._uninitializedComponentsProvider)throw new Y(G.FAILED_PRECONDITION,"SDK cache is already specified.");$i("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let i=n._freezeSettings(),r=new tf,s=new H0(r,i.cacheSizeBytes,e?.forceOwnership);return l4(t,r,s)}function a4(n){n=Je(n,kt),m4(n);let e=on(n);if(e._uninitializedComponentsProvider)throw new Y(G.FAILED_PRECONDITION,"SDK cache is already specified.");$i("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),i=new tf,r=new qC(i,t.cacheSizeBytes);return l4(e,i,r)}function l4(n,e,t){let i=new jt;return n.asyncQueue.enqueue(()=>B(this,null,function*(){try{yield c0(n,t),yield HC(n,e),i.resolve()}catch(r){let s=r;if(!Y3(s))throw s;$i("Error enabling indexeddb cache. Falling back to memory cache: "+s),i.reject(s)}})).then(()=>i.promise)}function c4(n){if(n._initialized&&!n._terminated)throw new Y(G.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new jt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>B(this,null,function*(){try{yield KJ(PT(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function u4(n){n=Je(n,kt);let e=on(n);return ute(e)}function d4(n){n=Je(n,kt);let e=on(n);return lte(e)}function h4(n){n=Je(n,kt);let e=on(n);return cte(e)}function f4(n,e){n=Je(n,kt);let t=on(n),i=new KC;return Ste(t,n._databaseId,e,i),i}function p4(n,e){n=Je(n,kt);let t=on(n);return bte(t,e).then(i=>i?new wn(n,null,i.query):null)}function m4(n){if(n._initialized||n._terminated)throw new Y(G.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function Mte(n,e=!0){yK(Uf),ta(new ri("firestore",(t,{instanceIdentifier:i,options:r})=>{let s=t.getProvider("app").getImmediate(),o=new kt(new u1(t.getProvider("auth-internal")),new p1(t.getProvider("app-check-internal")),gY(s,i),s);return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),Yi(qN,zN,n),Yi(qN,zN,"esm2017")}var Wr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Wt.fromBase64String(e))}catch(t){throw new Y(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Wt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var dr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Y(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ht(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var ms=class{constructor(e){this._methodName=e}};var Ja=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Y(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Y(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ne(this._lat,e._lat)||Ne(this._long,e._long)}};var nf=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return YJ(this._values,e._values)}};var Ote=/^__.*__$/,YC=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new ur(e,this.data,this.fieldMask,t,this.fieldTransforms):new Oo(e,this.data,t,this.fieldTransforms)}},K0=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new ur(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function g4(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fe()}}var Y0=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.contextWith({path:i,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.contextWith({path:i,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Q0(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(g4(this.dataSource)&&Ote.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},QC=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||pf(e)}createContext(e,t,i,r=!1){return new Y0({dataSource:e,methodName:t,targetDoc:i,path:Ht.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function il(n){let e=n._freezeSettings(),t=pf(n._databaseId);return new QC(n._databaseId,!!e.ignoreUndefinedProperties,t)}function yy(n,e,t,i,r,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,r);tx("Data must be an object, but it was:",o,i);let a=_4(i,o),l,c;if(s.merge)l=new gi(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let h=tT(e,d,t);if(!o.contains(h))throw new Y(G.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);S4(u,h)||u.push(h)}l=new gi(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new YC(new An(a),l,c)}var rf=class n extends ms{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function y4(n,e,t){return new Y0({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var XC=class n extends ms{_toFieldTransform(e){return new Wa(e.path,new Ro)}isEqual(e){return e instanceof n}},JC=class n extends ms{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=y4(this,e,!0),i=this._elements.map(s=>rl(s,t)),r=new fs(i);return new Wa(e.path,r)}isEqual(e){return e instanceof n&&Gy(this._elements,e._elements)}},ZC=class n extends ms{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=y4(this,e,!0),i=this._elements.map(s=>rl(s,t)),r=new ps(i);return new Wa(e.path,r)}isEqual(e){return e instanceof n&&Gy(this._elements,e._elements)}},eT=class n extends ms{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Mo(e.serializer,GF(e.serializer,this._operand));return new Wa(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function ZT(n,e,t,i){let r=n.createContext(1,e,t);tx("Data must be an object, but it was:",r,i);let s=[],o=An.empty();nl(i,(l,c)=>{let u=nx(e,l,t);c=We(c);let d=r.childContextForFieldPath(u);if(c instanceof rf)s.push(u);else{let h=rl(c,d);h!=null&&(s.push(u),o.set(u,h))}});let a=new gi(s);return new K0(o,a,r.fieldTransforms)}function ex(n,e,t,i,r,s){let o=n.createContext(1,e,t),a=[tT(e,i,t)],l=[r];if(s.length%2!==0)throw new Y(G.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(tT(e,s[h])),l.push(s[h+1]);let c=[],u=An.empty();for(let h=a.length-1;h>=0;--h)if(!S4(c,a[h])){let f=a[h],g=l[h];g=We(g);let _=o.childContextForFieldPath(f);if(g instanceof rf)c.push(f);else{let S=rl(g,_);S!=null&&(c.push(f),u.set(f,S))}}let d=new gi(c);return new K0(u,d,o.fieldTransforms)}function v4(n,e,t,i=!1){let r=n.createContext(i?4:3,e);return rl(t,r)}function rl(n,e){if(n=We(n),w4(n))return tx("Unsupported field value:",e,n),_4(n,e);if(n instanceof ms)return Lte(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return Nte(n,e)}else return Fte(n,e)}function _4(n,e){let t={};return yF(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):nl(n,(i,r)=>{let s=rl(r,e.childContextForField(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function Nte(n,e){let t=[],i=0;for(let r of n){let s=rl(r,e.childContextForArray(i));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),i++}return{arrayValue:{values:t}}}function Lte(n,e){if(!g4(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function Fte(n,e){if(n=We(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return GF(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Mt.fromDate(n);return{timestampValue:tu(e.serializer,t)}}else if(n instanceof Mt){let t=new Mt(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:tu(e.serializer,t)}}else{if(n instanceof Ja)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Wr)return{bytesValue:n3(e.serializer,n._byteString)};if(n instanceof gt){let t=e.databaseId,i=n.firestore._databaseId;if(!i.isEqual(t))throw e.createError(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:xT(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof nf)return Bte(n,e);throw e.createError(`Unsupported field value: ${gf(n)}`)}}}function Bte(n,e){return{mapValue:{fields:{[vT]:{stringValue:_T},[Yc]:{arrayValue:{values:n.toArray().map(i=>{if(typeof i!="number")throw e.createError("VectorValues must only contain numeric values.");return TT(e.serializer,i)})}}}}}}function w4(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Mt)&&!(n instanceof Ja)&&!(n instanceof Wr)&&!(n instanceof gt)&&!(n instanceof ms)&&!(n instanceof nf)}function tx(n,e,t){if(!w4(t)||!Zee(t)){let i=gf(t);throw i==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+i)}}function tT(n,e,t){if(e=We(e),e instanceof dr)return e._internalPath;if(typeof e=="string")return nx(n,e);throw Q0("Field path arguments must be of type string or ",n,!1,void 0,t)}var Ute=new RegExp("[~\\*/\\[\\]]");function nx(n,e,t){if(e.search(Ute)>=0)throw Q0(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new dr(...e.split("."))._internalPath}catch{throw Q0(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Q0(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new Y(G.INVALID_ARGUMENT,a+n+l)}function S4(n,e){return n.some(t=>t.isEqual(e))}var Za=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new gt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new nT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(vy("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},nT=class extends Za{data(){return super.data()}};function vy(n,e){return typeof e=="string"?nx(n,e):e instanceof dr?e._internalPath:e._delegate._internalPath}function b4(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Y(G.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var sf=class{},el=class extends sf{};function _s(n,e,...t){let i=[];e instanceof sf&&i.push(e),i=i.concat(t),Wte(i);for(let r of i)n=r._apply(n);return n}var X0=class n extends el{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return R4(e._query,t),new wn(e.firestore,e.converter,ET(e._query,t))}_parse(e){let t=il(e.firestore);return qte(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function E4(n,e,t){let i=e,r=vy("where",n);return X0._create(r,i,t)}var iT=class n extends sf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:st.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(Gte(e._query,t),new wn(e.firestore,e.converter,ET(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var rT=class n extends el{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=zte(e._query,this._field,this._direction);return new wn(e.firestore,e.converter,oQ(e._query,t))}};function C4(n,e="asc"){let t=e,i=vy("orderBy",n);return rT._create(i,t)}var J0=class n extends el{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new wn(e.firestore,e.converter,w0(e._query,this._limit,this._limitType))}};function T4(n){return K3("limit",n),J0._create("limit",n,"F")}function x4(n){return K3("limitToLast",n),J0._create("limitToLast",n,"L")}var Z0=class n extends el{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=P4(e,this.type,this._docOrFields,this._inclusive);return new wn(e.firestore,e.converter,aQ(e._query,t))}};function I4(...n){return Z0._create("startAt",n,!0)}function k4(...n){return Z0._create("startAfter",n,!1)}var ey=class n extends el{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=P4(e,this.type,this._docOrFields,this._inclusive);return new wn(e.firestore,e.converter,lQ(e._query,t))}};function A4(...n){return ey._create("endBefore",n,!1)}function D4(...n){return ey._create("endAt",n,!0)}function P4(n,e,t,i){if(t[0]=We(t[0]),t[0]instanceof Za)return Vte(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=il(n.firestore);return $te(n._query,n.firestore._databaseId,r,e,t,i)}}function qte(n,e,t,i,r,s,o){let a;if(r.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new Y(G.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){YL(o,s);let c=[];for(let u of o)c.push(KL(i,n,u));a={arrayValue:{values:c}}}else a=KL(i,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&YL(o,s),a=v4(t,e,o,s==="in"||s==="not-in");return Ke.create(r,s,a)}function zte(n,e,t){if(n.startAt!==null)throw new Y(G.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new Y(G.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ga(e,t)}function Vte(n,e,t,i,r){if(!i)throw new Y(G.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of Jc(n))if(o.field.isKeyField())s.push(ja(e,i.key));else{let a=i.data.field(o.field);if(ly(a))throw new Y(G.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new Y(G.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new Gr(s,r)}function $te(n,e,t,i,r,s){let o=n.explicitOrderBy;if(r.length>o.length)throw new Y(G.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<r.length;l++){let c=r[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new Y(G.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!bT(n)&&c.indexOf("/")!==-1)throw new Y(G.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(Xe.fromString(c));if(!le.isDocumentKey(d))throw new Y(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let h=new le(d);a.push(ja(e,h))}else{let d=v4(t,i,c);a.push(d)}}return new Gr(a,s)}function KL(n,e,t){if(t=We(t),typeof t=="string"){if(t==="")throw new Y(G.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bT(e)&&t.indexOf("/")!==-1)throw new Y(G.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(Xe.fromString(t));if(!le.isDocumentKey(i))throw new Y(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return ja(n,new le(i))}else{if(t instanceof gt)return ja(n,t._key);throw new Y(G.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gf(t)}.`)}}function YL(n,e){if(!Array.isArray(n)||n.length===0)throw new Y(G.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function jte(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function R4(n,e){let t=Hte(n.filters,jte(e.op));if(t!==null)throw t===e.op?new Y(G.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Y(G.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Gte(n,e){let t=n,i=e.getFlattenedFilters();for(let r of i)R4(t,r),t=ET(t,r)}function Hte(n,e){for(let t of n)for(let i of t.getFlattenedFilters())if(e.indexOf(i.op)>=0)return i.op;return null}function Wte(n){let e=n.filter(i=>i instanceof iT).length,t=n.filter(i=>i instanceof X0).length;if(e>1||e>0&&t>0)throw new Y(G.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var uu=class{convertValue(e,t="none"){switch($a(e)){case 0:return null;case 1:return e.booleanValue;case 2:return It(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ao(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw fe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return nl(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;let s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t[Yc].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(o=>It(o.doubleValue));return new nf(s)}convertGeoPoint(e){return new Ja(It(e.latitude),It(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=yT(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Lh(e));default:return null}}convertTimestamp(e){let t=hs(e);return new Mt(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=Xe.fromString(e);_e(f3(i));let r=new Do(i.get(1),i.get(3)),s=new le(i.popFirst(5));return r.isEqual(t)||Rt(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function _y(n,e,t){let i;return n?t&&(t.merge||t.mergeFields)?i=n.toFirestore(e,t):i=n.toFirestore(e):i=e,i}var sT=class extends uu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new gt(this.firestore,null,t)}};function oT(n){return Kte(n,["next","error","complete"])}function Kte(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var gs=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Gi=class extends Za{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Fo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let i=this._document.data.field(vy("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},Fo=class extends Gi{data(e={}){return super.data(e)}},hr=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new gs(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Fo(this._firestore,this._userDataWriter,i.key,i,new gs(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Y(G.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=Yte(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Yte(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(i=>{let r=new Fo(n._firestore,n._userDataWriter,i.doc.key,i.doc,new gs(n._snapshot.mutatedKeys.has(i.doc.key),n._snapshot.fromCache),n.query.converter);return i.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(i=>e||i.type!==3).map(i=>{let r=new Fo(n._firestore,n._userDataWriter,i.doc.key,i.doc,new gs(n._snapshot.mutatedKeys.has(i.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return i.type!==0&&(s=t.indexOf(i.doc.key),t=t.delete(i.doc.key)),i.type!==1&&(t=t.add(i.doc),o=t.indexOf(i.doc.key)),{type:Qte(i.type),doc:r,oldIndex:s,newIndex:o}})}}function Qte(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fe()}}function ix(n,e){return n instanceof Gi&&e instanceof Gi?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof hr&&e instanceof hr?n._firestore===e._firestore&&JT(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function M4(n){n=Je(n,gt);let e=Je(n.firestore,kt),t=on(e);return J3(t,n._key).then(i=>ax(e,n,i))}var ys=class extends uu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new gt(this.firestore,null,t)}};function O4(n){n=Je(n,gt);let e=Je(n.firestore,kt),t=on(e),i=new ys(e);return hte(t,n._key).then(r=>new Gi(e,i,n._key,r,new gs(r!==null&&r.hasLocalMutations,!0),n.converter))}function N4(n){n=Je(n,gt);let e=Je(n.firestore,kt),t=on(e);return J3(t,n._key,{source:"server"}).then(i=>ax(e,n,i))}function L4(n){n=Je(n,wn);let e=Je(n.firestore,kt),t=on(e),i=new ys(e);return b4(n._query),Z3(t,n._query).then(r=>new hr(e,i,n,r))}function F4(n){n=Je(n,wn);let e=Je(n.firestore,kt),t=on(e),i=new ys(e);return fte(t,n._query).then(r=>new hr(e,i,n,r))}function B4(n){n=Je(n,wn);let e=Je(n.firestore,kt),t=on(e),i=new ys(e);return Z3(t,n._query,{source:"server"}).then(r=>new hr(e,i,n,r))}function rx(n,e,t){n=Je(n,gt);let i=Je(n.firestore,kt),r=_y(n.converter,e,t),s=il(i),a=yy(s,"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Bt.none());return Su(i,[a])}function sx(n,e,t,...i){n=Je(n,gt);let r=Je(n.firestore,kt),s=il(r);e=We(e);let o;typeof e=="string"||e instanceof dr?o=ex(s,"updateDoc",n._key,e,t,i):o=ZT(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Bt.exists(!0));return Su(r,[a])}function U4(n){let e=Je(n.firestore,kt),t=[new No(n._key,Bt.none())];return Su(e,t)}function q4(n,e){let t=Je(n.firestore,kt),i=yf(n),r=_y(n.converter,e),s=il(n.firestore),a=yy(s,"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Bt.exists(!1));return Su(t,[a]).then(()=>i)}function ox(n,...e){var t,i,r;n=We(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!oT(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(oT(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),e[o+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}let l,c,u;if(n instanceof gt)c=Je(n.firestore,kt),u=mu(n._key.path),l={next:h=>{e[o]&&e[o](ax(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=Je(n,wn);c=Je(h.firestore,kt),u=h._query;let f=new ys(c);l={next:g=>{e[o]&&e[o](new hr(c,f,h,g))},error:e[o+1],complete:e[o+2]},b4(n._query)}let d=on(c);return dte(d,u,a,l)}function z4(n,e){n=Je(n,kt);let t=on(n),i=oT(e)?e:{next:e};return mte(t,i)}function Su(n,e){let t=on(n);return pte(t,e)}function ax(n,e,t){let i=t.docs.get(e._key),r=new ys(n);return new Gi(n,r,e._key,i,new gs(t.hasPendingWrites,t.fromCache),e.converter)}var Xte={maxAttempts:5};function Jte(n){if(n.maxAttempts<1)throw new Y(G.INVALID_ARGUMENT,"Max attempts must be at least 1")}var ty=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=il(e)}set(e,t,i){this._verifyNotCommitted();let r=To(e,this._firestore),s=_y(r.converter,t,i),o=yy(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,Bt.none())),this}update(e,t,i,...r){this._verifyNotCommitted();let s=To(e,this._firestore);t=We(t);let o;return typeof t=="string"||t instanceof dr?o=ex(this._dataReader,"WriteBatch.update",s._key,t,i,r):o=ZT(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Bt.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=To(e,this._firestore);return this._mutations=this._mutations.concat(new No(t._key,Bt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Y(G.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function To(n,e){if(n=We(n),n.firestore!==e)throw new Y(G.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var aT=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=il(e)}get(e){let t=To(e,this._firestore),i=new sT(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||r.length!==1)return fe();let s=r[0];if(s.isFoundDocument())return new Za(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new Za(this._firestore,i,t._key,null,t.converter);throw fe()})}set(e,t,i){let r=To(e,this._firestore),s=_y(r.converter,t,i),o=yy(this._dataReader,"Transaction.set",r._key,s,r.converter!==null,i);return this._transaction.set(r._key,o),this}update(e,t,i,...r){let s=To(e,this._firestore);t=We(t);let o;return typeof t=="string"||t instanceof dr?o=ex(this._dataReader,"Transaction.update",s._key,t,i,r):o=ZT(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=To(e,this._firestore);return this._transaction.delete(t._key),this}};var lT=class extends aT{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=To(e,this._firestore),i=new ys(this._firestore);return super.get(e).then(r=>new Gi(this._firestore,i,t._key,r._document,new gs(!1,!1),t.converter))}};function V4(n,e,t){n=Je(n,kt);let i=Object.assign(Object.assign({},Xte),t);Jte(i);let r=on(n);return gte(r,s=>e(new lT(n,s)),i)}function $4(){return new rf("deleteField")}function j4(){return new XC("serverTimestamp")}function G4(...n){return new JC("arrayUnion",n)}function H4(...n){return new ZC("arrayRemove",n)}function W4(n){return new eT("increment",n)}Mte("node");var Zte="@firebase/firestore-compat",ene="0.3.37";function fx(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new Y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function K4(){if(typeof Uint8Array>"u")throw new Y("unimplemented","Uint8Arrays are not available in this environment.")}function Y4(){if(!vF())throw new Y("unimplemented","Blobs are unavailable in Firestore in this environment.")}var wy=class n{constructor(e){this._delegate=e}static fromBase64String(e){return Y4(),new n(Wr.fromBase64String(e))}static fromUint8Array(e){return K4(),new n(Wr.fromUint8Array(e))}toBase64(){return Y4(),this._delegate.toBase64()}toUint8Array(){return K4(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function lx(n){return tne(n,["next","error","complete"])}function tne(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var cx=class{enableIndexedDbPersistence(e,t){return o4(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return a4(e._delegate)}clearIndexedDbPersistence(e){return c4(e._delegate)}},Sy=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof Do||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&$i("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){n4(this._delegate,e,t,i)}enableNetwork(){return d4(this._delegate)}disableNetwork(){return h4(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,HT("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return u4(this._delegate)}onSnapshotsInSync(e){return z4(this._delegate,e)}get app(){if(!this._appCompat)throw new Y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Cu(this,QT(this._delegate,e))}catch(t){throw qn(t,"collection()","Firestore.collection()")}}doc(e){try{return new Kr(this,yf(this._delegate,e))}catch(t){throw qn(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ll(this,i4(this._delegate,e))}catch(t){throw qn(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return V4(this._delegate,t=>e(new by(this,t)))}batch(){return on(this._delegate),new Ey(new ty(this._delegate,e=>Su(this._delegate,e)))}loadBundle(e){return f4(this._delegate,e)}namedQuery(e){return p4(this._delegate,e).then(t=>t?new ll(this,t):null)}},bu=class extends uu{constructor(e){super(),this.firestore=e}convertBytes(e){return new wy(new Wr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Kr.forKey(t,this.firestore,null)}};function nne(n){XL(n)}var by=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new bu(e)}get(e){let t=sl(e);return this._delegate.get(t).then(i=>new ol(this._firestore,new Gi(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let r=sl(e);return i?(fx("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=sl(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=sl(e);return this._delegate.delete(t),this}},Ey=class{constructor(e){this._delegate=e}set(e,t,i){let r=sl(e);return i?(fx("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=sl(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=sl(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Eu=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new Fo(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new al(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new n(e,new bu(e),t),r.set(t,s)),s}};Eu.INSTANCES=new WeakMap;var Kr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new bu(e)}static forPath(e,t,i){if(e.length%2!==0)throw new Y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new gt(t._delegate,i,new le(e)))}static forKey(e,t,i){return new n(t,new gt(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new Cu(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Cu(this.firestore,QT(this._delegate,e))}catch(t){throw qn(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=We(e),e instanceof gt?XT(this._delegate,e):!1}set(e,t){t=fx("DocumentReference.set",t);try{return t?rx(this._delegate,e,t):rx(this._delegate,e)}catch(i){throw qn(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?sx(this._delegate,e):sx(this._delegate,e,t,...i)}catch(r){throw qn(r,"updateDoc()","DocumentReference.update()")}}delete(){return U4(this._delegate)}onSnapshot(...e){let t=Q4(e),i=X4(e,r=>new ol(this.firestore,new Gi(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return ox(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=O4(this._delegate):e?.source==="server"?t=N4(this._delegate):t=M4(this._delegate),t.then(i=>new ol(this.firestore,new Gi(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Eu.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function qn(n,e,t){return n.message=n.message.replace(e,t),n}function Q4(n){for(let e of n)if(typeof e=="object"&&!lx(e))return e;return{}}function X4(n,e){var t,i;let r;return lx(n[0])?r=n[0]:lx(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}var ol=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Kr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ix(this._delegate,e._delegate)}},al=class extends ol{data(e){let t=this._delegate.data(e);return this._delegate._converter||JL(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ll=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new bu(e)}where(e,t,i){try{return new n(this.firestore,_s(this._delegate,E4(e,t,i)))}catch(r){throw qn(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,_s(this._delegate,C4(e,t)))}catch(i){throw qn(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,_s(this._delegate,T4(e)))}catch(t){throw qn(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,_s(this._delegate,x4(e)))}catch(t){throw qn(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,_s(this._delegate,I4(...e)))}catch(t){throw qn(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,_s(this._delegate,k4(...e)))}catch(t){throw qn(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,_s(this._delegate,A4(...e)))}catch(t){throw qn(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,_s(this._delegate,D4(...e)))}catch(t){throw qn(t,"endAt()","Query.endAt()")}}isEqual(e){return JT(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=F4(this._delegate):e?.source==="server"?t=B4(this._delegate):t=L4(this._delegate),t.then(i=>new vf(this.firestore,new hr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=Q4(e),i=X4(e,r=>new vf(this.firestore,new hr(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return ox(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Eu.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},ux=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new al(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},vf=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ll(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new al(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new ux(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new al(this._firestore,i))})}isEqual(e){return ix(this._delegate,e._delegate)}},Cu=class n extends ll{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Kr(this.firestore,e):null}doc(e){try{return e===void 0?new Kr(this.firestore,yf(this._delegate)):new Kr(this.firestore,yf(this._delegate,e))}catch(t){throw qn(t,"doc()","CollectionReference.doc()")}}add(e){return q4(this._delegate,e).then(t=>new Kr(this.firestore,t))}isEqual(e){return XT(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Eu.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function sl(n){return Je(n,gt)}var dx=class n{constructor(...e){this._delegate=new dr(...e)}static documentId(){return new n(Ht.keyField().canonicalString())}isEqual(e){return e=We(e),e instanceof dr?this._delegate._internalPath.isEqual(e._internalPath):!1}};var hx=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=j4();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=$4();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=G4(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=H4(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=W4(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var ine={Firestore:Sy,GeoPoint:Ja,Timestamp:Mt,Blob:wy,Transaction:by,WriteBatch:Ey,DocumentReference:Kr,DocumentSnapshot:ol,Query:ll,QueryDocumentSnapshot:al,QuerySnapshot:vf,CollectionReference:Cu,FieldPath:dx,FieldValue:hx,setLogLevel:nne,CACHE_SIZE_UNLIMITED:r4};function rne(n,e){n.INTERNAL.registerComponent(new ri("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},ine)))}function sne(n){rne(n,(e,t)=>new Sy(e,t,new cx)),n.registerVersion(Zte,ene,"node")}sne(dn);function one(n,e=fl){return new Es(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function J4(n,e){return one(n,e)}function ane(n,e){return J4(n,e).pipe(Tf(void 0),Cf(),vt(t=>{let[i,r]=t;return r.exists?i?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function gx(n,e){return J4(n,e).pipe(vt(t=>({payload:t,type:"query"})))}var Cy=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:r,query:s}=iB(i,t);return new xy(r,s,this.afs)}snapshotChanges(){return ane(this.ref,this.afs.schedulers.outsideAngular).pipe(zt)}valueChanges(e={}){return this.snapshotChanges().pipe(vt(({payload:t})=>e.idField?Sn(ht({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Cs(this.ref.get(e)).pipe(zt)}};function Ty(n,e){return gx(n,e).pipe(Tf(void 0),Cf(),vt(t=>{let[i,r]=t,s=r.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=i?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function Z4(n,e,t){return Ty(n,t).pipe(ea((i,r)=>lne(i,r.map(s=>s.payload),e),[]),Ef(),vt(i=>i.map(r=>({type:r.type,payload:r}))))}function lne(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=cne(n,i))}),n}function px(n,e,t,...i){let r=n.slice();return r.splice(e,t,...i),r}function cne(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return px(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return px(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return px(n,e.oldIndex,1);break}return n}function eB(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var xy=class{ref;query;afs;constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=Ty(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(vt(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(Tf(void 0),Cf(),Zo(([i,r])=>r.length>0||!i),vt(([,i])=>i),zt)}auditTrail(e){return this.stateChanges(e).pipe(ea((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=eB(e);return Z4(this.query,t,this.afs.schedulers.outsideAngular).pipe(zt)}valueChanges(e={}){return gx(this.query,this.afs.schedulers.outsideAngular).pipe(vt(t=>t.payload.docs.map(i=>e.idField?Sn(ht({},i.data()),{[e.idField]:i.id}):i.data())),zt)}get(e){return Cs(this.query.get(e)).pipe(zt)}add(e){return this.ref.add(e)}doc(e){return new Cy(this.ref.doc(e),this.afs)}},mx=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Ty(this.query,this.afs.schedulers.outsideAngular).pipe(zt):Ty(this.query,this.afs.schedulers.outsideAngular).pipe(vt(t=>t.filter(i=>e.indexOf(i.type)>-1)),Zo(t=>t.length>0),zt)}auditTrail(e){return this.stateChanges(e).pipe(ea((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=eB(e);return Z4(this.query,t,this.afs.schedulers.outsideAngular).pipe(zt)}valueChanges(e={}){return gx(this.query,this.afs.schedulers.outsideAngular).pipe(vt(i=>i.payload.docs.map(r=>e.idField?ht({[e.idField]:r.id},r.data()):r.data())),zt)}get(e){return Cs(this.query.get(e)).pipe(zt)}},tB=new ln("angularfire2.enableFirestorePersistence"),nB=new ln("angularfire2.firestore.persistenceSettings"),une=new ln("angularfire2.firestore.settings"),dne=new ln("angularfire2.firestore.use-emulator");function iB(n,e=t=>t){return{query:e(n),ref:n}}var hne=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,i,r,s,o,a,l,c,u,d,h,f,g,_,S,I,E){this.schedulers=l;let b=ia(t,a,i),M=u;d&&Yu(b,a,h,g,_,S,f,I),[this.firestore,this.persistenceEnabled$]=El(`${b.name}.firestore`,"AngularFirestore",b.name,()=>{let N=a.runOutsideAngular(()=>b.firestore());if(s&&N.settings(s),M&&N.useEmulator(...M),r&&!Rf(o)){let U=()=>{try{return Cs(N.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(R){return typeof console<"u"&&console.warn(R),yi(!1)}};return[N,a.runOutsideAngular(U)]}else return[N,yi(!1)]},[s,M,r])}collection(t,i){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=iB(r,i),a=this.schedulers.ngZone.run(()=>s);return new xy(a,o,this)}collectionGroup(t,i){let r=i||(o=>o),s=this.firestore.collectionGroup(t);return new mx(r(s),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let r=this.schedulers.ngZone.run(()=>i);return new Cy(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(be(Ps),be(Rs,8),be(tB,8),be(une,8),be(bn),be(Vn),be(bl),be(nB,8),be(dne,8),be(Jf,8),be($u,8),be(ju,8),be(Gu,8),be(Hu,8),be(Wu,8),be(Ku,8),be(Zr,8))};static \u0275prov=at({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),rB=(()=>{class n{constructor(){dn.registerVersion("angularfire",Ds.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:tB,useValue:!0},{provide:nB,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=xs({type:n});static \u0275inj=Ts({providers:[hne]})}return n})();var en=(()=>{let e=class e{constructor(){this._HttpClient=H($n)}getMovies(i,r){return this._HttpClient.get(`${te.url}movie/${i}?api_key=${te.apiKey}&page=${r}`)}getPopularPeople(i,r){return this._HttpClient.get(`${te.url}person/popular?api_key=${te.apiKey}&page=${r}`)}getPopularMovies(i){return this._HttpClient.get(`${te.url}movie/popular?api_key=${te.apiKey}&page=${i}`)}getTrendingShows(i,r,s){return i=i||"movie",r=r||"day",s=s||1,this._HttpClient.get(`${te.url}trending/${i}/${r}?api_key=${te.apiKey}&page=${s}`)}getMovieGenres(){return this._HttpClient.get(`${te.url}genre/movie/list?api_key=${te.apiKey}`)}getTvGenres(){return this._HttpClient.get(`${te.url}genre/tv/list?api_key=${te.apiKey}`)}getNowPLayingMovies(){return this._HttpClient.get(`${te.url}movie/now_playing?api_key=${te.apiKey}&language=en-US&page=1`)}getTopRatedMovies(){return this._HttpClient.get(`${te.url}movie/top_rated?api_key=${te.apiKey}&language=en-US&page=1`)}getUpcomingMovies(){return this._HttpClient.get(`${te.url}movie/upcoming?api_key=${te.apiKey}&language=en-US&page=1`)}getShowDetails(i,r){return this._HttpClient.get(`${te.url}${r}/${i}?api_key=${te.apiKey}`)}getShowTrailers(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/videos?api_key=${te.apiKey}`)}getMovieCredits(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/credits?api_key=${te.apiKey}`)}getShowCredits(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/aggregate_credits?api_key=${te.apiKey}`)}getShowImages(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/images?api_key=${te.apiKey}`)}getShowVideos(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/videos?api_key=${te.apiKey}`)}getShowRecommendations(i,r,s){return this._HttpClient.get(`${te.url}${r}/${i}/recommendations?api_key=${te.apiKey}&page=${s}`)}getShowReviews(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/reviews?api_key=${te.apiKey}`)}getShowExternalIDs(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/external_ids?api_key=${te.apiKey}`)}getShowSimilar(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/similar?api_key=${te.apiKey}`)}getShowLists(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/lists?api_key=${te.apiKey}`)}getShowKeywords(i,r){return this._HttpClient.get(`${te.url}${r}/${i}/keywords?api_key=${te.apiKey}`)}getCollection(i){return this._HttpClient.get(`${te.url}collection/${i}?api_key=${te.apiKey}`)}getNetworkDetails(i){return this._HttpClient.get(`${te.url}network/${i}?api_key=${te.apiKey}`)}getKeywordDetails(i,r){return this._HttpClient.get(`${te.url}discover/${r}?api_key=${te.apiKey}&with_keywords=${i}`)}getSeasonDetails(i,r){return this._HttpClient.get(`${te.url}tv/${i}/season/${r}?api_key=${te.apiKey}`)}discoverMovies(i=28,r=2024,s="popularity",o="desc"){return this._HttpClient.get(`${te.url}discover/movie?api_key=${te.apiKey}&primary_release_year=${r}&with_genres=${i}&sort_by=${s}.${o}`)}discoverShows(i=28,r=2024,s="popularity",o="desc"){return this._HttpClient.get(`${te.url}discover/movie?api_key=${te.apiKey}&first_air_date_year=${r}&with_genres=${i}&sort_by=${s}.${o}`)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function sB(n){return n!==null&&typeof n=="object"&&"constructor"in n&&n.constructor===Object}function yx(n,e){n===void 0&&(n={}),e===void 0&&(e={}),Object.keys(e).forEach(t=>{typeof n[t]>"u"?n[t]=e[t]:sB(e[t])&&sB(n[t])&&Object.keys(e[t]).length>0&&yx(n[t],e[t])})}var oB={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function yt(){let n=typeof document<"u"?document:{};return yx(n,oB),n}var fne={document:oB,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(n){return typeof setTimeout>"u"?(n(),null):setTimeout(n,0)},cancelAnimationFrame(n){typeof setTimeout>"u"||clearTimeout(n)}};function ot(){let n=typeof window<"u"?window:{};return yx(n,fne),n}function ws(n){return n===void 0&&(n=""),n.trim().split(" ").filter(e=>!!e.trim())}function aB(n){let e=n;Object.keys(e).forEach(t=>{try{e[t]=null}catch{}try{delete e[t]}catch{}})}function fr(n,e){return e===void 0&&(e=0),setTimeout(n,e)}function zn(){return Date.now()}function pne(n){let e=ot(),t;return e.getComputedStyle&&(t=e.getComputedStyle(n,null)),!t&&n.currentStyle&&(t=n.currentStyle),t||(t=n.style),t}function _f(n,e){e===void 0&&(e="x");let t=ot(),i,r,s,o=pne(n);return t.WebKitCSSMatrix?(r=o.transform||o.webkitTransform,r.split(",").length>6&&(r=r.split(", ").map(a=>a.replace(",",".")).join(", ")),s=new t.WebKitCSSMatrix(r==="none"?"":r)):(s=o.MozTransform||o.OTransform||o.MsTransform||o.msTransform||o.transform||o.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),i=s.toString().split(",")),e==="x"&&(t.WebKitCSSMatrix?r=s.m41:i.length===16?r=parseFloat(i[12]):r=parseFloat(i[4])),e==="y"&&(t.WebKitCSSMatrix?r=s.m42:i.length===16?r=parseFloat(i[13]):r=parseFloat(i[5])),r||0}function Tu(n){return typeof n=="object"&&n!==null&&n.constructor&&Object.prototype.toString.call(n).slice(8,-1)==="Object"}function mne(n){return typeof window<"u"&&typeof window.HTMLElement<"u"?n instanceof HTMLElement:n&&(n.nodeType===1||n.nodeType===11)}function Zn(){let n=Object(arguments.length<=0?void 0:arguments[0]),e=["__proto__","constructor","prototype"];for(let t=1;t<arguments.length;t+=1){let i=t<0||arguments.length<=t?void 0:arguments[t];if(i!=null&&!mne(i)){let r=Object.keys(Object(i)).filter(s=>e.indexOf(s)<0);for(let s=0,o=r.length;s<o;s+=1){let a=r[s],l=Object.getOwnPropertyDescriptor(i,a);l!==void 0&&l.enumerable&&(Tu(n[a])&&Tu(i[a])?i[a].__swiper__?n[a]=i[a]:Zn(n[a],i[a]):!Tu(n[a])&&Tu(i[a])?(n[a]={},i[a].__swiper__?n[a]=i[a]:Zn(n[a],i[a])):n[a]=i[a])}}}return n}function cl(n,e,t){n.style.setProperty(e,t)}function vx(n){let{swiper:e,targetPosition:t,side:i}=n,r=ot(),s=-e.translate,o=null,a,l=e.params.speed;e.wrapperEl.style.scrollSnapType="none",r.cancelAnimationFrame(e.cssModeFrameID);let c=t>s?"next":"prev",u=(h,f)=>c==="next"&&h>=f||c==="prev"&&h<=f,d=()=>{a=new Date().getTime(),o===null&&(o=a);let h=Math.max(Math.min((a-o)/l,1),0),f=.5-Math.cos(h*Math.PI)/2,g=s+f*(t-s);if(u(g,t)&&(g=t),e.wrapperEl.scrollTo({[i]:g}),u(g,t)){e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout(()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[i]:g})}),r.cancelAnimationFrame(e.cssModeFrameID);return}e.cssModeFrameID=r.requestAnimationFrame(d)};d()}function ei(n){return n.querySelector(".swiper-slide-transform")||n.shadowRoot&&n.shadowRoot.querySelector(".swiper-slide-transform")||n}function At(n,e){e===void 0&&(e="");let t=[...n.children];return n instanceof HTMLSlotElement&&t.push(...n.assignedElements()),e?t.filter(i=>i.matches(e)):t}function lB(n,e){let t=e.contains(n);return!t&&e instanceof HTMLSlotElement?[...e.assignedElements()].includes(n):t}function wf(n){try{console.warn(n);return}catch{}}function tn(n,e){e===void 0&&(e=[]);let t=document.createElement(n);return t.classList.add(...Array.isArray(e)?e:ws(e)),t}function ul(n){let e=ot(),t=yt(),i=n.getBoundingClientRect(),r=t.body,s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,a=n===e?e.scrollY:n.scrollTop,l=n===e?e.scrollX:n.scrollLeft;return{top:i.top+a-s,left:i.left+l-o}}function cB(n,e){let t=[];for(;n.previousElementSibling;){let i=n.previousElementSibling;e?i.matches(e)&&t.push(i):t.push(i),n=i}return t}function uB(n,e){let t=[];for(;n.nextElementSibling;){let i=n.nextElementSibling;e?i.matches(e)&&t.push(i):t.push(i),n=i}return t}function Ss(n,e){return ot().getComputedStyle(n,null).getPropertyValue(e)}function $o(n){let e=n,t;if(e){for(t=0;(e=e.previousSibling)!==null;)e.nodeType===1&&(t+=1);return t}}function pr(n,e){let t=[],i=n.parentElement;for(;i;)e?i.matches(e)&&t.push(i):t.push(i),i=i.parentElement;return t}function jo(n,e){function t(i){i.target===n&&(e.call(n,i),n.removeEventListener("transitionend",t))}e&&n.addEventListener("transitionend",t)}function Sf(n,e,t){let i=ot();return t?n[e==="width"?"offsetWidth":"offsetHeight"]+parseFloat(i.getComputedStyle(n,null).getPropertyValue(e==="width"?"margin-right":"margin-top"))+parseFloat(i.getComputedStyle(n,null).getPropertyValue(e==="width"?"margin-left":"margin-bottom")):n.offsetWidth}function Ue(n){return(Array.isArray(n)?n:[n]).filter(e=>!!e)}function Go(n){return e=>Math.abs(e)>0&&n.browser&&n.browser.need3dFix&&Math.abs(e)%90===0?e+.001:e}var _x;function gne(){let n=ot(),e=yt();return{smoothScroll:e.documentElement&&e.documentElement.style&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in n||n.DocumentTouch&&e instanceof n.DocumentTouch)}}function mB(){return _x||(_x=gne()),_x}var wx;function yne(n){let{userAgent:e}=n===void 0?{}:n,t=mB(),i=ot(),r=i.navigator.platform,s=e||i.navigator.userAgent,o={ios:!1,android:!1},a=i.screen.width,l=i.screen.height,c=s.match(/(Android);?[\s\/]+([\d.]+)?/),u=s.match(/(iPad).*OS\s([\d_]+)/),d=s.match(/(iPod)(.*OS\s([\d_]+))?/),h=!u&&s.match(/(iPhone\sOS|iOS)\s([\d_]+)/),f=r==="Win32",g=r==="MacIntel",_=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!u&&g&&t.touch&&_.indexOf(`${a}x${l}`)>=0&&(u=s.match(/(Version)\/([\d.]+)/),u||(u=[0,1,"13_0_0"]),g=!1),c&&!f&&(o.os="android",o.android=!0),(u||h||d)&&(o.os="ios",o.ios=!0),o}function gB(n){return n===void 0&&(n={}),wx||(wx=yne(n)),wx}var Sx;function vne(){let n=ot(),e=gB(),t=!1;function i(){let a=n.navigator.userAgent.toLowerCase();return a.indexOf("safari")>=0&&a.indexOf("chrome")<0&&a.indexOf("android")<0}if(i()){let a=String(n.navigator.userAgent);if(a.includes("Version/")){let[l,c]=a.split("Version/")[1].split(" ")[0].split(".").map(u=>Number(u));t=l<16||l===16&&c<2}}let r=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(n.navigator.userAgent),s=i(),o=s||r&&e.ios;return{isSafari:t||s,needPerspectiveFix:t,need3dFix:o,isWebView:r}}function _ne(){return Sx||(Sx=vne()),Sx}function wne(n){let{swiper:e,on:t,emit:i}=n,r=ot(),s=null,o=null,a=()=>{!e||e.destroyed||!e.initialized||(i("beforeResize"),i("resize"))},l=()=>{!e||e.destroyed||!e.initialized||(s=new ResizeObserver(d=>{o=r.requestAnimationFrame(()=>{let{width:h,height:f}=e,g=h,_=f;d.forEach(S=>{let{contentBoxSize:I,contentRect:E,target:b}=S;b&&b!==e.el||(g=E?E.width:(I[0]||I).inlineSize,_=E?E.height:(I[0]||I).blockSize)}),(g!==h||_!==f)&&a()})}),s.observe(e.el))},c=()=>{o&&r.cancelAnimationFrame(o),s&&s.unobserve&&e.el&&(s.unobserve(e.el),s=null)},u=()=>{!e||e.destroyed||!e.initialized||i("orientationchange")};t("init",()=>{if(e.params.resizeObserver&&typeof r.ResizeObserver<"u"){l();return}r.addEventListener("resize",a),r.addEventListener("orientationchange",u)}),t("destroy",()=>{c(),r.removeEventListener("resize",a),r.removeEventListener("orientationchange",u)})}function Sne(n){let{swiper:e,extendParams:t,on:i,emit:r}=n,s=[],o=ot(),a=function(u,d){d===void 0&&(d={});let h=o.MutationObserver||o.WebkitMutationObserver,f=new h(g=>{if(e.__preventObserver__)return;if(g.length===1){r("observerUpdate",g[0]);return}let _=function(){r("observerUpdate",g[0])};o.requestAnimationFrame?o.requestAnimationFrame(_):o.setTimeout(_,0)});f.observe(u,{attributes:typeof d.attributes>"u"?!0:d.attributes,childList:e.isElement||(typeof d.childList>"u"?!0:d).childList,characterData:typeof d.characterData>"u"?!0:d.characterData}),s.push(f)},l=()=>{if(e.params.observer){if(e.params.observeParents){let u=pr(e.hostEl);for(let d=0;d<u.length;d+=1)a(u[d])}a(e.hostEl,{childList:e.params.observeSlideChildren}),a(e.wrapperEl,{attributes:!1})}},c=()=>{s.forEach(u=>{u.disconnect()}),s.splice(0,s.length)};t({observer:!1,observeParents:!1,observeSlideChildren:!1}),i("init",l),i("destroy",c)}var bne={on(n,e,t){let i=this;if(!i.eventsListeners||i.destroyed||typeof e!="function")return i;let r=t?"unshift":"push";return n.split(" ").forEach(s=>{i.eventsListeners[s]||(i.eventsListeners[s]=[]),i.eventsListeners[s][r](e)}),i},once(n,e,t){let i=this;if(!i.eventsListeners||i.destroyed||typeof e!="function")return i;function r(){i.off(n,r),r.__emitterProxy&&delete r.__emitterProxy;for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];e.apply(i,o)}return r.__emitterProxy=e,i.on(n,r,t)},onAny(n,e){let t=this;if(!t.eventsListeners||t.destroyed||typeof n!="function")return t;let i=e?"unshift":"push";return t.eventsAnyListeners.indexOf(n)<0&&t.eventsAnyListeners[i](n),t},offAny(n){let e=this;if(!e.eventsListeners||e.destroyed||!e.eventsAnyListeners)return e;let t=e.eventsAnyListeners.indexOf(n);return t>=0&&e.eventsAnyListeners.splice(t,1),e},off(n,e){let t=this;return!t.eventsListeners||t.destroyed||!t.eventsListeners||n.split(" ").forEach(i=>{typeof e>"u"?t.eventsListeners[i]=[]:t.eventsListeners[i]&&t.eventsListeners[i].forEach((r,s)=>{(r===e||r.__emitterProxy&&r.__emitterProxy===e)&&t.eventsListeners[i].splice(s,1)})}),t},emit(){let n=this;if(!n.eventsListeners||n.destroyed||!n.eventsListeners)return n;let e,t,i;for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return typeof s[0]=="string"||Array.isArray(s[0])?(e=s[0],t=s.slice(1,s.length),i=n):(e=s[0].events,t=s[0].data,i=s[0].context||n),t.unshift(i),(Array.isArray(e)?e:e.split(" ")).forEach(l=>{n.eventsAnyListeners&&n.eventsAnyListeners.length&&n.eventsAnyListeners.forEach(c=>{c.apply(i,[l,...t])}),n.eventsListeners&&n.eventsListeners[l]&&n.eventsListeners[l].forEach(c=>{c.apply(i,t)})}),n}};function Ene(){let n=this,e,t,i=n.el;typeof n.params.width<"u"&&n.params.width!==null?e=n.params.width:e=i.clientWidth,typeof n.params.height<"u"&&n.params.height!==null?t=n.params.height:t=i.clientHeight,!(e===0&&n.isHorizontal()||t===0&&n.isVertical())&&(e=e-parseInt(Ss(i,"padding-left")||0,10)-parseInt(Ss(i,"padding-right")||0,10),t=t-parseInt(Ss(i,"padding-top")||0,10)-parseInt(Ss(i,"padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Object.assign(n,{width:e,height:t,size:n.isHorizontal()?e:t}))}function Cne(){let n=this;function e(A,C){return parseFloat(A.getPropertyValue(n.getDirectionLabel(C))||0)}let t=n.params,{wrapperEl:i,slidesEl:r,size:s,rtlTranslate:o,wrongRTL:a}=n,l=n.virtual&&t.virtual.enabled,c=l?n.virtual.slides.length:n.slides.length,u=At(r,`.${n.params.slideClass}, swiper-slide`),d=l?n.virtual.slides.length:u.length,h=[],f=[],g=[],_=t.slidesOffsetBefore;typeof _=="function"&&(_=t.slidesOffsetBefore.call(n));let S=t.slidesOffsetAfter;typeof S=="function"&&(S=t.slidesOffsetAfter.call(n));let I=n.snapGrid.length,E=n.slidesGrid.length,b=t.spaceBetween,M=-_,N=0,U=0;if(typeof s>"u")return;typeof b=="string"&&b.indexOf("%")>=0?b=parseFloat(b.replace("%",""))/100*s:typeof b=="string"&&(b=parseFloat(b)),n.virtualSize=-b,u.forEach(A=>{o?A.style.marginLeft="":A.style.marginRight="",A.style.marginBottom="",A.style.marginTop=""}),t.centeredSlides&&t.cssMode&&(cl(i,"--swiper-centered-offset-before",""),cl(i,"--swiper-centered-offset-after",""));let R=t.grid&&t.grid.rows>1&&n.grid;R?n.grid.initSlides(u):n.grid&&n.grid.unsetSlides();let x,T=t.slidesPerView==="auto"&&t.breakpoints&&Object.keys(t.breakpoints).filter(A=>typeof t.breakpoints[A].slidesPerView<"u").length>0;for(let A=0;A<d;A+=1){x=0;let C;if(u[A]&&(C=u[A]),R&&n.grid.updateSlide(A,C,u),!(u[A]&&Ss(C,"display")==="none")){if(t.slidesPerView==="auto"){T&&(u[A].style[n.getDirectionLabel("width")]="");let P=getComputedStyle(C),y=C.style.transform,w=C.style.webkitTransform;if(y&&(C.style.transform="none"),w&&(C.style.webkitTransform="none"),t.roundLengths)x=n.isHorizontal()?Sf(C,"width",!0):Sf(C,"height",!0);else{let F=e(P,"width"),Q=e(P,"padding-left"),z=e(P,"padding-right"),V=e(P,"margin-left"),ne=e(P,"margin-right"),ue=P.getPropertyValue("box-sizing");if(ue&&ue==="border-box")x=F+V+ne;else{let{clientWidth:W,offsetWidth:ee}=C;x=F+Q+z+V+ne+(ee-W)}}y&&(C.style.transform=y),w&&(C.style.webkitTransform=w),t.roundLengths&&(x=Math.floor(x))}else x=(s-(t.slidesPerView-1)*b)/t.slidesPerView,t.roundLengths&&(x=Math.floor(x)),u[A]&&(u[A].style[n.getDirectionLabel("width")]=`${x}px`);u[A]&&(u[A].swiperSlideSize=x),g.push(x),t.centeredSlides?(M=M+x/2+N/2+b,N===0&&A!==0&&(M=M-s/2-b),A===0&&(M=M-s/2-b),Math.abs(M)<1/1e3&&(M=0),t.roundLengths&&(M=Math.floor(M)),U%t.slidesPerGroup===0&&h.push(M),f.push(M)):(t.roundLengths&&(M=Math.floor(M)),(U-Math.min(n.params.slidesPerGroupSkip,U))%n.params.slidesPerGroup===0&&h.push(M),f.push(M),M=M+x+b),n.virtualSize+=x+b,N=x,U+=1}}if(n.virtualSize=Math.max(n.virtualSize,s)+S,o&&a&&(t.effect==="slide"||t.effect==="coverflow")&&(i.style.width=`${n.virtualSize+b}px`),t.setWrapperSize&&(i.style[n.getDirectionLabel("width")]=`${n.virtualSize+b}px`),R&&n.grid.updateWrapperSize(x,h),!t.centeredSlides){let A=[];for(let C=0;C<h.length;C+=1){let P=h[C];t.roundLengths&&(P=Math.floor(P)),h[C]<=n.virtualSize-s&&A.push(P)}h=A,Math.floor(n.virtualSize-s)-Math.floor(h[h.length-1])>1&&h.push(n.virtualSize-s)}if(l&&t.loop){let A=g[0]+b;if(t.slidesPerGroup>1){let C=Math.ceil((n.virtual.slidesBefore+n.virtual.slidesAfter)/t.slidesPerGroup),P=A*t.slidesPerGroup;for(let y=0;y<C;y+=1)h.push(h[h.length-1]+P)}for(let C=0;C<n.virtual.slidesBefore+n.virtual.slidesAfter;C+=1)t.slidesPerGroup===1&&h.push(h[h.length-1]+A),f.push(f[f.length-1]+A),n.virtualSize+=A}if(h.length===0&&(h=[0]),b!==0){let A=n.isHorizontal()&&o?"marginLeft":n.getDirectionLabel("marginRight");u.filter((C,P)=>!t.cssMode||t.loop?!0:P!==u.length-1).forEach(C=>{C.style[A]=`${b}px`})}if(t.centeredSlides&&t.centeredSlidesBounds){let A=0;g.forEach(P=>{A+=P+(b||0)}),A-=b;let C=A>s?A-s:0;h=h.map(P=>P<=0?-_:P>C?C+S:P)}if(t.centerInsufficientSlides){let A=0;g.forEach(P=>{A+=P+(b||0)}),A-=b;let C=(t.slidesOffsetBefore||0)+(t.slidesOffsetAfter||0);if(A+C<s){let P=(s-A-C)/2;h.forEach((y,w)=>{h[w]=y-P}),f.forEach((y,w)=>{f[w]=y+P})}}if(Object.assign(n,{slides:u,snapGrid:h,slidesGrid:f,slidesSizesGrid:g}),t.centeredSlides&&t.cssMode&&!t.centeredSlidesBounds){cl(i,"--swiper-centered-offset-before",`${-h[0]}px`),cl(i,"--swiper-centered-offset-after",`${n.size/2-g[g.length-1]/2}px`);let A=-n.snapGrid[0],C=-n.slidesGrid[0];n.snapGrid=n.snapGrid.map(P=>P+A),n.slidesGrid=n.slidesGrid.map(P=>P+C)}if(d!==c&&n.emit("slidesLengthChange"),h.length!==I&&(n.params.watchOverflow&&n.checkOverflow(),n.emit("snapGridLengthChange")),f.length!==E&&n.emit("slidesGridLengthChange"),t.watchSlidesProgress&&n.updateSlidesOffset(),n.emit("slidesUpdated"),!l&&!t.cssMode&&(t.effect==="slide"||t.effect==="fade")){let A=`${t.containerModifierClass}backface-hidden`,C=n.el.classList.contains(A);d<=t.maxBackfaceHiddenSlides?C||n.el.classList.add(A):C&&n.el.classList.remove(A)}}function Tne(n){let e=this,t=[],i=e.virtual&&e.params.virtual.enabled,r=0,s;typeof n=="number"?e.setTransition(n):n===!0&&e.setTransition(e.params.speed);let o=a=>i?e.slides[e.getSlideIndexByData(a)]:e.slides[a];if(e.params.slidesPerView!=="auto"&&e.params.slidesPerView>1)if(e.params.centeredSlides)(e.visibleSlides||[]).forEach(a=>{t.push(a)});else for(s=0;s<Math.ceil(e.params.slidesPerView);s+=1){let a=e.activeIndex+s;if(a>e.slides.length&&!i)break;t.push(o(a))}else t.push(o(e.activeIndex));for(s=0;s<t.length;s+=1)if(typeof t[s]<"u"){let a=t[s].offsetHeight;r=a>r?a:r}(r||r===0)&&(e.wrapperEl.style.height=`${r}px`)}function xne(){let n=this,e=n.slides,t=n.isElement?n.isHorizontal()?n.wrapperEl.offsetLeft:n.wrapperEl.offsetTop:0;for(let i=0;i<e.length;i+=1)e[i].swiperSlideOffset=(n.isHorizontal()?e[i].offsetLeft:e[i].offsetTop)-t-n.cssOverflowAdjustment()}var dB=(n,e,t)=>{e&&!n.classList.contains(t)?n.classList.add(t):!e&&n.classList.contains(t)&&n.classList.remove(t)};function Ine(n){n===void 0&&(n=this&&this.translate||0);let e=this,t=e.params,{slides:i,rtlTranslate:r,snapGrid:s}=e;if(i.length===0)return;typeof i[0].swiperSlideOffset>"u"&&e.updateSlidesOffset();let o=-n;r&&(o=n),e.visibleSlidesIndexes=[],e.visibleSlides=[];let a=t.spaceBetween;typeof a=="string"&&a.indexOf("%")>=0?a=parseFloat(a.replace("%",""))/100*e.size:typeof a=="string"&&(a=parseFloat(a));for(let l=0;l<i.length;l+=1){let c=i[l],u=c.swiperSlideOffset;t.cssMode&&t.centeredSlides&&(u-=i[0].swiperSlideOffset);let d=(o+(t.centeredSlides?e.minTranslate():0)-u)/(c.swiperSlideSize+a),h=(o-s[0]+(t.centeredSlides?e.minTranslate():0)-u)/(c.swiperSlideSize+a),f=-(o-u),g=f+e.slidesSizesGrid[l],_=f>=0&&f<=e.size-e.slidesSizesGrid[l],S=f>=0&&f<e.size-1||g>1&&g<=e.size||f<=0&&g>=e.size;S&&(e.visibleSlides.push(c),e.visibleSlidesIndexes.push(l)),dB(c,S,t.slideVisibleClass),dB(c,_,t.slideFullyVisibleClass),c.progress=r?-d:d,c.originalProgress=r?-h:h}}function kne(n){let e=this;if(typeof n>"u"){let u=e.rtlTranslate?-1:1;n=e&&e.translate&&e.translate*u||0}let t=e.params,i=e.maxTranslate()-e.minTranslate(),{progress:r,isBeginning:s,isEnd:o,progressLoop:a}=e,l=s,c=o;if(i===0)r=0,s=!0,o=!0;else{r=(n-e.minTranslate())/i;let u=Math.abs(n-e.minTranslate())<1,d=Math.abs(n-e.maxTranslate())<1;s=u||r<=0,o=d||r>=1,u&&(r=0),d&&(r=1)}if(t.loop){let u=e.getSlideIndexByData(0),d=e.getSlideIndexByData(e.slides.length-1),h=e.slidesGrid[u],f=e.slidesGrid[d],g=e.slidesGrid[e.slidesGrid.length-1],_=Math.abs(n);_>=h?a=(_-h)/g:a=(_+g-f)/g,a>1&&(a-=1)}Object.assign(e,{progress:r,progressLoop:a,isBeginning:s,isEnd:o}),(t.watchSlidesProgress||t.centeredSlides&&t.autoHeight)&&e.updateSlidesProgress(n),s&&!l&&e.emit("reachBeginning toEdge"),o&&!c&&e.emit("reachEnd toEdge"),(l&&!s||c&&!o)&&e.emit("fromEdge"),e.emit("progress",r)}var bx=(n,e,t)=>{e&&!n.classList.contains(t)?n.classList.add(t):!e&&n.classList.contains(t)&&n.classList.remove(t)};function Ane(){let n=this,{slides:e,params:t,slidesEl:i,activeIndex:r}=n,s=n.virtual&&t.virtual.enabled,o=n.grid&&t.grid&&t.grid.rows>1,a=d=>At(i,`.${t.slideClass}${d}, swiper-slide${d}`)[0],l,c,u;if(s)if(t.loop){let d=r-n.virtual.slidesBefore;d<0&&(d=n.virtual.slides.length+d),d>=n.virtual.slides.length&&(d-=n.virtual.slides.length),l=a(`[data-swiper-slide-index="${d}"]`)}else l=a(`[data-swiper-slide-index="${r}"]`);else o?(l=e.filter(d=>d.column===r)[0],u=e.filter(d=>d.column===r+1)[0],c=e.filter(d=>d.column===r-1)[0]):l=e[r];l&&(o||(u=uB(l,`.${t.slideClass}, swiper-slide`)[0],t.loop&&!u&&(u=e[0]),c=cB(l,`.${t.slideClass}, swiper-slide`)[0],t.loop&&!c===0&&(c=e[e.length-1]))),e.forEach(d=>{bx(d,d===l,t.slideActiveClass),bx(d,d===u,t.slideNextClass),bx(d,d===c,t.slidePrevClass)}),n.emitSlidesClasses()}var Iy=(n,e)=>{if(!n||n.destroyed||!n.params)return;let t=()=>n.isElement?"swiper-slide":`.${n.params.slideClass}`,i=e.closest(t());if(i){let r=i.querySelector(`.${n.params.lazyPreloaderClass}`);!r&&n.isElement&&(i.shadowRoot?r=i.shadowRoot.querySelector(`.${n.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{i.shadowRoot&&(r=i.shadowRoot.querySelector(`.${n.params.lazyPreloaderClass}`),r&&r.remove())})),r&&r.remove()}},Ex=(n,e)=>{if(!n.slides[e])return;let t=n.slides[e].querySelector('[loading="lazy"]');t&&t.removeAttribute("loading")},xx=n=>{if(!n||n.destroyed||!n.params)return;let e=n.params.lazyPreloadPrevNext,t=n.slides.length;if(!t||!e||e<0)return;e=Math.min(e,t);let i=n.params.slidesPerView==="auto"?n.slidesPerViewDynamic():Math.ceil(n.params.slidesPerView),r=n.activeIndex;if(n.params.grid&&n.params.grid.rows>1){let o=r,a=[o-e];a.push(...Array.from({length:e}).map((l,c)=>o+i+c)),n.slides.forEach((l,c)=>{a.includes(l.column)&&Ex(n,c)});return}let s=r+i-1;if(n.params.rewind||n.params.loop)for(let o=r-e;o<=s+e;o+=1){let a=(o%t+t)%t;(a<r||a>s)&&Ex(n,a)}else for(let o=Math.max(r-e,0);o<=Math.min(s+e,t-1);o+=1)o!==r&&(o>s||o<r)&&Ex(n,o)};function Dne(n){let{slidesGrid:e,params:t}=n,i=n.rtlTranslate?n.translate:-n.translate,r;for(let s=0;s<e.length;s+=1)typeof e[s+1]<"u"?i>=e[s]&&i<e[s+1]-(e[s+1]-e[s])/2?r=s:i>=e[s]&&i<e[s+1]&&(r=s+1):i>=e[s]&&(r=s);return t.normalizeSlideIndex&&(r<0||typeof r>"u")&&(r=0),r}function Pne(n){let e=this,t=e.rtlTranslate?e.translate:-e.translate,{snapGrid:i,params:r,activeIndex:s,realIndex:o,snapIndex:a}=e,l=n,c,u=f=>{let g=f-e.virtual.slidesBefore;return g<0&&(g=e.virtual.slides.length+g),g>=e.virtual.slides.length&&(g-=e.virtual.slides.length),g};if(typeof l>"u"&&(l=Dne(e)),i.indexOf(t)>=0)c=i.indexOf(t);else{let f=Math.min(r.slidesPerGroupSkip,l);c=f+Math.floor((l-f)/r.slidesPerGroup)}if(c>=i.length&&(c=i.length-1),l===s&&!e.params.loop){c!==a&&(e.snapIndex=c,e.emit("snapIndexChange"));return}if(l===s&&e.params.loop&&e.virtual&&e.params.virtual.enabled){e.realIndex=u(l);return}let d=e.grid&&r.grid&&r.grid.rows>1,h;if(e.virtual&&r.virtual.enabled&&r.loop)h=u(l);else if(d){let f=e.slides.filter(_=>_.column===l)[0],g=parseInt(f.getAttribute("data-swiper-slide-index"),10);Number.isNaN(g)&&(g=Math.max(e.slides.indexOf(f),0)),h=Math.floor(g/r.grid.rows)}else if(e.slides[l]){let f=e.slides[l].getAttribute("data-swiper-slide-index");f?h=parseInt(f,10):h=l}else h=l;Object.assign(e,{previousSnapIndex:a,snapIndex:c,previousRealIndex:o,realIndex:h,previousIndex:s,activeIndex:l}),e.initialized&&xx(e),e.emit("activeIndexChange"),e.emit("snapIndexChange"),(e.initialized||e.params.runCallbacksOnInit)&&(o!==h&&e.emit("realIndexChange"),e.emit("slideChange"))}function Rne(n,e){let t=this,i=t.params,r=n.closest(`.${i.slideClass}, swiper-slide`);!r&&t.isElement&&e&&e.length>1&&e.includes(n)&&[...e.slice(e.indexOf(n)+1,e.length)].forEach(a=>{!r&&a.matches&&a.matches(`.${i.slideClass}, swiper-slide`)&&(r=a)});let s=!1,o;if(r){for(let a=0;a<t.slides.length;a+=1)if(t.slides[a]===r){s=!0,o=a;break}}if(r&&s)t.clickedSlide=r,t.virtual&&t.params.virtual.enabled?t.clickedIndex=parseInt(r.getAttribute("data-swiper-slide-index"),10):t.clickedIndex=o;else{t.clickedSlide=void 0,t.clickedIndex=void 0;return}i.slideToClickedSlide&&t.clickedIndex!==void 0&&t.clickedIndex!==t.activeIndex&&t.slideToClickedSlide()}var Mne={updateSize:Ene,updateSlides:Cne,updateAutoHeight:Tne,updateSlidesOffset:xne,updateSlidesProgress:Ine,updateProgress:kne,updateSlidesClasses:Ane,updateActiveIndex:Pne,updateClickedSlide:Rne};function One(n){n===void 0&&(n=this.isHorizontal()?"x":"y");let e=this,{params:t,rtlTranslate:i,translate:r,wrapperEl:s}=e;if(t.virtualTranslate)return i?-r:r;if(t.cssMode)return r;let o=_f(s,n);return o+=e.cssOverflowAdjustment(),i&&(o=-o),o||0}function Nne(n,e){let t=this,{rtlTranslate:i,params:r,wrapperEl:s,progress:o}=t,a=0,l=0,c=0;t.isHorizontal()?a=i?-n:n:l=n,r.roundLengths&&(a=Math.floor(a),l=Math.floor(l)),t.previousTranslate=t.translate,t.translate=t.isHorizontal()?a:l,r.cssMode?s[t.isHorizontal()?"scrollLeft":"scrollTop"]=t.isHorizontal()?-a:-l:r.virtualTranslate||(t.isHorizontal()?a-=t.cssOverflowAdjustment():l-=t.cssOverflowAdjustment(),s.style.transform=`translate3d(${a}px, ${l}px, ${c}px)`);let u,d=t.maxTranslate()-t.minTranslate();d===0?u=0:u=(n-t.minTranslate())/d,u!==o&&t.updateProgress(n),t.emit("setTranslate",t.translate,e)}function Lne(){return-this.snapGrid[0]}function Fne(){return-this.snapGrid[this.snapGrid.length-1]}function Bne(n,e,t,i,r){n===void 0&&(n=0),e===void 0&&(e=this.params.speed),t===void 0&&(t=!0),i===void 0&&(i=!0);let s=this,{params:o,wrapperEl:a}=s;if(s.animating&&o.preventInteractionOnTransition)return!1;let l=s.minTranslate(),c=s.maxTranslate(),u;if(i&&n>l?u=l:i&&n<c?u=c:u=n,s.updateProgress(u),o.cssMode){let d=s.isHorizontal();if(e===0)a[d?"scrollLeft":"scrollTop"]=-u;else{if(!s.support.smoothScroll)return vx({swiper:s,targetPosition:-u,side:d?"left":"top"}),!0;a.scrollTo({[d?"left":"top"]:-u,behavior:"smooth"})}return!0}return e===0?(s.setTransition(0),s.setTranslate(u),t&&(s.emit("beforeTransitionStart",e,r),s.emit("transitionEnd"))):(s.setTransition(e),s.setTranslate(u),t&&(s.emit("beforeTransitionStart",e,r),s.emit("transitionStart")),s.animating||(s.animating=!0,s.onTranslateToWrapperTransitionEnd||(s.onTranslateToWrapperTransitionEnd=function(h){!s||s.destroyed||h.target===this&&(s.wrapperEl.removeEventListener("transitionend",s.onTranslateToWrapperTransitionEnd),s.onTranslateToWrapperTransitionEnd=null,delete s.onTranslateToWrapperTransitionEnd,s.animating=!1,t&&s.emit("transitionEnd"))}),s.wrapperEl.addEventListener("transitionend",s.onTranslateToWrapperTransitionEnd))),!0}var Une={getTranslate:One,setTranslate:Nne,minTranslate:Lne,maxTranslate:Fne,translateTo:Bne};function qne(n,e){let t=this;t.params.cssMode||(t.wrapperEl.style.transitionDuration=`${n}ms`,t.wrapperEl.style.transitionDelay=n===0?"0ms":""),t.emit("setTransition",n,e)}function yB(n){let{swiper:e,runCallbacks:t,direction:i,step:r}=n,{activeIndex:s,previousIndex:o}=e,a=i;if(a||(s>o?a="next":s<o?a="prev":a="reset"),e.emit(`transition${r}`),t&&s!==o){if(a==="reset"){e.emit(`slideResetTransition${r}`);return}e.emit(`slideChangeTransition${r}`),a==="next"?e.emit(`slideNextTransition${r}`):e.emit(`slidePrevTransition${r}`)}}function zne(n,e){n===void 0&&(n=!0);let t=this,{params:i}=t;i.cssMode||(i.autoHeight&&t.updateAutoHeight(),yB({swiper:t,runCallbacks:n,direction:e,step:"Start"}))}function Vne(n,e){n===void 0&&(n=!0);let t=this,{params:i}=t;t.animating=!1,!i.cssMode&&(t.setTransition(0),yB({swiper:t,runCallbacks:n,direction:e,step:"End"}))}var $ne={setTransition:qne,transitionStart:zne,transitionEnd:Vne};function jne(n,e,t,i,r){n===void 0&&(n=0),t===void 0&&(t=!0),typeof n=="string"&&(n=parseInt(n,10));let s=this,o=n;o<0&&(o=0);let{params:a,snapGrid:l,slidesGrid:c,previousIndex:u,activeIndex:d,rtlTranslate:h,wrapperEl:f,enabled:g}=s;if(!g&&!i&&!r||s.destroyed||s.animating&&a.preventInteractionOnTransition)return!1;typeof e>"u"&&(e=s.params.speed);let _=Math.min(s.params.slidesPerGroupSkip,o),S=_+Math.floor((o-_)/s.params.slidesPerGroup);S>=l.length&&(S=l.length-1);let I=-l[S];if(a.normalizeSlideIndex)for(let N=0;N<c.length;N+=1){let U=-Math.floor(I*100),R=Math.floor(c[N]*100),x=Math.floor(c[N+1]*100);typeof c[N+1]<"u"?U>=R&&U<x-(x-R)/2?o=N:U>=R&&U<x&&(o=N+1):U>=R&&(o=N)}if(s.initialized&&o!==d&&(!s.allowSlideNext&&(h?I>s.translate&&I>s.minTranslate():I<s.translate&&I<s.minTranslate())||!s.allowSlidePrev&&I>s.translate&&I>s.maxTranslate()&&(d||0)!==o))return!1;o!==(u||0)&&t&&s.emit("beforeSlideChangeStart"),s.updateProgress(I);let E;o>d?E="next":o<d?E="prev":E="reset";let b=s.virtual&&s.params.virtual.enabled;if(!(b&&r)&&(h&&-I===s.translate||!h&&I===s.translate))return s.updateActiveIndex(o),a.autoHeight&&s.updateAutoHeight(),s.updateSlidesClasses(),a.effect!=="slide"&&s.setTranslate(I),E!=="reset"&&(s.transitionStart(t,E),s.transitionEnd(t,E)),!1;if(a.cssMode){let N=s.isHorizontal(),U=h?I:-I;if(e===0)b&&(s.wrapperEl.style.scrollSnapType="none",s._immediateVirtual=!0),b&&!s._cssModeVirtualInitialSet&&s.params.initialSlide>0?(s._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{f[N?"scrollLeft":"scrollTop"]=U})):f[N?"scrollLeft":"scrollTop"]=U,b&&requestAnimationFrame(()=>{s.wrapperEl.style.scrollSnapType="",s._immediateVirtual=!1});else{if(!s.support.smoothScroll)return vx({swiper:s,targetPosition:U,side:N?"left":"top"}),!0;f.scrollTo({[N?"left":"top"]:U,behavior:"smooth"})}return!0}return s.setTransition(e),s.setTranslate(I),s.updateActiveIndex(o),s.updateSlidesClasses(),s.emit("beforeTransitionStart",e,i),s.transitionStart(t,E),e===0?s.transitionEnd(t,E):s.animating||(s.animating=!0,s.onSlideToWrapperTransitionEnd||(s.onSlideToWrapperTransitionEnd=function(U){!s||s.destroyed||U.target===this&&(s.wrapperEl.removeEventListener("transitionend",s.onSlideToWrapperTransitionEnd),s.onSlideToWrapperTransitionEnd=null,delete s.onSlideToWrapperTransitionEnd,s.transitionEnd(t,E))}),s.wrapperEl.addEventListener("transitionend",s.onSlideToWrapperTransitionEnd)),!0}function Gne(n,e,t,i){n===void 0&&(n=0),t===void 0&&(t=!0),typeof n=="string"&&(n=parseInt(n,10));let r=this;if(r.destroyed)return;typeof e>"u"&&(e=r.params.speed);let s=r.grid&&r.params.grid&&r.params.grid.rows>1,o=n;if(r.params.loop)if(r.virtual&&r.params.virtual.enabled)o=o+r.virtual.slidesBefore;else{let a;if(s){let h=o*r.params.grid.rows;a=r.slides.filter(f=>f.getAttribute("data-swiper-slide-index")*1===h)[0].column}else a=r.getSlideIndexByData(o);let l=s?Math.ceil(r.slides.length/r.params.grid.rows):r.slides.length,{centeredSlides:c}=r.params,u=r.params.slidesPerView;u==="auto"?u=r.slidesPerViewDynamic():(u=Math.ceil(parseFloat(r.params.slidesPerView,10)),c&&u%2===0&&(u=u+1));let d=l-a<u;if(c&&(d=d||a<Math.ceil(u/2)),i&&c&&r.params.slidesPerView!=="auto"&&!s&&(d=!1),d){let h=c?a<r.activeIndex?"prev":"next":a-r.activeIndex-1<r.params.slidesPerView?"next":"prev";r.loopFix({direction:h,slideTo:!0,activeSlideIndex:h==="next"?a+1:a-l+1,slideRealIndex:h==="next"?r.realIndex:void 0})}if(s){let h=o*r.params.grid.rows;o=r.slides.filter(f=>f.getAttribute("data-swiper-slide-index")*1===h)[0].column}else o=r.getSlideIndexByData(o)}return requestAnimationFrame(()=>{r.slideTo(o,e,t,i)}),r}function Hne(n,e,t){e===void 0&&(e=!0);let i=this,{enabled:r,params:s,animating:o}=i;if(!r||i.destroyed)return i;typeof n>"u"&&(n=i.params.speed);let a=s.slidesPerGroup;s.slidesPerView==="auto"&&s.slidesPerGroup===1&&s.slidesPerGroupAuto&&(a=Math.max(i.slidesPerViewDynamic("current",!0),1));let l=i.activeIndex<s.slidesPerGroupSkip?1:a,c=i.virtual&&s.virtual.enabled;if(s.loop){if(o&&!c&&s.loopPreventsSliding)return!1;if(i.loopFix({direction:"next"}),i._clientLeft=i.wrapperEl.clientLeft,i.activeIndex===i.slides.length-1&&s.cssMode)return requestAnimationFrame(()=>{i.slideTo(i.activeIndex+l,n,e,t)}),!0}return s.rewind&&i.isEnd?i.slideTo(0,n,e,t):i.slideTo(i.activeIndex+l,n,e,t)}function Wne(n,e,t){e===void 0&&(e=!0);let i=this,{params:r,snapGrid:s,slidesGrid:o,rtlTranslate:a,enabled:l,animating:c}=i;if(!l||i.destroyed)return i;typeof n>"u"&&(n=i.params.speed);let u=i.virtual&&r.virtual.enabled;if(r.loop){if(c&&!u&&r.loopPreventsSliding)return!1;i.loopFix({direction:"prev"}),i._clientLeft=i.wrapperEl.clientLeft}let d=a?i.translate:-i.translate;function h(I){return I<0?-Math.floor(Math.abs(I)):Math.floor(I)}let f=h(d),g=s.map(I=>h(I)),_=s[g.indexOf(f)-1];if(typeof _>"u"&&r.cssMode){let I;s.forEach((E,b)=>{f>=E&&(I=b)}),typeof I<"u"&&(_=s[I>0?I-1:I])}let S=0;if(typeof _<"u"&&(S=o.indexOf(_),S<0&&(S=i.activeIndex-1),r.slidesPerView==="auto"&&r.slidesPerGroup===1&&r.slidesPerGroupAuto&&(S=S-i.slidesPerViewDynamic("previous",!0)+1,S=Math.max(S,0))),r.rewind&&i.isBeginning){let I=i.params.virtual&&i.params.virtual.enabled&&i.virtual?i.virtual.slides.length-1:i.slides.length-1;return i.slideTo(I,n,e,t)}else if(r.loop&&i.activeIndex===0&&r.cssMode)return requestAnimationFrame(()=>{i.slideTo(S,n,e,t)}),!0;return i.slideTo(S,n,e,t)}function Kne(n,e,t){e===void 0&&(e=!0);let i=this;if(!i.destroyed)return typeof n>"u"&&(n=i.params.speed),i.slideTo(i.activeIndex,n,e,t)}function Yne(n,e,t,i){e===void 0&&(e=!0),i===void 0&&(i=.5);let r=this;if(r.destroyed)return;typeof n>"u"&&(n=r.params.speed);let s=r.activeIndex,o=Math.min(r.params.slidesPerGroupSkip,s),a=o+Math.floor((s-o)/r.params.slidesPerGroup),l=r.rtlTranslate?r.translate:-r.translate;if(l>=r.snapGrid[a]){let c=r.snapGrid[a],u=r.snapGrid[a+1];l-c>(u-c)*i&&(s+=r.params.slidesPerGroup)}else{let c=r.snapGrid[a-1],u=r.snapGrid[a];l-c<=(u-c)*i&&(s-=r.params.slidesPerGroup)}return s=Math.max(s,0),s=Math.min(s,r.slidesGrid.length-1),r.slideTo(s,n,e,t)}function Qne(){let n=this;if(n.destroyed)return;let{params:e,slidesEl:t}=n,i=e.slidesPerView==="auto"?n.slidesPerViewDynamic():e.slidesPerView,r=n.clickedIndex,s,o=n.isElement?"swiper-slide":`.${e.slideClass}`;if(e.loop){if(n.animating)return;s=parseInt(n.clickedSlide.getAttribute("data-swiper-slide-index"),10),e.centeredSlides?r<n.loopedSlides-i/2||r>n.slides.length-n.loopedSlides+i/2?(n.loopFix(),r=n.getSlideIndex(At(t,`${o}[data-swiper-slide-index="${s}"]`)[0]),fr(()=>{n.slideTo(r)})):n.slideTo(r):r>n.slides.length-i?(n.loopFix(),r=n.getSlideIndex(At(t,`${o}[data-swiper-slide-index="${s}"]`)[0]),fr(()=>{n.slideTo(r)})):n.slideTo(r)}else n.slideTo(r)}var Xne={slideTo:jne,slideToLoop:Gne,slideNext:Hne,slidePrev:Wne,slideReset:Kne,slideToClosest:Yne,slideToClickedSlide:Qne};function Jne(n){let e=this,{params:t,slidesEl:i}=e;if(!t.loop||e.virtual&&e.params.virtual.enabled)return;let r=()=>{At(i,`.${t.slideClass}, swiper-slide`).forEach((d,h)=>{d.setAttribute("data-swiper-slide-index",h)})},s=e.grid&&t.grid&&t.grid.rows>1,o=t.slidesPerGroup*(s?t.grid.rows:1),a=e.slides.length%o!==0,l=s&&e.slides.length%t.grid.rows!==0,c=u=>{for(let d=0;d<u;d+=1){let h=e.isElement?tn("swiper-slide",[t.slideBlankClass]):tn("div",[t.slideClass,t.slideBlankClass]);e.slidesEl.append(h)}};if(a){if(t.loopAddBlankSlides){let u=o-e.slides.length%o;c(u),e.recalcSlides(),e.updateSlides()}else wf("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");r()}else if(l){if(t.loopAddBlankSlides){let u=t.grid.rows-e.slides.length%t.grid.rows;c(u),e.recalcSlides(),e.updateSlides()}else wf("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");r()}else r();e.loopFix({slideRealIndex:n,direction:t.centeredSlides?void 0:"next"})}function Zne(n){let{slideRealIndex:e,slideTo:t=!0,direction:i,setTranslate:r,activeSlideIndex:s,byController:o,byMousewheel:a}=n===void 0?{}:n,l=this;if(!l.params.loop)return;l.emit("beforeLoopFix");let{slides:c,allowSlidePrev:u,allowSlideNext:d,slidesEl:h,params:f}=l,{centeredSlides:g}=f;if(l.allowSlidePrev=!0,l.allowSlideNext=!0,l.virtual&&f.virtual.enabled){t&&(!f.centeredSlides&&l.snapIndex===0?l.slideTo(l.virtual.slides.length,0,!1,!0):f.centeredSlides&&l.snapIndex<f.slidesPerView?l.slideTo(l.virtual.slides.length+l.snapIndex,0,!1,!0):l.snapIndex===l.snapGrid.length-1&&l.slideTo(l.virtual.slidesBefore,0,!1,!0)),l.allowSlidePrev=u,l.allowSlideNext=d,l.emit("loopFix");return}let _=f.slidesPerView;_==="auto"?_=l.slidesPerViewDynamic():(_=Math.ceil(parseFloat(f.slidesPerView,10)),g&&_%2===0&&(_=_+1));let S=f.slidesPerGroupAuto?_:f.slidesPerGroup,I=S;I%S!==0&&(I+=S-I%S),I+=f.loopAdditionalSlides,l.loopedSlides=I;let E=l.grid&&f.grid&&f.grid.rows>1;c.length<_+I?wf("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):E&&f.grid.fill==="row"&&wf("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");let b=[],M=[],N=l.activeIndex;typeof s>"u"?s=l.getSlideIndex(c.filter(y=>y.classList.contains(f.slideActiveClass))[0]):N=s;let U=i==="next"||!i,R=i==="prev"||!i,x=0,T=0,A=E?Math.ceil(c.length/f.grid.rows):c.length,P=(E?c[s].column:s)+(g&&typeof r>"u"?-_/2+.5:0);if(P<I){x=Math.max(I-P,S);for(let y=0;y<I-P;y+=1){let w=y-Math.floor(y/A)*A;if(E){let F=A-w-1;for(let Q=c.length-1;Q>=0;Q-=1)c[Q].column===F&&b.push(Q)}else b.push(A-w-1)}}else if(P+_>A-I){T=Math.max(P-(A-I*2),S);for(let y=0;y<T;y+=1){let w=y-Math.floor(y/A)*A;E?c.forEach((F,Q)=>{F.column===w&&M.push(Q)}):M.push(w)}}if(l.__preventObserver__=!0,requestAnimationFrame(()=>{l.__preventObserver__=!1}),R&&b.forEach(y=>{c[y].swiperLoopMoveDOM=!0,h.prepend(c[y]),c[y].swiperLoopMoveDOM=!1}),U&&M.forEach(y=>{c[y].swiperLoopMoveDOM=!0,h.append(c[y]),c[y].swiperLoopMoveDOM=!1}),l.recalcSlides(),f.slidesPerView==="auto"?l.updateSlides():E&&(b.length>0&&R||M.length>0&&U)&&l.slides.forEach((y,w)=>{l.grid.updateSlide(w,y,l.slides)}),f.watchSlidesProgress&&l.updateSlidesOffset(),t){if(b.length>0&&R){if(typeof e>"u"){let y=l.slidesGrid[N],F=l.slidesGrid[N+x]-y;a?l.setTranslate(l.translate-F):(l.slideTo(N+Math.ceil(x),0,!1,!0),r&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-F,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-F))}else if(r){let y=E?b.length/f.grid.rows:b.length;l.slideTo(l.activeIndex+y,0,!1,!0),l.touchEventsData.currentTranslate=l.translate}}else if(M.length>0&&U)if(typeof e>"u"){let y=l.slidesGrid[N],F=l.slidesGrid[N-T]-y;a?l.setTranslate(l.translate-F):(l.slideTo(N-T,0,!1,!0),r&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-F,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-F))}else{let y=E?M.length/f.grid.rows:M.length;l.slideTo(l.activeIndex-y,0,!1,!0)}}if(l.allowSlidePrev=u,l.allowSlideNext=d,l.controller&&l.controller.control&&!o){let y={slideRealIndex:e,direction:i,setTranslate:r,activeSlideIndex:s,byController:!0};Array.isArray(l.controller.control)?l.controller.control.forEach(w=>{!w.destroyed&&w.params.loop&&w.loopFix(Sn(ht({},y),{slideTo:w.params.slidesPerView===f.slidesPerView?t:!1}))}):l.controller.control instanceof l.constructor&&l.controller.control.params.loop&&l.controller.control.loopFix(Sn(ht({},y),{slideTo:l.controller.control.params.slidesPerView===f.slidesPerView?t:!1}))}l.emit("loopFix")}function eie(){let n=this,{params:e,slidesEl:t}=n;if(!e.loop||n.virtual&&n.params.virtual.enabled)return;n.recalcSlides();let i=[];n.slides.forEach(r=>{let s=typeof r.swiperSlideIndex>"u"?r.getAttribute("data-swiper-slide-index")*1:r.swiperSlideIndex;i[s]=r}),n.slides.forEach(r=>{r.removeAttribute("data-swiper-slide-index")}),i.forEach(r=>{t.append(r)}),n.recalcSlides(),n.slideTo(n.realIndex,0)}var tie={loopCreate:Jne,loopFix:Zne,loopDestroy:eie};function nie(n){let e=this;if(!e.params.simulateTouch||e.params.watchOverflow&&e.isLocked||e.params.cssMode)return;let t=e.params.touchEventsTarget==="container"?e.el:e.wrapperEl;e.isElement&&(e.__preventObserver__=!0),t.style.cursor="move",t.style.cursor=n?"grabbing":"grab",e.isElement&&requestAnimationFrame(()=>{e.__preventObserver__=!1})}function iie(){let n=this;n.params.watchOverflow&&n.isLocked||n.params.cssMode||(n.isElement&&(n.__preventObserver__=!0),n[n.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",n.isElement&&requestAnimationFrame(()=>{n.__preventObserver__=!1}))}var rie={setGrabCursor:nie,unsetGrabCursor:iie};function sie(n,e){e===void 0&&(e=this);function t(i){if(!i||i===yt()||i===ot())return null;i.assignedSlot&&(i=i.assignedSlot);let r=i.closest(n);return!r&&!i.getRootNode?null:r||t(i.getRootNode().host)}return t(e)}function hB(n,e,t){let i=ot(),{params:r}=n,s=r.edgeSwipeDetection,o=r.edgeSwipeThreshold;return s&&(t<=o||t>=i.innerWidth-o)?s==="prevent"?(e.preventDefault(),!0):!1:!0}function oie(n){let e=this,t=yt(),i=n;i.originalEvent&&(i=i.originalEvent);let r=e.touchEventsData;if(i.type==="pointerdown"){if(r.pointerId!==null&&r.pointerId!==i.pointerId)return;r.pointerId=i.pointerId}else i.type==="touchstart"&&i.targetTouches.length===1&&(r.touchId=i.targetTouches[0].identifier);if(i.type==="touchstart"){hB(e,i,i.targetTouches[0].pageX);return}let{params:s,touches:o,enabled:a}=e;if(!a||!s.simulateTouch&&i.pointerType==="mouse"||e.animating&&s.preventInteractionOnTransition)return;!e.animating&&s.cssMode&&s.loop&&e.loopFix();let l=i.target;if(s.touchEventsTarget==="wrapper"&&!lB(l,e.wrapperEl)||"which"in i&&i.which===3||"button"in i&&i.button>0||r.isTouched&&r.isMoved)return;let c=!!s.noSwipingClass&&s.noSwipingClass!=="",u=i.composedPath?i.composedPath():i.path;c&&i.target&&i.target.shadowRoot&&u&&(l=u[0]);let d=s.noSwipingSelector?s.noSwipingSelector:`.${s.noSwipingClass}`,h=!!(i.target&&i.target.shadowRoot);if(s.noSwiping&&(h?sie(d,l):l.closest(d))){e.allowClick=!0;return}if(s.swipeHandler&&!l.closest(s.swipeHandler))return;o.currentX=i.pageX,o.currentY=i.pageY;let f=o.currentX,g=o.currentY;if(!hB(e,i,f))return;Object.assign(r,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),o.startX=f,o.startY=g,r.touchStartTime=zn(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,s.threshold>0&&(r.allowThresholdMove=!1);let _=!0;l.matches(r.focusableElements)&&(_=!1,l.nodeName==="SELECT"&&(r.isTouched=!1)),t.activeElement&&t.activeElement.matches(r.focusableElements)&&t.activeElement!==l&&(i.pointerType==="mouse"||i.pointerType!=="mouse"&&!l.matches(r.focusableElements))&&t.activeElement.blur();let S=_&&e.allowTouchMove&&s.touchStartPreventDefault;(s.touchStartForcePreventDefault||S)&&!l.isContentEditable&&i.preventDefault(),s.freeMode&&s.freeMode.enabled&&e.freeMode&&e.animating&&!s.cssMode&&e.freeMode.onTouchStart(),e.emit("touchStart",i)}function aie(n){let e=yt(),t=this,i=t.touchEventsData,{params:r,touches:s,rtlTranslate:o,enabled:a}=t;if(!a||!r.simulateTouch&&n.pointerType==="mouse")return;let l=n;if(l.originalEvent&&(l=l.originalEvent),l.type==="pointermove"&&(i.touchId!==null||l.pointerId!==i.pointerId))return;let c;if(l.type==="touchmove"){if(c=[...l.changedTouches].filter(U=>U.identifier===i.touchId)[0],!c||c.identifier!==i.touchId)return}else c=l;if(!i.isTouched){i.startMoving&&i.isScrolling&&t.emit("touchMoveOpposite",l);return}let u=c.pageX,d=c.pageY;if(l.preventedByNestedSwiper){s.startX=u,s.startY=d;return}if(!t.allowTouchMove){l.target.matches(i.focusableElements)||(t.allowClick=!1),i.isTouched&&(Object.assign(s,{startX:u,startY:d,currentX:u,currentY:d}),i.touchStartTime=zn());return}if(r.touchReleaseOnEdges&&!r.loop){if(t.isVertical()){if(d<s.startY&&t.translate<=t.maxTranslate()||d>s.startY&&t.translate>=t.minTranslate()){i.isTouched=!1,i.isMoved=!1;return}}else if(u<s.startX&&t.translate<=t.maxTranslate()||u>s.startX&&t.translate>=t.minTranslate())return}if(e.activeElement&&e.activeElement.matches(i.focusableElements)&&e.activeElement!==l.target&&l.pointerType!=="mouse"&&e.activeElement.blur(),e.activeElement&&l.target===e.activeElement&&l.target.matches(i.focusableElements)){i.isMoved=!0,t.allowClick=!1;return}i.allowTouchCallbacks&&t.emit("touchMove",l),s.previousX=s.currentX,s.previousY=s.currentY,s.currentX=u,s.currentY=d;let h=s.currentX-s.startX,f=s.currentY-s.startY;if(t.params.threshold&&Math.sqrt(h**2+f**2)<t.params.threshold)return;if(typeof i.isScrolling>"u"){let U;t.isHorizontal()&&s.currentY===s.startY||t.isVertical()&&s.currentX===s.startX?i.isScrolling=!1:h*h+f*f>=25&&(U=Math.atan2(Math.abs(f),Math.abs(h))*180/Math.PI,i.isScrolling=t.isHorizontal()?U>r.touchAngle:90-U>r.touchAngle)}if(i.isScrolling&&t.emit("touchMoveOpposite",l),typeof i.startMoving>"u"&&(s.currentX!==s.startX||s.currentY!==s.startY)&&(i.startMoving=!0),i.isScrolling||l.type==="touchmove"&&i.preventTouchMoveFromPointerMove){i.isTouched=!1;return}if(!i.startMoving)return;t.allowClick=!1,!r.cssMode&&l.cancelable&&l.preventDefault(),r.touchMoveStopPropagation&&!r.nested&&l.stopPropagation();let g=t.isHorizontal()?h:f,_=t.isHorizontal()?s.currentX-s.previousX:s.currentY-s.previousY;r.oneWayMovement&&(g=Math.abs(g)*(o?1:-1),_=Math.abs(_)*(o?1:-1)),s.diff=g,g*=r.touchRatio,o&&(g=-g,_=-_);let S=t.touchesDirection;t.swipeDirection=g>0?"prev":"next",t.touchesDirection=_>0?"prev":"next";let I=t.params.loop&&!r.cssMode,E=t.touchesDirection==="next"&&t.allowSlideNext||t.touchesDirection==="prev"&&t.allowSlidePrev;if(!i.isMoved){if(I&&E&&t.loopFix({direction:t.swipeDirection}),i.startTranslate=t.getTranslate(),t.setTransition(0),t.animating){let U=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});t.wrapperEl.dispatchEvent(U)}i.allowMomentumBounce=!1,r.grabCursor&&(t.allowSlideNext===!0||t.allowSlidePrev===!0)&&t.setGrabCursor(!0),t.emit("sliderFirstMove",l)}let b;if(new Date().getTime(),i.isMoved&&i.allowThresholdMove&&S!==t.touchesDirection&&I&&E&&Math.abs(g)>=1){Object.assign(s,{startX:u,startY:d,currentX:u,currentY:d,startTranslate:i.currentTranslate}),i.loopSwapReset=!0,i.startTranslate=i.currentTranslate;return}t.emit("sliderMove",l),i.isMoved=!0,i.currentTranslate=g+i.startTranslate;let M=!0,N=r.resistanceRatio;if(r.touchReleaseOnEdges&&(N=0),g>0?(I&&E&&!b&&i.allowThresholdMove&&i.currentTranslate>(r.centeredSlides?t.minTranslate()-t.slidesSizesGrid[t.activeIndex+1]-(r.slidesPerView!=="auto"&&t.slides.length-r.slidesPerView>=2?t.slidesSizesGrid[t.activeIndex+1]+t.params.spaceBetween:0)-t.params.spaceBetween:t.minTranslate())&&t.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),i.currentTranslate>t.minTranslate()&&(M=!1,r.resistance&&(i.currentTranslate=t.minTranslate()-1+(-t.minTranslate()+i.startTranslate+g)**N))):g<0&&(I&&E&&!b&&i.allowThresholdMove&&i.currentTranslate<(r.centeredSlides?t.maxTranslate()+t.slidesSizesGrid[t.slidesSizesGrid.length-1]+t.params.spaceBetween+(r.slidesPerView!=="auto"&&t.slides.length-r.slidesPerView>=2?t.slidesSizesGrid[t.slidesSizesGrid.length-1]+t.params.spaceBetween:0):t.maxTranslate())&&t.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:t.slides.length-(r.slidesPerView==="auto"?t.slidesPerViewDynamic():Math.ceil(parseFloat(r.slidesPerView,10)))}),i.currentTranslate<t.maxTranslate()&&(M=!1,r.resistance&&(i.currentTranslate=t.maxTranslate()+1-(t.maxTranslate()-i.startTranslate-g)**N))),M&&(l.preventedByNestedSwiper=!0),!t.allowSlideNext&&t.swipeDirection==="next"&&i.currentTranslate<i.startTranslate&&(i.currentTranslate=i.startTranslate),!t.allowSlidePrev&&t.swipeDirection==="prev"&&i.currentTranslate>i.startTranslate&&(i.currentTranslate=i.startTranslate),!t.allowSlidePrev&&!t.allowSlideNext&&(i.currentTranslate=i.startTranslate),r.threshold>0)if(Math.abs(g)>r.threshold||i.allowThresholdMove){if(!i.allowThresholdMove){i.allowThresholdMove=!0,s.startX=s.currentX,s.startY=s.currentY,i.currentTranslate=i.startTranslate,s.diff=t.isHorizontal()?s.currentX-s.startX:s.currentY-s.startY;return}}else{i.currentTranslate=i.startTranslate;return}!r.followFinger||r.cssMode||((r.freeMode&&r.freeMode.enabled&&t.freeMode||r.watchSlidesProgress)&&(t.updateActiveIndex(),t.updateSlidesClasses()),r.freeMode&&r.freeMode.enabled&&t.freeMode&&t.freeMode.onTouchMove(),t.updateProgress(i.currentTranslate),t.setTranslate(i.currentTranslate))}function lie(n){let e=this,t=e.touchEventsData,i=n;i.originalEvent&&(i=i.originalEvent);let r;if(i.type==="touchend"||i.type==="touchcancel"){if(r=[...i.changedTouches].filter(N=>N.identifier===t.touchId)[0],!r||r.identifier!==t.touchId)return}else{if(t.touchId!==null||i.pointerId!==t.pointerId)return;r=i}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(i.type)&&!(["pointercancel","contextmenu"].includes(i.type)&&(e.browser.isSafari||e.browser.isWebView)))return;t.pointerId=null,t.touchId=null;let{params:o,touches:a,rtlTranslate:l,slidesGrid:c,enabled:u}=e;if(!u||!o.simulateTouch&&i.pointerType==="mouse")return;if(t.allowTouchCallbacks&&e.emit("touchEnd",i),t.allowTouchCallbacks=!1,!t.isTouched){t.isMoved&&o.grabCursor&&e.setGrabCursor(!1),t.isMoved=!1,t.startMoving=!1;return}o.grabCursor&&t.isMoved&&t.isTouched&&(e.allowSlideNext===!0||e.allowSlidePrev===!0)&&e.setGrabCursor(!1);let d=zn(),h=d-t.touchStartTime;if(e.allowClick){let N=i.path||i.composedPath&&i.composedPath();e.updateClickedSlide(N&&N[0]||i.target,N),e.emit("tap click",i),h<300&&d-t.lastClickTime<300&&e.emit("doubleTap doubleClick",i)}if(t.lastClickTime=zn(),fr(()=>{e.destroyed||(e.allowClick=!0)}),!t.isTouched||!t.isMoved||!e.swipeDirection||a.diff===0&&!t.loopSwapReset||t.currentTranslate===t.startTranslate&&!t.loopSwapReset){t.isTouched=!1,t.isMoved=!1,t.startMoving=!1;return}t.isTouched=!1,t.isMoved=!1,t.startMoving=!1;let f;if(o.followFinger?f=l?e.translate:-e.translate:f=-t.currentTranslate,o.cssMode)return;if(o.freeMode&&o.freeMode.enabled){e.freeMode.onTouchEnd({currentPos:f});return}let g=f>=-e.maxTranslate()&&!e.params.loop,_=0,S=e.slidesSizesGrid[0];for(let N=0;N<c.length;N+=N<o.slidesPerGroupSkip?1:o.slidesPerGroup){let U=N<o.slidesPerGroupSkip-1?1:o.slidesPerGroup;typeof c[N+U]<"u"?(g||f>=c[N]&&f<c[N+U])&&(_=N,S=c[N+U]-c[N]):(g||f>=c[N])&&(_=N,S=c[c.length-1]-c[c.length-2])}let I=null,E=null;o.rewind&&(e.isBeginning?E=o.virtual&&o.virtual.enabled&&e.virtual?e.virtual.slides.length-1:e.slides.length-1:e.isEnd&&(I=0));let b=(f-c[_])/S,M=_<o.slidesPerGroupSkip-1?1:o.slidesPerGroup;if(h>o.longSwipesMs){if(!o.longSwipes){e.slideTo(e.activeIndex);return}e.swipeDirection==="next"&&(b>=o.longSwipesRatio?e.slideTo(o.rewind&&e.isEnd?I:_+M):e.slideTo(_)),e.swipeDirection==="prev"&&(b>1-o.longSwipesRatio?e.slideTo(_+M):E!==null&&b<0&&Math.abs(b)>o.longSwipesRatio?e.slideTo(E):e.slideTo(_))}else{if(!o.shortSwipes){e.slideTo(e.activeIndex);return}e.navigation&&(i.target===e.navigation.nextEl||i.target===e.navigation.prevEl)?i.target===e.navigation.nextEl?e.slideTo(_+M):e.slideTo(_):(e.swipeDirection==="next"&&e.slideTo(I!==null?I:_+M),e.swipeDirection==="prev"&&e.slideTo(E!==null?E:_))}}function fB(){let n=this,{params:e,el:t}=n;if(t&&t.offsetWidth===0)return;e.breakpoints&&n.setBreakpoint();let{allowSlideNext:i,allowSlidePrev:r,snapGrid:s}=n,o=n.virtual&&n.params.virtual.enabled;n.allowSlideNext=!0,n.allowSlidePrev=!0,n.updateSize(),n.updateSlides(),n.updateSlidesClasses();let a=o&&e.loop;(e.slidesPerView==="auto"||e.slidesPerView>1)&&n.isEnd&&!n.isBeginning&&!n.params.centeredSlides&&!a?n.slideTo(n.slides.length-1,0,!1,!0):n.params.loop&&!o?n.slideToLoop(n.realIndex,0,!1,!0):n.slideTo(n.activeIndex,0,!1,!0),n.autoplay&&n.autoplay.running&&n.autoplay.paused&&(clearTimeout(n.autoplay.resizeTimeout),n.autoplay.resizeTimeout=setTimeout(()=>{n.autoplay&&n.autoplay.running&&n.autoplay.paused&&n.autoplay.resume()},500)),n.allowSlidePrev=r,n.allowSlideNext=i,n.params.watchOverflow&&s!==n.snapGrid&&n.checkOverflow()}function cie(n){let e=this;e.enabled&&(e.allowClick||(e.params.preventClicks&&n.preventDefault(),e.params.preventClicksPropagation&&e.animating&&(n.stopPropagation(),n.stopImmediatePropagation())))}function uie(){let n=this,{wrapperEl:e,rtlTranslate:t,enabled:i}=n;if(!i)return;n.previousTranslate=n.translate,n.isHorizontal()?n.translate=-e.scrollLeft:n.translate=-e.scrollTop,n.translate===0&&(n.translate=0),n.updateActiveIndex(),n.updateSlidesClasses();let r,s=n.maxTranslate()-n.minTranslate();s===0?r=0:r=(n.translate-n.minTranslate())/s,r!==n.progress&&n.updateProgress(t?-n.translate:n.translate),n.emit("setTranslate",n.translate,!1)}function die(n){let e=this;Iy(e,n.target),!(e.params.cssMode||e.params.slidesPerView!=="auto"&&!e.params.autoHeight)&&e.update()}function hie(){let n=this;n.documentTouchHandlerProceeded||(n.documentTouchHandlerProceeded=!0,n.params.touchReleaseOnEdges&&(n.el.style.touchAction="auto"))}var vB=(n,e)=>{let t=yt(),{params:i,el:r,wrapperEl:s,device:o}=n,a=!!i.nested,l=e==="on"?"addEventListener":"removeEventListener",c=e;!r||typeof r=="string"||(t[l]("touchstart",n.onDocumentTouchStart,{passive:!1,capture:a}),r[l]("touchstart",n.onTouchStart,{passive:!1}),r[l]("pointerdown",n.onTouchStart,{passive:!1}),t[l]("touchmove",n.onTouchMove,{passive:!1,capture:a}),t[l]("pointermove",n.onTouchMove,{passive:!1,capture:a}),t[l]("touchend",n.onTouchEnd,{passive:!0}),t[l]("pointerup",n.onTouchEnd,{passive:!0}),t[l]("pointercancel",n.onTouchEnd,{passive:!0}),t[l]("touchcancel",n.onTouchEnd,{passive:!0}),t[l]("pointerout",n.onTouchEnd,{passive:!0}),t[l]("pointerleave",n.onTouchEnd,{passive:!0}),t[l]("contextmenu",n.onTouchEnd,{passive:!0}),(i.preventClicks||i.preventClicksPropagation)&&r[l]("click",n.onClick,!0),i.cssMode&&s[l]("scroll",n.onScroll),i.updateOnWindowResize?n[c](o.ios||o.android?"resize orientationchange observerUpdate":"resize observerUpdate",fB,!0):n[c]("observerUpdate",fB,!0),r[l]("load",n.onLoad,{capture:!0}))};function fie(){let n=this,{params:e}=n;n.onTouchStart=oie.bind(n),n.onTouchMove=aie.bind(n),n.onTouchEnd=lie.bind(n),n.onDocumentTouchStart=hie.bind(n),e.cssMode&&(n.onScroll=uie.bind(n)),n.onClick=cie.bind(n),n.onLoad=die.bind(n),vB(n,"on")}function pie(){vB(this,"off")}var mie={attachEvents:fie,detachEvents:pie},pB=(n,e)=>n.grid&&e.grid&&e.grid.rows>1;function gie(){let n=this,{realIndex:e,initialized:t,params:i,el:r}=n,s=i.breakpoints;if(!s||s&&Object.keys(s).length===0)return;let o=n.getBreakpoint(s,n.params.breakpointsBase,n.el);if(!o||n.currentBreakpoint===o)return;let l=(o in s?s[o]:void 0)||n.originalParams,c=pB(n,i),u=pB(n,l),d=n.params.grabCursor,h=l.grabCursor,f=i.enabled;c&&!u?(r.classList.remove(`${i.containerModifierClass}grid`,`${i.containerModifierClass}grid-column`),n.emitContainerClasses()):!c&&u&&(r.classList.add(`${i.containerModifierClass}grid`),(l.grid.fill&&l.grid.fill==="column"||!l.grid.fill&&i.grid.fill==="column")&&r.classList.add(`${i.containerModifierClass}grid-column`),n.emitContainerClasses()),d&&!h?n.unsetGrabCursor():!d&&h&&n.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(b=>{if(typeof l[b]>"u")return;let M=i[b]&&i[b].enabled,N=l[b]&&l[b].enabled;M&&!N&&n[b].disable(),!M&&N&&n[b].enable()});let g=l.direction&&l.direction!==i.direction,_=i.loop&&(l.slidesPerView!==i.slidesPerView||g),S=i.loop;g&&t&&n.changeDirection(),Zn(n.params,l);let I=n.params.enabled,E=n.params.loop;Object.assign(n,{allowTouchMove:n.params.allowTouchMove,allowSlideNext:n.params.allowSlideNext,allowSlidePrev:n.params.allowSlidePrev}),f&&!I?n.disable():!f&&I&&n.enable(),n.currentBreakpoint=o,n.emit("_beforeBreakpoint",l),t&&(_?(n.loopDestroy(),n.loopCreate(e),n.updateSlides()):!S&&E?(n.loopCreate(e),n.updateSlides()):S&&!E&&n.loopDestroy()),n.emit("breakpoint",l)}function yie(n,e,t){if(e===void 0&&(e="window"),!n||e==="container"&&!t)return;let i=!1,r=ot(),s=e==="window"?r.innerHeight:t.clientHeight,o=Object.keys(n).map(a=>{if(typeof a=="string"&&a.indexOf("@")===0){let l=parseFloat(a.substr(1));return{value:s*l,point:a}}return{value:a,point:a}});o.sort((a,l)=>parseInt(a.value,10)-parseInt(l.value,10));for(let a=0;a<o.length;a+=1){let{point:l,value:c}=o[a];e==="window"?r.matchMedia(`(min-width: ${c}px)`).matches&&(i=l):c<=t.clientWidth&&(i=l)}return i||"max"}var vie={setBreakpoint:gie,getBreakpoint:yie};function _ie(n,e){let t=[];return n.forEach(i=>{typeof i=="object"?Object.keys(i).forEach(r=>{i[r]&&t.push(e+r)}):typeof i=="string"&&t.push(e+i)}),t}function wie(){let n=this,{classNames:e,params:t,rtl:i,el:r,device:s}=n,o=_ie(["initialized",t.direction,{"free-mode":n.params.freeMode&&t.freeMode.enabled},{autoheight:t.autoHeight},{rtl:i},{grid:t.grid&&t.grid.rows>1},{"grid-column":t.grid&&t.grid.rows>1&&t.grid.fill==="column"},{android:s.android},{ios:s.ios},{"css-mode":t.cssMode},{centered:t.cssMode&&t.centeredSlides},{"watch-progress":t.watchSlidesProgress}],t.containerModifierClass);e.push(...o),r.classList.add(...e),n.emitContainerClasses()}function Sie(){let n=this,{el:e,classNames:t}=n;!e||typeof e=="string"||(e.classList.remove(...t),n.emitContainerClasses())}var bie={addClasses:wie,removeClasses:Sie};function Eie(){let n=this,{isLocked:e,params:t}=n,{slidesOffsetBefore:i}=t;if(i){let r=n.slides.length-1,s=n.slidesGrid[r]+n.slidesSizesGrid[r]+i*2;n.isLocked=n.size>s}else n.isLocked=n.snapGrid.length===1;t.allowSlideNext===!0&&(n.allowSlideNext=!n.isLocked),t.allowSlidePrev===!0&&(n.allowSlidePrev=!n.isLocked),e&&e!==n.isLocked&&(n.isEnd=!1),e!==n.isLocked&&n.emit(n.isLocked?"lock":"unlock")}var Cie={checkOverflow:Eie},ky={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function Tie(n,e){return function(i){i===void 0&&(i={});let r=Object.keys(i)[0],s=i[r];if(typeof s!="object"||s===null){Zn(e,i);return}if(n[r]===!0&&(n[r]={enabled:!0}),r==="navigation"&&n[r]&&n[r].enabled&&!n[r].prevEl&&!n[r].nextEl&&(n[r].auto=!0),["pagination","scrollbar"].indexOf(r)>=0&&n[r]&&n[r].enabled&&!n[r].el&&(n[r].auto=!0),!(r in n&&"enabled"in s)){Zn(e,i);return}typeof n[r]=="object"&&!("enabled"in n[r])&&(n[r].enabled=!0),n[r]||(n[r]={enabled:!1}),Zn(e,i)}}var Cx={eventsEmitter:bne,update:Mne,translate:Une,transition:$ne,slide:Xne,loop:tie,grabCursor:rie,events:mie,breakpoints:vie,checkOverflow:Cie,classes:bie},Tx={},Ho=class n{constructor(){let e,t;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];r.length===1&&r[0].constructor&&Object.prototype.toString.call(r[0]).slice(8,-1)==="Object"?t=r[0]:[e,t]=r,t||(t={}),t=Zn({},t),e&&!t.el&&(t.el=e);let o=yt();if(t.el&&typeof t.el=="string"&&o.querySelectorAll(t.el).length>1){let u=[];return o.querySelectorAll(t.el).forEach(d=>{let h=Zn({},t,{el:d});u.push(new n(h))}),u}let a=this;a.__swiper__=!0,a.support=mB(),a.device=gB({userAgent:t.userAgent}),a.browser=_ne(),a.eventsListeners={},a.eventsAnyListeners=[],a.modules=[...a.__modules__],t.modules&&Array.isArray(t.modules)&&a.modules.push(...t.modules);let l={};a.modules.forEach(u=>{u({params:t,swiper:a,extendParams:Tie(t,l),on:a.on.bind(a),once:a.once.bind(a),off:a.off.bind(a),emit:a.emit.bind(a)})});let c=Zn({},ky,l);return a.params=Zn({},c,Tx,t),a.originalParams=Zn({},a.params),a.passedParams=Zn({},t),a.params&&a.params.on&&Object.keys(a.params.on).forEach(u=>{a.on(u,a.params.on[u])}),a.params&&a.params.onAny&&a.onAny(a.params.onAny),Object.assign(a,{enabled:a.params.enabled,el:e,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return a.params.direction==="horizontal"},isVertical(){return a.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:a.params.allowSlideNext,allowSlidePrev:a.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:a.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:a.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),a.emit("_swiper"),a.params.init&&a.init(),a}getDirectionLabel(e){return this.isHorizontal()?e:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[e]}getSlideIndex(e){let{slidesEl:t,params:i}=this,r=At(t,`.${i.slideClass}, swiper-slide`),s=$o(r[0]);return $o(e)-s}getSlideIndexByData(e){return this.getSlideIndex(this.slides.filter(t=>t.getAttribute("data-swiper-slide-index")*1===e)[0])}recalcSlides(){let e=this,{slidesEl:t,params:i}=e;e.slides=At(t,`.${i.slideClass}, swiper-slide`)}enable(){let e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){let e=this;e.enabled&&(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,t){let i=this;e=Math.min(Math.max(e,0),1);let r=i.minTranslate(),o=(i.maxTranslate()-r)*e+r;i.translateTo(o,typeof t>"u"?0:t),i.updateActiveIndex(),i.updateSlidesClasses()}emitContainerClasses(){let e=this;if(!e.params._emitClasses||!e.el)return;let t=e.el.className.split(" ").filter(i=>i.indexOf("swiper")===0||i.indexOf(e.params.containerModifierClass)===0);e.emit("_containerClasses",t.join(" "))}getSlideClasses(e){let t=this;return t.destroyed?"":e.className.split(" ").filter(i=>i.indexOf("swiper-slide")===0||i.indexOf(t.params.slideClass)===0).join(" ")}emitSlidesClasses(){let e=this;if(!e.params._emitClasses||!e.el)return;let t=[];e.slides.forEach(i=>{let r=e.getSlideClasses(i);t.push({slideEl:i,classNames:r}),e.emit("_slideClass",i,r)}),e.emit("_slideClasses",t)}slidesPerViewDynamic(e,t){e===void 0&&(e="current"),t===void 0&&(t=!1);let i=this,{params:r,slides:s,slidesGrid:o,slidesSizesGrid:a,size:l,activeIndex:c}=i,u=1;if(typeof r.slidesPerView=="number")return r.slidesPerView;if(r.centeredSlides){let d=s[c]?Math.ceil(s[c].swiperSlideSize):0,h;for(let f=c+1;f<s.length;f+=1)s[f]&&!h&&(d+=Math.ceil(s[f].swiperSlideSize),u+=1,d>l&&(h=!0));for(let f=c-1;f>=0;f-=1)s[f]&&!h&&(d+=s[f].swiperSlideSize,u+=1,d>l&&(h=!0))}else if(e==="current")for(let d=c+1;d<s.length;d+=1)(t?o[d]+a[d]-o[c]<l:o[d]-o[c]<l)&&(u+=1);else for(let d=c-1;d>=0;d-=1)o[c]-o[d]<l&&(u+=1);return u}update(){let e=this;if(!e||e.destroyed)return;let{snapGrid:t,params:i}=e;i.breakpoints&&e.setBreakpoint(),[...e.el.querySelectorAll('[loading="lazy"]')].forEach(o=>{o.complete&&Iy(e,o)}),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses();function r(){let o=e.rtlTranslate?e.translate*-1:e.translate,a=Math.min(Math.max(o,e.maxTranslate()),e.minTranslate());e.setTranslate(a),e.updateActiveIndex(),e.updateSlidesClasses()}let s;if(i.freeMode&&i.freeMode.enabled&&!i.cssMode)r(),i.autoHeight&&e.updateAutoHeight();else{if((i.slidesPerView==="auto"||i.slidesPerView>1)&&e.isEnd&&!i.centeredSlides){let o=e.virtual&&i.virtual.enabled?e.virtual.slides:e.slides;s=e.slideTo(o.length-1,0,!1,!0)}else s=e.slideTo(e.activeIndex,0,!1,!0);s||r()}i.watchOverflow&&t!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,t){t===void 0&&(t=!0);let i=this,r=i.params.direction;return e||(e=r==="horizontal"?"vertical":"horizontal"),e===r||e!=="horizontal"&&e!=="vertical"||(i.el.classList.remove(`${i.params.containerModifierClass}${r}`),i.el.classList.add(`${i.params.containerModifierClass}${e}`),i.emitContainerClasses(),i.params.direction=e,i.slides.forEach(s=>{e==="vertical"?s.style.width="":s.style.height=""}),i.emit("changeDirection"),t&&i.update()),i}changeLanguageDirection(e){let t=this;t.rtl&&e==="rtl"||!t.rtl&&e==="ltr"||(t.rtl=e==="rtl",t.rtlTranslate=t.params.direction==="horizontal"&&t.rtl,t.rtl?(t.el.classList.add(`${t.params.containerModifierClass}rtl`),t.el.dir="rtl"):(t.el.classList.remove(`${t.params.containerModifierClass}rtl`),t.el.dir="ltr"),t.update())}mount(e){let t=this;if(t.mounted)return!0;let i=e||t.params.el;if(typeof i=="string"&&(i=document.querySelector(i)),!i)return!1;i.swiper=t,i.parentNode&&i.parentNode.host&&i.parentNode.host.nodeName===t.params.swiperElementNodeName.toUpperCase()&&(t.isElement=!0);let r=()=>`.${(t.params.wrapperClass||"").trim().split(" ").join(".")}`,o=i&&i.shadowRoot&&i.shadowRoot.querySelector?i.shadowRoot.querySelector(r()):At(i,r())[0];return!o&&t.params.createElements&&(o=tn("div",t.params.wrapperClass),i.append(o),At(i,`.${t.params.slideClass}`).forEach(a=>{o.append(a)})),Object.assign(t,{el:i,wrapperEl:o,slidesEl:t.isElement&&!i.parentNode.host.slideSlots?i.parentNode.host:o,hostEl:t.isElement?i.parentNode.host:i,mounted:!0,rtl:i.dir.toLowerCase()==="rtl"||Ss(i,"direction")==="rtl",rtlTranslate:t.params.direction==="horizontal"&&(i.dir.toLowerCase()==="rtl"||Ss(i,"direction")==="rtl"),wrongRTL:Ss(o,"display")==="-webkit-box"}),!0}init(e){let t=this;if(t.initialized||t.mount(e)===!1)return t;t.emit("beforeInit"),t.params.breakpoints&&t.setBreakpoint(),t.addClasses(),t.updateSize(),t.updateSlides(),t.params.watchOverflow&&t.checkOverflow(),t.params.grabCursor&&t.enabled&&t.setGrabCursor(),t.params.loop&&t.virtual&&t.params.virtual.enabled?t.slideTo(t.params.initialSlide+t.virtual.slidesBefore,0,t.params.runCallbacksOnInit,!1,!0):t.slideTo(t.params.initialSlide,0,t.params.runCallbacksOnInit,!1,!0),t.params.loop&&t.loopCreate(),t.attachEvents();let r=[...t.el.querySelectorAll('[loading="lazy"]')];return t.isElement&&r.push(...t.hostEl.querySelectorAll('[loading="lazy"]')),r.forEach(s=>{s.complete?Iy(t,s):s.addEventListener("load",o=>{Iy(t,o.target)})}),xx(t),t.initialized=!0,xx(t),t.emit("init"),t.emit("afterInit"),t}destroy(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0);let i=this,{params:r,el:s,wrapperEl:o,slides:a}=i;return typeof i.params>"u"||i.destroyed||(i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),r.loop&&i.loopDestroy(),t&&(i.removeClasses(),s&&typeof s!="string"&&s.removeAttribute("style"),o&&o.removeAttribute("style"),a&&a.length&&a.forEach(l=>{l.classList.remove(r.slideVisibleClass,r.slideFullyVisibleClass,r.slideActiveClass,r.slideNextClass,r.slidePrevClass),l.removeAttribute("style"),l.removeAttribute("data-swiper-slide-index")})),i.emit("destroy"),Object.keys(i.eventsListeners).forEach(l=>{i.off(l)}),e!==!1&&(i.el&&typeof i.el!="string"&&(i.el.swiper=null),aB(i)),i.destroyed=!0),null}static extendDefaults(e){Zn(Tx,e)}static get extendedDefaults(){return Tx}static get defaults(){return ky}static installModule(e){n.prototype.__modules__||(n.prototype.__modules__=[]);let t=n.prototype.__modules__;typeof e=="function"&&t.indexOf(e)<0&&t.push(e)}static use(e){return Array.isArray(e)?(e.forEach(t=>n.installModule(t)),n):(n.installModule(e),n)}};Object.keys(Cx).forEach(n=>{Object.keys(Cx[n]).forEach(e=>{Ho.prototype[e]=Cx[n][e]})});Ho.use([wne,Sne]);function _B(n){let{swiper:e,extendParams:t,on:i,emit:r}=n;t({virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}});let s,o=yt();e.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]};let a=o.createElement("div");function l(g,_){let S=e.params.virtual;if(S.cache&&e.virtual.cache[_])return e.virtual.cache[_];let I;return S.renderSlide?(I=S.renderSlide.call(e,g,_),typeof I=="string"&&(a.innerHTML=I,I=a.children[0])):e.isElement?I=tn("swiper-slide"):I=tn("div",e.params.slideClass),I.setAttribute("data-swiper-slide-index",_),S.renderSlide||(I.innerHTML=g),S.cache&&(e.virtual.cache[_]=I),I}function c(g,_){let{slidesPerView:S,slidesPerGroup:I,centeredSlides:E,loop:b,initialSlide:M}=e.params;if(_&&!b&&M>0)return;let{addSlidesBefore:N,addSlidesAfter:U}=e.params.virtual,{from:R,to:x,slides:T,slidesGrid:A,offset:C}=e.virtual;e.params.cssMode||e.updateActiveIndex();let P=e.activeIndex||0,y;e.rtlTranslate?y="right":y=e.isHorizontal()?"left":"top";let w,F;E?(w=Math.floor(S/2)+I+U,F=Math.floor(S/2)+I+N):(w=S+(I-1)+U,F=(b?S:I)+N);let Q=P-F,z=P+w;b||(Q=Math.max(Q,0),z=Math.min(z,T.length-1));let V=(e.slidesGrid[Q]||0)-(e.slidesGrid[0]||0);b&&P>=F?(Q-=F,E||(V+=e.slidesGrid[0])):b&&P<F&&(Q=-F,E&&(V+=e.slidesGrid[0])),Object.assign(e.virtual,{from:Q,to:z,offset:V,slidesGrid:e.slidesGrid,slidesBefore:F,slidesAfter:w});function ne(){e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),r("virtualUpdate")}if(R===Q&&x===z&&!g){e.slidesGrid!==A&&V!==C&&e.slides.forEach(ae=>{ae.style[y]=`${V-Math.abs(e.cssOverflowAdjustment())}px`}),e.updateProgress(),r("virtualUpdate");return}if(e.params.virtual.renderExternal){e.params.virtual.renderExternal.call(e,{offset:V,from:Q,to:z,slides:function(){let Ae=[];for(let Ot=Q;Ot<=z;Ot+=1)Ae.push(T[Ot]);return Ae}()}),e.params.virtual.renderExternalUpdate?ne():r("virtualUpdate");return}let ue=[],W=[],ee=ae=>{let Ae=ae;return ae<0?Ae=T.length+ae:Ae>=T.length&&(Ae=Ae-T.length),Ae};if(g)e.slides.filter(ae=>ae.matches(`.${e.params.slideClass}, swiper-slide`)).forEach(ae=>{ae.remove()});else for(let ae=R;ae<=x;ae+=1)if(ae<Q||ae>z){let Ae=ee(ae);e.slides.filter(Ot=>Ot.matches(`.${e.params.slideClass}[data-swiper-slide-index="${Ae}"], swiper-slide[data-swiper-slide-index="${Ae}"]`)).forEach(Ot=>{Ot.remove()})}let re=b?-T.length:0,Le=b?T.length*2:T.length;for(let ae=re;ae<Le;ae+=1)if(ae>=Q&&ae<=z){let Ae=ee(ae);typeof x>"u"||g?W.push(Ae):(ae>x&&W.push(Ae),ae<R&&ue.push(Ae))}if(W.forEach(ae=>{e.slidesEl.append(l(T[ae],ae))}),b)for(let ae=ue.length-1;ae>=0;ae-=1){let Ae=ue[ae];e.slidesEl.prepend(l(T[Ae],Ae))}else ue.sort((ae,Ae)=>Ae-ae),ue.forEach(ae=>{e.slidesEl.prepend(l(T[ae],ae))});At(e.slidesEl,".swiper-slide, swiper-slide").forEach(ae=>{ae.style[y]=`${V-Math.abs(e.cssOverflowAdjustment())}px`}),ne()}function u(g){if(typeof g=="object"&&"length"in g)for(let _=0;_<g.length;_+=1)g[_]&&e.virtual.slides.push(g[_]);else e.virtual.slides.push(g);c(!0)}function d(g){let _=e.activeIndex,S=_+1,I=1;if(Array.isArray(g)){for(let E=0;E<g.length;E+=1)g[E]&&e.virtual.slides.unshift(g[E]);S=_+g.length,I=g.length}else e.virtual.slides.unshift(g);if(e.params.virtual.cache){let E=e.virtual.cache,b={};Object.keys(E).forEach(M=>{let N=E[M],U=N.getAttribute("data-swiper-slide-index");U&&N.setAttribute("data-swiper-slide-index",parseInt(U,10)+I),b[parseInt(M,10)+I]=N}),e.virtual.cache=b}c(!0),e.slideTo(S,0)}function h(g){if(typeof g>"u"||g===null)return;let _=e.activeIndex;if(Array.isArray(g))for(let S=g.length-1;S>=0;S-=1)e.params.virtual.cache&&(delete e.virtual.cache[g[S]],Object.keys(e.virtual.cache).forEach(I=>{I>g&&(e.virtual.cache[I-1]=e.virtual.cache[I],e.virtual.cache[I-1].setAttribute("data-swiper-slide-index",I-1),delete e.virtual.cache[I])})),e.virtual.slides.splice(g[S],1),g[S]<_&&(_-=1),_=Math.max(_,0);else e.params.virtual.cache&&(delete e.virtual.cache[g],Object.keys(e.virtual.cache).forEach(S=>{S>g&&(e.virtual.cache[S-1]=e.virtual.cache[S],e.virtual.cache[S-1].setAttribute("data-swiper-slide-index",S-1),delete e.virtual.cache[S])})),e.virtual.slides.splice(g,1),g<_&&(_-=1),_=Math.max(_,0);c(!0),e.slideTo(_,0)}function f(){e.virtual.slides=[],e.params.virtual.cache&&(e.virtual.cache={}),c(!0),e.slideTo(0,0)}i("beforeInit",()=>{if(!e.params.virtual.enabled)return;let g;if(typeof e.passedParams.virtual.slides>"u"){let _=[...e.slidesEl.children].filter(S=>S.matches(`.${e.params.slideClass}, swiper-slide`));_&&_.length&&(e.virtual.slides=[..._],g=!0,_.forEach((S,I)=>{S.setAttribute("data-swiper-slide-index",I),e.virtual.cache[I]=S,S.remove()}))}g||(e.virtual.slides=e.params.virtual.slides),e.classNames.push(`${e.params.containerModifierClass}virtual`),e.params.watchSlidesProgress=!0,e.originalParams.watchSlidesProgress=!0,c(!1,!0)}),i("setTranslate",()=>{e.params.virtual.enabled&&(e.params.cssMode&&!e._immediateVirtual?(clearTimeout(s),s=setTimeout(()=>{c()},100)):c())}),i("init update resize",()=>{e.params.virtual.enabled&&e.params.cssMode&&cl(e.wrapperEl,"--swiper-virtual-size",`${e.virtualSize}px`)}),Object.assign(e.virtual,{appendSlide:u,prependSlide:d,removeSlide:h,removeAllSlides:f,update:c})}function wB(n){let{swiper:e,extendParams:t,on:i,emit:r}=n,s=yt(),o=ot();e.keyboard={enabled:!1},t({keyboard:{enabled:!1,onlyInViewport:!0,pageUpDown:!0}});function a(u){if(!e.enabled)return;let{rtlTranslate:d}=e,h=u;h.originalEvent&&(h=h.originalEvent);let f=h.keyCode||h.charCode,g=e.params.keyboard.pageUpDown,_=g&&f===33,S=g&&f===34,I=f===37,E=f===39,b=f===38,M=f===40;if(!e.allowSlideNext&&(e.isHorizontal()&&E||e.isVertical()&&M||S)||!e.allowSlidePrev&&(e.isHorizontal()&&I||e.isVertical()&&b||_))return!1;if(!(h.shiftKey||h.altKey||h.ctrlKey||h.metaKey)&&!(s.activeElement&&s.activeElement.nodeName&&(s.activeElement.nodeName.toLowerCase()==="input"||s.activeElement.nodeName.toLowerCase()==="textarea"))){if(e.params.keyboard.onlyInViewport&&(_||S||I||E||b||M)){let N=!1;if(pr(e.el,`.${e.params.slideClass}, swiper-slide`).length>0&&pr(e.el,`.${e.params.slideActiveClass}`).length===0)return;let U=e.el,R=U.clientWidth,x=U.clientHeight,T=o.innerWidth,A=o.innerHeight,C=ul(U);d&&(C.left-=U.scrollLeft);let P=[[C.left,C.top],[C.left+R,C.top],[C.left,C.top+x],[C.left+R,C.top+x]];for(let y=0;y<P.length;y+=1){let w=P[y];if(w[0]>=0&&w[0]<=T&&w[1]>=0&&w[1]<=A){if(w[0]===0&&w[1]===0)continue;N=!0}}if(!N)return}e.isHorizontal()?((_||S||I||E)&&(h.preventDefault?h.preventDefault():h.returnValue=!1),((S||E)&&!d||(_||I)&&d)&&e.slideNext(),((_||I)&&!d||(S||E)&&d)&&e.slidePrev()):((_||S||b||M)&&(h.preventDefault?h.preventDefault():h.returnValue=!1),(S||M)&&e.slideNext(),(_||b)&&e.slidePrev()),r("keyPress",f)}}function l(){e.keyboard.enabled||(s.addEventListener("keydown",a),e.keyboard.enabled=!0)}function c(){e.keyboard.enabled&&(s.removeEventListener("keydown",a),e.keyboard.enabled=!1)}i("init",()=>{e.params.keyboard.enabled&&l()}),i("destroy",()=>{e.keyboard.enabled&&c()}),Object.assign(e.keyboard,{enable:l,disable:c})}function SB(n){let{swiper:e,extendParams:t,on:i,emit:r}=n,s=ot();t({mousewheel:{enabled:!1,releaseOnEdges:!1,invert:!1,forceToAxis:!1,sensitivity:1,eventsTarget:"container",thresholdDelta:null,thresholdTime:null,noMousewheelClass:"swiper-no-mousewheel"}}),e.mousewheel={enabled:!1};let o,a=zn(),l,c=[];function u(b){let R=0,x=0,T=0,A=0;return"detail"in b&&(x=b.detail),"wheelDelta"in b&&(x=-b.wheelDelta/120),"wheelDeltaY"in b&&(x=-b.wheelDeltaY/120),"wheelDeltaX"in b&&(R=-b.wheelDeltaX/120),"axis"in b&&b.axis===b.HORIZONTAL_AXIS&&(R=x,x=0),T=R*10,A=x*10,"deltaY"in b&&(A=b.deltaY),"deltaX"in b&&(T=b.deltaX),b.shiftKey&&!T&&(T=A,A=0),(T||A)&&b.deltaMode&&(b.deltaMode===1?(T*=40,A*=40):(T*=800,A*=800)),T&&!R&&(R=T<1?-1:1),A&&!x&&(x=A<1?-1:1),{spinX:R,spinY:x,pixelX:T,pixelY:A}}function d(){e.enabled&&(e.mouseEntered=!0)}function h(){e.enabled&&(e.mouseEntered=!1)}function f(b){return e.params.mousewheel.thresholdDelta&&b.delta<e.params.mousewheel.thresholdDelta||e.params.mousewheel.thresholdTime&&zn()-a<e.params.mousewheel.thresholdTime?!1:b.delta>=6&&zn()-a<60?!0:(b.direction<0?(!e.isEnd||e.params.loop)&&!e.animating&&(e.slideNext(),r("scroll",b.raw)):(!e.isBeginning||e.params.loop)&&!e.animating&&(e.slidePrev(),r("scroll",b.raw)),a=new s.Date().getTime(),!1)}function g(b){let M=e.params.mousewheel;if(b.direction<0){if(e.isEnd&&!e.params.loop&&M.releaseOnEdges)return!0}else if(e.isBeginning&&!e.params.loop&&M.releaseOnEdges)return!0;return!1}function _(b){let M=b,N=!0;if(!e.enabled||b.target.closest(`.${e.params.mousewheel.noMousewheelClass}`))return;let U=e.params.mousewheel;e.params.cssMode&&M.preventDefault();let R=e.el;e.params.mousewheel.eventsTarget!=="container"&&(R=document.querySelector(e.params.mousewheel.eventsTarget));let x=R&&R.contains(M.target);if(!e.mouseEntered&&!x&&!U.releaseOnEdges)return!0;M.originalEvent&&(M=M.originalEvent);let T=0,A=e.rtlTranslate?-1:1,C=u(M);if(U.forceToAxis)if(e.isHorizontal())if(Math.abs(C.pixelX)>Math.abs(C.pixelY))T=-C.pixelX*A;else return!0;else if(Math.abs(C.pixelY)>Math.abs(C.pixelX))T=-C.pixelY;else return!0;else T=Math.abs(C.pixelX)>Math.abs(C.pixelY)?-C.pixelX*A:-C.pixelY;if(T===0)return!0;U.invert&&(T=-T);let P=e.getTranslate()+T*U.sensitivity;if(P>=e.minTranslate()&&(P=e.minTranslate()),P<=e.maxTranslate()&&(P=e.maxTranslate()),N=e.params.loop?!0:!(P===e.minTranslate()||P===e.maxTranslate()),N&&e.params.nested&&M.stopPropagation(),!e.params.freeMode||!e.params.freeMode.enabled){let y={time:zn(),delta:Math.abs(T),direction:Math.sign(T),raw:b};c.length>=2&&c.shift();let w=c.length?c[c.length-1]:void 0;if(c.push(y),w?(y.direction!==w.direction||y.delta>w.delta||y.time>w.time+150)&&f(y):f(y),g(y))return!0}else{let y={time:zn(),delta:Math.abs(T),direction:Math.sign(T)},w=l&&y.time<l.time+500&&y.delta<=l.delta&&y.direction===l.direction;if(!w){l=void 0;let F=e.getTranslate()+T*U.sensitivity,Q=e.isBeginning,z=e.isEnd;if(F>=e.minTranslate()&&(F=e.minTranslate()),F<=e.maxTranslate()&&(F=e.maxTranslate()),e.setTransition(0),e.setTranslate(F),e.updateProgress(),e.updateActiveIndex(),e.updateSlidesClasses(),(!Q&&e.isBeginning||!z&&e.isEnd)&&e.updateSlidesClasses(),e.params.loop&&e.loopFix({direction:y.direction<0?"next":"prev",byMousewheel:!0}),e.params.freeMode.sticky){clearTimeout(o),o=void 0,c.length>=15&&c.shift();let V=c.length?c[c.length-1]:void 0,ne=c[0];if(c.push(y),V&&(y.delta>V.delta||y.direction!==V.direction))c.splice(0);else if(c.length>=15&&y.time-ne.time<500&&ne.delta-y.delta>=1&&y.delta<=6){let ue=T>0?.8:.2;l=y,c.splice(0),o=fr(()=>{e.destroyed||!e.params||e.slideToClosest(e.params.speed,!0,void 0,ue)},0)}o||(o=fr(()=>{if(e.destroyed||!e.params)return;let ue=.5;l=y,c.splice(0),e.slideToClosest(e.params.speed,!0,void 0,ue)},500))}if(w||r("scroll",M),e.params.autoplay&&e.params.autoplayDisableOnInteraction&&e.autoplay.stop(),U.releaseOnEdges&&(F===e.minTranslate()||F===e.maxTranslate()))return!0}}return M.preventDefault?M.preventDefault():M.returnValue=!1,!1}function S(b){let M=e.el;e.params.mousewheel.eventsTarget!=="container"&&(M=document.querySelector(e.params.mousewheel.eventsTarget)),M[b]("mouseenter",d),M[b]("mouseleave",h),M[b]("wheel",_)}function I(){return e.params.cssMode?(e.wrapperEl.removeEventListener("wheel",_),!0):e.mousewheel.enabled?!1:(S("addEventListener"),e.mousewheel.enabled=!0,!0)}function E(){return e.params.cssMode?(e.wrapperEl.addEventListener(event,_),!0):e.mousewheel.enabled?(S("removeEventListener"),e.mousewheel.enabled=!1,!0):!1}i("init",()=>{!e.params.mousewheel.enabled&&e.params.cssMode&&E(),e.params.mousewheel.enabled&&I()}),i("destroy",()=>{e.params.cssMode&&I(),e.mousewheel.enabled&&E()}),Object.assign(e.mousewheel,{enable:I,disable:E})}function xu(n,e,t,i){return n.params.createElements&&Object.keys(i).forEach(r=>{if(!t[r]&&t.auto===!0){let s=At(n.el,`.${i[r]}`)[0];s||(s=tn("div",i[r]),s.className=i[r],n.el.append(s)),t[r]=s,e[r]=s}}),t}function bB(n){let{swiper:e,extendParams:t,on:i,emit:r}=n;t({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null};function s(g){let _;return g&&typeof g=="string"&&e.isElement&&(_=e.el.querySelector(g)||e.hostEl.querySelector(g),_)?_:(g&&(typeof g=="string"&&(_=[...document.querySelectorAll(g)]),e.params.uniqueNavElements&&typeof g=="string"&&_&&_.length>1&&e.el.querySelectorAll(g).length===1?_=e.el.querySelector(g):_&&_.length===1&&(_=_[0])),g&&!_?g:_)}function o(g,_){let S=e.params.navigation;g=Ue(g),g.forEach(I=>{I&&(I.classList[_?"add":"remove"](...S.disabledClass.split(" ")),I.tagName==="BUTTON"&&(I.disabled=_),e.params.watchOverflow&&e.enabled&&I.classList[e.isLocked?"add":"remove"](S.lockClass))})}function a(){let{nextEl:g,prevEl:_}=e.navigation;if(e.params.loop){o(_,!1),o(g,!1);return}o(_,e.isBeginning&&!e.params.rewind),o(g,e.isEnd&&!e.params.rewind)}function l(g){g.preventDefault(),!(e.isBeginning&&!e.params.loop&&!e.params.rewind)&&(e.slidePrev(),r("navigationPrev"))}function c(g){g.preventDefault(),!(e.isEnd&&!e.params.loop&&!e.params.rewind)&&(e.slideNext(),r("navigationNext"))}function u(){let g=e.params.navigation;if(e.params.navigation=xu(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(g.nextEl||g.prevEl))return;let _=s(g.nextEl),S=s(g.prevEl);Object.assign(e.navigation,{nextEl:_,prevEl:S}),_=Ue(_),S=Ue(S);let I=(E,b)=>{E&&E.addEventListener("click",b==="next"?c:l),!e.enabled&&E&&E.classList.add(...g.lockClass.split(" "))};_.forEach(E=>I(E,"next")),S.forEach(E=>I(E,"prev"))}function d(){let{nextEl:g,prevEl:_}=e.navigation;g=Ue(g),_=Ue(_);let S=(I,E)=>{I.removeEventListener("click",E==="next"?c:l),I.classList.remove(...e.params.navigation.disabledClass.split(" "))};g.forEach(I=>S(I,"next")),_.forEach(I=>S(I,"prev"))}i("init",()=>{e.params.navigation.enabled===!1?f():(u(),a())}),i("toEdge fromEdge lock unlock",()=>{a()}),i("destroy",()=>{d()}),i("enable disable",()=>{let{nextEl:g,prevEl:_}=e.navigation;if(g=Ue(g),_=Ue(_),e.enabled){a();return}[...g,..._].filter(S=>!!S).forEach(S=>S.classList.add(e.params.navigation.lockClass))}),i("click",(g,_)=>{let{nextEl:S,prevEl:I}=e.navigation;S=Ue(S),I=Ue(I);let E=_.target,b=I.includes(E)||S.includes(E);if(e.isElement&&!b){let M=_.path||_.composedPath&&_.composedPath();M&&(b=M.find(N=>S.includes(N)||I.includes(N)))}if(e.params.navigation.hideOnClick&&!b){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===E||e.pagination.el.contains(E)))return;let M;S.length?M=S[0].classList.contains(e.params.navigation.hiddenClass):I.length&&(M=I[0].classList.contains(e.params.navigation.hiddenClass)),r(M===!0?"navigationShow":"navigationHide"),[...S,...I].filter(N=>!!N).forEach(N=>N.classList.toggle(e.params.navigation.hiddenClass))}});let h=()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),u(),a()},f=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),d()};Object.assign(e.navigation,{enable:h,disable:f,update:a,init:u,destroy:d})}function Hi(n){return n===void 0&&(n=""),`.${n.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function EB(n){let{swiper:e,extendParams:t,on:i,emit:r}=n,s="swiper-pagination";t({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:E=>E,formatFractionTotal:E=>E,bulletClass:`${s}-bullet`,bulletActiveClass:`${s}-bullet-active`,modifierClass:`${s}-`,currentClass:`${s}-current`,totalClass:`${s}-total`,hiddenClass:`${s}-hidden`,progressbarFillClass:`${s}-progressbar-fill`,progressbarOppositeClass:`${s}-progressbar-opposite`,clickableClass:`${s}-clickable`,lockClass:`${s}-lock`,horizontalClass:`${s}-horizontal`,verticalClass:`${s}-vertical`,paginationDisabledClass:`${s}-disabled`}}),e.pagination={el:null,bullets:[]};let o,a=0;function l(){return!e.params.pagination.el||!e.pagination.el||Array.isArray(e.pagination.el)&&e.pagination.el.length===0}function c(E,b){let{bulletActiveClass:M}=e.params.pagination;E&&(E=E[`${b==="prev"?"previous":"next"}ElementSibling`],E&&(E.classList.add(`${M}-${b}`),E=E[`${b==="prev"?"previous":"next"}ElementSibling`],E&&E.classList.add(`${M}-${b}-${b}`)))}function u(E,b,M){if(E=E%M,b=b%M,b===E+1)return"next";if(b===E-1)return"previous"}function d(E){let b=E.target.closest(Hi(e.params.pagination.bulletClass));if(!b)return;E.preventDefault();let M=$o(b)*e.params.slidesPerGroup;if(e.params.loop){if(e.realIndex===M)return;let N=u(e.realIndex,M,e.slides.length);N==="next"?e.slideNext():N==="previous"?e.slidePrev():e.slideToLoop(M)}else e.slideTo(M)}function h(){let E=e.rtl,b=e.params.pagination;if(l())return;let M=e.pagination.el;M=Ue(M);let N,U,R=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,x=e.params.loop?Math.ceil(R/e.params.slidesPerGroup):e.snapGrid.length;if(e.params.loop?(U=e.previousRealIndex||0,N=e.params.slidesPerGroup>1?Math.floor(e.realIndex/e.params.slidesPerGroup):e.realIndex):typeof e.snapIndex<"u"?(N=e.snapIndex,U=e.previousSnapIndex):(U=e.previousIndex||0,N=e.activeIndex||0),b.type==="bullets"&&e.pagination.bullets&&e.pagination.bullets.length>0){let T=e.pagination.bullets,A,C,P;if(b.dynamicBullets&&(o=Sf(T[0],e.isHorizontal()?"width":"height",!0),M.forEach(y=>{y.style[e.isHorizontal()?"width":"height"]=`${o*(b.dynamicMainBullets+4)}px`}),b.dynamicMainBullets>1&&U!==void 0&&(a+=N-(U||0),a>b.dynamicMainBullets-1?a=b.dynamicMainBullets-1:a<0&&(a=0)),A=Math.max(N-a,0),C=A+(Math.min(T.length,b.dynamicMainBullets)-1),P=(C+A)/2),T.forEach(y=>{let w=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(F=>`${b.bulletActiveClass}${F}`)].map(F=>typeof F=="string"&&F.includes(" ")?F.split(" "):F).flat();y.classList.remove(...w)}),M.length>1)T.forEach(y=>{let w=$o(y);w===N?y.classList.add(...b.bulletActiveClass.split(" ")):e.isElement&&y.setAttribute("part","bullet"),b.dynamicBullets&&(w>=A&&w<=C&&y.classList.add(...`${b.bulletActiveClass}-main`.split(" ")),w===A&&c(y,"prev"),w===C&&c(y,"next"))});else{let y=T[N];if(y&&y.classList.add(...b.bulletActiveClass.split(" ")),e.isElement&&T.forEach((w,F)=>{w.setAttribute("part",F===N?"bullet-active":"bullet")}),b.dynamicBullets){let w=T[A],F=T[C];for(let Q=A;Q<=C;Q+=1)T[Q]&&T[Q].classList.add(...`${b.bulletActiveClass}-main`.split(" "));c(w,"prev"),c(F,"next")}}if(b.dynamicBullets){let y=Math.min(T.length,b.dynamicMainBullets+4),w=(o*y-o)/2-P*o,F=E?"right":"left";T.forEach(Q=>{Q.style[e.isHorizontal()?F:"top"]=`${w}px`})}}M.forEach((T,A)=>{if(b.type==="fraction"&&(T.querySelectorAll(Hi(b.currentClass)).forEach(C=>{C.textContent=b.formatFractionCurrent(N+1)}),T.querySelectorAll(Hi(b.totalClass)).forEach(C=>{C.textContent=b.formatFractionTotal(x)})),b.type==="progressbar"){let C;b.progressbarOpposite?C=e.isHorizontal()?"vertical":"horizontal":C=e.isHorizontal()?"horizontal":"vertical";let P=(N+1)/x,y=1,w=1;C==="horizontal"?y=P:w=P,T.querySelectorAll(Hi(b.progressbarFillClass)).forEach(F=>{F.style.transform=`translate3d(0,0,0) scaleX(${y}) scaleY(${w})`,F.style.transitionDuration=`${e.params.speed}ms`})}b.type==="custom"&&b.renderCustom?(T.innerHTML=b.renderCustom(e,N+1,x),A===0&&r("paginationRender",T)):(A===0&&r("paginationRender",T),r("paginationUpdate",T)),e.params.watchOverflow&&e.enabled&&T.classList[e.isLocked?"add":"remove"](b.lockClass)})}function f(){let E=e.params.pagination;if(l())return;let b=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.grid&&e.params.grid.rows>1?e.slides.length/Math.ceil(e.params.grid.rows):e.slides.length,M=e.pagination.el;M=Ue(M);let N="";if(E.type==="bullets"){let U=e.params.loop?Math.ceil(b/e.params.slidesPerGroup):e.snapGrid.length;e.params.freeMode&&e.params.freeMode.enabled&&U>b&&(U=b);for(let R=0;R<U;R+=1)E.renderBullet?N+=E.renderBullet.call(e,R,E.bulletClass):N+=`<${E.bulletElement} ${e.isElement?'part="bullet"':""} class="${E.bulletClass}"></${E.bulletElement}>`}E.type==="fraction"&&(E.renderFraction?N=E.renderFraction.call(e,E.currentClass,E.totalClass):N=`<span class="${E.currentClass}"></span> / <span class="${E.totalClass}"></span>`),E.type==="progressbar"&&(E.renderProgressbar?N=E.renderProgressbar.call(e,E.progressbarFillClass):N=`<span class="${E.progressbarFillClass}"></span>`),e.pagination.bullets=[],M.forEach(U=>{E.type!=="custom"&&(U.innerHTML=N||""),E.type==="bullets"&&e.pagination.bullets.push(...U.querySelectorAll(Hi(E.bulletClass)))}),E.type!=="custom"&&r("paginationRender",M[0])}function g(){e.params.pagination=xu(e,e.originalParams.pagination,e.params.pagination,{el:"swiper-pagination"});let E=e.params.pagination;if(!E.el)return;let b;typeof E.el=="string"&&e.isElement&&(b=e.el.querySelector(E.el)),!b&&typeof E.el=="string"&&(b=[...document.querySelectorAll(E.el)]),b||(b=E.el),!(!b||b.length===0)&&(e.params.uniqueNavElements&&typeof E.el=="string"&&Array.isArray(b)&&b.length>1&&(b=[...e.el.querySelectorAll(E.el)],b.length>1&&(b=b.filter(M=>pr(M,".swiper")[0]===e.el)[0])),Array.isArray(b)&&b.length===1&&(b=b[0]),Object.assign(e.pagination,{el:b}),b=Ue(b),b.forEach(M=>{E.type==="bullets"&&E.clickable&&M.classList.add(...(E.clickableClass||"").split(" ")),M.classList.add(E.modifierClass+E.type),M.classList.add(e.isHorizontal()?E.horizontalClass:E.verticalClass),E.type==="bullets"&&E.dynamicBullets&&(M.classList.add(`${E.modifierClass}${E.type}-dynamic`),a=0,E.dynamicMainBullets<1&&(E.dynamicMainBullets=1)),E.type==="progressbar"&&E.progressbarOpposite&&M.classList.add(E.progressbarOppositeClass),E.clickable&&M.addEventListener("click",d),e.enabled||M.classList.add(E.lockClass)}))}function _(){let E=e.params.pagination;if(l())return;let b=e.pagination.el;b&&(b=Ue(b),b.forEach(M=>{M.classList.remove(E.hiddenClass),M.classList.remove(E.modifierClass+E.type),M.classList.remove(e.isHorizontal()?E.horizontalClass:E.verticalClass),E.clickable&&(M.classList.remove(...(E.clickableClass||"").split(" ")),M.removeEventListener("click",d))})),e.pagination.bullets&&e.pagination.bullets.forEach(M=>M.classList.remove(...E.bulletActiveClass.split(" ")))}i("changeDirection",()=>{if(!e.pagination||!e.pagination.el)return;let E=e.params.pagination,{el:b}=e.pagination;b=Ue(b),b.forEach(M=>{M.classList.remove(E.horizontalClass,E.verticalClass),M.classList.add(e.isHorizontal()?E.horizontalClass:E.verticalClass)})}),i("init",()=>{e.params.pagination.enabled===!1?I():(g(),f(),h())}),i("activeIndexChange",()=>{typeof e.snapIndex>"u"&&h()}),i("snapIndexChange",()=>{h()}),i("snapGridLengthChange",()=>{f(),h()}),i("destroy",()=>{_()}),i("enable disable",()=>{let{el:E}=e.pagination;E&&(E=Ue(E),E.forEach(b=>b.classList[e.enabled?"remove":"add"](e.params.pagination.lockClass)))}),i("lock unlock",()=>{h()}),i("click",(E,b)=>{let M=b.target,N=Ue(e.pagination.el);if(e.params.pagination.el&&e.params.pagination.hideOnClick&&N&&N.length>0&&!M.classList.contains(e.params.pagination.bulletClass)){if(e.navigation&&(e.navigation.nextEl&&M===e.navigation.nextEl||e.navigation.prevEl&&M===e.navigation.prevEl))return;let U=N[0].classList.contains(e.params.pagination.hiddenClass);r(U===!0?"paginationShow":"paginationHide"),N.forEach(R=>R.classList.toggle(e.params.pagination.hiddenClass))}});let S=()=>{e.el.classList.remove(e.params.pagination.paginationDisabledClass);let{el:E}=e.pagination;E&&(E=Ue(E),E.forEach(b=>b.classList.remove(e.params.pagination.paginationDisabledClass))),g(),f(),h()},I=()=>{e.el.classList.add(e.params.pagination.paginationDisabledClass);let{el:E}=e.pagination;E&&(E=Ue(E),E.forEach(b=>b.classList.add(e.params.pagination.paginationDisabledClass))),_()};Object.assign(e.pagination,{enable:S,disable:I,render:f,update:h,init:g,destroy:_})}function CB(n){let{swiper:e,extendParams:t,on:i,emit:r}=n,s=yt(),o=!1,a=null,l=null,c,u,d,h;t({scrollbar:{el:null,dragSize:"auto",hide:!1,draggable:!1,snapOnRelease:!0,lockClass:"swiper-scrollbar-lock",dragClass:"swiper-scrollbar-drag",scrollbarDisabledClass:"swiper-scrollbar-disabled",horizontalClass:"swiper-scrollbar-horizontal",verticalClass:"swiper-scrollbar-vertical"}}),e.scrollbar={el:null,dragEl:null};function f(){if(!e.params.scrollbar.el||!e.scrollbar.el)return;let{scrollbar:P,rtlTranslate:y}=e,{dragEl:w,el:F}=P,Q=e.params.scrollbar,z=e.params.loop?e.progressLoop:e.progress,V=u,ne=(d-u)*z;y?(ne=-ne,ne>0?(V=u-ne,ne=0):-ne+u>d&&(V=d+ne)):ne<0?(V=u+ne,ne=0):ne+u>d&&(V=d-ne),e.isHorizontal()?(w.style.transform=`translate3d(${ne}px, 0, 0)`,w.style.width=`${V}px`):(w.style.transform=`translate3d(0px, ${ne}px, 0)`,w.style.height=`${V}px`),Q.hide&&(clearTimeout(a),F.style.opacity=1,a=setTimeout(()=>{F.style.opacity=0,F.style.transitionDuration="400ms"},1e3))}function g(P){!e.params.scrollbar.el||!e.scrollbar.el||(e.scrollbar.dragEl.style.transitionDuration=`${P}ms`)}function _(){if(!e.params.scrollbar.el||!e.scrollbar.el)return;let{scrollbar:P}=e,{dragEl:y,el:w}=P;y.style.width="",y.style.height="",d=e.isHorizontal()?w.offsetWidth:w.offsetHeight,h=e.size/(e.virtualSize+e.params.slidesOffsetBefore-(e.params.centeredSlides?e.snapGrid[0]:0)),e.params.scrollbar.dragSize==="auto"?u=d*h:u=parseInt(e.params.scrollbar.dragSize,10),e.isHorizontal()?y.style.width=`${u}px`:y.style.height=`${u}px`,h>=1?w.style.display="none":w.style.display="",e.params.scrollbar.hide&&(w.style.opacity=0),e.params.watchOverflow&&e.enabled&&P.el.classList[e.isLocked?"add":"remove"](e.params.scrollbar.lockClass)}function S(P){return e.isHorizontal()?P.clientX:P.clientY}function I(P){let{scrollbar:y,rtlTranslate:w}=e,{el:F}=y,Q;Q=(S(P)-ul(F)[e.isHorizontal()?"left":"top"]-(c!==null?c:u/2))/(d-u),Q=Math.max(Math.min(Q,1),0),w&&(Q=1-Q);let z=e.minTranslate()+(e.maxTranslate()-e.minTranslate())*Q;e.updateProgress(z),e.setTranslate(z),e.updateActiveIndex(),e.updateSlidesClasses()}function E(P){let y=e.params.scrollbar,{scrollbar:w,wrapperEl:F}=e,{el:Q,dragEl:z}=w;o=!0,c=P.target===z?S(P)-P.target.getBoundingClientRect()[e.isHorizontal()?"left":"top"]:null,P.preventDefault(),P.stopPropagation(),F.style.transitionDuration="100ms",z.style.transitionDuration="100ms",I(P),clearTimeout(l),Q.style.transitionDuration="0ms",y.hide&&(Q.style.opacity=1),e.params.cssMode&&(e.wrapperEl.style["scroll-snap-type"]="none"),r("scrollbarDragStart",P)}function b(P){let{scrollbar:y,wrapperEl:w}=e,{el:F,dragEl:Q}=y;o&&(P.preventDefault&&P.cancelable?P.preventDefault():P.returnValue=!1,I(P),w.style.transitionDuration="0ms",F.style.transitionDuration="0ms",Q.style.transitionDuration="0ms",r("scrollbarDragMove",P))}function M(P){let y=e.params.scrollbar,{scrollbar:w,wrapperEl:F}=e,{el:Q}=w;o&&(o=!1,e.params.cssMode&&(e.wrapperEl.style["scroll-snap-type"]="",F.style.transitionDuration=""),y.hide&&(clearTimeout(l),l=fr(()=>{Q.style.opacity=0,Q.style.transitionDuration="400ms"},1e3)),r("scrollbarDragEnd",P),y.snapOnRelease&&e.slideToClosest())}function N(P){let{scrollbar:y,params:w}=e,F=y.el;if(!F)return;let Q=F,z=w.passiveListeners?{passive:!1,capture:!1}:!1,V=w.passiveListeners?{passive:!0,capture:!1}:!1;if(!Q)return;let ne=P==="on"?"addEventListener":"removeEventListener";Q[ne]("pointerdown",E,z),s[ne]("pointermove",b,z),s[ne]("pointerup",M,V)}function U(){!e.params.scrollbar.el||!e.scrollbar.el||N("on")}function R(){!e.params.scrollbar.el||!e.scrollbar.el||N("off")}function x(){let{scrollbar:P,el:y}=e;e.params.scrollbar=xu(e,e.originalParams.scrollbar,e.params.scrollbar,{el:"swiper-scrollbar"});let w=e.params.scrollbar;if(!w.el)return;let F;if(typeof w.el=="string"&&e.isElement&&(F=e.el.querySelector(w.el)),!F&&typeof w.el=="string"){if(F=s.querySelectorAll(w.el),!F.length)return}else F||(F=w.el);e.params.uniqueNavElements&&typeof w.el=="string"&&F.length>1&&y.querySelectorAll(w.el).length===1&&(F=y.querySelector(w.el)),F.length>0&&(F=F[0]),F.classList.add(e.isHorizontal()?w.horizontalClass:w.verticalClass);let Q;F&&(Q=F.querySelector(Hi(e.params.scrollbar.dragClass)),Q||(Q=tn("div",e.params.scrollbar.dragClass),F.append(Q))),Object.assign(P,{el:F,dragEl:Q}),w.draggable&&U(),F&&F.classList[e.enabled?"remove":"add"](...ws(e.params.scrollbar.lockClass))}function T(){let P=e.params.scrollbar,y=e.scrollbar.el;y&&y.classList.remove(...ws(e.isHorizontal()?P.horizontalClass:P.verticalClass)),R()}i("changeDirection",()=>{if(!e.scrollbar||!e.scrollbar.el)return;let P=e.params.scrollbar,{el:y}=e.scrollbar;y=Ue(y),y.forEach(w=>{w.classList.remove(P.horizontalClass,P.verticalClass),w.classList.add(e.isHorizontal()?P.horizontalClass:P.verticalClass)})}),i("init",()=>{e.params.scrollbar.enabled===!1?C():(x(),_(),f())}),i("update resize observerUpdate lock unlock changeDirection",()=>{_()}),i("setTranslate",()=>{f()}),i("setTransition",(P,y)=>{g(y)}),i("enable disable",()=>{let{el:P}=e.scrollbar;P&&P.classList[e.enabled?"remove":"add"](...ws(e.params.scrollbar.lockClass))}),i("destroy",()=>{T()});let A=()=>{e.el.classList.remove(...ws(e.params.scrollbar.scrollbarDisabledClass)),e.scrollbar.el&&e.scrollbar.el.classList.remove(...ws(e.params.scrollbar.scrollbarDisabledClass)),x(),_(),f()},C=()=>{e.el.classList.add(...ws(e.params.scrollbar.scrollbarDisabledClass)),e.scrollbar.el&&e.scrollbar.el.classList.add(...ws(e.params.scrollbar.scrollbarDisabledClass)),T()};Object.assign(e.scrollbar,{enable:A,disable:C,updateSize:_,setTranslate:f,init:x,destroy:T})}function TB(n){let{swiper:e,extendParams:t,on:i}=n;t({parallax:{enabled:!1}});let r="[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]",s=(l,c)=>{let{rtl:u}=e,d=u?-1:1,h=l.getAttribute("data-swiper-parallax")||"0",f=l.getAttribute("data-swiper-parallax-x"),g=l.getAttribute("data-swiper-parallax-y"),_=l.getAttribute("data-swiper-parallax-scale"),S=l.getAttribute("data-swiper-parallax-opacity"),I=l.getAttribute("data-swiper-parallax-rotate");if(f||g?(f=f||"0",g=g||"0"):e.isHorizontal()?(f=h,g="0"):(g=h,f="0"),f.indexOf("%")>=0?f=`${parseInt(f,10)*c*d}%`:f=`${f*c*d}px`,g.indexOf("%")>=0?g=`${parseInt(g,10)*c}%`:g=`${g*c}px`,typeof S<"u"&&S!==null){let b=S-(S-1)*(1-Math.abs(c));l.style.opacity=b}let E=`translate3d(${f}, ${g}, 0px)`;if(typeof _<"u"&&_!==null){let b=_-(_-1)*(1-Math.abs(c));E+=` scale(${b})`}if(I&&typeof I<"u"&&I!==null){let b=I*c*-1;E+=` rotate(${b}deg)`}l.style.transform=E},o=()=>{let{el:l,slides:c,progress:u,snapGrid:d,isElement:h}=e,f=At(l,r);e.isElement&&f.push(...At(e.hostEl,r)),f.forEach(g=>{s(g,u)}),c.forEach((g,_)=>{let S=g.progress;e.params.slidesPerGroup>1&&e.params.slidesPerView!=="auto"&&(S+=Math.ceil(_/2)-u*(d.length-1)),S=Math.min(Math.max(S,-1),1),g.querySelectorAll(`${r}, [data-swiper-parallax-rotate]`).forEach(I=>{s(I,S)})})},a=function(l){l===void 0&&(l=e.params.speed);let{el:c,hostEl:u}=e,d=[...c.querySelectorAll(r)];e.isElement&&d.push(...u.querySelectorAll(r)),d.forEach(h=>{let f=parseInt(h.getAttribute("data-swiper-parallax-duration"),10)||l;l===0&&(f=0),h.style.transitionDuration=`${f}ms`})};i("beforeInit",()=>{e.params.parallax.enabled&&(e.params.watchSlidesProgress=!0,e.originalParams.watchSlidesProgress=!0)}),i("init",()=>{e.params.parallax.enabled&&o()}),i("setTranslate",()=>{e.params.parallax.enabled&&o()}),i("setTransition",(l,c)=>{e.params.parallax.enabled&&a(c)})}function xB(n){let{swiper:e,extendParams:t,on:i,emit:r}=n,s=ot();t({zoom:{enabled:!1,limitToOriginalSize:!1,maxRatio:3,minRatio:1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}}),e.zoom={enabled:!1};let o=1,a=!1,l,c,u=[],d={originX:0,originY:0,slideEl:void 0,slideWidth:void 0,slideHeight:void 0,imageEl:void 0,imageWrapEl:void 0,maxRatio:3},h={isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},f={x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0},g=1;Object.defineProperty(e.zoom,"scale",{get(){return g},set(W){if(g!==W){let ee=d.imageEl,re=d.slideEl;r("zoomChange",W,ee,re)}g=W}});function _(){if(u.length<2)return 1;let W=u[0].pageX,ee=u[0].pageY,re=u[1].pageX,Le=u[1].pageY;return Math.sqrt((re-W)**2+(Le-ee)**2)}function S(){let W=e.params.zoom,ee=d.imageWrapEl.getAttribute("data-swiper-zoom")||W.maxRatio;if(W.limitToOriginalSize&&d.imageEl&&d.imageEl.naturalWidth){let re=d.imageEl.naturalWidth/d.imageEl.offsetWidth;return Math.min(re,ee)}return ee}function I(){if(u.length<2)return{x:null,y:null};let W=d.imageEl.getBoundingClientRect();return[(u[0].pageX+(u[1].pageX-u[0].pageX)/2-W.x-s.scrollX)/o,(u[0].pageY+(u[1].pageY-u[0].pageY)/2-W.y-s.scrollY)/o]}function E(){return e.isElement?"swiper-slide":`.${e.params.slideClass}`}function b(W){let ee=E();return!!(W.target.matches(ee)||e.slides.filter(re=>re.contains(W.target)).length>0)}function M(W){let ee=`.${e.params.zoom.containerClass}`;return!!(W.target.matches(ee)||[...e.hostEl.querySelectorAll(ee)].filter(re=>re.contains(W.target)).length>0)}function N(W){if(W.pointerType==="mouse"&&u.splice(0,u.length),!b(W))return;let ee=e.params.zoom;if(l=!1,c=!1,u.push(W),!(u.length<2)){if(l=!0,d.scaleStart=_(),!d.slideEl){d.slideEl=W.target.closest(`.${e.params.slideClass}, swiper-slide`),d.slideEl||(d.slideEl=e.slides[e.activeIndex]);let re=d.slideEl.querySelector(`.${ee.containerClass}`);if(re&&(re=re.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),d.imageEl=re,re?d.imageWrapEl=pr(d.imageEl,`.${ee.containerClass}`)[0]:d.imageWrapEl=void 0,!d.imageWrapEl){d.imageEl=void 0;return}d.maxRatio=S()}if(d.imageEl){let[re,Le]=I();d.originX=re,d.originY=Le,d.imageEl.style.transitionDuration="0ms"}a=!0}}function U(W){if(!b(W))return;let ee=e.params.zoom,re=e.zoom,Le=u.findIndex(ae=>ae.pointerId===W.pointerId);Le>=0&&(u[Le]=W),!(u.length<2)&&(c=!0,d.scaleMove=_(),d.imageEl&&(re.scale=d.scaleMove/d.scaleStart*o,re.scale>d.maxRatio&&(re.scale=d.maxRatio-1+(re.scale-d.maxRatio+1)**.5),re.scale<ee.minRatio&&(re.scale=ee.minRatio+1-(ee.minRatio-re.scale+1)**.5),d.imageEl.style.transform=`translate3d(0,0,0) scale(${re.scale})`))}function R(W){if(!b(W)||W.pointerType==="mouse"&&W.type==="pointerout")return;let ee=e.params.zoom,re=e.zoom,Le=u.findIndex(ae=>ae.pointerId===W.pointerId);Le>=0&&u.splice(Le,1),!(!l||!c)&&(l=!1,c=!1,d.imageEl&&(re.scale=Math.max(Math.min(re.scale,d.maxRatio),ee.minRatio),d.imageEl.style.transitionDuration=`${e.params.speed}ms`,d.imageEl.style.transform=`translate3d(0,0,0) scale(${re.scale})`,o=re.scale,a=!1,re.scale>1&&d.slideEl?d.slideEl.classList.add(`${ee.zoomedSlideClass}`):re.scale<=1&&d.slideEl&&d.slideEl.classList.remove(`${ee.zoomedSlideClass}`),re.scale===1&&(d.originX=0,d.originY=0,d.slideEl=void 0)))}let x;function T(){e.touchEventsData.preventTouchMoveFromPointerMove=!1}function A(){clearTimeout(x),e.touchEventsData.preventTouchMoveFromPointerMove=!0,x=setTimeout(()=>{e.destroyed||T()})}function C(W){let ee=e.device;if(!d.imageEl||h.isTouched)return;ee.android&&W.cancelable&&W.preventDefault(),h.isTouched=!0;let re=u.length>0?u[0]:W;h.touchesStart.x=re.pageX,h.touchesStart.y=re.pageY}function P(W){if(!b(W)||!M(W))return;let ee=e.zoom;if(!d.imageEl||!h.isTouched||!d.slideEl)return;h.isMoved||(h.width=d.imageEl.offsetWidth||d.imageEl.clientWidth,h.height=d.imageEl.offsetHeight||d.imageEl.clientHeight,h.startX=_f(d.imageWrapEl,"x")||0,h.startY=_f(d.imageWrapEl,"y")||0,d.slideWidth=d.slideEl.offsetWidth,d.slideHeight=d.slideEl.offsetHeight,d.imageWrapEl.style.transitionDuration="0ms");let re=h.width*ee.scale,Le=h.height*ee.scale;if(h.minX=Math.min(d.slideWidth/2-re/2,0),h.maxX=-h.minX,h.minY=Math.min(d.slideHeight/2-Le/2,0),h.maxY=-h.minY,h.touchesCurrent.x=u.length>0?u[0].pageX:W.pageX,h.touchesCurrent.y=u.length>0?u[0].pageY:W.pageY,Math.max(Math.abs(h.touchesCurrent.x-h.touchesStart.x),Math.abs(h.touchesCurrent.y-h.touchesStart.y))>5&&(e.allowClick=!1),!h.isMoved&&!a){if(e.isHorizontal()&&(Math.floor(h.minX)===Math.floor(h.startX)&&h.touchesCurrent.x<h.touchesStart.x||Math.floor(h.maxX)===Math.floor(h.startX)&&h.touchesCurrent.x>h.touchesStart.x)){h.isTouched=!1,T();return}if(!e.isHorizontal()&&(Math.floor(h.minY)===Math.floor(h.startY)&&h.touchesCurrent.y<h.touchesStart.y||Math.floor(h.maxY)===Math.floor(h.startY)&&h.touchesCurrent.y>h.touchesStart.y)){h.isTouched=!1,T();return}}W.cancelable&&W.preventDefault(),W.stopPropagation(),A(),h.isMoved=!0;let Ae=(ee.scale-o)/(d.maxRatio-e.params.zoom.minRatio),{originX:Ot,originY:Dt}=d;h.currentX=h.touchesCurrent.x-h.touchesStart.x+h.startX+Ae*(h.width-Ot*2),h.currentY=h.touchesCurrent.y-h.touchesStart.y+h.startY+Ae*(h.height-Dt*2),h.currentX<h.minX&&(h.currentX=h.minX+1-(h.minX-h.currentX+1)**.8),h.currentX>h.maxX&&(h.currentX=h.maxX-1+(h.currentX-h.maxX+1)**.8),h.currentY<h.minY&&(h.currentY=h.minY+1-(h.minY-h.currentY+1)**.8),h.currentY>h.maxY&&(h.currentY=h.maxY-1+(h.currentY-h.maxY+1)**.8),f.prevPositionX||(f.prevPositionX=h.touchesCurrent.x),f.prevPositionY||(f.prevPositionY=h.touchesCurrent.y),f.prevTime||(f.prevTime=Date.now()),f.x=(h.touchesCurrent.x-f.prevPositionX)/(Date.now()-f.prevTime)/2,f.y=(h.touchesCurrent.y-f.prevPositionY)/(Date.now()-f.prevTime)/2,Math.abs(h.touchesCurrent.x-f.prevPositionX)<2&&(f.x=0),Math.abs(h.touchesCurrent.y-f.prevPositionY)<2&&(f.y=0),f.prevPositionX=h.touchesCurrent.x,f.prevPositionY=h.touchesCurrent.y,f.prevTime=Date.now(),d.imageWrapEl.style.transform=`translate3d(${h.currentX}px, ${h.currentY}px,0)`}function y(){let W=e.zoom;if(!d.imageEl)return;if(!h.isTouched||!h.isMoved){h.isTouched=!1,h.isMoved=!1;return}h.isTouched=!1,h.isMoved=!1;let ee=300,re=300,Le=f.x*ee,ae=h.currentX+Le,Ae=f.y*re,Ot=h.currentY+Ae;f.x!==0&&(ee=Math.abs((ae-h.currentX)/f.x)),f.y!==0&&(re=Math.abs((Ot-h.currentY)/f.y));let Dt=Math.max(ee,re);h.currentX=ae,h.currentY=Ot;let X=h.width*W.scale,K=h.height*W.scale;h.minX=Math.min(d.slideWidth/2-X/2,0),h.maxX=-h.minX,h.minY=Math.min(d.slideHeight/2-K/2,0),h.maxY=-h.minY,h.currentX=Math.max(Math.min(h.currentX,h.maxX),h.minX),h.currentY=Math.max(Math.min(h.currentY,h.maxY),h.minY),d.imageWrapEl.style.transitionDuration=`${Dt}ms`,d.imageWrapEl.style.transform=`translate3d(${h.currentX}px, ${h.currentY}px,0)`}function w(){let W=e.zoom;d.slideEl&&e.activeIndex!==e.slides.indexOf(d.slideEl)&&(d.imageEl&&(d.imageEl.style.transform="translate3d(0,0,0) scale(1)"),d.imageWrapEl&&(d.imageWrapEl.style.transform="translate3d(0,0,0)"),d.slideEl.classList.remove(`${e.params.zoom.zoomedSlideClass}`),W.scale=1,o=1,d.slideEl=void 0,d.imageEl=void 0,d.imageWrapEl=void 0,d.originX=0,d.originY=0)}function F(W){let ee=e.zoom,re=e.params.zoom;if(!d.slideEl){W&&W.target&&(d.slideEl=W.target.closest(`.${e.params.slideClass}, swiper-slide`)),d.slideEl||(e.params.virtual&&e.params.virtual.enabled&&e.virtual?d.slideEl=At(e.slidesEl,`.${e.params.slideActiveClass}`)[0]:d.slideEl=e.slides[e.activeIndex]);let Mu=d.slideEl.querySelector(`.${re.containerClass}`);Mu&&(Mu=Mu.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),d.imageEl=Mu,Mu?d.imageWrapEl=pr(d.imageEl,`.${re.containerClass}`)[0]:d.imageWrapEl=void 0}if(!d.imageEl||!d.imageWrapEl)return;e.params.cssMode&&(e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.touchAction="none"),d.slideEl.classList.add(`${re.zoomedSlideClass}`);let Le,ae,Ae,Ot,Dt,X,K,se,Se,ye,Pe,dt,ni,an,bs,bf,Xo,Fy;typeof h.touchesStart.x>"u"&&W?(Le=W.pageX,ae=W.pageY):(Le=h.touchesStart.x,ae=h.touchesStart.y);let Ru=typeof W=="number"?W:null;o===1&&Ru&&(Le=void 0,ae=void 0,h.touchesStart.x=void 0,h.touchesStart.y=void 0);let Lx=S();ee.scale=Ru||Lx,o=Ru||Lx,W&&!(o===1&&Ru)?(Xo=d.slideEl.offsetWidth,Fy=d.slideEl.offsetHeight,Ae=ul(d.slideEl).left+s.scrollX,Ot=ul(d.slideEl).top+s.scrollY,Dt=Ae+Xo/2-Le,X=Ot+Fy/2-ae,Se=d.imageEl.offsetWidth||d.imageEl.clientWidth,ye=d.imageEl.offsetHeight||d.imageEl.clientHeight,Pe=Se*ee.scale,dt=ye*ee.scale,ni=Math.min(Xo/2-Pe/2,0),an=Math.min(Fy/2-dt/2,0),bs=-ni,bf=-an,K=Dt*ee.scale,se=X*ee.scale,K<ni&&(K=ni),K>bs&&(K=bs),se<an&&(se=an),se>bf&&(se=bf)):(K=0,se=0),Ru&&ee.scale===1&&(d.originX=0,d.originY=0),d.imageWrapEl.style.transitionDuration="300ms",d.imageWrapEl.style.transform=`translate3d(${K}px, ${se}px,0)`,d.imageEl.style.transitionDuration="300ms",d.imageEl.style.transform=`translate3d(0,0,0) scale(${ee.scale})`}function Q(){let W=e.zoom,ee=e.params.zoom;if(!d.slideEl){e.params.virtual&&e.params.virtual.enabled&&e.virtual?d.slideEl=At(e.slidesEl,`.${e.params.slideActiveClass}`)[0]:d.slideEl=e.slides[e.activeIndex];let re=d.slideEl.querySelector(`.${ee.containerClass}`);re&&(re=re.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),d.imageEl=re,re?d.imageWrapEl=pr(d.imageEl,`.${ee.containerClass}`)[0]:d.imageWrapEl=void 0}!d.imageEl||!d.imageWrapEl||(e.params.cssMode&&(e.wrapperEl.style.overflow="",e.wrapperEl.style.touchAction=""),W.scale=1,o=1,h.touchesStart.x=void 0,h.touchesStart.y=void 0,d.imageWrapEl.style.transitionDuration="300ms",d.imageWrapEl.style.transform="translate3d(0,0,0)",d.imageEl.style.transitionDuration="300ms",d.imageEl.style.transform="translate3d(0,0,0) scale(1)",d.slideEl.classList.remove(`${ee.zoomedSlideClass}`),d.slideEl=void 0,d.originX=0,d.originY=0)}function z(W){let ee=e.zoom;ee.scale&&ee.scale!==1?Q():F(W)}function V(){let W=e.params.passiveListeners?{passive:!0,capture:!1}:!1,ee=e.params.passiveListeners?{passive:!1,capture:!0}:!0;return{passiveListener:W,activeListenerWithCapture:ee}}function ne(){let W=e.zoom;if(W.enabled)return;W.enabled=!0;let{passiveListener:ee,activeListenerWithCapture:re}=V();e.wrapperEl.addEventListener("pointerdown",N,ee),e.wrapperEl.addEventListener("pointermove",U,re),["pointerup","pointercancel","pointerout"].forEach(Le=>{e.wrapperEl.addEventListener(Le,R,ee)}),e.wrapperEl.addEventListener("pointermove",P,re)}function ue(){let W=e.zoom;if(!W.enabled)return;W.enabled=!1;let{passiveListener:ee,activeListenerWithCapture:re}=V();e.wrapperEl.removeEventListener("pointerdown",N,ee),e.wrapperEl.removeEventListener("pointermove",U,re),["pointerup","pointercancel","pointerout"].forEach(Le=>{e.wrapperEl.removeEventListener(Le,R,ee)}),e.wrapperEl.removeEventListener("pointermove",P,re)}i("init",()=>{e.params.zoom.enabled&&ne()}),i("destroy",()=>{ue()}),i("touchStart",(W,ee)=>{e.zoom.enabled&&C(ee)}),i("touchEnd",(W,ee)=>{e.zoom.enabled&&y()}),i("doubleTap",(W,ee)=>{!e.animating&&e.params.zoom.enabled&&e.zoom.enabled&&e.params.zoom.toggle&&z(ee)}),i("transitionEnd",()=>{e.zoom.enabled&&e.params.zoom.enabled&&w()}),i("slideChange",()=>{e.zoom.enabled&&e.params.zoom.enabled&&e.params.cssMode&&w()}),Object.assign(e.zoom,{enable:ne,disable:ue,in:F,out:Q,toggle:z})}function IB(n){let{swiper:e,extendParams:t,on:i}=n;t({controller:{control:void 0,inverse:!1,by:"slide"}}),e.controller={control:void 0};function r(c,u){let d=function(){let _,S,I;return(E,b)=>{for(S=-1,_=E.length;_-S>1;)I=_+S>>1,E[I]<=b?S=I:_=I;return _}}();this.x=c,this.y=u,this.lastIndex=c.length-1;let h,f;return this.interpolate=function(_){return _?(f=d(this.x,_),h=f-1,(_-this.x[h])*(this.y[f]-this.y[h])/(this.x[f]-this.x[h])+this.y[h]):0},this}function s(c){e.controller.spline=e.params.loop?new r(e.slidesGrid,c.slidesGrid):new r(e.snapGrid,c.snapGrid)}function o(c,u){let d=e.controller.control,h,f,g=e.constructor;function _(S){if(S.destroyed)return;let I=e.rtlTranslate?-e.translate:e.translate;e.params.controller.by==="slide"&&(s(S),f=-e.controller.spline.interpolate(-I)),(!f||e.params.controller.by==="container")&&(h=(S.maxTranslate()-S.minTranslate())/(e.maxTranslate()-e.minTranslate()),(Number.isNaN(h)||!Number.isFinite(h))&&(h=1),f=(I-e.minTranslate())*h+S.minTranslate()),e.params.controller.inverse&&(f=S.maxTranslate()-f),S.updateProgress(f),S.setTranslate(f,e),S.updateActiveIndex(),S.updateSlidesClasses()}if(Array.isArray(d))for(let S=0;S<d.length;S+=1)d[S]!==u&&d[S]instanceof g&&_(d[S]);else d instanceof g&&u!==d&&_(d)}function a(c,u){let d=e.constructor,h=e.controller.control,f;function g(_){_.destroyed||(_.setTransition(c,e),c!==0&&(_.transitionStart(),_.params.autoHeight&&fr(()=>{_.updateAutoHeight()}),jo(_.wrapperEl,()=>{h&&_.transitionEnd()})))}if(Array.isArray(h))for(f=0;f<h.length;f+=1)h[f]!==u&&h[f]instanceof d&&g(h[f]);else h instanceof d&&u!==h&&g(h)}function l(){e.controller.control&&e.controller.spline&&(e.controller.spline=void 0,delete e.controller.spline)}i("beforeInit",()=>{if(typeof window<"u"&&(typeof e.params.controller.control=="string"||e.params.controller.control instanceof HTMLElement)){(typeof e.params.controller.control=="string"?[...document.querySelectorAll(e.params.controller.control)]:[e.params.controller.control]).forEach(u=>{if(e.controller.control||(e.controller.control=[]),u&&u.swiper)e.controller.control.push(u.swiper);else if(u){let d=`${e.params.eventsPrefix}init`,h=f=>{e.controller.control.push(f.detail[0]),e.update(),u.removeEventListener(d,h)};u.addEventListener(d,h)}});return}e.controller.control=e.params.controller.control}),i("update",()=>{l()}),i("resize",()=>{l()}),i("observerUpdate",()=>{l()}),i("setTranslate",(c,u,d)=>{!e.controller.control||e.controller.control.destroyed||e.controller.setTranslate(u,d)}),i("setTransition",(c,u,d)=>{!e.controller.control||e.controller.control.destroyed||e.controller.setTransition(u,d)}),Object.assign(e.controller,{setTranslate:o,setTransition:a})}function kB(n){let{swiper:e,extendParams:t,on:i}=n;t({a11y:{enabled:!0,notificationClass:"swiper-notification",prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",slideLabelMessage:"{{index}} / {{slidesLength}}",containerMessage:null,containerRoleDescriptionMessage:null,containerRole:null,itemRoleDescriptionMessage:null,slideRole:"group",id:null,scrollOnFocus:!0}}),e.a11y={clicked:!1};let r=null,s,o,a=new Date().getTime();function l(z){let V=r;V.length!==0&&(V.innerHTML="",V.innerHTML=z)}function c(z){z===void 0&&(z=16);let V=()=>Math.round(16*Math.random()).toString(16);return"x".repeat(z).replace(/x/g,V)}function u(z){z=Ue(z),z.forEach(V=>{V.setAttribute("tabIndex","0")})}function d(z){z=Ue(z),z.forEach(V=>{V.setAttribute("tabIndex","-1")})}function h(z,V){z=Ue(z),z.forEach(ne=>{ne.setAttribute("role",V)})}function f(z,V){z=Ue(z),z.forEach(ne=>{ne.setAttribute("aria-roledescription",V)})}function g(z,V){z=Ue(z),z.forEach(ne=>{ne.setAttribute("aria-controls",V)})}function _(z,V){z=Ue(z),z.forEach(ne=>{ne.setAttribute("aria-label",V)})}function S(z,V){z=Ue(z),z.forEach(ne=>{ne.setAttribute("id",V)})}function I(z,V){z=Ue(z),z.forEach(ne=>{ne.setAttribute("aria-live",V)})}function E(z){z=Ue(z),z.forEach(V=>{V.setAttribute("aria-disabled",!0)})}function b(z){z=Ue(z),z.forEach(V=>{V.setAttribute("aria-disabled",!1)})}function M(z){if(z.keyCode!==13&&z.keyCode!==32)return;let V=e.params.a11y,ne=z.target;if(!(e.pagination&&e.pagination.el&&(ne===e.pagination.el||e.pagination.el.contains(z.target))&&!z.target.matches(Hi(e.params.pagination.bulletClass)))){if(e.navigation&&e.navigation.prevEl&&e.navigation.nextEl){let ue=Ue(e.navigation.prevEl);Ue(e.navigation.nextEl).includes(ne)&&(e.isEnd&&!e.params.loop||e.slideNext(),e.isEnd?l(V.lastSlideMessage):l(V.nextSlideMessage)),ue.includes(ne)&&(e.isBeginning&&!e.params.loop||e.slidePrev(),e.isBeginning?l(V.firstSlideMessage):l(V.prevSlideMessage))}e.pagination&&ne.matches(Hi(e.params.pagination.bulletClass))&&ne.click()}}function N(){if(e.params.loop||e.params.rewind||!e.navigation)return;let{nextEl:z,prevEl:V}=e.navigation;V&&(e.isBeginning?(E(V),d(V)):(b(V),u(V))),z&&(e.isEnd?(E(z),d(z)):(b(z),u(z)))}function U(){return e.pagination&&e.pagination.bullets&&e.pagination.bullets.length}function R(){return U()&&e.params.pagination.clickable}function x(){let z=e.params.a11y;U()&&e.pagination.bullets.forEach(V=>{e.params.pagination.clickable&&(u(V),e.params.pagination.renderBullet||(h(V,"button"),_(V,z.paginationBulletMessage.replace(/\{\{index\}\}/,$o(V)+1)))),V.matches(Hi(e.params.pagination.bulletActiveClass))?V.setAttribute("aria-current","true"):V.removeAttribute("aria-current")})}let T=(z,V,ne)=>{u(z),z.tagName!=="BUTTON"&&(h(z,"button"),z.addEventListener("keydown",M)),_(z,ne),g(z,V)},A=z=>{o&&o!==z.target&&!o.contains(z.target)&&(s=!0),e.a11y.clicked=!0},C=()=>{s=!1,requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.destroyed||(e.a11y.clicked=!1)})})},P=z=>{a=new Date().getTime()},y=z=>{if(e.a11y.clicked||!e.params.a11y.scrollOnFocus||new Date().getTime()-a<100)return;let V=z.target.closest(`.${e.params.slideClass}, swiper-slide`);if(!V||!e.slides.includes(V))return;o=V;let ne=e.slides.indexOf(V)===e.activeIndex,ue=e.params.watchSlidesProgress&&e.visibleSlides&&e.visibleSlides.includes(V);ne||ue||z.sourceCapabilities&&z.sourceCapabilities.firesTouchEvents||(e.isHorizontal()?e.el.scrollLeft=0:e.el.scrollTop=0,requestAnimationFrame(()=>{s||(e.params.loop?e.slideToLoop(parseInt(V.getAttribute("data-swiper-slide-index")),0):e.slideTo(e.slides.indexOf(V),0),s=!1)}))},w=()=>{let z=e.params.a11y;z.itemRoleDescriptionMessage&&f(e.slides,z.itemRoleDescriptionMessage),z.slideRole&&h(e.slides,z.slideRole);let V=e.slides.length;z.slideLabelMessage&&e.slides.forEach((ne,ue)=>{let W=e.params.loop?parseInt(ne.getAttribute("data-swiper-slide-index"),10):ue,ee=z.slideLabelMessage.replace(/\{\{index\}\}/,W+1).replace(/\{\{slidesLength\}\}/,V);_(ne,ee)})},F=()=>{let z=e.params.a11y;e.el.append(r);let V=e.el;z.containerRoleDescriptionMessage&&f(V,z.containerRoleDescriptionMessage),z.containerMessage&&_(V,z.containerMessage),z.containerRole&&h(V,z.containerRole);let ne=e.wrapperEl,ue=z.id||ne.getAttribute("id")||`swiper-wrapper-${c(16)}`,W=e.params.autoplay&&e.params.autoplay.enabled?"off":"polite";S(ne,ue),I(ne,W),w();let{nextEl:ee,prevEl:re}=e.navigation?e.navigation:{};ee=Ue(ee),re=Ue(re),ee&&ee.forEach(ae=>T(ae,ue,z.nextSlideMessage)),re&&re.forEach(ae=>T(ae,ue,z.prevSlideMessage)),R()&&Ue(e.pagination.el).forEach(Ae=>{Ae.addEventListener("keydown",M)}),yt().addEventListener("visibilitychange",P),e.el.addEventListener("focus",y,!0),e.el.addEventListener("focus",y,!0),e.el.addEventListener("pointerdown",A,!0),e.el.addEventListener("pointerup",C,!0)};function Q(){r&&r.remove();let{nextEl:z,prevEl:V}=e.navigation?e.navigation:{};z=Ue(z),V=Ue(V),z&&z.forEach(ue=>ue.removeEventListener("keydown",M)),V&&V.forEach(ue=>ue.removeEventListener("keydown",M)),R()&&Ue(e.pagination.el).forEach(W=>{W.removeEventListener("keydown",M)}),yt().removeEventListener("visibilitychange",P),e.el&&typeof e.el!="string"&&(e.el.removeEventListener("focus",y,!0),e.el.removeEventListener("pointerdown",A,!0),e.el.removeEventListener("pointerup",C,!0))}i("beforeInit",()=>{r=tn("span",e.params.a11y.notificationClass),r.setAttribute("aria-live","assertive"),r.setAttribute("aria-atomic","true")}),i("afterInit",()=>{e.params.a11y.enabled&&F()}),i("slidesLengthChange snapGridLengthChange slidesGridLengthChange",()=>{e.params.a11y.enabled&&w()}),i("fromEdge toEdge afterInit lock unlock",()=>{e.params.a11y.enabled&&N()}),i("paginationUpdate",()=>{e.params.a11y.enabled&&x()}),i("destroy",()=>{e.params.a11y.enabled&&Q()})}function AB(n){let{swiper:e,extendParams:t,on:i}=n;t({history:{enabled:!1,root:"",replaceState:!1,key:"slides",keepQuery:!1}});let r=!1,s={},o=f=>f.toString().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,""),a=f=>{let g=ot(),_;f?_=new URL(f):_=g.location;let S=_.pathname.slice(1).split("/").filter(M=>M!==""),I=S.length,E=S[I-2],b=S[I-1];return{key:E,value:b}},l=(f,g)=>{let _=ot();if(!r||!e.params.history.enabled)return;let S;e.params.url?S=new URL(e.params.url):S=_.location;let I=e.virtual&&e.params.virtual.enabled?e.slidesEl.querySelector(`[data-swiper-slide-index="${g}"]`):e.slides[g],E=o(I.getAttribute("data-history"));if(e.params.history.root.length>0){let M=e.params.history.root;M[M.length-1]==="/"&&(M=M.slice(0,M.length-1)),E=`${M}/${f?`${f}/`:""}${E}`}else S.pathname.includes(f)||(E=`${f?`${f}/`:""}${E}`);e.params.history.keepQuery&&(E+=S.search);let b=_.history.state;b&&b.value===E||(e.params.history.replaceState?_.history.replaceState({value:E},null,E):_.history.pushState({value:E},null,E))},c=(f,g,_)=>{if(g)for(let S=0,I=e.slides.length;S<I;S+=1){let E=e.slides[S];if(o(E.getAttribute("data-history"))===g){let M=e.getSlideIndex(E);e.slideTo(M,f,_)}}else e.slideTo(0,f,_)},u=()=>{s=a(e.params.url),c(e.params.speed,s.value,!1)},d=()=>{let f=ot();if(e.params.history){if(!f.history||!f.history.pushState){e.params.history.enabled=!1,e.params.hashNavigation.enabled=!0;return}if(r=!0,s=a(e.params.url),!s.key&&!s.value){e.params.history.replaceState||f.addEventListener("popstate",u);return}c(0,s.value,e.params.runCallbacksOnInit),e.params.history.replaceState||f.addEventListener("popstate",u)}},h=()=>{let f=ot();e.params.history.replaceState||f.removeEventListener("popstate",u)};i("init",()=>{e.params.history.enabled&&d()}),i("destroy",()=>{e.params.history.enabled&&h()}),i("transitionEnd _freeModeNoMomentumRelease",()=>{r&&l(e.params.history.key,e.activeIndex)}),i("slideChange",()=>{r&&e.params.cssMode&&l(e.params.history.key,e.activeIndex)})}function DB(n){let{swiper:e,extendParams:t,emit:i,on:r}=n,s=!1,o=yt(),a=ot();t({hashNavigation:{enabled:!1,replaceState:!1,watchState:!1,getSlideIndex(h,f){if(e.virtual&&e.params.virtual.enabled){let g=e.slides.filter(S=>S.getAttribute("data-hash")===f)[0];return g?parseInt(g.getAttribute("data-swiper-slide-index"),10):0}return e.getSlideIndex(At(e.slidesEl,`.${e.params.slideClass}[data-hash="${f}"], swiper-slide[data-hash="${f}"]`)[0])}}});let l=()=>{i("hashChange");let h=o.location.hash.replace("#",""),f=e.virtual&&e.params.virtual.enabled?e.slidesEl.querySelector(`[data-swiper-slide-index="${e.activeIndex}"]`):e.slides[e.activeIndex],g=f?f.getAttribute("data-hash"):"";if(h!==g){let _=e.params.hashNavigation.getSlideIndex(e,h);if(typeof _>"u"||Number.isNaN(_))return;e.slideTo(_)}},c=()=>{if(!s||!e.params.hashNavigation.enabled)return;let h=e.virtual&&e.params.virtual.enabled?e.slidesEl.querySelector(`[data-swiper-slide-index="${e.activeIndex}"]`):e.slides[e.activeIndex],f=h?h.getAttribute("data-hash")||h.getAttribute("data-history"):"";e.params.hashNavigation.replaceState&&a.history&&a.history.replaceState?(a.history.replaceState(null,null,`#${f}`||""),i("hashSet")):(o.location.hash=f||"",i("hashSet"))},u=()=>{if(!e.params.hashNavigation.enabled||e.params.history&&e.params.history.enabled)return;s=!0;let h=o.location.hash.replace("#","");if(h){let g=e.params.hashNavigation.getSlideIndex(e,h);e.slideTo(g||0,0,e.params.runCallbacksOnInit,!0)}e.params.hashNavigation.watchState&&a.addEventListener("hashchange",l)},d=()=>{e.params.hashNavigation.watchState&&a.removeEventListener("hashchange",l)};r("init",()=>{e.params.hashNavigation.enabled&&u()}),r("destroy",()=>{e.params.hashNavigation.enabled&&d()}),r("transitionEnd _freeModeNoMomentumRelease",()=>{s&&c()}),r("slideChange",()=>{s&&e.params.cssMode&&c()})}function PB(n){let{swiper:e,extendParams:t,on:i,emit:r,params:s}=n;e.autoplay={running:!1,paused:!1,timeLeft:0},t({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let o,a,l=s&&s.autoplay?s.autoplay.delay:3e3,c=s&&s.autoplay?s.autoplay.delay:3e3,u,d=new Date().getTime(),h,f,g,_,S,I,E;function b(V){!e||e.destroyed||!e.wrapperEl||V.target===e.wrapperEl&&(e.wrapperEl.removeEventListener("transitionend",b),!(E||V.detail&&V.detail.bySwiperTouchMove)&&A())}let M=()=>{if(e.destroyed||!e.autoplay.running)return;e.autoplay.paused?h=!0:h&&(c=u,h=!1);let V=e.autoplay.paused?u:d+c-new Date().getTime();e.autoplay.timeLeft=V,r("autoplayTimeLeft",V,V/l),a=requestAnimationFrame(()=>{M()})},N=()=>{let V;return e.virtual&&e.params.virtual.enabled?V=e.slides.filter(ue=>ue.classList.contains("swiper-slide-active"))[0]:V=e.slides[e.activeIndex],V?parseInt(V.getAttribute("data-swiper-autoplay"),10):void 0},U=V=>{if(e.destroyed||!e.autoplay.running)return;cancelAnimationFrame(a),M();let ne=typeof V>"u"?e.params.autoplay.delay:V;l=e.params.autoplay.delay,c=e.params.autoplay.delay;let ue=N();!Number.isNaN(ue)&&ue>0&&typeof V>"u"&&(ne=ue,l=ue,c=ue),u=ne;let W=e.params.speed,ee=()=>{!e||e.destroyed||(e.params.autoplay.reverseDirection?!e.isBeginning||e.params.loop||e.params.rewind?(e.slidePrev(W,!0,!0),r("autoplay")):e.params.autoplay.stopOnLastSlide||(e.slideTo(e.slides.length-1,W,!0,!0),r("autoplay")):!e.isEnd||e.params.loop||e.params.rewind?(e.slideNext(W,!0,!0),r("autoplay")):e.params.autoplay.stopOnLastSlide||(e.slideTo(0,W,!0,!0),r("autoplay")),e.params.cssMode&&(d=new Date().getTime(),requestAnimationFrame(()=>{U()})))};return ne>0?(clearTimeout(o),o=setTimeout(()=>{ee()},ne)):requestAnimationFrame(()=>{ee()}),ne},R=()=>{d=new Date().getTime(),e.autoplay.running=!0,U(),r("autoplayStart")},x=()=>{e.autoplay.running=!1,clearTimeout(o),cancelAnimationFrame(a),r("autoplayStop")},T=(V,ne)=>{if(e.destroyed||!e.autoplay.running)return;clearTimeout(o),V||(I=!0);let ue=()=>{r("autoplayPause"),e.params.autoplay.waitForTransition?e.wrapperEl.addEventListener("transitionend",b):A()};if(e.autoplay.paused=!0,ne){S&&(u=e.params.autoplay.delay),S=!1,ue();return}u=(u||e.params.autoplay.delay)-(new Date().getTime()-d),!(e.isEnd&&u<0&&!e.params.loop)&&(u<0&&(u=0),ue())},A=()=>{e.isEnd&&u<0&&!e.params.loop||e.destroyed||!e.autoplay.running||(d=new Date().getTime(),I?(I=!1,U(u)):U(),e.autoplay.paused=!1,r("autoplayResume"))},C=()=>{if(e.destroyed||!e.autoplay.running)return;let V=yt();V.visibilityState==="hidden"&&(I=!0,T(!0)),V.visibilityState==="visible"&&A()},P=V=>{V.pointerType==="mouse"&&(I=!0,E=!0,!(e.animating||e.autoplay.paused)&&T(!0))},y=V=>{V.pointerType==="mouse"&&(E=!1,e.autoplay.paused&&A())},w=()=>{e.params.autoplay.pauseOnMouseEnter&&(e.el.addEventListener("pointerenter",P),e.el.addEventListener("pointerleave",y))},F=()=>{e.el&&typeof e.el!="string"&&(e.el.removeEventListener("pointerenter",P),e.el.removeEventListener("pointerleave",y))},Q=()=>{yt().addEventListener("visibilitychange",C)},z=()=>{yt().removeEventListener("visibilitychange",C)};i("init",()=>{e.params.autoplay.enabled&&(w(),Q(),R())}),i("destroy",()=>{F(),z(),e.autoplay.running&&x()}),i("_freeModeStaticRelease",()=>{(g||I)&&A()}),i("_freeModeNoMomentumRelease",()=>{e.params.autoplay.disableOnInteraction?x():T(!0,!0)}),i("beforeTransitionStart",(V,ne,ue)=>{e.destroyed||!e.autoplay.running||(ue||!e.params.autoplay.disableOnInteraction?T(!0,!0):x())}),i("sliderFirstMove",()=>{if(!(e.destroyed||!e.autoplay.running)){if(e.params.autoplay.disableOnInteraction){x();return}f=!0,g=!1,I=!1,_=setTimeout(()=>{I=!0,g=!0,T(!0)},200)}}),i("touchEnd",()=>{if(!(e.destroyed||!e.autoplay.running||!f)){if(clearTimeout(_),clearTimeout(o),e.params.autoplay.disableOnInteraction){g=!1,f=!1;return}g&&e.params.cssMode&&A(),g=!1,f=!1}}),i("slideChange",()=>{e.destroyed||!e.autoplay.running||(S=!0)}),Object.assign(e.autoplay,{start:R,stop:x,pause:T,resume:A})}function RB(n){let{swiper:e,extendParams:t,on:i}=n;t({thumbs:{swiper:null,multipleActiveThumbs:!0,autoScrollOffset:0,slideThumbActiveClass:"swiper-slide-thumb-active",thumbsContainerClass:"swiper-thumbs"}});let r=!1,s=!1;e.thumbs={swiper:null};function o(){let c=e.thumbs.swiper;if(!c||c.destroyed)return;let u=c.clickedIndex,d=c.clickedSlide;if(d&&d.classList.contains(e.params.thumbs.slideThumbActiveClass)||typeof u>"u"||u===null)return;let h;c.params.loop?h=parseInt(c.clickedSlide.getAttribute("data-swiper-slide-index"),10):h=u,e.params.loop?e.slideToLoop(h):e.slideTo(h)}function a(){let{thumbs:c}=e.params;if(r)return!1;r=!0;let u=e.constructor;if(c.swiper instanceof u)e.thumbs.swiper=c.swiper,Object.assign(e.thumbs.swiper.originalParams,{watchSlidesProgress:!0,slideToClickedSlide:!1}),Object.assign(e.thumbs.swiper.params,{watchSlidesProgress:!0,slideToClickedSlide:!1}),e.thumbs.swiper.update();else if(Tu(c.swiper)){let d=Object.assign({},c.swiper);Object.assign(d,{watchSlidesProgress:!0,slideToClickedSlide:!1}),e.thumbs.swiper=new u(d),s=!0}return e.thumbs.swiper.el.classList.add(e.params.thumbs.thumbsContainerClass),e.thumbs.swiper.on("tap",o),!0}function l(c){let u=e.thumbs.swiper;if(!u||u.destroyed)return;let d=u.params.slidesPerView==="auto"?u.slidesPerViewDynamic():u.params.slidesPerView,h=1,f=e.params.thumbs.slideThumbActiveClass;if(e.params.slidesPerView>1&&!e.params.centeredSlides&&(h=e.params.slidesPerView),e.params.thumbs.multipleActiveThumbs||(h=1),h=Math.floor(h),u.slides.forEach(S=>S.classList.remove(f)),u.params.loop||u.params.virtual&&u.params.virtual.enabled)for(let S=0;S<h;S+=1)At(u.slidesEl,`[data-swiper-slide-index="${e.realIndex+S}"]`).forEach(I=>{I.classList.add(f)});else for(let S=0;S<h;S+=1)u.slides[e.realIndex+S]&&u.slides[e.realIndex+S].classList.add(f);let g=e.params.thumbs.autoScrollOffset,_=g&&!u.params.loop;if(e.realIndex!==u.realIndex||_){let S=u.activeIndex,I,E;if(u.params.loop){let b=u.slides.filter(M=>M.getAttribute("data-swiper-slide-index")===`${e.realIndex}`)[0];I=u.slides.indexOf(b),E=e.activeIndex>e.previousIndex?"next":"prev"}else I=e.realIndex,E=I>e.previousIndex?"next":"prev";_&&(I+=E==="next"?g:-1*g),u.visibleSlidesIndexes&&u.visibleSlidesIndexes.indexOf(I)<0&&(u.params.centeredSlides?I>S?I=I-Math.floor(d/2)+1:I=I+Math.floor(d/2)-1:I>S&&u.params.slidesPerGroup,u.slideTo(I,c?0:void 0))}}i("beforeInit",()=>{let{thumbs:c}=e.params;if(!(!c||!c.swiper))if(typeof c.swiper=="string"||c.swiper instanceof HTMLElement){let u=yt(),d=()=>{let f=typeof c.swiper=="string"?u.querySelector(c.swiper):c.swiper;if(f&&f.swiper)c.swiper=f.swiper,a(),l(!0);else if(f){let g=`${e.params.eventsPrefix}init`,_=S=>{c.swiper=S.detail[0],f.removeEventListener(g,_),a(),l(!0),c.swiper.update(),e.update()};f.addEventListener(g,_)}return f},h=()=>{if(e.destroyed)return;d()||requestAnimationFrame(h)};requestAnimationFrame(h)}else a(),l(!0)}),i("slideChange update resize observerUpdate",()=>{l()}),i("setTransition",(c,u)=>{let d=e.thumbs.swiper;!d||d.destroyed||d.setTransition(u)}),i("beforeDestroy",()=>{let c=e.thumbs.swiper;!c||c.destroyed||s&&c.destroy()}),Object.assign(e.thumbs,{init:a,update:l})}function MB(n){let{swiper:e,extendParams:t,emit:i,once:r}=n;t({freeMode:{enabled:!1,momentum:!0,momentumRatio:1,momentumBounce:!0,momentumBounceRatio:1,momentumVelocityRatio:1,sticky:!1,minimumVelocity:.02}});function s(){if(e.params.cssMode)return;let l=e.getTranslate();e.setTranslate(l),e.setTransition(0),e.touchEventsData.velocities.length=0,e.freeMode.onTouchEnd({currentPos:e.rtl?e.translate:-e.translate})}function o(){if(e.params.cssMode)return;let{touchEventsData:l,touches:c}=e;l.velocities.length===0&&l.velocities.push({position:c[e.isHorizontal()?"startX":"startY"],time:l.touchStartTime}),l.velocities.push({position:c[e.isHorizontal()?"currentX":"currentY"],time:zn()})}function a(l){let{currentPos:c}=l;if(e.params.cssMode)return;let{params:u,wrapperEl:d,rtlTranslate:h,snapGrid:f,touchEventsData:g}=e,S=zn()-g.touchStartTime;if(c<-e.minTranslate()){e.slideTo(e.activeIndex);return}if(c>-e.maxTranslate()){e.slides.length<f.length?e.slideTo(f.length-1):e.slideTo(e.slides.length-1);return}if(u.freeMode.momentum){if(g.velocities.length>1){let x=g.velocities.pop(),T=g.velocities.pop(),A=x.position-T.position,C=x.time-T.time;e.velocity=A/C,e.velocity/=2,Math.abs(e.velocity)<u.freeMode.minimumVelocity&&(e.velocity=0),(C>150||zn()-x.time>300)&&(e.velocity=0)}else e.velocity=0;e.velocity*=u.freeMode.momentumVelocityRatio,g.velocities.length=0;let I=1e3*u.freeMode.momentumRatio,E=e.velocity*I,b=e.translate+E;h&&(b=-b);let M=!1,N,U=Math.abs(e.velocity)*20*u.freeMode.momentumBounceRatio,R;if(b<e.maxTranslate())u.freeMode.momentumBounce?(b+e.maxTranslate()<-U&&(b=e.maxTranslate()-U),N=e.maxTranslate(),M=!0,g.allowMomentumBounce=!0):b=e.maxTranslate(),u.loop&&u.centeredSlides&&(R=!0);else if(b>e.minTranslate())u.freeMode.momentumBounce?(b-e.minTranslate()>U&&(b=e.minTranslate()+U),N=e.minTranslate(),M=!0,g.allowMomentumBounce=!0):b=e.minTranslate(),u.loop&&u.centeredSlides&&(R=!0);else if(u.freeMode.sticky){let x;for(let T=0;T<f.length;T+=1)if(f[T]>-b){x=T;break}Math.abs(f[x]-b)<Math.abs(f[x-1]-b)||e.swipeDirection==="next"?b=f[x]:b=f[x-1],b=-b}if(R&&r("transitionEnd",()=>{e.loopFix()}),e.velocity!==0){if(h?I=Math.abs((-b-e.translate)/e.velocity):I=Math.abs((b-e.translate)/e.velocity),u.freeMode.sticky){let x=Math.abs((h?-b:b)-e.translate),T=e.slidesSizesGrid[e.activeIndex];x<T?I=u.speed:x<2*T?I=u.speed*1.5:I=u.speed*2.5}}else if(u.freeMode.sticky){e.slideToClosest();return}u.freeMode.momentumBounce&&M?(e.updateProgress(N),e.setTransition(I),e.setTranslate(b),e.transitionStart(!0,e.swipeDirection),e.animating=!0,jo(d,()=>{!e||e.destroyed||!g.allowMomentumBounce||(i("momentumBounce"),e.setTransition(u.speed),setTimeout(()=>{e.setTranslate(N),jo(d,()=>{!e||e.destroyed||e.transitionEnd()})},0))})):e.velocity?(i("_freeModeNoMomentumRelease"),e.updateProgress(b),e.setTransition(I),e.setTranslate(b),e.transitionStart(!0,e.swipeDirection),e.animating||(e.animating=!0,jo(d,()=>{!e||e.destroyed||e.transitionEnd()}))):e.updateProgress(b),e.updateActiveIndex(),e.updateSlidesClasses()}else if(u.freeMode.sticky){e.slideToClosest();return}else u.freeMode&&i("_freeModeNoMomentumRelease");(!u.freeMode.momentum||S>=u.longSwipesMs)&&(i("_freeModeStaticRelease"),e.updateProgress(),e.updateActiveIndex(),e.updateSlidesClasses())}Object.assign(e,{freeMode:{onTouchStart:s,onTouchMove:o,onTouchEnd:a}})}function OB(n){let{swiper:e,extendParams:t,on:i}=n;t({grid:{rows:1,fill:"column"}});let r,s,o,a,l=()=>{let _=e.params.spaceBetween;return typeof _=="string"&&_.indexOf("%")>=0?_=parseFloat(_.replace("%",""))/100*e.size:typeof _=="string"&&(_=parseFloat(_)),_},c=_=>{let{slidesPerView:S}=e.params,{rows:I,fill:E}=e.params.grid,b=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:_.length;o=Math.floor(b/I),Math.floor(b/I)===b/I?r=b:r=Math.ceil(b/I)*I,S!=="auto"&&E==="row"&&(r=Math.max(r,S*I)),s=r/I},u=()=>{e.slides&&e.slides.forEach(_=>{_.swiperSlideGridSet&&(_.style.height="",_.style[e.getDirectionLabel("margin-top")]="")})},d=(_,S,I)=>{let{slidesPerGroup:E}=e.params,b=l(),{rows:M,fill:N}=e.params.grid,U=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:I.length,R,x,T;if(N==="row"&&E>1){let A=Math.floor(_/(E*M)),C=_-M*E*A,P=A===0?E:Math.min(Math.ceil((U-A*M*E)/M),E);T=Math.floor(C/P),x=C-T*P+A*E,R=x+T*r/M,S.style.order=R}else N==="column"?(x=Math.floor(_/M),T=_-x*M,(x>o||x===o&&T===M-1)&&(T+=1,T>=M&&(T=0,x+=1))):(T=Math.floor(_/s),x=_-T*s);S.row=T,S.column=x,S.style.height=`calc((100% - ${(M-1)*b}px) / ${M})`,S.style[e.getDirectionLabel("margin-top")]=T!==0?b&&`${b}px`:"",S.swiperSlideGridSet=!0},h=(_,S)=>{let{centeredSlides:I,roundLengths:E}=e.params,b=l(),{rows:M}=e.params.grid;if(e.virtualSize=(_+b)*r,e.virtualSize=Math.ceil(e.virtualSize/M)-b,e.params.cssMode||(e.wrapperEl.style[e.getDirectionLabel("width")]=`${e.virtualSize+b}px`),I){let N=[];for(let U=0;U<S.length;U+=1){let R=S[U];E&&(R=Math.floor(R)),S[U]<e.virtualSize+S[0]&&N.push(R)}S.splice(0,S.length),S.push(...N)}},f=()=>{a=e.params.grid&&e.params.grid.rows>1},g=()=>{let{params:_,el:S}=e,I=_.grid&&_.grid.rows>1;a&&!I?(S.classList.remove(`${_.containerModifierClass}grid`,`${_.containerModifierClass}grid-column`),o=1,e.emitContainerClasses()):!a&&I&&(S.classList.add(`${_.containerModifierClass}grid`),_.grid.fill==="column"&&S.classList.add(`${_.containerModifierClass}grid-column`),e.emitContainerClasses()),a=I};i("init",f),i("update",g),e.grid={initSlides:c,unsetSlides:u,updateSlide:d,updateWrapperSize:h}}function xie(n){let e=this,{params:t,slidesEl:i}=e;t.loop&&e.loopDestroy();let r=s=>{if(typeof s=="string"){let o=document.createElement("div");o.innerHTML=s,i.append(o.children[0]),o.innerHTML=""}else i.append(s)};if(typeof n=="object"&&"length"in n)for(let s=0;s<n.length;s+=1)n[s]&&r(n[s]);else r(n);e.recalcSlides(),t.loop&&e.loopCreate(),(!t.observer||e.isElement)&&e.update()}function Iie(n){let e=this,{params:t,activeIndex:i,slidesEl:r}=e;t.loop&&e.loopDestroy();let s=i+1,o=a=>{if(typeof a=="string"){let l=document.createElement("div");l.innerHTML=a,r.prepend(l.children[0]),l.innerHTML=""}else r.prepend(a)};if(typeof n=="object"&&"length"in n){for(let a=0;a<n.length;a+=1)n[a]&&o(n[a]);s=i+n.length}else o(n);e.recalcSlides(),t.loop&&e.loopCreate(),(!t.observer||e.isElement)&&e.update(),e.slideTo(s,0,!1)}function kie(n,e){let t=this,{params:i,activeIndex:r,slidesEl:s}=t,o=r;i.loop&&(o-=t.loopedSlides,t.loopDestroy(),t.recalcSlides());let a=t.slides.length;if(n<=0){t.prependSlide(e);return}if(n>=a){t.appendSlide(e);return}let l=o>n?o+1:o,c=[];for(let u=a-1;u>=n;u-=1){let d=t.slides[u];d.remove(),c.unshift(d)}if(typeof e=="object"&&"length"in e){for(let u=0;u<e.length;u+=1)e[u]&&s.append(e[u]);l=o>n?o+e.length:o}else s.append(e);for(let u=0;u<c.length;u+=1)s.append(c[u]);t.recalcSlides(),i.loop&&t.loopCreate(),(!i.observer||t.isElement)&&t.update(),i.loop?t.slideTo(l+t.loopedSlides,0,!1):t.slideTo(l,0,!1)}function Aie(n){let e=this,{params:t,activeIndex:i}=e,r=i;t.loop&&(r-=e.loopedSlides,e.loopDestroy());let s=r,o;if(typeof n=="object"&&"length"in n){for(let a=0;a<n.length;a+=1)o=n[a],e.slides[o]&&e.slides[o].remove(),o<s&&(s-=1);s=Math.max(s,0)}else o=n,e.slides[o]&&e.slides[o].remove(),o<s&&(s-=1),s=Math.max(s,0);e.recalcSlides(),t.loop&&e.loopCreate(),(!t.observer||e.isElement)&&e.update(),t.loop?e.slideTo(s+e.loopedSlides,0,!1):e.slideTo(s,0,!1)}function Die(){let n=this,e=[];for(let t=0;t<n.slides.length;t+=1)e.push(t);n.removeSlide(e)}function NB(n){let{swiper:e}=n;Object.assign(e,{appendSlide:xie.bind(e),prependSlide:Iie.bind(e),addSlide:kie.bind(e),removeSlide:Aie.bind(e),removeAllSlides:Die.bind(e)})}function Wi(n){let{effect:e,swiper:t,on:i,setTranslate:r,setTransition:s,overwriteParams:o,perspective:a,recreateShadows:l,getEffectParams:c}=n;i("beforeInit",()=>{if(t.params.effect!==e)return;t.classNames.push(`${t.params.containerModifierClass}${e}`),a&&a()&&t.classNames.push(`${t.params.containerModifierClass}3d`);let d=o?o():{};Object.assign(t.params,d),Object.assign(t.originalParams,d)}),i("setTranslate",()=>{t.params.effect===e&&r()}),i("setTransition",(d,h)=>{t.params.effect===e&&s(h)}),i("transitionEnd",()=>{if(t.params.effect===e&&l){if(!c||!c().slideShadows)return;t.slides.forEach(d=>{d.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(h=>h.remove())}),l()}});let u;i("virtualUpdate",()=>{t.params.effect===e&&(t.slides.length||(u=!0),requestAnimationFrame(()=>{u&&t.slides&&t.slides.length&&(r(),u=!1)}))})}function Yr(n,e){let t=ei(e);return t!==e&&(t.style.backfaceVisibility="hidden",t.style["-webkit-backface-visibility"]="hidden"),t}function Wo(n){let{swiper:e,duration:t,transformElements:i,allSlides:r}=n,{activeIndex:s}=e,o=a=>a.parentElement?a.parentElement:e.slides.filter(c=>c.shadowRoot&&c.shadowRoot===a.parentNode)[0];if(e.params.virtualTranslate&&t!==0){let a=!1,l;r?l=i:l=i.filter(c=>{let u=c.classList.contains("swiper-slide-transform")?o(c):c;return e.getSlideIndex(u)===s}),l.forEach(c=>{jo(c,()=>{if(a||!e||e.destroyed)return;a=!0,e.animating=!1;let u=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0});e.wrapperEl.dispatchEvent(u)})})}}function LB(n){let{swiper:e,extendParams:t,on:i}=n;t({fadeEffect:{crossFade:!1}}),Wi({effect:"fade",swiper:e,on:i,setTranslate:()=>{let{slides:o}=e,a=e.params.fadeEffect;for(let l=0;l<o.length;l+=1){let c=e.slides[l],d=-c.swiperSlideOffset;e.params.virtualTranslate||(d-=e.translate);let h=0;e.isHorizontal()||(h=d,d=0);let f=e.params.fadeEffect.crossFade?Math.max(1-Math.abs(c.progress),0):1+Math.min(Math.max(c.progress,-1),0),g=Yr(a,c);g.style.opacity=f,g.style.transform=`translate3d(${d}px, ${h}px, 0px)`}},setTransition:o=>{let a=e.slides.map(l=>ei(l));a.forEach(l=>{l.style.transitionDuration=`${o}ms`}),Wo({swiper:e,duration:o,transformElements:a,allSlides:!0})},overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!e.params.cssMode})})}function FB(n){let{swiper:e,extendParams:t,on:i}=n;t({cubeEffect:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94}});let r=(l,c,u)=>{let d=u?l.querySelector(".swiper-slide-shadow-left"):l.querySelector(".swiper-slide-shadow-top"),h=u?l.querySelector(".swiper-slide-shadow-right"):l.querySelector(".swiper-slide-shadow-bottom");d||(d=tn("div",`swiper-slide-shadow-cube swiper-slide-shadow-${u?"left":"top"}`.split(" ")),l.append(d)),h||(h=tn("div",`swiper-slide-shadow-cube swiper-slide-shadow-${u?"right":"bottom"}`.split(" ")),l.append(h)),d&&(d.style.opacity=Math.max(-c,0)),h&&(h.style.opacity=Math.max(c,0))};Wi({effect:"cube",swiper:e,on:i,setTranslate:()=>{let{el:l,wrapperEl:c,slides:u,width:d,height:h,rtlTranslate:f,size:g,browser:_}=e,S=Go(e),I=e.params.cubeEffect,E=e.isHorizontal(),b=e.virtual&&e.params.virtual.enabled,M=0,N;I.shadow&&(E?(N=e.wrapperEl.querySelector(".swiper-cube-shadow"),N||(N=tn("div","swiper-cube-shadow"),e.wrapperEl.append(N)),N.style.height=`${d}px`):(N=l.querySelector(".swiper-cube-shadow"),N||(N=tn("div","swiper-cube-shadow"),l.append(N))));for(let R=0;R<u.length;R+=1){let x=u[R],T=R;b&&(T=parseInt(x.getAttribute("data-swiper-slide-index"),10));let A=T*90,C=Math.floor(A/360);f&&(A=-A,C=Math.floor(-A/360));let P=Math.max(Math.min(x.progress,1),-1),y=0,w=0,F=0;T%4===0?(y=-C*4*g,F=0):(T-1)%4===0?(y=0,F=-C*4*g):(T-2)%4===0?(y=g+C*4*g,F=g):(T-3)%4===0&&(y=-g,F=3*g+g*4*C),f&&(y=-y),E||(w=y,y=0);let Q=`rotateX(${S(E?0:-A)}deg) rotateY(${S(E?A:0)}deg) translate3d(${y}px, ${w}px, ${F}px)`;P<=1&&P>-1&&(M=T*90+P*90,f&&(M=-T*90-P*90)),x.style.transform=Q,I.slideShadows&&r(x,P,E)}if(c.style.transformOrigin=`50% 50% -${g/2}px`,c.style["-webkit-transform-origin"]=`50% 50% -${g/2}px`,I.shadow)if(E)N.style.transform=`translate3d(0px, ${d/2+I.shadowOffset}px, ${-d/2}px) rotateX(89.99deg) rotateZ(0deg) scale(${I.shadowScale})`;else{let R=Math.abs(M)-Math.floor(Math.abs(M)/90)*90,x=1.5-(Math.sin(R*2*Math.PI/360)/2+Math.cos(R*2*Math.PI/360)/2),T=I.shadowScale,A=I.shadowScale/x,C=I.shadowOffset;N.style.transform=`scale3d(${T}, 1, ${A}) translate3d(0px, ${h/2+C}px, ${-h/2/A}px) rotateX(-89.99deg)`}let U=(_.isSafari||_.isWebView)&&_.needPerspectiveFix?-g/2:0;c.style.transform=`translate3d(0px,0,${U}px) rotateX(${S(e.isHorizontal()?0:M)}deg) rotateY(${S(e.isHorizontal()?-M:0)}deg)`,c.style.setProperty("--swiper-cube-translate-z",`${U}px`)},setTransition:l=>{let{el:c,slides:u}=e;if(u.forEach(d=>{d.style.transitionDuration=`${l}ms`,d.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(h=>{h.style.transitionDuration=`${l}ms`})}),e.params.cubeEffect.shadow&&!e.isHorizontal()){let d=c.querySelector(".swiper-cube-shadow");d&&(d.style.transitionDuration=`${l}ms`)}},recreateShadows:()=>{let l=e.isHorizontal();e.slides.forEach(c=>{let u=Math.max(Math.min(c.progress,1),-1);r(c,u,l)})},getEffectParams:()=>e.params.cubeEffect,perspective:()=>!0,overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,resistanceRatio:0,spaceBetween:0,centeredSlides:!1,virtualTranslate:!0})})}function Qr(n,e,t){let i=`swiper-slide-shadow${t?`-${t}`:""}${n?` swiper-slide-shadow-${n}`:""}`,r=ei(e),s=r.querySelector(`.${i.split(" ").join(".")}`);return s||(s=tn("div",i.split(" ")),r.append(s)),s}function BB(n){let{swiper:e,extendParams:t,on:i}=n;t({flipEffect:{slideShadows:!0,limitRotation:!0}});let r=(l,c)=>{let u=e.isHorizontal()?l.querySelector(".swiper-slide-shadow-left"):l.querySelector(".swiper-slide-shadow-top"),d=e.isHorizontal()?l.querySelector(".swiper-slide-shadow-right"):l.querySelector(".swiper-slide-shadow-bottom");u||(u=Qr("flip",l,e.isHorizontal()?"left":"top")),d||(d=Qr("flip",l,e.isHorizontal()?"right":"bottom")),u&&(u.style.opacity=Math.max(-c,0)),d&&(d.style.opacity=Math.max(c,0))};Wi({effect:"flip",swiper:e,on:i,setTranslate:()=>{let{slides:l,rtlTranslate:c}=e,u=e.params.flipEffect,d=Go(e);for(let h=0;h<l.length;h+=1){let f=l[h],g=f.progress;e.params.flipEffect.limitRotation&&(g=Math.max(Math.min(f.progress,1),-1));let _=f.swiperSlideOffset,I=-180*g,E=0,b=e.params.cssMode?-_-e.translate:-_,M=0;e.isHorizontal()?c&&(I=-I):(M=b,b=0,E=-I,I=0),f.style.zIndex=-Math.abs(Math.round(g))+l.length,u.slideShadows&&r(f,g);let N=`translate3d(${b}px, ${M}px, 0px) rotateX(${d(E)}deg) rotateY(${d(I)}deg)`,U=Yr(u,f);U.style.transform=N}},setTransition:l=>{let c=e.slides.map(u=>ei(u));c.forEach(u=>{u.style.transitionDuration=`${l}ms`,u.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(d=>{d.style.transitionDuration=`${l}ms`})}),Wo({swiper:e,duration:l,transformElements:c})},recreateShadows:()=>{e.params.flipEffect,e.slides.forEach(l=>{let c=l.progress;e.params.flipEffect.limitRotation&&(c=Math.max(Math.min(l.progress,1),-1)),r(l,c)})},getEffectParams:()=>e.params.flipEffect,perspective:()=>!0,overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!e.params.cssMode})})}function UB(n){let{swiper:e,extendParams:t,on:i}=n;t({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Wi({effect:"coverflow",swiper:e,on:i,setTranslate:()=>{let{width:o,height:a,slides:l,slidesSizesGrid:c}=e,u=e.params.coverflowEffect,d=e.isHorizontal(),h=e.translate,f=d?-h+o/2:-h+a/2,g=d?u.rotate:-u.rotate,_=u.depth,S=Go(e);for(let I=0,E=l.length;I<E;I+=1){let b=l[I],M=c[I],N=b.swiperSlideOffset,U=(f-N-M/2)/M,R=typeof u.modifier=="function"?u.modifier(U):U*u.modifier,x=d?g*R:0,T=d?0:g*R,A=-_*Math.abs(R),C=u.stretch;typeof C=="string"&&C.indexOf("%")!==-1&&(C=parseFloat(u.stretch)/100*M);let P=d?0:C*R,y=d?C*R:0,w=1-(1-u.scale)*Math.abs(R);Math.abs(y)<.001&&(y=0),Math.abs(P)<.001&&(P=0),Math.abs(A)<.001&&(A=0),Math.abs(x)<.001&&(x=0),Math.abs(T)<.001&&(T=0),Math.abs(w)<.001&&(w=0);let F=`translate3d(${y}px,${P}px,${A}px)  rotateX(${S(T)}deg) rotateY(${S(x)}deg) scale(${w})`,Q=Yr(u,b);if(Q.style.transform=F,b.style.zIndex=-Math.abs(Math.round(R))+1,u.slideShadows){let z=d?b.querySelector(".swiper-slide-shadow-left"):b.querySelector(".swiper-slide-shadow-top"),V=d?b.querySelector(".swiper-slide-shadow-right"):b.querySelector(".swiper-slide-shadow-bottom");z||(z=Qr("coverflow",b,d?"left":"top")),V||(V=Qr("coverflow",b,d?"right":"bottom")),z&&(z.style.opacity=R>0?R:0),V&&(V.style.opacity=-R>0?-R:0)}}},setTransition:o=>{e.slides.map(l=>ei(l)).forEach(l=>{l.style.transitionDuration=`${o}ms`,l.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(c=>{c.style.transitionDuration=`${o}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}function qB(n){let{swiper:e,extendParams:t,on:i}=n;t({creativeEffect:{limitProgress:1,shadowPerProgress:!1,progressMultiplier:1,perspective:!0,prev:{translate:[0,0,0],rotate:[0,0,0],opacity:1,scale:1},next:{translate:[0,0,0],rotate:[0,0,0],opacity:1,scale:1}}});let r=a=>typeof a=="string"?a:`${a}px`;Wi({effect:"creative",swiper:e,on:i,setTranslate:()=>{let{slides:a,wrapperEl:l,slidesSizesGrid:c}=e,u=e.params.creativeEffect,{progressMultiplier:d}=u,h=e.params.centeredSlides,f=Go(e);if(h){let g=c[0]/2-e.params.slidesOffsetBefore||0;l.style.transform=`translateX(calc(50% - ${g}px))`}for(let g=0;g<a.length;g+=1){let _=a[g],S=_.progress,I=Math.min(Math.max(_.progress,-u.limitProgress),u.limitProgress),E=I;h||(E=Math.min(Math.max(_.originalProgress,-u.limitProgress),u.limitProgress));let b=_.swiperSlideOffset,M=[e.params.cssMode?-b-e.translate:-b,0,0],N=[0,0,0],U=!1;e.isHorizontal()||(M[1]=M[0],M[0]=0);let R={translate:[0,0,0],rotate:[0,0,0],scale:1,opacity:1};I<0?(R=u.next,U=!0):I>0&&(R=u.prev,U=!0),M.forEach((w,F)=>{M[F]=`calc(${w}px + (${r(R.translate[F])} * ${Math.abs(I*d)}))`}),N.forEach((w,F)=>{let Q=R.rotate[F]*Math.abs(I*d);N[F]=Q}),_.style.zIndex=-Math.abs(Math.round(S))+a.length;let x=M.join(", "),T=`rotateX(${f(N[0])}deg) rotateY(${f(N[1])}deg) rotateZ(${f(N[2])}deg)`,A=E<0?`scale(${1+(1-R.scale)*E*d})`:`scale(${1-(1-R.scale)*E*d})`,C=E<0?1+(1-R.opacity)*E*d:1-(1-R.opacity)*E*d,P=`translate3d(${x}) ${T} ${A}`;if(U&&R.shadow||!U){let w=_.querySelector(".swiper-slide-shadow");if(!w&&R.shadow&&(w=Qr("creative",_)),w){let F=u.shadowPerProgress?I*(1/u.limitProgress):I;w.style.opacity=Math.min(Math.max(Math.abs(F),0),1)}}let y=Yr(u,_);y.style.transform=P,y.style.opacity=C,R.origin&&(y.style.transformOrigin=R.origin)}},setTransition:a=>{let l=e.slides.map(c=>ei(c));l.forEach(c=>{c.style.transitionDuration=`${a}ms`,c.querySelectorAll(".swiper-slide-shadow").forEach(u=>{u.style.transitionDuration=`${a}ms`})}),Wo({swiper:e,duration:a,transformElements:l,allSlides:!0})},perspective:()=>e.params.creativeEffect.perspective,overwriteParams:()=>({watchSlidesProgress:!0,virtualTranslate:!e.params.cssMode})})}function zB(n){let{swiper:e,extendParams:t,on:i}=n;t({cardsEffect:{slideShadows:!0,rotate:!0,perSlideRotate:2,perSlideOffset:8}}),Wi({effect:"cards",swiper:e,on:i,setTranslate:()=>{let{slides:o,activeIndex:a,rtlTranslate:l}=e,c=e.params.cardsEffect,{startTranslate:u,isTouched:d}=e.touchEventsData,h=l?-e.translate:e.translate;for(let f=0;f<o.length;f+=1){let g=o[f],_=g.progress,S=Math.min(Math.max(_,-4),4),I=g.swiperSlideOffset;e.params.centeredSlides&&!e.params.cssMode&&(e.wrapperEl.style.transform=`translateX(${e.minTranslate()}px)`),e.params.centeredSlides&&e.params.cssMode&&(I-=o[0].swiperSlideOffset);let E=e.params.cssMode?-I-e.translate:-I,b=0,M=-100*Math.abs(S),N=1,U=-c.perSlideRotate*S,R=c.perSlideOffset-Math.abs(S)*.75,x=e.virtual&&e.params.virtual.enabled?e.virtual.from+f:f,T=(x===a||x===a-1)&&S>0&&S<1&&(d||e.params.cssMode)&&h<u,A=(x===a||x===a+1)&&S<0&&S>-1&&(d||e.params.cssMode)&&h>u;if(T||A){let w=(1-Math.abs((Math.abs(S)-.5)/.5))**.5;U+=-28*S*w,N+=-.5*w,R+=96*w,b=`${-25*w*Math.abs(S)}%`}if(S<0?E=`calc(${E}px ${l?"-":"+"} (${R*Math.abs(S)}%))`:S>0?E=`calc(${E}px ${l?"-":"+"} (-${R*Math.abs(S)}%))`:E=`${E}px`,!e.isHorizontal()){let w=b;b=E,E=w}let C=S<0?`${1+(1-N)*S}`:`${1-(1-N)*S}`,P=`
        translate3d(${E}, ${b}, ${M}px)
        rotateZ(${c.rotate?l?-U:U:0}deg)
        scale(${C})
      `;if(c.slideShadows){let w=g.querySelector(".swiper-slide-shadow");w||(w=Qr("cards",g)),w&&(w.style.opacity=Math.min(Math.max((Math.abs(S)-.5)/.5,0),1))}g.style.zIndex=-Math.abs(Math.round(_))+o.length;let y=Yr(c,g);y.style.transform=P}},setTransition:o=>{let a=e.slides.map(l=>ei(l));a.forEach(l=>{l.style.transitionDuration=`${o}ms`,l.querySelectorAll(".swiper-slide-shadow").forEach(c=>{c.style.transitionDuration=`${o}ms`})}),Wo({swiper:e,duration:o,transformElements:a})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0,virtualTranslate:!e.params.cssMode})})}var Pie=[_B,wB,SB,bB,EB,CB,TB,xB,IB,kB,AB,DB,PB,RB,MB,OB,NB,LB,FB,BB,UB,qB,zB];Ho.use(Pie);var Iu=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function dl(n){return typeof n=="object"&&n!==null&&n.constructor&&Object.prototype.toString.call(n).slice(8,-1)==="Object"&&!n.__swiper__}function Ay(n,e){let t=["__proto__","constructor","prototype"];Object.keys(e).filter(i=>t.indexOf(i)<0).forEach(i=>{typeof n[i]>"u"?n[i]=e[i]:dl(e[i])&&dl(n[i])&&Object.keys(e[i]).length>0?e[i].__swiper__?n[i]=e[i]:Ay(n[i],e[i]):n[i]=e[i]})}function VB(n){return n===void 0&&(n={}),n.navigation&&typeof n.navigation.nextEl>"u"&&typeof n.navigation.prevEl>"u"}function $B(n){return n===void 0&&(n={}),n.pagination&&typeof n.pagination.el>"u"}function jB(n){return n===void 0&&(n={}),n.scrollbar&&typeof n.scrollbar.el>"u"}function ku(n){return n===void 0&&(n=""),n.replace(/-[a-z]/g,e=>e.toUpperCase().replace("-",""))}function GB(n){let{swiper:e,slides:t,passedParams:i,changedParams:r,nextEl:s,prevEl:o,scrollbarEl:a,paginationEl:l}=n,c=r.filter(T=>T!=="children"&&T!=="direction"&&T!=="wrapperClass"),{params:u,pagination:d,navigation:h,scrollbar:f,virtual:g,thumbs:_}=e,S,I,E,b,M,N,U,R;r.includes("thumbs")&&i.thumbs&&i.thumbs.swiper&&u.thumbs&&!u.thumbs.swiper&&(S=!0),r.includes("controller")&&i.controller&&i.controller.control&&u.controller&&!u.controller.control&&(I=!0),r.includes("pagination")&&i.pagination&&(i.pagination.el||l)&&(u.pagination||u.pagination===!1)&&d&&!d.el&&(E=!0),r.includes("scrollbar")&&i.scrollbar&&(i.scrollbar.el||a)&&(u.scrollbar||u.scrollbar===!1)&&f&&!f.el&&(b=!0),r.includes("navigation")&&i.navigation&&(i.navigation.prevEl||o)&&(i.navigation.nextEl||s)&&(u.navigation||u.navigation===!1)&&h&&!h.prevEl&&!h.nextEl&&(M=!0);let x=T=>{e[T]&&(e[T].destroy(),T==="navigation"?(e.isElement&&(e[T].prevEl.remove(),e[T].nextEl.remove()),u[T].prevEl=void 0,u[T].nextEl=void 0,e[T].prevEl=void 0,e[T].nextEl=void 0):(e.isElement&&e[T].el.remove(),u[T].el=void 0,e[T].el=void 0))};r.includes("loop")&&e.isElement&&(u.loop&&!i.loop?N=!0:!u.loop&&i.loop?U=!0:R=!0),c.forEach(T=>{if(dl(u[T])&&dl(i[T]))Object.assign(u[T],i[T]),(T==="navigation"||T==="pagination"||T==="scrollbar")&&"enabled"in i[T]&&!i[T].enabled&&x(T);else{let A=i[T];(A===!0||A===!1)&&(T==="navigation"||T==="pagination"||T==="scrollbar")?A===!1&&x(T):u[T]=i[T]}}),c.includes("controller")&&!I&&e.controller&&e.controller.control&&u.controller&&u.controller.control&&(e.controller.control=u.controller.control),r.includes("children")&&t&&g&&u.virtual.enabled?(g.slides=t,g.update(!0)):r.includes("virtual")&&g&&u.virtual.enabled&&(t&&(g.slides=t),g.update(!0)),r.includes("children")&&t&&u.loop&&(R=!0),S&&_.init()&&_.update(!0),I&&(e.controller.control=u.controller.control),E&&(e.isElement&&(!l||typeof l=="string")&&(l=document.createElement("div"),l.classList.add("swiper-pagination"),l.part.add("pagination"),e.el.appendChild(l)),l&&(u.pagination.el=l),d.init(),d.render(),d.update()),b&&(e.isElement&&(!a||typeof a=="string")&&(a=document.createElement("div"),a.classList.add("swiper-scrollbar"),a.part.add("scrollbar"),e.el.appendChild(a)),a&&(u.scrollbar.el=a),f.init(),f.updateSize(),f.setTranslate()),M&&(e.isElement&&((!s||typeof s=="string")&&(s=document.createElement("div"),s.classList.add("swiper-button-next"),s.innerHTML=e.hostEl.constructor.nextButtonSvg,s.part.add("button-next"),e.el.appendChild(s)),(!o||typeof o=="string")&&(o=document.createElement("div"),o.classList.add("swiper-button-prev"),o.innerHTML=e.hostEl.constructor.prevButtonSvg,o.part.add("button-prev"),e.el.appendChild(o))),s&&(u.navigation.nextEl=s),o&&(u.navigation.prevEl=o),h.init(),h.update()),r.includes("allowSlideNext")&&(e.allowSlideNext=i.allowSlideNext),r.includes("allowSlidePrev")&&(e.allowSlidePrev=i.allowSlidePrev),r.includes("direction")&&e.changeDirection(i.direction,!1),(N||R)&&e.loopDestroy(),(U||R)&&e.loopCreate(),e.update()}var HB=n=>{if(parseFloat(n)===Number(n))return Number(n);if(n==="true"||n==="")return!0;if(n==="false")return!1;if(n==="null")return null;if(n!=="undefined"){if(typeof n=="string"&&n.includes("{")&&n.includes("}")&&n.includes('"')){let e;try{e=JSON.parse(n)}catch{e=n}return e}return n}},WB=["a11y","autoplay","controller","cards-effect","coverflow-effect","creative-effect","cube-effect","fade-effect","flip-effect","free-mode","grid","hash-navigation","history","keyboard","mousewheel","navigation","pagination","parallax","scrollbar","thumbs","virtual","zoom"];function Ix(n,e,t){let i={},r={};Ay(i,ky);let s=[...Iu,"on"],o=s.map(l=>l.replace(/_/,""));s.forEach(l=>{l=l.replace("_",""),typeof n[l]<"u"&&(r[l]=n[l])});let a=[...n.attributes];return typeof e=="string"&&typeof t<"u"&&a.push({name:e,value:dl(t)?ht({},t):t}),a.forEach(l=>{let c=WB.filter(u=>l.name.indexOf(`${u}-`)===0)[0];if(c){let u=ku(c),d=ku(l.name.split(`${c}-`)[1]);typeof r[u]>"u"&&(r[u]={}),r[u]===!0&&(r[u]={enabled:!0}),r[u][d]=HB(l.value)}else{let u=ku(l.name);if(!o.includes(u))return;let d=HB(l.value);r[u]&&WB.includes(l.name)&&!dl(d)?(r[u].constructor!==Object&&(r[u]={}),r[u].enabled=!!d):r[u]=d}}),Ay(i,r),i.navigation?i.navigation=ht({prevEl:".swiper-button-prev",nextEl:".swiper-button-next"},i.navigation!==!0?i.navigation:{}):i.navigation===!1&&delete i.navigation,i.scrollbar?i.scrollbar=ht({el:".swiper-scrollbar"},i.scrollbar!==!0?i.scrollbar:{}):i.scrollbar===!1&&delete i.scrollbar,i.pagination?i.pagination=ht({el:".swiper-pagination"},i.pagination!==!0?i.pagination:{}):i.pagination===!1&&delete i.pagination,{params:i,passedParams:r}}var Rie=":host{--swiper-theme-color:#007aff}:host{position:relative;display:block;margin-left:auto;margin-right:auto;z-index:1}.swiper{width:100%;height:100%;margin-left:auto;margin-right:auto;position:relative;overflow:hidden;list-style:none;padding:0;z-index:1;display:block}.swiper-vertical>.swiper-wrapper{flex-direction:column}.swiper-wrapper{position:relative;width:100%;height:100%;z-index:1;display:flex;transition-property:transform;transition-timing-function:var(--swiper-wrapper-transition-timing-function,initial);box-sizing:content-box}.swiper-android ::slotted(swiper-slide),.swiper-ios ::slotted(swiper-slide),.swiper-wrapper{transform:translate3d(0px,0,0)}.swiper-horizontal{touch-action:pan-y}.swiper-vertical{touch-action:pan-x}::slotted(swiper-slide){flex-shrink:0;width:100%;height:100%;position:relative;transition-property:transform;display:block}::slotted(.swiper-slide-invisible-blank){visibility:hidden}.swiper-autoheight,.swiper-autoheight ::slotted(swiper-slide){height:auto}.swiper-autoheight .swiper-wrapper{align-items:flex-start;transition-property:transform,height}.swiper-backface-hidden ::slotted(swiper-slide){transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-3d.swiper-css-mode .swiper-wrapper{perspective:1200px}.swiper-3d .swiper-wrapper{transform-style:preserve-3d}.swiper-3d{perspective:1200px}.swiper-3d .swiper-cube-shadow,.swiper-3d ::slotted(swiper-slide){transform-style:preserve-3d}.swiper-css-mode>.swiper-wrapper{overflow:auto;scrollbar-width:none;-ms-overflow-style:none}.swiper-css-mode>.swiper-wrapper::-webkit-scrollbar{display:none}.swiper-css-mode ::slotted(swiper-slide){scroll-snap-align:start start}.swiper-css-mode.swiper-horizontal>.swiper-wrapper{scroll-snap-type:x mandatory}.swiper-css-mode.swiper-vertical>.swiper-wrapper{scroll-snap-type:y mandatory}.swiper-css-mode.swiper-free-mode>.swiper-wrapper{scroll-snap-type:none}.swiper-css-mode.swiper-free-mode ::slotted(swiper-slide){scroll-snap-align:none}.swiper-css-mode.swiper-centered>.swiper-wrapper::before{content:'';flex-shrink:0;order:9999}.swiper-css-mode.swiper-centered ::slotted(swiper-slide){scroll-snap-align:center center;scroll-snap-stop:always}.swiper-css-mode.swiper-centered.swiper-horizontal ::slotted(swiper-slide):first-child{margin-inline-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-horizontal>.swiper-wrapper::before{height:100%;min-height:1px;width:var(--swiper-centered-offset-after)}.swiper-css-mode.swiper-centered.swiper-vertical ::slotted(swiper-slide):first-child{margin-block-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-vertical>.swiper-wrapper::before{width:100%;min-width:1px;height:var(--swiper-centered-offset-after)}.swiper-virtual ::slotted(swiper-slide){-webkit-backface-visibility:hidden;transform:translateZ(0)}.swiper-virtual.swiper-css-mode .swiper-wrapper::after{content:'';position:absolute;left:0;top:0;pointer-events:none}.swiper-virtual.swiper-css-mode.swiper-horizontal .swiper-wrapper::after{height:1px;width:var(--swiper-virtual-size)}.swiper-virtual.swiper-css-mode.swiper-vertical .swiper-wrapper::after{width:1px;height:var(--swiper-virtual-size)}:host{--swiper-navigation-size:44px}.swiper-button-next,.swiper-button-prev{position:absolute;top:var(--swiper-navigation-top-offset,50%);width:calc(var(--swiper-navigation-size)/ 44 * 27);height:var(--swiper-navigation-size);margin-top:calc(0px - (var(--swiper-navigation-size)/ 2));z-index:10;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--swiper-navigation-color,var(--swiper-theme-color))}.swiper-button-next.swiper-button-disabled,.swiper-button-prev.swiper-button-disabled{opacity:.35;cursor:auto;pointer-events:none}.swiper-button-next.swiper-button-hidden,.swiper-button-prev.swiper-button-hidden{opacity:0;cursor:auto;pointer-events:none}.swiper-navigation-disabled .swiper-button-next,.swiper-navigation-disabled .swiper-button-prev{display:none!important}.swiper-button-next svg,.swiper-button-prev svg{width:100%;height:100%;object-fit:contain;transform-origin:center}.swiper-rtl .swiper-button-next svg,.swiper-rtl .swiper-button-prev svg{transform:rotate(180deg)}.swiper-button-prev,.swiper-rtl .swiper-button-next{left:var(--swiper-navigation-sides-offset,10px);right:auto}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:var(--swiper-navigation-sides-offset,10px);left:auto}.swiper-button-lock{display:none}.swiper-pagination{position:absolute;text-align:center;transition:.3s opacity;transform:translate3d(0,0,0);z-index:10}.swiper-pagination.swiper-pagination-hidden{opacity:0}.swiper-pagination-disabled>.swiper-pagination,.swiper-pagination.swiper-pagination-disabled{display:none!important}.swiper-horizontal>.swiper-pagination-bullets,.swiper-pagination-bullets.swiper-pagination-horizontal,.swiper-pagination-custom,.swiper-pagination-fraction{bottom:var(--swiper-pagination-bottom,8px);top:var(--swiper-pagination-top,auto);left:0;width:100%}.swiper-pagination-bullets-dynamic{overflow:hidden;font-size:0}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transform:scale(.33);position:relative}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev{transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next{transform:scale(.33)}.swiper-pagination-bullet{width:var(--swiper-pagination-bullet-width,var(--swiper-pagination-bullet-size,8px));height:var(--swiper-pagination-bullet-height,var(--swiper-pagination-bullet-size,8px));display:inline-block;border-radius:var(--swiper-pagination-bullet-border-radius,50%);background:var(--swiper-pagination-bullet-inactive-color,#000);opacity:var(--swiper-pagination-bullet-inactive-opacity, .2)}button.swiper-pagination-bullet{border:none;margin:0;padding:0;box-shadow:none;-webkit-appearance:none;appearance:none}.swiper-pagination-clickable .swiper-pagination-bullet{cursor:pointer}.swiper-pagination-bullet:only-child{display:none!important}.swiper-pagination-bullet-active{opacity:var(--swiper-pagination-bullet-opacity, 1);background:var(--swiper-pagination-color,var(--swiper-theme-color))}.swiper-pagination-vertical.swiper-pagination-bullets,.swiper-vertical>.swiper-pagination-bullets{right:var(--swiper-pagination-right,8px);left:var(--swiper-pagination-left,auto);top:50%;transform:translate3d(0px,-50%,0)}.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets .swiper-pagination-bullet{margin:var(--swiper-pagination-bullet-vertical-gap,6px) 0;display:block}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{top:50%;transform:translateY(-50%);width:8px}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{display:inline-block;transition:.2s transform,.2s top}.swiper-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet{margin:0 var(--swiper-pagination-bullet-horizontal-gap,4px)}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{left:50%;transform:translateX(-50%);white-space:nowrap}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s left}.swiper-horizontal.swiper-rtl>.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s right}.swiper-pagination-fraction{color:var(--swiper-pagination-fraction-color,inherit)}.swiper-pagination-progressbar{background:var(--swiper-pagination-progressbar-bg-color,rgba(0,0,0,.25));position:absolute}.swiper-pagination-progressbar .swiper-pagination-progressbar-fill{background:var(--swiper-pagination-color,var(--swiper-theme-color));position:absolute;left:0;top:0;width:100%;height:100%;transform:scale(0);transform-origin:left top}.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill{transform-origin:right top}.swiper-horizontal>.swiper-pagination-progressbar,.swiper-pagination-progressbar.swiper-pagination-horizontal,.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite,.swiper-vertical>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite{width:100%;height:var(--swiper-pagination-progressbar-size,4px);left:0;top:0}.swiper-horizontal>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-vertical,.swiper-vertical>.swiper-pagination-progressbar{width:var(--swiper-pagination-progressbar-size,4px);height:100%;left:0;top:0}.swiper-pagination-lock{display:none}.swiper-scrollbar{border-radius:var(--swiper-scrollbar-border-radius,10px);position:relative;touch-action:none;background:var(--swiper-scrollbar-bg-color,rgba(0,0,0,.1))}.swiper-scrollbar-disabled>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-disabled{display:none!important}.swiper-horizontal>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-horizontal{position:absolute;left:var(--swiper-scrollbar-sides-offset,1%);bottom:var(--swiper-scrollbar-bottom,4px);top:var(--swiper-scrollbar-top,auto);z-index:50;height:var(--swiper-scrollbar-size,4px);width:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar.swiper-scrollbar-vertical,.swiper-vertical>.swiper-scrollbar{position:absolute;left:var(--swiper-scrollbar-left,auto);right:var(--swiper-scrollbar-right,4px);top:var(--swiper-scrollbar-sides-offset,1%);z-index:50;width:var(--swiper-scrollbar-size,4px);height:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar-drag{height:100%;width:100%;position:relative;background:var(--swiper-scrollbar-drag-bg-color,rgba(0,0,0,.5));border-radius:var(--swiper-scrollbar-border-radius,10px);left:0;top:0}.swiper-scrollbar-cursor-drag{cursor:move}.swiper-scrollbar-lock{display:none}::slotted(.swiper-slide-zoomed){cursor:move;touch-action:none}.swiper .swiper-notification{position:absolute;left:0;top:0;pointer-events:none;opacity:0;z-index:-1000}.swiper-free-mode>.swiper-wrapper{transition-timing-function:ease-out;margin:0 auto}.swiper-grid>.swiper-wrapper{flex-wrap:wrap}.swiper-grid-column>.swiper-wrapper{flex-wrap:wrap;flex-direction:column}.swiper-fade.swiper-free-mode ::slotted(swiper-slide){transition-timing-function:ease-out}.swiper-fade ::slotted(swiper-slide){pointer-events:none;transition-property:opacity}.swiper-fade ::slotted(swiper-slide) ::slotted(swiper-slide){pointer-events:none}.swiper-fade ::slotted(.swiper-slide-active){pointer-events:auto}.swiper-fade ::slotted(.swiper-slide-active) ::slotted(.swiper-slide-active){pointer-events:auto}.swiper.swiper-cube{overflow:visible}.swiper-cube ::slotted(swiper-slide){pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1;visibility:hidden;transform-origin:0 0;width:100%;height:100%}.swiper-cube ::slotted(swiper-slide) ::slotted(swiper-slide){pointer-events:none}.swiper-cube.swiper-rtl ::slotted(swiper-slide){transform-origin:100% 0}.swiper-cube ::slotted(.swiper-slide-active),.swiper-cube ::slotted(.swiper-slide-active) ::slotted(.swiper-slide-active){pointer-events:auto}.swiper-cube ::slotted(.swiper-slide-active),.swiper-cube ::slotted(.swiper-slide-next),.swiper-cube ::slotted(.swiper-slide-prev){pointer-events:auto;visibility:visible}.swiper-cube .swiper-cube-shadow{position:absolute;left:0;bottom:0px;width:100%;height:100%;opacity:.6;z-index:0}.swiper-cube .swiper-cube-shadow:before{content:'';background:#000;position:absolute;left:0;top:0;bottom:0;right:0;filter:blur(50px)}.swiper-cube ::slotted(.swiper-slide-next)+::slotted(swiper-slide){pointer-events:auto;visibility:visible}.swiper.swiper-flip{overflow:visible}.swiper-flip ::slotted(swiper-slide){pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1}.swiper-flip ::slotted(swiper-slide) ::slotted(swiper-slide){pointer-events:none}.swiper-flip ::slotted(.swiper-slide-active),.swiper-flip ::slotted(.swiper-slide-active) ::slotted(.swiper-slide-active){pointer-events:auto}.swiper-creative ::slotted(swiper-slide){-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden;transition-property:transform,opacity,height}.swiper.swiper-cards{overflow:visible}.swiper-cards ::slotted(swiper-slide){transform-origin:center bottom;-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden}",Mie="::slotted(.swiper-slide-shadow),::slotted(.swiper-slide-shadow-bottom),::slotted(.swiper-slide-shadow-left),::slotted(.swiper-slide-shadow-right),::slotted(.swiper-slide-shadow-top){position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:10}::slotted(.swiper-slide-shadow){background:rgba(0,0,0,.15)}::slotted(.swiper-slide-shadow-left){background-image:linear-gradient(to left,rgba(0,0,0,.5),rgba(0,0,0,0))}::slotted(.swiper-slide-shadow-right){background-image:linear-gradient(to right,rgba(0,0,0,.5),rgba(0,0,0,0))}::slotted(.swiper-slide-shadow-top){background-image:linear-gradient(to top,rgba(0,0,0,.5),rgba(0,0,0,0))}::slotted(.swiper-slide-shadow-bottom){background-image:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-lazy-preloader{animation:swiper-preloader-spin 1s infinite linear;width:42px;height:42px;position:absolute;left:50%;top:50%;margin-left:-21px;margin-top:-21px;z-index:10;transform-origin:50%;box-sizing:border-box;border:4px solid var(--swiper-preloader-color,var(--swiper-theme-color));border-radius:50%;border-top-color:transparent}@keyframes swiper-preloader-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}::slotted(.swiper-slide-shadow-cube.swiper-slide-shadow-bottom),::slotted(.swiper-slide-shadow-cube.swiper-slide-shadow-left),::slotted(.swiper-slide-shadow-cube.swiper-slide-shadow-right),::slotted(.swiper-slide-shadow-cube.swiper-slide-shadow-top){z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}::slotted(.swiper-slide-shadow-flip.swiper-slide-shadow-bottom),::slotted(.swiper-slide-shadow-flip.swiper-slide-shadow-left),::slotted(.swiper-slide-shadow-flip.swiper-slide-shadow-right),::slotted(.swiper-slide-shadow-flip.swiper-slide-shadow-top){z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}::slotted(.swiper-zoom-container){width:100%;height:100%;display:flex;justify-content:center;align-items:center;text-align:center}::slotted(.swiper-zoom-container)>canvas,::slotted(.swiper-zoom-container)>img,::slotted(.swiper-zoom-container)>svg{max-width:100%;max-height:100%;object-fit:contain}",kx=class{},YB=typeof window>"u"||typeof HTMLElement>"u"?kx:HTMLElement,KB=`<svg width="11" height="20" viewBox="0 0 11 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.38296 20.0762C0.111788 19.805 0.111788 19.3654 0.38296 19.0942L9.19758 10.2796L0.38296 1.46497C0.111788 1.19379 0.111788 0.754138 0.38296 0.482966C0.654131 0.211794 1.09379 0.211794 1.36496 0.482966L10.4341 9.55214C10.8359 9.9539 10.8359 10.6053 10.4341 11.007L1.36496 20.0762C1.09379 20.3474 0.654131 20.3474 0.38296 20.0762Z" fill="currentColor"/></svg>
    `,QB=(n,e)=>{if(typeof CSSStyleSheet<"u"&&n.adoptedStyleSheets){let t=new CSSStyleSheet;t.replaceSync(e),n.adoptedStyleSheets=[t]}else{let t=document.createElement("style");t.rel="stylesheet",t.textContent=e,n.appendChild(t)}},Dy=class extends YB{constructor(){super(),this.attachShadow({mode:"open"})}static get nextButtonSvg(){return KB}static get prevButtonSvg(){return KB.replace("/></svg>",' transform-origin="center" transform="rotate(180)"/></svg>')}cssStyles(){return[Rie,...this.injectStyles&&Array.isArray(this.injectStyles)?this.injectStyles:[]].join(`
`)}cssLinks(){return this.injectStylesUrls||[]}calcSlideSlots(){let e=this.slideSlots||0,t=[...this.querySelectorAll("[slot^=slide-]")].map(i=>parseInt(i.getAttribute("slot").split("slide-")[1],10));if(this.slideSlots=t.length?Math.max(...t)+1:0,!!this.rendered){if(this.slideSlots>e)for(let i=e;i<this.slideSlots;i+=1){let r=document.createElement("swiper-slide");r.setAttribute("part",`slide slide-${i+1}`);let s=document.createElement("slot");s.setAttribute("name",`slide-${i+1}`),r.appendChild(s),this.shadowRoot.querySelector(".swiper-wrapper").appendChild(r)}else if(this.slideSlots<e){let i=this.swiper.slides;for(let r=i.length-1;r>=0;r-=1)r>this.slideSlots&&i[r].remove()}}}render(){if(this.rendered)return;this.calcSlideSlots();let e=this.cssStyles();this.slideSlots>0&&(e=e.replace(/::slotted\(([a-z-0-9.]*)\)/g,"$1")),e.length&&QB(this.shadowRoot,e),this.cssLinks().forEach(i=>{if(this.shadowRoot.querySelector(`link[href="${i}"]`))return;let s=document.createElement("link");s.rel="stylesheet",s.href=i,this.shadowRoot.appendChild(s)});let t=document.createElement("div");t.classList.add("swiper"),t.part="container",t.innerHTML=`
      <slot name="container-start"></slot>
      <div class="swiper-wrapper" part="wrapper">
        <slot></slot>
        ${Array.from({length:this.slideSlots}).map((i,r)=>`
        <swiper-slide part="slide slide-${r}">
          <slot name="slide-${r}"></slot>
        </swiper-slide>
        `).join("")}
      </div>
      <slot name="container-end"></slot>
      ${VB(this.passedParams)?`
        <div part="button-prev" class="swiper-button-prev">${this.constructor.prevButtonSvg}</div>
        <div part="button-next" class="swiper-button-next">${this.constructor.nextButtonSvg}</div>
      `:""}
      ${$B(this.passedParams)?`
        <div part="pagination" class="swiper-pagination"></div>
      `:""}
      ${jB(this.passedParams)?`
        <div part="scrollbar" class="swiper-scrollbar"></div>
      `:""}
    `,this.shadowRoot.appendChild(t),this.rendered=!0}initialize(){var e=this;if(this.initialized)return;this.initialized=!0;let{params:t,passedParams:i}=Ix(this);this.swiperParams=t,this.passedParams=i,delete this.swiperParams.init,this.render(),this.swiper=new Ho(this.shadowRoot.querySelector(".swiper"),Sn(ht(ht({},t.virtual?{}:{observer:!0}),t),{touchEventsTarget:"container",onAny:function(r){r==="observerUpdate"&&e.calcSlideSlots();let s=t.eventsPrefix?`${t.eventsPrefix}${r.toLowerCase()}`:r.toLowerCase();for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];let c=new CustomEvent(s,{detail:a,bubbles:r!=="hashChange",cancelable:!0});e.dispatchEvent(c)}}))}connectedCallback(){this.initialized&&this.nested&&this.closest("swiper-slide")&&this.closest("swiper-slide").swiperLoopMoveDOM||this.init===!1||this.getAttribute("init")==="false"||this.initialize()}disconnectedCallback(){this.nested&&this.closest("swiper-slide")&&this.closest("swiper-slide").swiperLoopMoveDOM||(this.swiper&&this.swiper.destroy&&this.swiper.destroy(),this.initialized=!1)}updateSwiperOnPropChange(e,t){let{params:i,passedParams:r}=Ix(this,e,t);this.passedParams=r,this.swiperParams=i,!(this.swiper&&this.swiper.params[e]===t)&&GB(ht(ht(ht({swiper:this.swiper,passedParams:this.passedParams,changedParams:[ku(e)]},e==="navigation"&&r[e]?{prevEl:".swiper-button-prev",nextEl:".swiper-button-next"}:{}),e==="pagination"&&r[e]?{paginationEl:".swiper-pagination"}:{}),e==="scrollbar"&&r[e]?{scrollbarEl:".swiper-scrollbar"}:{}))}attributeChangedCallback(e,t,i){this.initialized&&(t==="true"&&i===null&&(i=!1),this.updateSwiperOnPropChange(e,i))}static get observedAttributes(){return Iu.filter(t=>t.includes("_")).map(t=>t.replace(/[A-Z]/g,i=>`-${i}`).replace("_","").toLowerCase())}};Iu.forEach(n=>{n!=="init"&&(n=n.replace("_",""),Object.defineProperty(Dy.prototype,n,{configurable:!0,get(){return(this.passedParams||{})[n]},set(e){this.passedParams||(this.passedParams={}),this.passedParams[n]=e,this.initialized&&this.updateSwiperOnPropChange(n,e)}}))});var Ax=class extends YB{constructor(){super(),this.attachShadow({mode:"open"})}render(){let e=this.lazy||this.getAttribute("lazy")===""||this.getAttribute("lazy")==="true";if(QB(this.shadowRoot,Mie),this.shadowRoot.appendChild(document.createElement("slot")),e){let t=document.createElement("div");t.classList.add("swiper-lazy-preloader"),t.part.add("preloader"),this.shadowRoot.appendChild(t)}}initialize(){this.render()}connectedCallback(){this.initialize()}},XB=()=>{typeof window>"u"||(window.customElements.get("swiper-container")||window.customElements.define("swiper-container",Dy),window.customElements.get("swiper-slide")||window.customElements.define("swiper-slide",Ax))};typeof window<"u"&&(window.SwiperElementRegisterParams=n=>{Iu.push(...n)});var Oie=(n,e)=>({background:n,padding:e}),Nie=n=>({"font-size":n}),Ut=(()=>{let e=class e{getProgressColor(){return this.progress>80?"green":this.progress>=50?"yellow":"red"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-progress-circle"]],inputs:{progress:"progress",paddingValue:"paddingValue",fontSizeValue:"fontSizeValue"},standalone:!0,features:[he],decls:9,vars:10,consts:[[1,"relative","flex","justify-center","items-center","rounded-full","w-10","h-10",3,"ngStyle"],["min","0","max","100",1,"hidden",3,"value"],[1,"absolute","text-sm","font-bold",3,"ngStyle"]],template:function(r,s){r&1&&(p(0,"div",0)(1,"progress",1),D(2),p(3,"sup"),D(4,"%"),m()(),p(5,"div",2),D(6),p(7,"sup"),D(8,"%"),m()()()),r&2&&(k("ngStyle",qe(5,Oie,"radial-gradient(closest-side, white 79%, transparent 80% 100%), conic-gradient("+s.getProgressColor()+" "+s.progress+"%, gray 0%)",s.paddingValue+"px")),v(),k("value",s.progress),v(),J(s.progress),v(3),k("ngStyle",Kt(8,Nie,s.fontSizeValue+"px")),v(),ve(" ",s.progress,""))},dependencies:[vl],styles:['.progress-bar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100px;height:100px;border-radius:50%;background:radial-gradient(closest-side,white 79%,transparent 80% 100%),conic-gradient(#ff69b4 5%,pink 0)}.progress-bar[_ngcontent-%COMP%]:before{content:"75%"}']});let n=e;return n})();var qt=(()=>{let e=class e{transform(i){return typeof i!="number"||isNaN(i)?0:Math.round(i*10)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=cn({name:"percentage",type:e,pure:!0,standalone:!0});let n=e;return n})();var JB=(n,e)=>["/m/show-details",n,e];function Lie(n,e){if(n&1&&L(0,"img",10),n&2){let t=O(2).$implicit;k("src","https://image.tmdb.org/t/p/w780/"+t.backdrop_path,pe)}}function Fie(n,e){n&1&&L(0,"img",11)}function Bie(n,e){if(n&1&&(p(0,"div",3),q(1,Lie,1,1,"img",10)(2,Fie,1,0),m()),n&2){let t=O().$implicit;k("routerLink",qe(2,JB,t.media_type||"tv",t.id)),v(),je(1,t.backdrop_path?1:2)}}function Uie(n,e){if(n&1&&L(0,"img",10),n&2){let t=O(2).$implicit;k("src","https://image.tmdb.org/t/p/w780/"+t.backdrop_path,pe)}}function qie(n,e){n&1&&L(0,"img",11)}function zie(n,e){if(n&1&&(p(0,"div",3),q(1,Uie,1,1,"img",10)(2,qie,1,0),m()),n&2){let t=O().$implicit;k("routerLink",qe(2,JB,t.media_type||"movie",t.id)),v(),je(1,t.backdrop_path?1:2)}}function Vie(n,e){n&1&&L(0,"div")}function $ie(n,e){if(n&1&&(p(0,"swiper-slide",2),q(1,Bie,3,5,"div",3)(2,zie,3,5),p(3,"div",4)(4,"div",5),L(5,"app-progress-circle",6),me(6,"percentage"),m(),q(7,Vie,1,0,"div",7),p(8,"h3",8),D(9),m(),p(10,"p",9),D(11),me(12,"date"),m()()()),n&2){let t=e.$implicit,i=O();v(),je(1,t.name?1:2),v(4),k("progress",ke(6,5,t.vote_average)),v(2),k("ngIf",i.displayGenres),v(2),J(t.title||t.name),v(2),J(lt(12,7,t.release_date||t.first_air_date,"mediumDate"))}}XB();var Py=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this.shows=[]}ngOnInit(){}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-movie-slider"]],inputs:{shows:"shows",slidesNum:"slidesNum",displayGenres:"displayGenres"},standalone:!0,features:[he],decls:2,vars:5,consts:[[3,"slidesPerView","spaceBetween","scrollbar","loop"],["class","w-40 slide min-w-40  rounded-lg  transition-transform duration-500 mb-10",4,"ngFor","ngForOf"],[1,"w-40","slide","min-w-40","rounded-lg","transition-transform","duration-500","mb-10"],[1,"p-1","crp",3,"routerLink"],[1,""],[1,"relative","-top-5","left-2","mb-2","text-black"],[3,"progress"],[4,"ngIf"],[1,"text-sm","font-black","text-black","crp","hover:text-gray-700","duration-200","title"],[1,"text-sm","text-gray-400"],["alt","Movie Image",1,"rounded-lg","h-56","object-cover",3,"src"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","alt","Movie Image",1,"rounded-lg","h-56","object-cover"]],template:function(r,s){r&1&&(p(0,"swiper-container",0),q(1,$ie,13,10,"swiper-slide",1),m()),r&2&&(k("slidesPerView",s.slidesNum)("spaceBetween",10)("scrollbar",!0)("loop",!0),v(),k("ngForOf",s.shows))},dependencies:[bt,Ut,qt,Ye,De,Nt],styles:["h3[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin:0!important}"]});let n=e;return n})();var Au=(()=>{let e=class e{constructor(){this._HttpClient=H($n)}getTvShows(i,r){return this._HttpClient.get(`${te.url}tv/${i}?api_key=${te.apiKey}&page=${r}`)}getPopularTvShows(i){return this._HttpClient.get(`${te.url}tv/popular?api_key=${te.apiKey}&page=${i}`)}getTrendingTvShows(){return this._HttpClient.get(`${te.url}trending/tv/week?api_key=${te.apiKey}`)}getTvTrailers(i){return this._HttpClient.get(`${te.url}tv/${i}/videos?api_key=${te.apiKey}`)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Ry=(()=>{let e=class e{constructor(i){this.sanitizer=i}transform(i){return this.sanitizer.bypassSecurityTrustResourceUrl(i)}};e.\u0275fac=function(r){return new(r||e)(Fu(SI,16))},e.\u0275pipe=cn({name:"safeUrl",type:e,pure:!0,standalone:!0});let n=e;return n})();function jie(n,e){if(n&1&&(L(0,"iframe",8),me(1,"safeUrl")),n&2){let t=O();k("src",ke(1,1,t.youtubeUrl),xf)}}var My=(()=>{let e=class e{constructor(){this.close=new Lu}ngOnInit(){this.addEscapeKeyListener()}ngOnDestroy(){this.removeEscapeKeyListener()}closeModal(){this.close.emit()}addEscapeKeyListener(){this.clickOutsideListener=i=>{i?.key==="Escape"&&this.closeModal()},document.addEventListener("keydown",this.clickOutsideListener)}removeEscapeKeyListener(){document.removeEventListener("keydown",this.clickOutsideListener)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-show-modal"]],inputs:{youtubeUrl:"youtubeUrl",movie:"movie"},outputs:{close:"close"},standalone:!0,features:[he],decls:9,vars:1,consts:[[1,"fixed","inset-0","z-50","bg-gradient-to-b","from-black","via-gray-900","to-black","bg-opacity-80","flex","justify-center","items-center",3,"click"],[1,"fixed","inset-0","z-50","flex","justify-center","items-center","animate-fade-in"],[1,"bg-gray-800","py-20","rounded-xl","shadow-2xl","max-w-5xl","w-full","mx-4","relative","flex","justify-center","items-center","border","border-gray-700"],[1,"absolute","top-0","right-4","text-4xl","md:top-4","font-bold","cursor-pointer","text-gray-400","hover:text-white","transition","duration-300",3,"click"],[1,"flex","flex-col","md:flex-row","gap-8","w-full","justify-center","items-center","mt-5","p-2","md:mt-0"],[1,"w-full"],[1,"relative","rounded-xl","overflow-hidden","shadow-lg",2,"padding-top","56.25%"],["class","absolute top-0 left-0 w-full h-full rounded-lg","title","YouTube video player","frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture","allowfullscreen","",3,"src",4,"ngIf"],["title","YouTube video player","frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture","allowfullscreen","",1,"absolute","top-0","left-0","w-full","h-full","rounded-lg",3,"src"]],template:function(r,s){r&1&&(p(0,"div",0),oe("click",function(){return s.closeModal()}),m(),p(1,"div",1)(2,"div",2)(3,"span",3),oe("click",function(){return s.closeModal()}),D(4,"\xD7"),m(),p(5,"div",4)(6,"div",5)(7,"div",6),q(8,jie,2,3,"iframe",7),m()()()()()),r&2&&(v(8),k("ngIf",s.youtubeUrl))},dependencies:[Ry,De],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-out}"]});let n=e;return n})();function Gie(n,e){if(n&1&&L(0,"img",5),n&2){let t=O().$implicit;k("src","https://image.tmdb.org/t/p/w780/"+t.backdrop_path,pe)}}function Hie(n,e){n&1&&L(0,"img",11)}function Wie(n,e){if(n&1){let t=ze();p(0,"swiper-slide",3)(1,"div",4),q(2,Gie,1,1,"img",5)(3,Hie,1,0),p(4,"div",6)(5,"i",7),oe("click",function(){let r=Re(t).$implicit,s=O();return Me(s.openModal(r))}),m()()(),p(6,"div",8)(7,"h3",9),D(8),m(),p(9,"p",10),D(10),m()()()}if(n&2){let t=e.$implicit;v(2),je(2,t.backdrop_path?2:3),v(6),J(t.title||t.name),v(2),J(t.release_date||t.first_air_date)}}function Kie(n,e){if(n&1){let t=ze();p(0,"app-show-modal",12),oe("close",function(){Re(t);let r=O();return Me(r.closeModal())}),m()}if(n&2){let t=O();k("youtubeUrl",t.selectedMovieUrl)("movie",t.selectedMovie)}}var ZB=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this._TvShowsService=H(Au),this.shows=[],this.selectedMovie=null,this.selectedMovieUrl="",this.backgroundStyle={"background-size":"cover","background-position":"top",transition:"all 0.5s ease-in-out"}}openModal(i){this.selectedMovie=i,this._MoviesService.getShowTrailers(i.id,i.media_type).subscribe({next:r=>{let s=r.results.find(o=>o.name==="Official Trailer");if(s){let o=`https://www.youtube.com/embed/${s.key}`;this.selectedMovieUrl=o}else if(r.results.length>0){let a=`https://www.youtube.com/embed/${r.results[0].key}`;this.selectedMovieUrl=a}else console.log("No trailers found."),this.selectedMovieUrl=""},error:r=>{console.error("Error fetching show trailers:",r)}})}onHover(i){let r=`https://image.tmdb.org/t/p/original/${i.backdrop_path}`;this.backgroundStyle=Sn(ht({},this.backgroundStyle),{"background-image":`linear-gradient(rgba(3, 37, 65, 0.8), rgba(3, 37, 65, 0.8)), url(${r})`})}closeModal(){this.selectedMovie=null,this.selectedMovieUrl=""}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-trailer-slider"]],inputs:{shows:"shows",slidesNum:"slidesNum"},standalone:!0,features:[he],decls:3,vars:6,consts:[[1,"trailers","p-4","relative","bg-gray-900",3,"slidesPerView","spaceBetween","scrollbar","loop"],["class","relative w-80 min-w-80 rounded-lg overflow-hidden shadow-lg transition-transform duration-500 hover:scale-105 hover:shadow-xl",4,"ngFor","ngForOf"],[3,"youtubeUrl","movie","close",4,"ngIf"],[1,"relative","w-80","min-w-80","rounded-lg","overflow-hidden","shadow-lg","transition-transform","duration-500","hover:scale-105","hover:shadow-xl"],[1,"relative","group"],["alt","Movie Image",1,"w-full","h-56","object-cover","rounded-lg","group-hover:opacity-80","transition-opacity","duration-300",3,"src"],[1,"absolute","inset-0","flex","justify-center","items-center","opacity-0","group-hover:opacity-100","transition-opacity","duration-300"],[1,"fa-solid","fa-play","text-4xl","text-white","cursor-pointer","hover:text-gray-300",3,"click"],[1,"p-4","rounded-b-lg"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-gray-400"],["src","assets/images/2922280_27002.jpg","alt","Movie Image",1,"w-full","h-56","object-cover","rounded-lg","group-hover:opacity-80","transition-opacity","duration-300"],[3,"close","youtubeUrl","movie"]],template:function(r,s){r&1&&(p(0,"swiper-container",0),q(1,Wie,11,3,"swiper-slide",1),m(),q(2,Kie,1,2,"app-show-modal",2)),r&2&&(k("slidesPerView",4)("spaceBetween",10)("scrollbar",!0)("loop",!0),v(),k("ngForOf",s.shows),v(),k("ngIf",s.selectedMovie))},dependencies:[bt,De,My],styles:[".trailers[_ngcontent-%COMP%]{background:linear-gradient(#032541cc,#032541cc),url(https://image.tmdb.org/t/p/original/r6Ghtw9ENhTXfeUsd1Al20ZAvX.jpg);background-size:cover;background-position:top}h3[_ngcontent-%COMP%], p[_ngcontent-%COMP%], h2[_ngcontent-%COMP%]{margin:0;text-align:center}"]});let n=e;return n})();var Oy=(()=>{let e=class e{constructor(){this._HttpClient=H($n)}getSearchResults(i,r){return this._HttpClient.get(`https://api.themoviedb.org/3/search/multi?api_key=${te.apiKey}&query=${i}&page=${r}`)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Yie=(n,e)=>e.id,eU=(n,e)=>({"px-4 py-2 rounded-full text-sm":!0,"bg-gray-800 text-white":n," active":e}),tU=(n,e)=>({"px-4 py-2 rounded-full text-sm":!0,"bg-gray-800 text-white":n,active:e}),Qie=(n,e)=>["/m/show-details",n,e],Xie=n=>["/m/person",n];function Jie(n,e){if(n&1&&L(0,"img",29),n&2){let t=O(2).$implicit;ii("alt",t.name||t.title),k("src","https://image.tmdb.org/t/p/w500"+t.poster_path,pe)}}function Zie(n,e){if(n&1&&L(0,"img",30),n&2){let t=O(2).$implicit;ii("alt",t.name||t.title)}}function ere(n,e){if(n&1&&(p(0,"a",26),q(1,Jie,1,2,"img",27)(2,Zie,1,1,"img",28),m()),n&2){let t=O().$implicit;k("routerLink",qe(3,Qie,t.media_type,t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path)}}function tre(n,e){if(n&1&&L(0,"img",29),n&2){let t=O(2).$implicit;ii("alt",t.name),k("src","https://image.tmdb.org/t/p/w500"+t.profile_path,pe)}}function nre(n,e){if(n&1&&L(0,"img",32),n&2){let t=O(2).$implicit;ii("alt",t.name)}}function ire(n,e){if(n&1&&(p(0,"a",26),q(1,tre,1,2,"img",27)(2,nre,1,1,"img",31),m()),n&2){let t=O().$implicit;k("routerLink",Kt(3,Xie,t.id)),v(),k("ngIf",t.profile_path),v(),k("ngIf",!t.profile_path)}}function rre(n,e){if(n&1&&(p(0,"h3",22),D(1),m()),n&2){let t=O().$implicit;v(),J(t.name||t.title)}}function sre(n,e){if(n&1&&(L(0,"app-progress-circle",24),me(1,"percentage")),n&2){let t=O().$implicit;k("progress",ke(1,1,t.vote_average))}}function ore(n,e){if(n&1&&(p(0,"div",25)(1,"p"),D(2),m()()),n&2){let t=O().$implicit;v(2),J(t.media_type)}}function are(n,e){if(n&1&&(p(0,"li",20),q(1,ere,3,6,"a",21)(2,ire,3,5,"a",21),p(3,"div"),q(4,rre,2,1,"h3",22),p(5,"div",23),q(6,sre,2,3,"app-progress-circle",24)(7,ore,3,1,"div",25),m()()()),n&2){let t=e.$implicit;v(),k("ngIf",t.media_type=="tv"||t.media_type=="movie"),v(),k("ngIf",t.media_type=="person"),v(2),je(4,t.name||t.title?4:-1),v(2),je(6,t.vote_average?6:-1),v(),je(7,t.media_type?7:-1)}}function lre(n,e){if(n&1&&(p(0,"div",19)(1,"ul"),vn(2,are,8,5,"li",20,Yie),m()()),n&2){let t=O();v(2),_n(t.searchResults)}}function cre(n,e){if(n&1&&(p(0,"div",33),D(1),m()),n&2){let t=O();v(),ve(' No results found for "',t.searchTerm,'". ')}}var nU=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this._TvShowsService=H(Au),this._SearchService=H(Oy),this.selectedTrend="day",this.selectedTrailer="tv",this.trendingShows=[],this.trailersShows=[],this.searchResults=[]}ngOnInit(){this._MoviesService.getTrendingShows("all","day",1).subscribe({next:i=>{this.trendingShows=i.results},error:i=>{}}),this._MoviesService.getTrendingShows("tv","week",1).subscribe({next:i=>{this.trailersShows=i.results},error:i=>{}}),this._TvShowsService.getTrendingTvShows().subscribe({next:i=>{},error:i=>{}})}getTrends(i,r,s){this.selectedTrend=r,this._MoviesService.getTrendingShows(i,r,s).subscribe({next:o=>{this.trendingShows=o.results},error:o=>{}})}getTrailersLists(i,r,s){this.selectedTrailer=i,this._MoviesService.getTrendingShows(i,r,s).subscribe({next:o=>{this.trailersShows=o.results},error:o=>{}})}searchItem(i){this._SearchService.getSearchResults(i,1).subscribe({next:r=>{r.results.length,this.searchResults=r.results}})}isActiveTrend(i){return this.selectedTrend===i}isActiveTrailer(i){return this.selectedTrailer===i}browserLog(i){typeof window<"u"&&console.log(i)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-home"]],standalone:!0,features:[he],decls:35,vars:22,consts:[[1,"relative","w-full","xl:w-4/5","mx-auto"],[1,"flex","justify-center","items-center","mb-5"],[1,"flex","flex-col"],[1,"title","text-white","mb-4"],[1,"text-2xl","text-white","mb-8"],[1,"relative","w-full"],["type","text","placeholder","Search for movie or TV show..",1,"w-full","py-3","px-5","pr-28","rounded-full","text-black","outline-none","text-lg",3,"ngModelChange","input","ngModel"],[1,"absolute","right-2","top-1/2","transform","-translate-y-1/2","bg-gradient-to-r","from-yellow-400","to-pink-500","px-6","py-2","rounded-full","text-white","text-lg","font-semibold"],["class","mt-4 bg-white p-4 rounded-lg shadow-lg max-h-80 overflow-auto",4,"ngIf"],["class","mt-4 text-red-500 text-lg",4,"ngIf"],[1,"p-6","bg-new","text-white"],[1,"flex","items-center","mb-4","gap-4"],[1,"text-2xl","font-bold","text-black"],[1,"flex","items-center","space-x-2"],[3,"click","ngClass"],[1,"trending"],[3,"slidesNum","shows"],[1,""],[3,"shows"],[1,"mt-4","bg-white","p-4","rounded-lg","shadow-lg","max-h-80","overflow-auto"],[1,"mb-4","flex","items-start","space-x-4"],["class","cursor-pointer",3,"routerLink",4,"ngIf"],[1,"text-lg","font-bold"],[1,"flex","items-center","space-x-4","mt-2"],[3,"progress"],[1,"bg-blue-100","text-blue-700","text-sm","font-semibold","capitalize","px-2","py-1","rounded-lg","shadow"],[1,"cursor-pointer",3,"routerLink"],["class","w-16 h-24 object-cover rounded",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","w-16 h-24 object-cover rounded",3,"alt",4,"ngIf"],[1,"w-16","h-24","object-cover","rounded",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-16","h-24","object-cover","rounded",3,"alt"],["src","../../../assets/images/lost_in_Giza.jpeg","class","w-16 h-24 object-cover rounded",3,"alt",4,"ngIf"],["src","../../../assets/images/lost_in_Giza.jpeg",1,"w-16","h-24","object-cover","rounded",3,"alt"],[1,"mt-4","text-red-500","text-lg"]],template:function(r,s){r&1&&(p(0,"section",0)(1,"header",1)(2,"div",2)(3,"h1",3),D(4,"Welcome"),m(),p(5,"p",4),D(6,"Millions of movies, TV shows and people to discover. Explore now."),m(),p(7,"div",5)(8,"input",6),Ci("ngModelChange",function(a){return Ei(s.searchTerm,a)||(s.searchTerm=a),a}),oe("input",function(){return s.searchItem(s.searchTerm)}),m(),p(9,"button",7),D(10," Search "),m()(),q(11,lre,4,0,"div",8)(12,cre,2,1,"div",9),m()(),p(13,"div",10)(14,"div",11)(15,"h2",12),D(16,"Trending"),m(),p(17,"div",13)(18,"button",14),oe("click",function(){return s.getTrends("all","day",1)}),D(19," Day "),m(),p(20,"button",14),oe("click",function(){return s.getTrends("all","week",1)}),D(21," Week "),m()()(),p(22,"div",15),L(23,"app-movie-slider",16),m()(),p(24,"div",10)(25,"div",11)(26,"h2",12),D(27,"Latest Trailers "),m(),p(28,"div",13)(29,"button",14),oe("click",function(){return s.getTrailersLists("tv","week",1)}),D(30," Tv-shows "),m(),p(31,"button",14),oe("click",function(){return s.getTrailersLists("movie","week",1)}),D(32," Movies "),m()()(),p(33,"div",17),L(34,"app-trailer-slider",18),m()()()),r&2&&(v(8),bi("ngModel",s.searchTerm),v(3),k("ngIf",s.searchResults.length>0),v(),k("ngIf",s.searchResults.length===0&&s.searchTerm),v(6),k("ngClass",qe(10,eU,!s.isActiveTrend("day"),s.isActiveTrend("day"))),v(2),k("ngClass",qe(13,tU,!s.isActiveTrend("week"),s.isActiveTrend("week"))),v(3),k("slidesNum",9)("shows",s.trendingShows),v(6),k("ngClass",qe(16,eU,!s.isActiveTrailer("tv"),s.isActiveTrailer("tv"))),v(2),k("ngClass",qe(19,tU,!s.isActiveTrailer("movie"),s.isActiveTrailer("movie"))),v(3),k("shows",s.trailersShows))},dependencies:[Py,Is,ZB,Wn,Hn,En,Ii,De,Ye,Ut,qt],styles:['header[_ngcontent-%COMP%]{background:linear-gradient(#032541cc,#032541cc),url(https://image.tmdb.org/t/p/original/r6Ghtw9ENhTXfeUsd1Al20ZAvX.jpg);background-size:cover;background-position:10% 10%;min-height:300px}.trending[_ngcontent-%COMP%]{background:url("./media/trending-bg-39afc2a5f77e31d469b25c187814c0a2efef225494c038098d62317d923f8415-5GDLM5EJ.svg");background-size:cover;background-position:top}.trailers[_ngcontent-%COMP%]{background:linear-gradient(#032541cc,#032541cc),url(https://image.tmdb.org/t/p/original/r6Ghtw9ENhTXfeUsd1Al20ZAvX.jpg);background-size:cover;background-position:top}.title[_ngcontent-%COMP%]{font-size:50px;font-weight:900}nav[_ngcontent-%COMP%]{background-color:#0009}button[_ngcontent-%COMP%]{transition:background-color .3s ease}button.active[_ngcontent-%COMP%]{background-color:#ff0;color:#000}h2[_ngcontent-%COMP%]{margin:0}']});let n=e;return n})();var ti=(()=>{let e=class e{transform(i){if(!i)return"";let r=i.split(" "),s=[];for(let o=0;o<r.length;o+=3)s.push(r.slice(o,o+3).join(" "));return s.join(`
`)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=cn({name:"splitTitle",type:e,pure:!0,standalone:!0});let n=e;return n})();function ure(n,e){if(n&1){let t=ze();p(0,"div",1),oe("click",function(){Re(t);let r=O();return Me(r.goToTop())}),vi(),p(1,"svg",2),L(2,"path",3),m()()}}var Ko=(()=>{let e=class e{constructor(){this.isButtonVisible=!1}goToTop(){window.scrollTo({top:0,behavior:"smooth"})}onWindowScroll(){(window.scrollY||document.documentElement.scrollTop)>window.innerHeight?this.isButtonVisible=!0:this.isButtonVisible=!1}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-arrowtop"]],hostBindings:function(r,s){r&1&&oe("scroll",function(){return s.onWindowScroll()},!1,ml)},standalone:!0,features:[he],decls:1,vars:1,consts:[["class","fixed bottom-10 right-10 cursor-pointer p-3 bg-gray-800 rounded-full shadow-lg hover:bg-gray-700 transition duration-300 ease-in-out",3,"click",4,"ngIf"],[1,"fixed","bottom-10","right-10","cursor-pointer","p-3","bg-gray-800","rounded-full","shadow-lg","hover:bg-gray-700","transition","duration-300","ease-in-out",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-6","w-6","text-white","animate-bounce"],["stroke-linecap","round","stroke-linejoin","round","d","M5 15l7-7 7 7"]],template:function(r,s){r&1&&q(0,ure,3,0,"div",0),r&2&&k("ngIf",s.isButtonVisible)},dependencies:[De]});let n=e;return n})();var Yo=(()=>{let e=class e{constructor(i){this._HttpClient=i}createPost(i){return this._HttpClient.post(`${te.socialAppUrl}posts`,i)}updatePost(i,r){return this._HttpClient.put(`${te.socialAppUrl}posts/${i}`,r)}deletePost(i){return this._HttpClient.delete(`${te.socialAppUrl}posts/${i}`)}getAllPosts(){return this._HttpClient.get(`${te.socialAppUrl}posts`)}getLimitedPosts(i){return this._HttpClient.get(`${te.socialAppUrl}posts?page=${i}`)}getUserPosts(){return this._HttpClient.get(`${te.socialAppUrl}users/664bcf3e33da217c4af21f00/posts`)}getSinglePost(i){return this._HttpClient.get(`${te.socialAppUrl}posts/${i}`)}};e.\u0275fac=function(r){return new(r||e)(be($n))},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Du=(()=>{let e=class e{transform(i){return i&&i.replace(/_/g," ").split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" ")}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=cn({name:"formatTitle",type:e,pure:!0,standalone:!0});let n=e;return n})();var Ny=(()=>{let e=class e{constructor(){this._HttpClient=H($n)}discoverShows(i,r){let s=new Date,o=new Date;o.setFullYear(s.getFullYear()-1);let a=s.toISOString().split("T")[0],l=o.toISOString().split("T")[0];return this._HttpClient.get(`${te.url}discover/${i}?api_key=${te.apiKey}&page=${r}&sort_by=popularity.desc&first_air_date.gte=${l}&first_air_date.lte=${a}&with_type=4&with_origin_country=US`)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var dre=(n,e)=>e.id,hre=(n,e)=>["/m/show-details",n,e];function fre(n,e){if(n&1&&(p(0,"div",31),L(1,"img",32),m()),n&2){let t=O();v(),k("src",t.previewUrl,pe)}}function pre(n,e){if(n&1&&(p(0,"p",18),D(1),m()),n&2){let t=O();v(),J(t.msgError)}}function mre(n,e){if(n&1&&L(0,"img",43),n&2){let t=O().$implicit,i=O();k("src",i.imageUrl+t.poster_path,pe)("alt",t.original_title)}}function gre(n,e){if(n&1&&L(0,"img",44),n&2){let t=O().$implicit;k("alt",t.original_title)}}function yre(n,e){if(n&1){let t=ze();p(0,"div",23)(1,"div",33),q(2,mre,1,2,"img",34)(3,gre,1,1,"img",35),m(),p(4,"div",36),L(5,"app-progress-circle",37),me(6,"percentage"),m(),p(7,"div",38)(8,"h3",39),D(9),me(10,"splitTitle"),m(),p(11,"p",40),D(12),m(),p(13,"button",41),oe("click",function(){let r=Re(t).$implicit,s=O();return Me(s.showModal(r.poster_path,r.id))}),L(14,"i",42),D(15," Share "),m()()()}if(n&2){let t=e.$implicit;v(),k("routerLink",qe(10,hre,t.media_type||"movie",t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(2),k("progress",ke(6,6,t.vote_average)),v(4),J(ke(10,8,t.title)),v(3),J(t.release_date)}}function vre(n,e){if(n&1){let t=ze();p(0,"span",45),oe("click",function(){Re(t);let r=O();return Me(r.fetchMovies(r.currentPage-2))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage-2)}}function _re(n,e){if(n&1){let t=ze();p(0,"span",45),oe("click",function(){Re(t);let r=O();return Me(r.fetchMovies(r.currentPage-1))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage-1)}}function wre(n,e){if(n&1){let t=ze();p(0,"span",45),oe("click",function(){Re(t);let r=O();return Me(r.fetchMovies(r.currentPage+1))}),D(1),m()}if(n&2){let t=O();v(),ve(" ",t.currentPage+1,"")}}function Sre(n,e){if(n&1){let t=ze();p(0,"span",45),oe("click",function(){Re(t);let r=O();return Me(r.fetchMovies(r.currentPage+2))}),D(1),m()}if(n&2){let t=O();v(),ve(" ",t.currentPage+2,"")}}var iU=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this._DiscoverShowsService=H(Ny),this._PostsService=H(Yo),this._ActivatedRoute=H(Lt),this._Router=H(Et),this.moviesList=[],this.MAX_PAGES=500,this.currentPage=1,this.imageUrl="https://image.tmdb.org/t/p/w300/",this.isFileOver=!1,this.isButtonVisible=!1,this.currentYear=new Date().getFullYear(),this.movieFilterForm=new BI({genre:new zf(null,_t.required),year:new zf(null,[_t.required,_t.min(1900),_t.max(this.currentYear)]),sort_by:new zf(null,_t.required)})}ngOnInit(){this._ActivatedRoute.paramMap.subscribe(i=>{this.category=i.get("category"),this.fetchMovies(1),this._MoviesService.getMovieGenres().subscribe({next:r=>{this.movieGenres=r.genres}})})}fetchMovies(i){this.category==="popular"?this.callAPI(this.category,i):this.category==="now_playing"?this.callAPI(this.category,i):this.category==="upcoming"?this.callAPI(this.category,i):this.category==="top_rated"&&this.callAPI(this.category,i)}callAPI(i,r){this._MoviesService.getMovies(i,r).subscribe({next:s=>{this.lastPage=s.total_pages,this.lastPage<this.MAX_PAGES&&(this.MAX_PAGES=this.lastPage),this.moviesList=s.results,this.currentPage=r},error:s=>{console.error("Error fetching movies:",s)}})}nextPage(){this.currentPage<this.MAX_PAGES&&this.fetchMovies(this.currentPage+1)}prevPage(){this.currentPage>1&&this.fetchMovies(this.currentPage-1)}goFirst(){this.currentPage>1&&this.fetchMovies(1)}goLast(){this.currentPage<this.MAX_PAGES&&this.fetchMovies(this.MAX_PAGES)}isFirstPage(){return this.currentPage===1}isLastPage(){return this.currentPage===this.MAX_PAGES}test(i){console.log("hi",i.target)}closeModal(){let i=document.getElementById("authentication-modal");i&&(i.classList.add("hidden"),i.classList.remove("flex"))}showModal(i,r){this.shareCurrentImage=i+r;let s=document.getElementById("authentication-modal");s&&(s.classList.remove("hidden"),s.classList.add("flex"))}createPost(){let i=new FormData;if(!this.content||this.content.trim()===""){this.msgError="Post content is required";return}let r="ms,"+this.shareCurrentImage+","+this.content;console.log(r),i.append("body",r),this._PostsService.createPost(i).subscribe({next:s=>{s.message=="success"&&(console.log(s),this.content="",this.closeModal())},error:s=>{this.msgError="try smaller image",console.error("Error creating post:",s)}})}goToTop(){window.scrollTo({top:0,behavior:"smooth"})}browserLog(i,r){typeof window<"u"&&console.log(i,r)}onWindowScroll(){(window.scrollY||document.documentElement.scrollTop)>window.innerHeight?this.isButtonVisible=!0:this.isButtonVisible=!1}filterMovies(){if(this.movieFilterForm.valid){let{genre:i,year:r,sort_by:s}=this.movieFilterForm.value;this._MoviesService.discoverMovies(i,r,s).subscribe({next:o=>{this.moviesList=o.results}})}else console.log("Form is invalid")}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-movies"]],hostBindings:function(r,s){r&1&&oe("scroll",function(){return s.onWindowScroll()},!1,ml)},standalone:!0,features:[he],decls:50,vars:11,consts:[[1,"mt-40"],[1,"lg:w-1/2","mx-auto","mb-20"],["id","authentication-modal","tabindex","-1",1,"hidden","overflow-y-auto","overflow-x-hidden","fixed","top-0","right-0","left-0","z-50","justify-center","items-center","w-full","md:inset-0","h-[calc(100%-1rem)]","max-h-full"],[1,"relative","p-4","w-1/2","max-h-full"],[1,"relative","bg-white","rounded-lg","shadow","dark:bg-gray-700"],[1,"flex","items-center","justify-between","p-4","md:p-5","border-b","rounded-t","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["type","button",1,"end-2.5","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"sr-only"],[1,"p-4","md:p-5"],[1,"space-y-4"],["for","body",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["name","body","id","body","placeholder","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-600","dark:border-gray-500","dark:placeholder-gray-400","dark:text-white",3,"ngModelChange","ngModel"],["class","mt-4",4,"ngIf"],[1,"flex","justify-around","items-center","gap-5"],["type","submit",1,"text-white","bg-blue-700","hover:bg-blue-800","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","px-2","py-2.5","text-center","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"click"],[1,"error","text-center","text-red-600"],[1,"flex"],[1,"w-4/5","container","mx-auto","p-6"],[1,"text-2xl","font-bold","text-orange-600","my-4","p-2","bg-slate-100","rounded-md","shadow-md"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-5","gap-6"],[1,"bg-slate-100","rounded-lg","shadow-lg","p-2","relative","transition-transform","duration-500","hover:scale-105"],[1,"flex","justify-center","items-center"],[1,"flex","justify-between","items-center","my-10","gap-3","bg-orange-400","md:w-2/3","w-full","p-4","rounded-lg","shadow-lg"],[1,"pagination-btn",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"page-number"],[1,"page-number-active"],[1,"fa-solid","fa-angles-right"],[1,"mt-4"],["alt","File Preview",1,"w-64","h-auto","border","border-gray-300","rounded-lg",3,"src"],[1,"h-52","overflow-hidden","rounded-lg",3,"routerLink"],["class","w-full h-full object-cover crp",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","w-full h-full object-cover crp",3,"alt",4,"ngIf"],[1,"relative","-top-5","left-2"],[3,"progress"],[1,"mt-2","text-center"],[1,"text-md","font-semibold","truncate"],[1,"text-sm"],[1,"text-[#1E90FF]","mt-2","flex","items-center","justify-center",3,"click"],[1,"fa-solid","fa-share-alt","mr-1"],[1,"w-full","h-full","object-cover","crp",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-full","object-cover","crp",3,"alt"],[1,"page-number",3,"click"]],template:function(r,s){r&1&&(p(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h3",6),D(7," Add New post "),m(),p(8,"button",7),oe("click",function(){return s.closeModal()}),vi(),p(9,"svg",8),L(10,"path",9),m(),Jr(),p(11,"span",10),D(12,"Close modal"),m()()(),p(13,"div",11)(14,"div",12)(15,"div")(16,"label",13),D(17,"content "),m(),p(18,"textarea",14),Ci("ngModelChange",function(a){return Ei(s.content,a)||(s.content=a),a}),m()(),p(19,"div"),q(20,fre,2,1,"div",15),m(),p(21,"div",16)(22,"button",17),oe("click",function(){return s.createPost()}),D(23,"Add post"),m()(),q(24,pre,2,1,"p",18),m()()()()()(),p(25,"div",19)(26,"div",20)(27,"h1",21),D(28),me(29,"formatTitle"),m(),p(30,"div",22),vn(31,yre,16,13,"div",23,dre),m(),p(33,"div",24)(34,"div",25)(35,"button",26),oe("click",function(){return s.goFirst()}),L(36,"i",27),m(),p(37,"button",26),oe("click",function(){return s.prevPage()}),D(38," Pervious "),m(),q(39,vre,2,1,"span",28)(40,_re,2,1,"span",28),p(41,"span",29),D(42),m(),q(43,wre,2,1,"span",28)(44,Sre,2,1,"span",28),p(45,"button",26),oe("click",function(){return s.nextPage()}),D(46," Next "),m(),p(47,"button",26),oe("click",function(){return s.goLast()}),L(48,"i",30),m()()()()(),L(49,"app-arrowtop"),m()),r&2&&(v(18),bi("ngModel",s.content),v(2),k("ngIf",s.previewUrl),v(4),je(24,s.msgError?24:-1),v(4),ve("",ke(29,9,s.category)," Movies"),v(3),_n(s.moviesList),v(8),je(39,s.currentPage>2?39:-1),v(),je(40,s.currentPage>1?40:-1),v(2),J(s.currentPage),v(),je(43,s.currentPage<500?43:-1),v(),je(44,s.currentPage<499?44:-1))},dependencies:[Ye,Du,qt,ti,De,Ko,Wn,Hn,En,Ii,Ut,Sl],styles:["sup[_ngcontent-%COMP%]{font-size:.5em;vertical-align:super;top:0;left:0}.word-wrap[_ngcontent-%COMP%]{white-space:pre-line;line-height:1.5}.pagination-btn[_ngcontent-%COMP%]{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));border-radius:.5rem;--tw-bg-opacity: 1;background-color:rgb(63 131 248 / var(--tw-bg-opacity));padding:.5rem;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity));--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow);transition-property:transform;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1);box-shadow:0 4px #0000004d}.pagination-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px #0000004d}.pagination-btn[_ngcontent-%COMP%]:active{transform:translateY(2px);box-shadow:0 2px #0000004d}.page-number[_ngcontent-%COMP%], .page-number-active[_ngcontent-%COMP%]{margin-left:.5rem;margin-right:.5rem;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:1.125rem;line-height:1.75rem;font-weight:600}.page-number[_ngcontent-%COMP%]{border-radius:.375rem;--tw-bg-opacity: 1;background-color:rgb(100 116 139 / var(--tw-bg-opacity));padding:.25rem .5rem;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity));box-shadow:0 4px #0003}.page-number-active[_ngcontent-%COMP%]{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity));background-color:#e2e8f0;padding:4px 10px;border-radius:6px;box-shadow:inset 0 4px #0003}"]});let n=e;return n})();var bre=(n,e)=>e.id,Ere=(n,e)=>["/m/show-details",n,e];function Cre(n,e){if(n&1&&(p(0,"div",31),L(1,"img",32),m()),n&2){let t=O();v(),k("src",t.previewUrl,pe)}}function Tre(n,e){if(n&1&&(p(0,"p",18),D(1),m()),n&2){let t=O();v(),J(t.msgError)}}function xre(n,e){if(n&1&&L(0,"img",43),n&2){let t=O().$implicit,i=O();k("src",i.imageUrl+t.poster_path,pe)("alt",t.original_title)}}function Ire(n,e){if(n&1&&L(0,"img",44),n&2){let t=O().$implicit;k("alt",t.original_title)}}function kre(n,e){if(n&1){let t=ze();p(0,"div",23)(1,"div",33),q(2,xre,1,2,"img",34)(3,Ire,1,1,"img",35),m(),p(4,"div",36),L(5,"app-progress-circle",37),me(6,"percentage"),m(),p(7,"div",38)(8,"h3",39),D(9),me(10,"splitTitle"),m(),p(11,"p",40),D(12),m(),p(13,"button",41),oe("click",function(){let r=Re(t).$implicit,s=O();return Me(s.showModal(r.poster_path,r.id))}),L(14,"i",42),D(15," Share "),m()()()}if(n&2){let t=e.$implicit;v(),k("routerLink",qe(10,Ere,t.media_type||"tv",t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(2),k("progress",ke(6,6,t.vote_average)),v(4),J(ke(10,8,t.name)),v(3),J(t.release_date)}}function Are(n,e){if(n&1){let t=ze();p(0,"span",45),oe("click",function(){Re(t);let r=O();return Me(r.fetchShows(r.currentPage-2))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage-2)}}function Dre(n,e){if(n&1){let t=ze();p(0,"span",45),oe("click",function(){Re(t);let r=O();return Me(r.fetchShows(r.currentPage-1))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage-1)}}function Pre(n,e){if(n&1){let t=ze();p(0,"span",45),oe("click",function(){Re(t);let r=O();return Me(r.fetchShows(r.currentPage+1))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage+1)}}function Rre(n,e){if(n&1){let t=ze();p(0,"span",45),oe("click",function(){Re(t);let r=O();return Me(r.fetchShows(r.currentPage+2))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage+2)}}var rU=(()=>{let e=class e{constructor(){this._TvShowsService=H(Au),this._PostsService=H(Yo),this._ActivatedRoute=H(Lt),this.showsList=[],this.MAX_PAGES=500,this.currentPage=1,this.imageUrl="https://image.tmdb.org/t/p/w300/",this.isFileOver=!1,this.isButtonVisible=!1}ngOnInit(){this._ActivatedRoute.paramMap.subscribe(i=>{this.category=i.get("tvCate"),this.fetchShows(1)})}fetchShows(i){this.category==="popular"?this.callAPI(this.category,i):this.category==="airing_today"?this.callAPI(this.category,i):this.category==="on_the_air"?this.callAPI(this.category,i):this.category==="top_rated"&&this.callAPI(this.category,i)}callAPI(i,r){this._TvShowsService.getTvShows(i,r).subscribe({next:s=>{this.lastPage=s.total_pages,this.lastPage<this.MAX_PAGES&&(this.MAX_PAGES=this.lastPage),this.showsList=s.results,this.currentPage=r},error:s=>{console.error("Error fetching movies:",s)}})}nextPage(){this.currentPage<this.MAX_PAGES&&this.fetchShows(this.currentPage+1)}prevPage(){this.currentPage>1&&this.fetchShows(this.currentPage-1)}goFirst(){this.currentPage>1&&this.fetchShows(1)}goLast(){this.currentPage<this.MAX_PAGES&&this.fetchShows(this.MAX_PAGES)}isFirstPage(){return this.currentPage===1}isLastPage(){return this.currentPage===this.MAX_PAGES}test(i){console.log("hi",i.target)}closeModal(){let i=document.getElementById("authentication-modal");i&&(i.classList.add("hidden"),i.classList.remove("flex"))}showModal(i,r){this.shareCurrentImage=i+r;let s=document.getElementById("authentication-modal");s&&(s.classList.remove("hidden"),s.classList.add("flex"))}createPost(){let i=new FormData;if(!this.content||this.content.trim()===""){this.msgError="Post content is required";return}let r="ms,"+this.shareCurrentImage+","+this.content;console.log(r),i.append("body",r),this._PostsService.createPost(i).subscribe({next:s=>{s.message=="success"&&(console.log(s),this.content="",this.closeModal())},error:s=>{this.msgError="try smaller image",console.error("Error creating post:",s)}})}goToTop(){window.scrollTo({top:0,behavior:"smooth"})}browserLog(i,r){typeof window<"u"&&console.log(i,r)}onWindowScroll(){(window.scrollY||document.documentElement.scrollTop)>window.innerHeight?this.isButtonVisible=!0:this.isButtonVisible=!1}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-tvshows"]],hostBindings:function(r,s){r&1&&oe("scroll",function(){return s.onWindowScroll()},!1,ml)},standalone:!0,features:[he],decls:50,vars:11,consts:[[1,"mt-40"],[1,"lg:w-1/2","mx-auto","mb-20"],["id","authentication-modal","tabindex","-1",1,"hidden","overflow-y-auto","overflow-x-hidden","fixed","top-0","right-0","left-0","z-50","justify-center","items-center","w-full","md:inset-0","h-[calc(100%-1rem)]","max-h-full"],[1,"relative","p-4","w-1/2","max-h-full"],[1,"relative","bg-white","rounded-lg","shadow","dark:bg-gray-700"],[1,"flex","items-center","justify-between","p-4","md:p-5","border-b","rounded-t","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["type","button",1,"end-2.5","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"sr-only"],[1,"p-4","md:p-5"],[1,"space-y-4"],["for","body",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["name","body","id","body","placeholder","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-600","dark:border-gray-500","dark:placeholder-gray-400","dark:text-white",3,"ngModelChange","ngModel"],["class","mt-4",4,"ngIf"],[1,"flex","justify-around","items-center","gap-5"],["type","submit",1,"text-white","bg-blue-700","hover:bg-blue-800","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","px-2","py-2.5","text-center","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"click"],[1,"error","text-center","text-red-600"],[1,"flex"],[1,"w-4/5","container","mx-auto","p-6"],[1,"text-2xl","font-bold","text-orange-600","my-4","p-2","bg-slate-100","rounded-md","shadow-md"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-5","gap-6"],[1,"movie-card","bg-slate-100","rounded-lg","shadow-lg","p-2","relative","transition-transform","duration-500","hover:scale-105"],[1,"flex","justify-center","items-center"],[1,"flex","justify-between","items-center","my-10","gap-3","bg-orange-400","md:w-2/3","w-full","p-4","rounded-lg","shadow-lg"],[1,"pagination-btn",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"page-number"],[1,"page-number-active"],[1,"fa-solid","fa-angles-right"],[1,"mt-4"],["alt","File Preview",1,"w-64","h-auto","border","border-gray-300","rounded-lg",3,"src"],[1,"h-52","overflow-hidden","rounded-lg",3,"routerLink"],["class","w-full h-full object-cover",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","w-full h-full object-cover",3,"alt",4,"ngIf"],[1,"relative","-top-5","left-2"],[3,"progress"],[1,"mt-2","text-center"],[1,"text-md","font-semibold","truncate"],[1,"text-sm"],[1,"text-[#1E90FF]","mt-2","flex","items-center","justify-center",3,"click"],[1,"fa-solid","fa-share-alt","mr-1"],[1,"w-full","h-full","object-cover",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-full","object-cover",3,"alt"],[1,"page-number",3,"click"]],template:function(r,s){r&1&&(p(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h3",6),D(7," Add New post "),m(),p(8,"button",7),oe("click",function(){return s.closeModal()}),vi(),p(9,"svg",8),L(10,"path",9),m(),Jr(),p(11,"span",10),D(12,"Close modal"),m()()(),p(13,"div",11)(14,"div",12)(15,"div")(16,"label",13),D(17,"content "),m(),p(18,"textarea",14),Ci("ngModelChange",function(a){return Ei(s.content,a)||(s.content=a),a}),m()(),p(19,"div"),q(20,Cre,2,1,"div",15),m(),p(21,"div",16)(22,"button",17),oe("click",function(){return s.createPost()}),D(23,"Add post"),m()(),q(24,Tre,2,1,"p",18),m()()()()()(),p(25,"div",19)(26,"div",20)(27,"h1",21),D(28),me(29,"formatTitle"),m(),p(30,"div",22),vn(31,kre,16,13,"div",23,bre),m(),p(33,"div",24)(34,"div",25)(35,"button",26),oe("click",function(){return s.goFirst()}),L(36,"i",27),m(),p(37,"button",26),oe("click",function(){return s.prevPage()}),D(38," Pervious "),m(),q(39,Are,2,1,"span",28)(40,Dre,2,1,"span",28),p(41,"span",29),D(42),m(),q(43,Pre,2,1,"span",28)(44,Rre,2,1,"span",28),p(45,"button",26),oe("click",function(){return s.nextPage()}),D(46," Next "),m(),p(47,"button",26),oe("click",function(){return s.goLast()}),L(48,"i",30),m()()()()(),L(49,"app-arrowtop"),m()),r&2&&(v(18),bi("ngModel",s.content),v(2),k("ngIf",s.previewUrl),v(4),je(24,s.msgError?24:-1),v(4),ve("",ke(29,9,s.category)," Tv Shows"),v(3),_n(s.showsList),v(8),je(39,s.currentPage>2?39:-1),v(),je(40,s.currentPage>1?40:-1),v(2),J(s.currentPage),v(),je(43,s.currentPage<500?43:-1),v(),je(44,s.currentPage<499?44:-1))},dependencies:[Ye,Du,qt,ti,De,Ko,Wn,Hn,En,Ii,Ut],styles:["sup[_ngcontent-%COMP%]{font-size:.5em;vertical-align:super;top:0;left:0}.word-wrap[_ngcontent-%COMP%]{white-space:pre-line;line-height:1.5}.pagination-btn[_ngcontent-%COMP%]{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));border-radius:.5rem;--tw-bg-opacity: 1;background-color:rgb(63 131 248 / var(--tw-bg-opacity));padding:.5rem;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity));--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow);transition-property:transform;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1);box-shadow:0 4px #0000004d}.pagination-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px #0000004d}.pagination-btn[_ngcontent-%COMP%]:active{transform:translateY(2px);box-shadow:0 2px #0000004d}.page-number[_ngcontent-%COMP%], .page-number-active[_ngcontent-%COMP%]{margin-left:.5rem;margin-right:.5rem;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:1.125rem;line-height:1.75rem;font-weight:600}.page-number[_ngcontent-%COMP%]{border-radius:.375rem;--tw-bg-opacity: 1;background-color:rgb(100 116 139 / var(--tw-bg-opacity));padding:.25rem .5rem;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity));box-shadow:0 4px #0003}.page-number-active[_ngcontent-%COMP%]{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity));background-color:#e2e8f0;padding:4px 10px;border-radius:6px;box-shadow:inset 0 4px #0003}"]});let n=e;return n})();function Mre(n,e){n&1&&(p(0,"li"),D(1,"Email is required"),m())}function Ore(n,e){n&1&&(p(0,"li"),D(1,"Invalid email format"),m())}function Nre(n,e){if(n&1&&(p(0,"div",13)(1,"ul"),q(2,Mre,2,0,"li",14)(3,Ore,2,0,"li",14),m()()),n&2){let t,i,r=O();v(2),k("ngIf",(t=r.LoginForm.get("email"))==null?null:t.getError("required")),v(),k("ngIf",(i=r.LoginForm.get("email"))==null?null:i.getError("pattern"))}}function Lre(n,e){n&1&&(p(0,"li"),D(1,"Password is required"),m())}function Fre(n,e){n&1&&(p(0,"li")(1,"ul")(2,"li"),D(3,"Password must be at least 8 characters"),m(),p(4,"li"),D(5,"Include upper and lower case letters"),m(),p(6,"li"),D(7,"At least one number"),m(),p(8,"li"),D(9,"At least one special character"),m()()())}function Bre(n,e){if(n&1&&(p(0,"div",13)(1,"ul"),q(2,Lre,2,0,"li",14)(3,Fre,10,0,"li",14),m()()),n&2){let t,i,r=O();v(2),k("ngIf",(t=r.LoginForm.get("password"))==null?null:t.getError("required")),v(),k("ngIf",(i=r.LoginForm.get("password"))==null?null:i.getError("pattern"))}}function Ure(n,e){if(n&1&&(p(0,"div",15)(1,"ul")(2,"li"),D(3),m()()()),n&2){let t=O();v(3),J(t.msgError)}}var sU=(()=>{let e=class e{constructor(){this._FormBuilder=H(Kf),this._Router=H(Et),this._AuthService=H(si),this.isLoading=!1,this.msgError="",this.LoginForm=this._FormBuilder.group({email:[null,[_t.required,_t.email,_t.pattern(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/)]],password:[null,[_t.required,_t.pattern(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/)]]})}login(){this.LoginForm.valid?this._AuthService.signIn(this.LoginForm.value).subscribe({next:i=>{i.message==="success"&&(localStorage.setItem("S&MToken",i.token),this._Router.navigate(["/home"]))},error:i=>{this.msgError=i.error.error,this.isLoading=!1}}):this.LoginForm.markAllAsTouched()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-login"]],standalone:!0,features:[he],decls:21,vars:5,consts:[[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-50","log_container"],[1,"w-full","max-w-lg","p-8","bg-black","bg-opacity-70","rounded-lg","shadow-lg",3,"ngSubmit","formGroup"],[1,"text-white","text-xl","py-3","capitalize"],[1,"relative","mb-8"],["formControlName","email","autocomplete","on","type","email","id","floating_email","placeholder"," ",1,"block","w-full","py-4","text-lg","text-white","bg-transparent","border-b-2","border-gray-600","appearance-none","focus:outline-none","focus:ring-0","focus:border-red-600","peer"],["for","floating_email",1,"absolute","text-sm","text-gray-400","transition-transform","transform","scale-75","-translate-y-8","top-4","left-0","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-8"],["class","text-red-500 text-sm mt-2",4,"ngIf"],["formControlName","password","autocomplete","off","type","password","id","floating_password","placeholder"," ",1,"block","w-full","py-4","text-lg","text-white","bg-transparent","border-b-2","border-gray-600","appearance-none","focus:outline-none","focus:ring-0","focus:border-red-600","peer"],["for","floating_password",1,"absolute","text-sm","text-gray-400","transition-transform","transform","scale-75","-translate-y-8","top-4","left-0","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-8"],["type","submit",1,"w-full","py-3","text-white","bg-red-600","hover:bg-red-700","focus:outline-none","focus:ring-4","focus:ring-red-500","rounded-lg","text-base","font-medium","transition",3,"disabled"],[1,"text-white","text-lg","py-3"],["routerLink","/signup",1,"underline"],["class","text-white bg-cyan-800 text-lg mt-2 p-2",4,"ngIf"],[1,"text-red-500","text-sm","mt-2"],[4,"ngIf"],[1,"text-white","bg-cyan-800","text-lg","mt-2","p-2"]],template:function(r,s){if(r&1&&(p(0,"div",0)(1,"form",1),oe("ngSubmit",function(){return s.login()}),p(2,"h1",2),D(3,"sign in"),m(),p(4,"div",3),L(5,"input",4),p(6,"label",5),D(7," Email address "),m(),q(8,Nre,4,2,"div",6),m(),p(9,"div",3),L(10,"input",7),p(11,"label",8),D(12," Password "),m(),q(13,Bre,4,2,"div",6),m(),p(14,"button",9),D(15," Sign In "),m(),p(16,"div",10),D(17,"New to SDM? "),p(18,"a",11),D(19,"Sign up now."),m()(),q(20,Ure,4,1,"div",12),m()()),r&2){let o,a;v(),k("formGroup",s.LoginForm),v(7),k("ngIf",((o=s.LoginForm.get("email"))==null?null:o.errors)&&((o=s.LoginForm.get("email"))==null?null:o.touched)),v(5),k("ngIf",((a=s.LoginForm.get("password"))==null?null:a.errors)&&((a=s.LoginForm.get("password"))==null?null:a.touched)),v(),k("disabled",s.LoginForm.invalid),v(6),k("ngIf",s.msgError)}},dependencies:[Sl,Vf,Hn,En,qf,$f,jf,Ye,De],styles:['.log_container[_ngcontent-%COMP%]{background-image:url("./media/net_log_x-PPDAZZP4.jpg");background-position:center;background-size:cover}']});let n=e;return n})();var oU=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-auth-layout"]],standalone:!0,features:[he],decls:3,vars:0,consts:[[1,"auth"],[1,"register-container"]],template:function(r,s){r&1&&(p(0,"div",0)(1,"div",1),L(2,"router-outlet"),m()())},dependencies:[mr],styles:[".register-container[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;margin-bottom:1.25rem;margin-top:2.5rem;border-radius:.125rem;padding:5rem;--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}"]});let n=e;return n})();var aU=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-blank-layout"]],standalone:!0,features:[he],decls:5,vars:0,consts:[[1,""]],template:function(r,s){r&1&&(p(0,"div",0),L(1,"app-navbar"),m(),p(2,"div",0),L(3,"router-outlet"),m(),L(4,"app-footer"))},dependencies:[mr,qI,VI]});let n=e;return n})();var Qo=(()=>{let e=class e{constructor(i){this.db=i,this.isInWatchlist=_i(!1),this.isInFavorites=_i(!1),this.dbPath="/users",this.usersRef=i.list(this.dbPath)}getAllUsers(){return this.usersRef}addUser(i){return B(this,null,function*(){return this.usersRef.push(i).catch(r=>{console.error("Error adding user:",r)})})}getUserIDByEmail(i){return B(this,null,function*(){try{let r=yield this.db.database.ref("/users").orderByChild("email").equalTo(i).once("value");if(r.exists()){let s=r.val();return Object.keys(s)[0]}else return console.log("No user found with the provided email."),null}catch(r){return console.error("Error fetching userID:",r),null}})}addToWatchlist(i,r){return B(this,null,function*(){try{let o=this.db.database.ref(`${this.dbPath}/${i}/watchlist`).child(r.id.toString());(yield o.once("value")).exists()?(yield this.removeFromWatchlist(i,r.id.toString()),this.isInWatchlist.set(!1)):(yield o.set(r),this.isInWatchlist.set(!0))}catch(s){console.error("Error adding show to watchlist:",s)}})}checkIfInWatchlist(i,r){return B(this,null,function*(){try{return(yield this.db.database.ref(`${this.dbPath}/${i}/watchlist/${r}`).once("value")).exists()}catch(s){return console.error("Error checking watchlist status:",s),!1}})}removeFromWatchlist(i,r){return B(this,null,function*(){try{yield this.db.database.ref(`${this.dbPath}/${i}/watchlist`).child(r).remove()}catch(s){console.error("Error removing show from watchlist:",s)}})}getWatchlist(i){return B(this,null,function*(){try{let o=(yield this.db.database.ref(`${this.dbPath}/${i}/watchlist`).once("value")).val()||{};return Object.values(o)}catch(r){return console.error("Error fetching watchlist:",r),[]}})}addToFavorites(i,r){return B(this,null,function*(){try{let o=this.db.database.ref(`${this.dbPath}/${i}/favoriteShows`).child(r.id.toString());(yield o.once("value")).exists()?(yield this.removeFromFavorites(i,r.id.toString()),this.isInFavorites.set(!1)):(yield o.set(r),this.isInFavorites.set(!0))}catch(s){console.error("Error adding show to favorites:",s)}})}removeFromFavorites(i,r){return B(this,null,function*(){try{yield this.db.database.ref(`${this.dbPath}/${i}/favoriteShows`).child(r).remove()}catch(s){console.error("Error removing show from favorites:",s)}})}checkIfInFavorites(i,r){return B(this,null,function*(){try{return(yield this.db.database.ref(`${this.dbPath}/${i}/favoriteShows/${r}`).once("value")).exists()}catch(s){return console.error("Error checking favorites status:",s),!1}})}getFavorites(i){return B(this,null,function*(){try{let o=(yield this.db.database.ref(`${this.dbPath}/${i}/favoriteShows`).once("value")).val()||{};return Object.values(o)}catch(r){return console.error("Error fetching favorite shows:",r),[]}})}addPost(i,r){return this.usersRef.update(i,{posts:this.db.database.ref(`${this.dbPath}/${i}/posts`).push(r)})}addLike(i,r){return this.usersRef.update(i,{likes:this.db.database.ref(`${this.dbPath}/${i}/likes`).push(r)})}};e.\u0275fac=function(r){return new(r||e)(be(Rw))},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function qre(n,e){n&1&&(p(0,"li"),D(1,"Name is required"),m())}function zre(n,e){n&1&&(p(0,"li"),D(1,"At least 3 characters"),m())}function Vre(n,e){n&1&&(p(0,"li"),D(1,"Up to 20 characters only"),m())}function $re(n,e){if(n&1&&(p(0,"div",25)(1,"ul"),q(2,qre,2,0,"li",26)(3,zre,2,0,"li",26)(4,Vre,2,0,"li",26),m()()),n&2){let t,i,r,s=O();v(2),k("ngIf",(t=s.registerForm.get("name"))==null?null:t.getError("required")),v(),k("ngIf",(i=s.registerForm.get("name"))==null?null:i.getError("minlength")),v(),k("ngIf",(r=s.registerForm.get("name"))==null?null:r.getError("maxlength"))}}function jre(n,e){n&1&&(p(0,"li"),D(1,"Email is required"),m())}function Gre(n,e){n&1&&(p(0,"li"),D(1,"Invalid email format"),m())}function Hre(n,e){if(n&1&&(p(0,"div",25)(1,"ul"),q(2,jre,2,0,"li",26)(3,Gre,2,0,"li",26),m()()),n&2){let t,i,r=O();v(2),k("ngIf",(t=r.registerForm.get("email"))==null?null:t.getError("required")),v(),k("ngIf",(i=r.registerForm.get("email"))==null?null:i.getError("pattern"))}}function Wre(n,e){n&1&&(p(0,"li"),D(1,"Password is required"),m())}function Kre(n,e){n&1&&(p(0,"li")(1,"ul")(2,"li"),D(3,"Password must be at least 8 characters"),m(),p(4,"li"),D(5,"Include upper and lower case letters"),m(),p(6,"li"),D(7,"At least one number"),m(),p(8,"li"),D(9,"At least one special character"),m()()())}function Yre(n,e){if(n&1&&(p(0,"div",25)(1,"ul"),q(2,Wre,2,0,"li",26)(3,Kre,10,0,"li",26),m()()),n&2){let t,i,r=O();v(2),k("ngIf",(t=r.registerForm.get("password"))==null?null:t.getError("required")),v(),k("ngIf",(i=r.registerForm.get("password"))==null?null:i.getError("pattern"))}}function Qre(n,e){n&1&&(p(0,"div",25)(1,"ul")(2,"li"),D(3,"Password does not match"),m()()())}function Xre(n,e){n&1&&(p(0,"li"),D(1,"Date of birth is required"),m())}function Jre(n,e){n&1&&(p(0,"li"),D(1,"Invalid date format (YYYY-MM-DD)"),m())}function Zre(n,e){if(n&1&&(p(0,"div",25)(1,"ul"),q(2,Xre,2,0,"li",26)(3,Jre,2,0,"li",26),m()()),n&2){let t,i,r=O();v(2),k("ngIf",(t=r.registerForm.get("dateOfBirth"))==null?null:t.getError("required")),v(),k("ngIf",(i=r.registerForm.get("dateOfBirth"))==null?null:i.getError("pattern"))}}function ese(n,e){if(n&1&&(p(0,"div",27)(1,"ul")(2,"li"),D(3),m()()()),n&2){let t=O();v(3),J(t.msgError)}}var lU=(()=>{let e=class e{constructor(){this._AuthService=H(si),this._FormBuilder=H(Kf),this._Router=H(Et),this._FireStoreService=H(Qo),this.msgError="",this.registerForm=this._FormBuilder.group({name:[null,[_t.required,_t.minLength(3),_t.maxLength(20)]],email:[null,[_t.required,_t.email,_t.pattern(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/)]],password:[null,[_t.required,_t.pattern(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/)]],rePassword:[null,[_t.required]],dateOfBirth:[null,[_t.required,_t.pattern(/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/)]],gender:[null,_t.required]},{validators:[this.confirmPassword]})}confirmPassword(i){return i.get("password")?.value===i.get("rePassword")?.value?null:{mismatch:!0}}signUp(){this.registerForm.valid&&this._AuthService.signUp(this.registerForm.value).subscribe({next:i=>B(this,null,function*(){if(i.message==="success"){let r=Sn(ht({},this.registerForm.value),{createdAt:new Date().toISOString(),watchlist:[],favoriteShows:[],posts:[],likes:[]});yield this._FireStoreService.addUser(r),this._Router.navigate(["/login"])}}),error:i=>{this.msgError=i.error.error}})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-register"]],standalone:!0,features:[he],decls:46,vars:8,consts:[[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-50","log_container"],[1,"w-full","max-w-lg","p-8","bg-black","bg-opacity-70","rounded-lg","shadow-lg",3,"ngSubmit","formGroup"],[1,"text-white","text-xl","py-3","capitalize"],[1,"grid","grid-cols-2","gap-2"],[1,"relative","mb-8"],["formControlName","name","autocomplete","off","type","text","id","floating_name","placeholder"," ",1,"block","w-full","py-4","text-lg","text-white","bg-transparent","border-b-2","border-gray-600","appearance-none","focus:outline-none","focus:ring-0","focus:border-red-600","peer"],["for","floating_name",1,"absolute","text-sm","text-gray-400","transition-transform","transform","scale-75","-translate-y-8","top-4","left-0","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-8"],["class","text-red-500 text-sm mt-2",4,"ngIf"],["formControlName","email","autocomplete","off","type","email","id","floating_email","placeholder"," ",1,"block","w-full","py-4","text-lg","text-white","bg-transparent","border-b-2","border-gray-600","appearance-none","focus:outline-none","focus:ring-0","focus:border-red-600","peer"],["for","floating_email",1,"absolute","text-sm","text-gray-400","transition-transform","transform","scale-75","-translate-y-8","top-4","left-0","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-8"],["formControlName","password","autocomplete","off","type","password","id","floating_password","placeholder"," ",1,"block","w-full","py-4","text-lg","text-white","bg-transparent","border-b-2","border-gray-600","appearance-none","focus:outline-none","focus:ring-0","focus:border-red-600","peer"],["for","floating_password",1,"absolute","text-sm","text-gray-400","transition-transform","transform","scale-75","-translate-y-8","top-4","left-0","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-8"],["formControlName","rePassword","autocomplete","off","type","password","id","floating_repeat_password","placeholder"," ",1,"block","w-full","py-4","text-lg","text-white","bg-transparent","border-b-2","border-gray-600","appearance-none","focus:outline-none","focus:ring-0","focus:border-red-600","peer"],["for","floating_repeat_password",1,"absolute","text-sm","text-gray-400","transition-transform","transform","scale-75","-translate-y-8","top-4","left-0","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-8"],["formControlName","dateOfBirth","autocomplete","off","type","date","id","floating_date_of_birth","placeholder"," ",1,"block","w-full","py-4","text-lg","text-white","bg-transparent","border-b-2","border-gray-600","appearance-none","focus:outline-none","focus:ring-0","focus:border-red-600","peer"],["for","floating_date_of_birth",1,"absolute","text-sm","text-gray-400","transition-transform","transform","scale-75","-translate-y-8","top-4","left-0","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-8"],["formControlName","gender","id","gender",1,"block","w-full","py-4","text-lg","text-white","bg-transparent","border-b-2","border-gray-600","appearance-none","focus:outline-none","focus:ring-0","focus:border-red-600","peer"],["value","","selected",""],["value","male",1,"text-black"],["value","female",1,"text-black"],["for","gender",1,"absolute","text-sm","text-gray-400","transition-transform","transform","scale-75","-translate-y-8","top-4","left-0","peer-placeholder-shown:translate-y-0","peer-placeholder-shown:scale-100","peer-focus:scale-75","peer-focus:-translate-y-8"],["type","submit",1,"w-full","py-3","text-white","bg-red-600","hover:bg-red-700","focus:outline-none","focus:ring-4","focus:ring-red-500","rounded-lg","text-base","font-medium","transition",3,"disabled"],[1,"text-white","text-lg","py-3"],["routerLink","/login",1,"underline"],["class","text-whitebg-cyan-800 text-lg mt-2 p-2",4,"ngIf"],[1,"text-red-500","text-sm","mt-2"],[4,"ngIf"],[1,"text-whitebg-cyan-800","text-lg","mt-2","p-2"]],template:function(r,s){if(r&1&&(p(0,"div",0)(1,"form",1),oe("ngSubmit",function(){return s.signUp()}),p(2,"h1",2),D(3,"Sign up"),m(),p(4,"div",3)(5,"div",4),L(6,"input",5),p(7,"label",6),D(8," Name "),m(),q(9,$re,5,3,"div",7),m(),p(10,"div",4),L(11,"input",8),p(12,"label",9),D(13," Email address "),m(),q(14,Hre,4,2,"div",7),m(),p(15,"div",4),L(16,"input",10),p(17,"label",11),D(18," Password "),m(),q(19,Yre,4,2,"div",7),m(),p(20,"div",4),L(21,"input",12),p(22,"label",13),D(23," Confirm password "),m(),q(24,Qre,4,0,"div",7),m(),p(25,"div",4),L(26,"input",14),p(27,"label",15),D(28," Date of birth "),m(),q(29,Zre,4,2,"div",7),m(),p(30,"div",4)(31,"select",16),L(32,"option",17),p(33,"option",18),D(34,"Male"),m(),p(35,"option",19),D(36,"Female"),m()(),p(37,"label",20),D(38," Gender "),m()()(),p(39,"button",21),D(40," Sign Up "),m(),p(41,"div",22),D(42,"Already have an account? "),p(43,"a",23),D(44,"Sign in now."),m()(),q(45,ese,4,1,"div",24),m()()),r&2){let o,a,l,c;v(),k("formGroup",s.registerForm),v(8),k("ngIf",((o=s.registerForm.get("name"))==null?null:o.errors)&&((o=s.registerForm.get("name"))==null?null:o.touched)),v(5),k("ngIf",((a=s.registerForm.get("email"))==null?null:a.errors)&&((a=s.registerForm.get("email"))==null?null:a.touched)),v(5),k("ngIf",((l=s.registerForm.get("password"))==null?null:l.errors)&&((l=s.registerForm.get("password"))==null?null:l.touched)),v(5),k("ngIf",s.registerForm.getError("mismatch")),v(5),k("ngIf",((c=s.registerForm.get("dateOfBirth"))==null?null:c.errors)&&((c=s.registerForm.get("dateOfBirth"))==null?null:c.touched)),v(10),k("disabled",s.registerForm.invalid),v(6),k("ngIf",s.msgError)}},dependencies:[Sl,Vf,Hf,Wf,Hn,Gf,En,qf,$f,jf,De],styles:['.log_container[_ngcontent-%COMP%]{background-image:url("./media/net_log_x-PPDAZZP4.jpg");background-position:center;background-size:cover}']});let n=e;return n})();var cU=(n,e)=>{let t=H(Et);sI(()=>{}),oI(()=>{});let i=H(bn);return _l(i)?localStorage.getItem("S&MToken")!==null?(t.navigate(["/home"]),!1):!0:!1};var uU=(n,e)=>{let t=H(Et);return typeof localStorage<"u"?localStorage.getItem("S&MToken")!==null?!0:(t.navigate(["/login"]),!1):!1};function tse(n,e,t,i){let r=window&&!!window.document&&window.document.documentElement,s=r&&e?window:t;if(n&&(s=n&&r&&typeof n=="string"?nse(n,t.nativeElement,i):n,!s))throw new Error("ngx-infinite-scroll {resolveContainerElement()}: selector for");return s}function nse(n,e,t){return(t?window.document:e).querySelector(n)}function Dx(n){return n&&!n.firstChange}function ise(){return typeof window<"u"}var rse={clientHeight:"clientHeight",offsetHeight:"offsetHeight",scrollHeight:"scrollHeight",pageYOffset:"pageYOffset",offsetTop:"offsetTop",scrollTop:"scrollTop",top:"top"},sse={clientHeight:"clientWidth",offsetHeight:"offsetWidth",scrollHeight:"scrollWidth",pageYOffset:"pageXOffset",offsetTop:"offsetLeft",scrollTop:"scrollLeft",top:"left"},Px=class{constructor(e=!0){this.vertical=e,this.propsMap=e?rse:sse}clientHeightKey(){return this.propsMap.clientHeight}offsetHeightKey(){return this.propsMap.offsetHeight}scrollHeightKey(){return this.propsMap.scrollHeight}pageYOffsetKey(){return this.propsMap.pageYOffset}offsetTopKey(){return this.propsMap.offsetTop}scrollTopKey(){return this.propsMap.scrollTop}topKey(){return this.propsMap.top}};function ose(n,e,t){return!!(n&&e||!t&&e)}function ase({windowElement:n,axis:e}){return lse({axis:e,isWindow:cse(n)},n)}function lse(n,e){let t=n.isWindow||e&&!e.nativeElement?e:e.nativeElement;return Sn(ht({},n),{container:t})}function cse(n){return["Window","global"].some(t=>Object.prototype.toString.call(n).includes(t))}function Ox(n,e){return n?e.document.documentElement:null}function dU(n,e){let t=hse(e);return e.isWindow?use(t,n,e):dse(t,n,e)}function use(n,e,t){let{axis:i,container:r,isWindow:s}=t,{offsetHeightKey:o,clientHeightKey:a}=hU(i),l=n+pU(Ox(s,r),i,s),c=fU(e.nativeElement,s,o,a),u=fse(e.nativeElement,i,s)+c;return{height:n,scrolled:l,totalToScroll:u,isWindow:s}}function dse(n,e,t){let{axis:i,container:r}=t,s=r[i.scrollTopKey()],o=r[i.scrollHeightKey()];return{height:n,scrolled:s,totalToScroll:o,isWindow:!1}}function hU(n){return{offsetHeightKey:n.offsetHeightKey(),clientHeightKey:n.clientHeightKey()}}function hse({container:n,isWindow:e,axis:t}){let{offsetHeightKey:i,clientHeightKey:r}=hU(t);return fU(n,e,i,r)}function fU(n,e,t,i){if(isNaN(n[t])){let r=Ox(e,n);return r?r[i]:0}else return n[t]}function fse(n,e,t){let i=e.topKey();if(n.getBoundingClientRect)return n.getBoundingClientRect()[i]+pU(n,e,t)}function pU(n,e,t){let i=e.pageYOffsetKey(),r=e.scrollTopKey(),s=e.offsetTopKey();return isNaN(window.pageYOffset)?Ox(t,n)[r]:n.ownerDocument?n.ownerDocument.defaultView[i]:n[s]}function pse(n,e={down:0,up:0},t){let i,r;if(n.totalToScroll<=0)return!1;let s=n.isWindow?n.scrolled:n.height+n.scrolled;if(t)i=(n.totalToScroll-s)/n.totalToScroll,r=(e?.down?e.down:0)/10;else{let a=n.scrolled+(n.totalToScroll-s);i=n.scrolled/a,r=(e?.up?e.up:0)/10}return i<=r}function mse(n,e){return n<e.scrolled}function gse(n,e,t){let i=mse(n,e);return{fire:pse(e,t,i),scrollDown:i}}var Rx=class{constructor(e){this.lastScrollPosition=0,this.lastTotalToScroll=0,this.totalToScroll=0,this.triggered={down:0,up:0},Object.assign(this,e)}updateScrollPosition(e){return this.lastScrollPosition=e}updateTotalToScroll(e){this.lastTotalToScroll!==e&&(this.lastTotalToScroll=this.totalToScroll,this.totalToScroll=e)}updateScroll(e,t){this.updateScrollPosition(e),this.updateTotalToScroll(t)}updateTriggeredFlag(e,t){t?this.triggered.down=e:this.triggered.up=e}isTriggeredScroll(e,t){return t?this.triggered.down===e:this.triggered.up===e}};function yse(n){let{scrollContainer:e,scrollWindow:t,element:i,fromRoot:r}=n,s=ase({axis:new Px(!n.horizontal),windowElement:tse(e,t,i,r)}),o=new Rx({totalToScroll:dU(i,s).totalToScroll}),a={container:s.container,throttle:n.throttle},l={up:n.upDistance,down:n.downDistance};return vse(a).pipe(Ux(()=>yi(dU(i,s))),vt(c=>_se(o.lastScrollPosition,c,l)),Nu(({stats:c})=>o.updateScroll(c.scrolled,c.totalToScroll)),Zo(({fire:c,scrollDown:u,stats:{totalToScroll:d}})=>ose(n.alwaysCallback,c,o.isTriggeredScroll(d,u))),Nu(({scrollDown:c,stats:{totalToScroll:u}})=>{o.updateTriggeredFlag(u,c)}),vt(wse))}function vse(n){let e=qx(n.container,"scroll");return n.throttle&&(e=e.pipe(jx(n.throttle,void 0,{leading:!0,trailing:!0}))),e}function _se(n,e,t){let{scrollDown:i,fire:r}=gse(n,e,t);return{scrollDown:i,fire:r,stats:e}}var Mx={DOWN:"[NGX_ISE] DOWN",UP:"[NGX_ISE] UP"};function wse(n){let{scrollDown:e,stats:{scrolled:t}}=n;return{type:e?Mx.DOWN:Mx.UP,payload:{currentScrollPosition:t}}}var Ly=(()=>{let e=class e{constructor(i,r){this.element=i,this.zone=r,this.scrolled=new Lu,this.scrolledUp=new Lu,this.infiniteScrollDistance=2,this.infiniteScrollUpDistance=1.5,this.infiniteScrollThrottle=150,this.infiniteScrollDisabled=!1,this.infiniteScrollContainer=null,this.scrollWindow=!0,this.immediateCheck=!1,this.horizontal=!1,this.alwaysCallback=!1,this.fromRoot=!1}ngAfterViewInit(){this.infiniteScrollDisabled||this.setup()}ngOnChanges({infiniteScrollContainer:i,infiniteScrollDisabled:r,infiniteScrollDistance:s}){let o=Dx(i),a=Dx(r),l=Dx(s),c=!a&&!this.infiniteScrollDisabled||a&&!r.currentValue||l;(o||a||l)&&(this.destroyScroller(),c&&this.setup())}ngOnDestroy(){this.destroyScroller()}setup(){ise()&&this.zone.runOutsideAngular(()=>{this.disposeScroller=yse({fromRoot:this.fromRoot,alwaysCallback:this.alwaysCallback,disable:this.infiniteScrollDisabled,downDistance:this.infiniteScrollDistance,element:this.element,horizontal:this.horizontal,scrollContainer:this.infiniteScrollContainer,scrollWindow:this.scrollWindow,throttle:this.infiniteScrollThrottle,upDistance:this.infiniteScrollUpDistance}).subscribe(i=>this.handleOnScroll(i))})}handleOnScroll({type:i,payload:r}){let s=i===Mx.DOWN?this.scrolled:this.scrolledUp;Sse(s)&&this.zone.run(()=>s.emit(r))}destroyScroller(){this.disposeScroller&&this.disposeScroller.unsubscribe()}};e.\u0275fac=function(r){return new(r||e)(Fu(Jx),Fu(Vn))},e.\u0275dir=Kx({type:e,selectors:[["","infiniteScroll",""],["","infinite-scroll",""],["","data-infinite-scroll",""]],inputs:{infiniteScrollDistance:"infiniteScrollDistance",infiniteScrollUpDistance:"infiniteScrollUpDistance",infiniteScrollThrottle:"infiniteScrollThrottle",infiniteScrollDisabled:"infiniteScrollDisabled",infiniteScrollContainer:"infiniteScrollContainer",scrollWindow:"scrollWindow",immediateCheck:"immediateCheck",horizontal:"horizontal",alwaysCallback:"alwaysCallback",fromRoot:"fromRoot"},outputs:{scrolled:"scrolled",scrolledUp:"scrolledUp"},standalone:!0,features:[Xx]});let n=e;return n})();function Sse(n){return n.observed??n.observers.length>0}var bse=(n,e)=>e._id,Ese=()=>[import("./chunk-JEW6KWKY.mjs").then(n=>n.CommentsComponent)],Cse=(n,e)=>({"bg-blue-100":n,"bg-gray-50":e});function Tse(n,e){n&1&&(p(0,"div",31),vi(),p(1,"svg",32),L(2,"path",33),m(),Jr(),p(3,"p",34)(4,"span",35),D(5,"Click to upload"),m(),D(6," or drag and drop"),m(),p(7,"p",36),D(8,"SVG, PNG or JPG"),m()())}function xse(n,e){if(n&1&&(p(0,"div",37),L(1,"img",38),m()),n&2){let t=O();v(),k("src",t.previewUrl,pe)}}function Ise(n,e){if(n&1){let t=ze();p(0,"button",39),oe("click",function(){Re(t);let r=O();return Me(r.removeFile())}),D(1," remove image "),m()}}function kse(n,e){if(n&1&&(p(0,"p",25),D(1),m()),n&2){let t=O();v(),J(t.msgError)}}function Ase(n,e){n&1&&(p(0,"div",26),L(1,"div",40),m())}function Dse(n,e){if(n&1&&(p(0,"div",48),L(1,"img",51),m()),n&2){let t=O().$implicit;v(),k("src",t.image,pe)("alt",t.body)}}function Pse(n,e){if(n&1&&L(0,"app-comments",52),n&2){let t=O().$implicit;k("postId",t._id)}}function Rse(n,e){if(n&1&&(p(0,"div",29)(1,"div",41)(2,"div",42),L(3,"img",43),p(4,"div",44)(5,"h2",45),D(6),m(),p(7,"p",46),D(8),me(9,"date"),m()()()(),p(10,"div",47),D(11),m(),q(12,Dse,2,2,"div",48),p(13,"div",49)(14,"div",42)(15,"button",50,0),D(17," show comments "),m()()(),q(18,Pse,1,1),If(19,18,Ese),kf(15),m()),n&2){let t=e.$implicit;v(3),k("src",t.user.photo,pe),v(3),J(t.user.name),v(2),J(ke(9,5,t.createdAt)),v(3),ve(" ",t.body," "),v(),je(12,t.image?12:-1)}}var mU=(()=>{let e=class e{constructor(){this._PostsService=H(Yo),this.postsList=_i([]),this.isLoading=!0,this.lastPage=28,this.isFileOver=!1,this.currentPage=_i(1)}ngOnInit(){this._PostsService.getLimitedPosts().subscribe({next:i=>{this.currentPage.set(i.paginationInfo.numberOfPages),this._PostsService.getLimitedPosts(this.currentPage()).subscribe({next:r=>{this.postsList.set(r.posts.reverse()),this.isLoading=!1,this.currentPage.set(r.paginationInfo.numberOfPages-1)},error:r=>{console.error("Error fetching posts:",r)}})},error:i=>{console.error("Error fetching posts:",i)}})}onScroll(){this.currentPage()>1&&(this._PostsService.getLimitedPosts(this.currentPage()).subscribe({next:i=>{this.postsList.set(this.postsList().concat(i.posts.reverse()))},error:i=>{console.error("Error fetching posts:",i)}}),this.currentPage.update(i=>i-1))}getImage(i){let r=i.target;r.files&&r.files.length>0&&(this.savedFile=r.files[0],this.previewFile(this.savedFile))}onDragOver(i){i.preventDefault(),this.isFileOver=!0}onDragLeave(i){i.preventDefault(),this.isFileOver=!1}onDrop(i){i.preventDefault(),this.isFileOver=!1,i.dataTransfer&&i.dataTransfer.files.length>0&&(this.savedFile=i.dataTransfer.files[0],this.previewFile(this.savedFile))}previewFile(i){let r=new FileReader;r.onload=s=>{this.previewUrl=s.target?.result},r.readAsDataURL(i)}removeFile(){this.savedFile=null,this.previewUrl=null;let i=document.getElementById("dropzone-file");i&&(i.value="")}closeModal(){let i=document.getElementById("authentication-modal");i&&(i.classList.add("hidden"),i.classList.remove("flex"))}showModal(){let i=document.getElementById("authentication-modal");i&&(i.classList.remove("hidden"),i.classList.add("flex"))}createPost(){let i=new FormData;if(!this.content||this.content.trim()===""){this.msgError="Post content is required";return}if(this.savedFile){if(!["image/png","image/jpeg","image/svg"].includes(this.savedFile.type)){this.msgError="Invalid file type. Only PNG and JPEG are allowed.";return}if(this.savedFile.size>4194304){this.msgError="File size exceeds the 4MB limit";return}}else{this.msgError="Image is required";return}i.append("body",this.content),i.append("image",this.savedFile),this._PostsService.createPost(i).subscribe({next:r=>{r.message=="success"&&(this.ngOnInit(),this.removeFile(),this.content="",this.closeModal())},error:r=>{this.msgError="try smaller image",console.error("Error creating post:",r)}})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-timeline"]],standalone:!0,features:[he],decls:38,vars:11,consts:[["showComment",""],[1,"lg:w-1/2","mx-auto","mb-20"],[1,"bg-slate-200","p-3","rounded-md"],["readonly","","placeholder","what's on your shoulder?","type","text",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"click"],["id","authentication-modal","tabindex","-1",1,"hidden","overflow-y-auto","overflow-x-hidden","fixed","top-0","right-0","left-0","z-50","justify-center","items-center","w-full","md:inset-0","h-[calc(100%-1rem)]","max-h-full"],[1,"relative","p-4","w-1/2","max-h-full"],[1,"relative","bg-white","rounded-lg","shadow","dark:bg-gray-700"],[1,"flex","items-center","justify-between","p-4","md:p-5","border-b","rounded-t","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["type","button",1,"end-2.5","text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ms-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"sr-only"],[1,"p-4","md:p-5"],[1,"space-y-4"],["for","body",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["name","body","id","body","placeholder","",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-blue-500","focus:border-blue-500","block","w-full","p-2.5","dark:bg-gray-600","dark:border-gray-500","dark:placeholder-gray-400","dark:text-white",3,"ngModelChange","ngModel"],[1,"flex","items-center","justify-center","w-full"],["for","dropzone-file",1,"flex","flex-col","items-center","justify-center","w-full","h-64","border-2","border-gray-300","border-dashed","rounded-lg","cursor-pointer","bg-gray-50","dark:hover:bg-gray-800","dark:bg-gray-700","hover:bg-gray-100","dark:border-gray-600","dark:hover:border-gray-500",3,"dragover","dragleave","drop","ngClass"],["class","flex flex-col items-center justify-center pt-5 pb-6",4,"ngIf"],["class","mt-4",4,"ngIf"],["id","dropzone-file","type","file",1,"hidden",3,"change"],[1,"flex","justify-around","items-center","gap-5"],["class"," text-white bg-red-300 hover:bg-red-500 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-2 py-2.5 text-center",3,"click",4,"ngIf"],["type","submit",1,"text-white","bg-blue-700","hover:bg-blue-800","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","px-2","py-2.5","text-center","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"click"],[1,"error","text-center","text-red-600"],[1,"flex","justify-center","items-center"],[1,"container","px-4","py-6","flex","justify-center","items-center"],[1,"lg:w-1/2","w-full"],[1,"bg-white","shadow-md","rounded-lg","mb-6","p-4"],["infiniteScroll","",1,"search-results",3,"scrolled","infiniteScrollDistance"],[1,"flex","flex-col","items-center","justify-center","pt-5","pb-6"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 20 16",1,"w-8","h-8","mb-4","text-gray-500","dark:text-gray-400"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"],[1,"mb-2","text-sm","text-gray-500","dark:text-gray-400"],[1,"font-semibold"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"mt-4"],["alt","File Preview",1,"w-64","h-auto","border","border-gray-300","rounded-lg",3,"src"],[1,"text-white","bg-red-300","hover:bg-red-500","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","px-2","py-2.5","text-center",3,"click"],[1,"loader"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center"],["alt","User Avatar",1,"w-12","h-12","rounded-full",3,"src"],[1,"ml-3"],[1,"font-semibold","text-lg"],[1,"text-sm","text-gray-600"],[1,"text-gray-800","mb-4","break-words"],[1,"mb-4"],[1,"flex","items-center","justify-between","text-gray-500","text-sm","mb-4"],[1,"focus:outline-none","flex","items-center"],[1,"rounded-lg","w-full",3,"src","alt"],[3,"postId"]],template:function(r,s){r&1&&(p(0,"div",1)(1,"div",2)(2,"input",3),oe("click",function(){return s.showModal()}),m()(),p(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"h3",8),D(8," Add New post "),m(),p(9,"button",9),oe("click",function(){return s.closeModal()}),vi(),p(10,"svg",10),L(11,"path",11),m(),Jr(),p(12,"span",12),D(13,"Close modal"),m()()(),p(14,"div",13)(15,"div",14)(16,"div")(17,"label",15),D(18,"content "),m(),p(19,"textarea",16),Ci("ngModelChange",function(a){return Ei(s.content,a)||(s.content=a),a}),m()(),p(20,"div")(21,"div",17)(22,"label",18),oe("dragover",function(a){return s.onDragOver(a)})("dragleave",function(a){return s.onDragLeave(a)})("drop",function(a){return s.onDrop(a)}),q(23,Tse,9,0,"div",19)(24,xse,2,1,"div",20),p(25,"input",21),oe("change",function(a){return s.getImage(a)}),m()()()(),p(26,"div",22),q(27,Ise,2,0,"button",23),p(28,"button",24),oe("click",function(){return s.createPost()}),D(29,"Add post"),m()(),q(30,kse,2,1,"p",25),m()()()()()(),q(31,Ase,2,0,"div",26),p(32,"div",27)(33,"div",28),vn(34,Rse,21,7,"div",29,bse),p(36,"div",30),oe("scrolled",function(){return s.onScroll()}),m()(),L(37,"app-arrowtop"),m()),r&2&&(v(19),bi("ngModel",s.content),v(3),k("ngClass",qe(8,Cse,s.isFileOver,!s.isFileOver)),v(),k("ngIf",!s.previewUrl),v(),k("ngIf",s.previewUrl),v(3),k("ngIf",s.previewUrl),v(3),je(30,s.msgError?30:-1),v(),je(31,s.isLoading?31:-1),v(3),_n(s.postsList()),v(2),k("infiniteScrollDistance",1))},dependencies:[Nt,De,Ko,Ly,Wn,Hn,En,Ii,Is],styles:['.loader[_ngcontent-%COMP%]{width:50px;aspect-ratio:1;display:grid}.loader[_ngcontent-%COMP%]:before, .loader[_ngcontent-%COMP%]:after{content:"";grid-area:1/1;border-radius:50%;background:#f03355;-webkit-mask:repeating-linear-gradient(#000 0 5px,#0000 0 10px);animation:_ngcontent-%COMP%_l35 1.5s infinite}.loader[_ngcontent-%COMP%]:after{-webkit-mask:repeating-linear-gradient(#0000 0 5px,#000 0 10px);--s:-1}@keyframes _ngcontent-%COMP%_l35{0%,10%{transform:translate(0) rotate(0)}35%{transform:translate(calc(var(--s,1)*50%)) rotate(0)}66%{transform:translate(calc(var(--s,1)*50%)) rotate(calc(var(--s,1)*180deg))}90%,to{transform:translate(0) rotate(calc(var(--s,1)*180deg))}}']});let n=e;return n})();var gU=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-mdb-layout"]],standalone:!0,features:[he],decls:1,vars:0,template:function(r,s){r&1&&L(0,"router-outlet")},dependencies:[mr]});let n=e;return n})();var yU=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-linked-layout"]],standalone:!0,features:[he],decls:1,vars:0,template:function(r,s){r&1&&L(0,"router-outlet")},dependencies:[mr]});let n=e;return n})();var vU=(()=>{let e=class e{constructor(){this.baseUrl="https://image.tmdb.org/t/p/w300/"}transform(i){if(!i)return"";let r=i.split(",");return this.baseUrl+(r[1]||"")}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=cn({name:"extractImageUrl",type:e,pure:!0,standalone:!0});let n=e;return n})();var _U=(()=>{let e=class e{transform(i){return i&&i.split(",").slice(2).join(",")||""}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=cn({name:"extractPostBody",type:e,pure:!0,standalone:!0});let n=e;return n})();var Mse=(n,e)=>e._id,Ose=()=>[import("./chunk-JEW6KWKY.mjs").then(n=>n.CommentsComponent)];function Nse(n,e){n&1&&(p(0,"div",1),L(1,"div",6),m())}function Lse(n,e){if(n&1&&L(0,"app-comments",18),n&2){let t=O().$implicit;k("postId",t._id)}}function Fse(n,e){if(n&1&&(p(0,"div",4)(1,"div",7)(2,"div",8),L(3,"img",9),p(4,"div",10)(5,"h2",11),D(6),m(),p(7,"p",12),D(8),me(9,"date"),m()()()(),p(10,"div",13),D(11),me(12,"extractPostBody"),m(),p(13,"div",14),L(14,"img",15),me(15,"extractImageUrl"),m(),p(16,"div",16)(17,"div",8)(18,"button",17,0),D(20," show comments "),m()()(),q(21,Lse,1,1),If(22,21,Ose),kf(18),m()),n&2){let t=e.$implicit;v(3),k("src",t.user.photo,pe),v(3),J(t.user.name),v(2),J(ke(9,5,t.createdAt)),v(3),ve(" ",ke(12,7,t.body)," "),v(3),k("src",ke(15,9,t.body),pe)}}var wU=(()=>{let e=class e{constructor(){this._PostsService=H(Yo),this.postsList=_i([]),this.isLoading=!0,this.lastPage=28,this.isFileOver=!1,this.currentPage=_i(1)}ngOnInit(){this._PostsService.getLimitedPosts().subscribe({next:i=>{this.currentPage.set(i.paginationInfo.numberOfPages),this._PostsService.getLimitedPosts(this.currentPage()).subscribe({next:r=>{let s=r.posts.filter(o=>o.body&&typeof o.body=="string"&&o.body.startsWith("ms,"));s.length>0?this.postsList.set(s.reverse()):(this.postsList.set([]),console.log("No posts found")),this.isLoading=!1,this.currentPage.set(r.paginationInfo.numberOfPages-1)},error:r=>{console.error("Error fetching posts:",r)}})},error:i=>{console.error("Error fetching posts:",i)}})}onScroll(){this.currentPage()>1&&(this._PostsService.getLimitedPosts(this.currentPage()).subscribe({next:i=>{let r=i.posts.filter(s=>s.body&&typeof s.body=="string"&&s.body.startsWith("ms,"));if(r.length>0)this.postsList.set(this.postsList().concat(r.reverse()));else return},error:i=>{console.error("Error fetching posts:",i)}}),this.currentPage.update(i=>i-1))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-movies-timeline"]],standalone:!0,features:[he],decls:7,vars:2,consts:[["showComment",""],[1,"flex","justify-center","items-center"],[1,"container","py-6","flex","justify-center","items-center"],[1,"lg:w-96","w-full"],[1,"bg-white","shadow-md","rounded-lg","mb-6","p-4"],["infiniteScroll","",1,"search-results",3,"scrolled","infiniteScrollDistance"],[1,"loader"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center"],["alt","User Avatar",1,"w-12","h-12","rounded-full",3,"src"],[1,"ml-3"],[1,"font-semibold","text-lg"],[1,"text-sm","text-gray-600"],[1,"text-gray-800","mb-4","break-words"],[1,"mb-4"],["alt","Post-Image",1,"rounded-lg","w-full",3,"src"],[1,"flex","items-center","justify-between","text-gray-500","text-sm","mb-4"],[1,"focus:outline-none","flex","items-center"],[3,"postId"]],template:function(r,s){r&1&&(q(0,Nse,2,0,"div",1),p(1,"div",2)(2,"div",3),vn(3,Fse,24,11,"div",4,Mse),p(5,"div",5),oe("scrolled",function(){return s.onScroll()}),m()(),L(6,"app-arrowtop"),m()),r&2&&(je(0,s.isLoading?0:-1),v(3),_n(s.postsList()),v(2),k("infiniteScrollDistance",1))},dependencies:[vU,_U,Nt,Ko,Ly,Wn],styles:['.loader[_ngcontent-%COMP%]{width:50px;aspect-ratio:1;display:grid}.loader[_ngcontent-%COMP%]:before, .loader[_ngcontent-%COMP%]:after{content:"";grid-area:1/1;border-radius:50%;background:#f03355;-webkit-mask:repeating-linear-gradient(#000 0 5px,#0000 0 10px);animation:_ngcontent-%COMP%_l35 1.5s infinite}.loader[_ngcontent-%COMP%]:after{-webkit-mask:repeating-linear-gradient(#0000 0 5px,#000 0 10px);--s:-1}@keyframes _ngcontent-%COMP%_l35{0%,10%{transform:translate(0) rotate(0)}35%{transform:translate(calc(var(--s,1)*50%)) rotate(0)}66%{transform:translate(calc(var(--s,1)*50%)) rotate(calc(var(--s,1)*180deg))}90%,to{transform:translate(0) rotate(calc(var(--s,1)*180deg))}}']});let n=e;return n})();function Bse(n,e){if(n&1){let t=ze();p(0,"button",6),oe("click",function(){Re(t);let r=O();return Me(r.clearSearchTerm())}),vi(),p(1,"svg",7),L(2,"path",8),m()()}}function Use(n,e){if(n&1&&(p(0,"div",9),D(1),m()),n&2){let t=O();v(),ve(' No results found for "',t.searchTerm,'". ')}}function qse(n,e){if(n&1&&(wi(0),p(1,"div",20),vi(),p(2,"svg",21),L(3,"path",22),m(),Jr(),p(4,"p"),D(5),m()(),Si()),n&2){let t=O().$implicit;v(5),ve("",t.vote_average," / 10")}}function zse(n,e){if(n&1&&(wi(0),p(1,"div",23)(2,"p"),D(3),m()(),Si()),n&2){let t=O().$implicit;v(3),J(t.media_type)}}function Vse(n,e){if(n&1&&(p(0,"li",14),L(1,"img",15),p(2,"div",16)(3,"h3",17),D(4),m(),p(5,"div",18),q(6,qse,6,1,"ng-container",19)(7,zse,4,1,"ng-container",19),m()()()),n&2){let t=e.$implicit;v(),ii("alt",t.name||t.title),k("src","https://image.tmdb.org/t/p/w500"+(t.poster_path?t.poster_path:t.profile_path),pe),v(3),J(t.name||t.title),v(2),k("ngIf",t.vote_average),v(),k("ngIf",t.media_type)}}function $se(n,e){if(n&1&&(p(0,"div",10)(1,"div",11)(2,"ul",12),q(3,Vse,8,5,"li",13),m()()()),n&2){let t=O();v(3),k("ngForOf",t.searchResults)}}var SU=(()=>{let e=class e{constructor(){this._SearchService=H(Oy),this.searchResults=[]}searchItem(i){this._SearchService.getSearchResults(i,1).subscribe({next:r=>{r.results.length,this.searchResults=r.results}})}clearSearchTerm(){this.searchTerm="",this.searchItem("")}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-search-results"]],standalone:!0,features:[he],decls:6,vars:4,consts:[[1,"flex","flex-col","items-center","justify-center","min-h-screen","bg-gray-100","p-4"],[1,"relative","mb-6"],["type","text","placeholder","Search for movies or TV shows...",1,"w-full","max-w-md","py-2","px-4","rounded-full","text-gray-700","outline-none","text-lg","border","border-gray-300","shadow-lg","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","input","ngModel"],["class","absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-800",3,"click",4,"ngIf"],["class","text-red-500 text-lg text-center",4,"ngIf"],["class","w-full max-w-4xl mt-8",4,"ngIf"],[1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","text-gray-500","hover:text-gray-800",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"text-red-500","text-lg","text-center"],[1,"w-full","max-w-4xl","mt-8"],[1,"bg-white","p-4","rounded-lg","shadow-lg"],[1,"space-y-4"],["class","flex items-start space-x-4 border-b border-gray-200 pb-4",4,"ngFor","ngForOf"],[1,"flex","items-start","space-x-4","border-b","border-gray-200","pb-4"],[1,"w-16","h-24","object-cover","rounded-md",3,"src","alt"],[1,"flex-1"],[1,"text-xl","font-semibold","mb-1"],[1,"flex","items-center","space-x-4"],[4,"ngIf"],[1,"flex","items-center","bg-yellow-100","text-yellow-700","text-sm","font-semibold","px-3","py-1","rounded-lg","shadow"],["fill","currentColor","viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg",1,"w-5","h-5","mr-1","text-yellow-500"],["d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.14 3.49a1 1 0 00.95.69h3.672c.969 0 1.371 1.24.588 1.81l-2.972 2.16a1 1 0 00-.364 1.118l1.14 3.49c.3.921-.755 1.688-1.54 1.118L10 13.011l-2.975 2.16c-.784.57-1.838-.197-1.538-1.118l1.14-3.49a1 1 0 00-.364-1.118L3.291 8.927c-.783-.57-.38-1.81.588-1.81h3.672a1 1 0 00.95-.69l1.14-3.49z"],[1,"bg-blue-100","text-blue-700","text-sm","font-semibold","capitalize","px-3","py-1","rounded-lg","shadow"]],template:function(r,s){r&1&&(p(0,"div",0)(1,"div",1)(2,"input",2),Ci("ngModelChange",function(a){return Ei(s.searchTerm,a)||(s.searchTerm=a),a}),oe("input",function(){return s.searchItem(s.searchTerm)}),m(),q(3,Bse,3,0,"button",3),m(),q(4,Use,2,1,"div",4)(5,$se,4,1,"div",5),m()),r&2&&(v(2),bi("ngModel",s.searchTerm),v(),k("ngIf",s.searchTerm),v(),k("ngIf",s.searchResults.length===0&&s.searchTerm),v(),k("ngIf",s.searchResults.length>0))},dependencies:[De,bt,Wn,Hn,En,Ii]});let n=e;return n})();var bU=(()=>{let e=class e{transform(i){if(typeof i!="number"||isNaN(i))return 0;if(i<60)return i+"m ";if(i>60){let r=Math.floor(i/60),s=i%60;return r+"h "+s+"m "}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=cn({name:"toHour",type:e,pure:!0,standalone:!0});let n=e;return n})();var jse=(n,e)=>e.id,Gse=n=>["/m/person",n];function Hse(n,e){if(n&1&&L(0,"img",8),n&2){let t=O().$implicit,i=O();k("src",i.mainImageUrl+t.profile_path,pe)("alt",t.name)}}function Wse(n,e){if(n&1&&L(0,"img",9),n&2){let t=O().$implicit;k("alt",t.name)}}function Kse(n,e){if(n&1&&(p(0,"swiper-slide",2)(1,"div",3)(2,"div",4),q(3,Hse,1,2,"img",5)(4,Wse,1,1,"ng-template",null,0,yl),m(),p(6,"p",6),D(7),m(),p(8,"p",7),D(9),m()()()),n&2){let t=e.$implicit,i=gl(5);v(2),k("routerLink",Kt(5,Gse,t.id)),v(),k("ngIf",t.profile_path)("ngIfElse",i),v(4),ve(" ",t.name," "),v(2),ve(" ",t.character," ")}}var EU=(()=>{let e=class e{constructor(){this.mainImageUrl="https://image.tmdb.org/t/p/w500"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-cast-slider"]],inputs:{showCredits:"showCredits",slidesNum:"slidesNum"},standalone:!0,features:[he],decls:4,vars:8,consts:[["backUp",""],[1,"",3,"slidesPerView","spaceBetween","scrollbar","loop"],[1,"w-40","min-w-40","rounded-lg","transition-transform","duration-500","group"],[1,"mb-10","p-1","credit-item","bg-slate-100","rounded-md","shadow-md","overflow-hidden"],[1,"crp","relative","w-full","h-48",3,"routerLink"],["class","w-full h-full object-cover rounded-lg transform transition-transform duration-500 group-hover:scale-105 group-hover:translate-y-1",3,"src","alt",4,"ngIf","ngIfElse"],[1,"text-sm","md:text-base","mt-2","font-medium","text-black","hover:text-blue-600","transition-colors","duration-200"],[1,"text-sm","text-gray-600"],[1,"w-full","h-full","object-cover","rounded-lg","transform","transition-transform","duration-500","group-hover:scale-105","group-hover:translate-y-1",3,"src","alt"],["src","../../../assets/images/lost_in_Giza.jpeg",1,"w-full","h-full","object-cover","rounded-lg","transform","transition-transform","duration-500","group-hover:scale-105","group-hover:translate-y-1",3,"alt"]],template:function(r,s){r&1&&(p(0,"swiper-container",1),vn(1,Kse,10,7,"swiper-slide",2,jse),me(3,"slice"),m()),r&2&&(k("slidesPerView",s.slidesNum)("spaceBetween",10)("scrollbar",!0)("loop",!0),v(),_n(cI(3,4,s.showCredits.cast,0,9)))},dependencies:[Ye,pI,De]});let n=e;return n})();var CU=(()=>{let e=class e{transform(i,r="USD"){if(i==null)return"";let s;i>=1e9?s=(i/1e9).toFixed(2)+"B":i>=1e6?s=(i/1e6).toFixed(2)+"M":i>=1e3?s=(i/1e3).toFixed(2)+"K":s=i.toFixed(2);let o="";switch(r){case"USD":o="$";break;case"EUR":o="\u20AC";break;case"EGP":o="\xA3";break;default:o=r}return o+s}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=cn({name:"formatAmount",type:e,pure:!0,standalone:!0});let n=e;return n})();var Yse=["imageCanvas"],TU=(n,e)=>e.id,Qse=n=>({"background-image":n,"background-size":"cover","background-position":"center","background-repeat":"no-repeat"}),Xse=(n,e)=>["/m/Theater",n,e],Jse=(n,e)=>({"text-red-600":n,"text-white":e}),Zse=(n,e)=>({"text-green-500":n,"text-white":e}),eoe=n=>["/m/person",n],toe=(n,e)=>["/m/show-details",n,e,"cast&crew"],noe=n=>({"background-color":n}),ioe=n=>["/m/network",n],roe=(n,e)=>["/m/keyword",n,e],soe=(n,e,t)=>["/m/show-details",n,e,"collection",t];function ooe(n,e){if(n&1&&L(0,"img",43),n&2){let t=O(2);ii("alt",t.showDetails.title||t.showDetails.name),k("src",t.mainImageUrl+t.showDetails.poster_path,pe)}}function aoe(n,e){if(n&1&&L(0,"img",44),n&2){let t=O(2);ii("alt",t.showDetails.title||t.showDetails.name)}}function loe(n,e){n&1&&(wi(0),D(1,","),Si())}function coe(n,e){if(n&1&&(p(0,"div")(1,"span",45),D(2),m(),q(3,loe,2,0,"ng-container",38),m()),n&2){let t=e.$implicit,i=e.index,r=O(2);v(2),ve(" ",t.name," "),v(),k("ngIf",i!==r.showDetails.genres.length-1)}}function uoe(n,e){if(n&1&&(p(0,"div"),D(1),me(2,"toHour"),m()),n&2){let t=O(2);v(),J(ke(2,1,t.showDetails.runtime))}}function doe(n,e){n&1&&(p(0,"span",46),D(1," No trailers found. "),m())}function hoe(n,e){if(n&1&&(p(0,"div",31),D(1),m()),n&2){let t=O(2);v(),J(t.showDetails.tagline)}}function foe(n,e){if(n&1&&(p(0,"div",47)(1,"a",48)(2,"span",49),D(3),m()(),p(4,"span"),D(5,"creator"),m()()),n&2){let t=e.$implicit;v(),k("routerLink",Kt(2,eoe,t.id)),v(2),J(t.name)}}function poe(n,e){if(n&1&&(p(0,"div",34),vn(1,foe,6,4,"div",47,TU),m()),n&2){let t=O(2);v(),_n(t.showDetails.created_by)}}function moe(n,e){n&1&&(p(0,"h2"),D(1,"Series Cast"),m())}function goe(n,e){n&1&&(p(0,"h2"),D(1,"Top Billed Cast"),m())}function yoe(n,e){if(n&1&&(p(0,"section",50),q(1,moe,2,0,"h2",38)(2,goe,2,0,"h2",38),L(3,"app-cast-slider",51),p(4,"span",52),D(5,"full cast and crew"),m()()),n&2){let t=O(2);v(),k("ngIf",t.showType=="tv"),v(),k("ngIf",t.showType=="movie"),v(),k("slidesNum",6)("showCredits",t.showCredits),v(),k("routerLink",qe(5,toe,t.showType,t.showDetails.id))}}function voe(n,e){n&1&&(p(0,"h2",66),D(1,"Current Season"),m())}function _oe(n,e){n&1&&(p(0,"h2",66),D(1,"last Season"),m())}function woe(n,e){if(n&1&&(wi(0),p(1,"span",67),D(2,"Upcoming "),p(3,"span",68),D(4),m()(),p(5,"span"),D(6),me(7,"date"),m(),Si()),n&2){let t=O(3);v(4),ve("Episode: ",t.showDetails.next_episode_to_air.episode_number,""),v(2),ve("date: ",lt(7,2,t.showDetails.next_episode_to_air.air_date,"dd/MM/yyyy"),"")}}function Soe(n,e){if(n&1&&(p(0,"section",50),q(1,voe,2,0,"h2",53)(2,_oe,2,0,"h2",53),p(3,"div",54)(4,"div",55),L(5,"img",56),m(),p(6,"div",57)(7,"h2",58),D(8),m(),p(9,"div",59)(10,"span",60),L(11,"i",61),D(12),me(13,"percentage"),m(),p(14,"span"),D(15),me(16,"date"),m(),p(17,"span",62),L(18,"i",63),m(),p(19,"span"),D(20),m()(),p(21,"div",64)(22,"p",65),D(23),m()(),p(24,"div"),q(25,woe,8,5,"ng-container",38),m()()()()),n&2){let t=O(2);v(),k("ngIf",t.showDetails.status=="Returning Series"),v(),k("ngIf",t.showDetails.status=="Ended"),v(3),k("src",t.mainImageUrl+t.showDetails.seasons[t.showDetails.seasons.length-1].poster_path,pe)("alt",t.showDetails.seasons[t.showDetails.seasons.length-1].name),v(3),J(t.showDetails.seasons[t.showDetails.seasons.length-1].name),v(4),ve("",ke(13,10,t.showDetails.seasons[t.showDetails.seasons.length-1].vote_average),"%"),v(3),J(lt(16,12,t.showDetails.seasons[t.showDetails.seasons.length-1].air_date,"yyyy")),v(5),ve("",t.showDetails.seasons[t.showDetails.seasons.length-1].episode_count," Episodes"),v(3),J(t.showDetails.seasons[t.showDetails.seasons.length-1].overview),v(2),k("ngIf",t.showDetails.next_episode_to_air==null?null:t.showDetails.next_episode_to_air.episode_number)}}function boe(n,e){if(n&1&&(p(0,"span"),D(1),m()),n&2){let t=O(3);v(),ve("(",t.showReviews.total_results,")")}}function Eoe(n,e){if(n&1&&L(0,"img",83),n&2){let t=O(4);k("src",t.mainImageUrl+t.review.author_details.avatar_path,pe)("alt",t.review.author_details.username)}}function Coe(n,e){if(n&1&&(p(0,"span",84)(1,"span"),D(2),m()()),n&2){let t=O(4);k("ngStyle",Kt(2,noe,t.getColorForUsername(t.review.author_details.username))),v(2),J(t.review.author_details.username.charAt(0).toUpperCase())}}function Toe(n,e){if(n&1&&(p(0,"span",85),L(1,"i",61),D(2),me(3,"percentage"),m()),n&2){let t=O(4);v(2),ve("",ke(3,1,t.review.author_details.rating),"% ")}}function xoe(n,e){if(n&1){let t=ze();p(0,"span",86),oe("click",function(){Re(t);let r=O(4);return Me(r.toggleContent())}),D(1),m()}if(n&2){let t=O(4);v(),ve(" ",t.showFullContent?"Read Less":"Read More"," ")}}function Ioe(n,e){if(n&1&&(p(0,"div",77)(1,"div",78)(2,"div"),q(3,Eoe,1,2,"img",79)(4,Coe,3,4,"span",80),m(),p(5,"div"),D(6),p(7,"div"),q(8,Toe,4,3,"span",81),D(9),me(10,"date"),m()()(),p(11,"div"),D(12),q(13,xoe,2,1,"span",82),m()()),n&2){let t=O(3);v(3),k("ngIf",t.review.author_details.avatar_path),v(),k("ngIf",!t.review.author_details.avatar_path),v(2),aI(" A review by ",t.review.author_details.username," (",t.currentStep+1,"/",t.showReviews.total_results,") "),v(2),k("ngIf",t.review.author_details.rating),v(),Bu(" Written by ",t.review.author_details.username," on ",lt(10,10,t.review.created_at,"MMMM d, y")," "),v(3),ve(" ",t.showFullContent?t.review.content:t.getTruncatedContent(t.review.content)," "),v(),k("ngIf",t.isContentLong(t.review.content))}}function koe(n,e){if(n&1&&(p(0,"p"),D(1),p(2,"span",87),D(3,"write one?"),m()()),n&2){let t=O(3);v(),ve("We don't have any reviews for ",t.showDetails.name||t.showDetails.title,". Would you like to ")}}function Aoe(n,e){if(n&1){let t=ze();p(0,"section")(1,"div",69)(2,"h2",70),D(3,"Social"),m(),p(4,"div",71)(5,"h2",72)(6,"span",66),D(7,"Reviews"),m(),q(8,boe,2,1,"span",38),m(),p(9,"div")(10,"button",73),oe("click",function(){Re(t);let r=O(2);return Me(r.prevReview())}),L(11,"i",74),D(12," prev"),m(),p(13,"button",73),oe("click",function(){Re(t);let r=O(2);return Me(r.nextReview())}),D(14,"next "),L(15,"i",75),m()()()(),q(16,Ioe,14,13,"div",76)(17,koe,4,1,"ng-template",null,1,yl),m()}if(n&2){let t=gl(18),i=O(2);v(8),k("ngIf",i.showReviews),v(8),k("ngIf",i.review&&i.showReviews.results.length>0)("ngIfElse",t)}}function Doe(n,e){if(n&1&&(p(0,"section",88)(1,"h2",70),D(2,"Recommendations"),m(),p(3,"div",89),L(4,"app-movie-slider",90),m()()),n&2){let t=O(2);v(4),k("slidesNum",3)("shows",t.showRecommendations)}}function Poe(n,e){if(n&1&&(p(0,"section",88)(1,"h2",91),D(2,"Related"),m(),p(3,"div",89),L(4,"app-movie-slider",90),m()()),n&2){let t=O(2);v(4),k("slidesNum",3)("shows",t.showRelated)}}function Roe(n,e){if(n&1&&(wi(0),p(1,"div",92)(2,"a",93),L(3,"i",94),m(),p(4,"a",93),L(5,"i",95),m(),p(6,"a",93),L(7,"i",96),m(),p(8,"a",93),L(9,"i",97),m()(),Si()),n&2){let t=O(2);v(2),k("href","https://www.facebook.com/"+t.showExternalIDs.facebook_id,pe),v(2),k("href","https://x.com/"+t.showExternalIDs.twitter_id,pe),v(2),k("href","https://www.instagram.com/"+t.showExternalIDs.instagram_id,pe),v(2),k("href",t.showDetails.homepage,pe)}}function Moe(n,e){if(n&1&&L(0,"img",107),n&2){let t=O().$implicit,i=O(4);k("src",i.mainImageUrl+t.logo_path,pe)("alt",t.name)}}function Ooe(n,e){if(n&1&&(p(0,"div",105),q(1,Moe,1,2,"img",106),m()),n&2){let t=e.$implicit;k("routerLink",Kt(2,ioe,t.id)),v(),k("ngIf",t.logo_path)}}function Noe(n,e){if(n&1&&(p(0,"div",100)(1,"h3",101),D(2,"Networks"),m(),q(3,Ooe,2,4,"div",104),m()),n&2){let t=O(3);v(3),k("ngForOf",t.showDetails.networks)}}function Loe(n,e){if(n&1&&(p(0,"div",100)(1,"h3",101),D(2,"Type"),m(),p(3,"p",102),D(4),m()()),n&2){let t=O(3);v(4),J(t.showDetails.type)}}function Foe(n,e){if(n&1&&(p(0,"div",100)(1,"h3",101),D(2,"Budget"),m(),p(3,"p",102),D(4),me(5,"formatAmount"),m()()),n&2){let t=O(3);v(4),ve("",lt(5,1,t.showDetails.budget,"USD")," ")}}function Boe(n,e){if(n&1&&(p(0,"div",100)(1,"h3",101),D(2,"Revenue"),m(),p(3,"p",102),D(4),me(5,"formatAmount"),m()()),n&2){let t=O(3);v(4),J(lt(5,1,t.showDetails.revenue,"USD"))}}function Uoe(n,e){if(n&1&&(wi(0),p(1,"h2",98),D(2,"Facts"),m(),p(3,"div",99)(4,"div",100)(5,"h3",101),D(6,"Status"),m(),p(7,"p",102),D(8),m()(),q(9,Noe,4,1,"div",103)(10,Loe,5,1,"div",103),p(11,"div",100)(12,"h3",101),D(13,"Original Language"),m(),p(14,"p",102),D(15),m()(),wi(16),q(17,Foe,6,4,"div",103)(18,Boe,6,4,"div",103),Si(),m(),Si()),n&2){let t=O(2);v(8),J(t.showDetails.status),v(),k("ngIf",t.showDetails.networks==null?null:t.showDetails.networks.length),v(),k("ngIf",t.showDetails.type),v(5),J(t.showDetails.original_language),v(2),k("ngIf",t.showDetails.budget>0),v(),k("ngIf",t.showDetails.revenue>0)}}function qoe(n,e){if(n&1&&(wi(0),p(1,"a",48)(2,"span",110),D(3),m()(),Si()),n&2){let t=e.$implicit,i=O(3);v(),k("routerLink",qe(2,roe,t.id+"-"+t.name,i.showType)),v(2),ve(" ",t.name," ")}}function zoe(n,e){if(n&1&&(p(0,"div",108)(1,"h2",98),D(2,"Keywords"),m(),p(3,"div",109),vn(4,qoe,4,5,"ng-container",null,TU),m()()),n&2){let t=O(2);v(4),_n(t.showKeywords)}}function Voe(n,e){if(n&1&&(p(0,"div",115),L(1,"img",116),m()),n&2){let t=O(3);v(),k("src",t.mainImageUrl+t.showDetails.belongs_to_collection.poster_path,pe)("alt",t.showDetails.belongs_to_collection.name)}}function $oe(n,e){if(n&1&&(p(0,"div",115),L(1,"img",117),m()),n&2){let t=O(3);v(),k("alt",t.showDetails.belongs_to_collection.name)}}function joe(n,e){if(n&1&&(p(0,"div",108)(1,"h2",111),D(2,"collection"),m(),p(3,"div",112),q(4,Voe,2,2,"div",113)(5,$oe,2,1,"div",113),p(6,"h3",114),D(7),m()()()),n&2){let t=O(2);v(3),k("routerLink",lI(4,soe,t.showType,t.showDetails.id,t.showDetails.belongs_to_collection.id)),v(),k("ngIf",t.showDetails.belongs_to_collection.poster_path),v(),k("ngIf",!t.showDetails.belongs_to_collection.poster_path),v(2),J(t.showDetails.belongs_to_collection.name)}}function Goe(n,e){if(n&1){let t=ze();p(0,"app-show-modal",118),oe("close",function(){Re(t);let r=O(2);return Me(r.closeModal())}),m()}if(n&2){let t=O(2);k("youtubeUrl",t.selectedMovieUrl)("movie",t.selectedMovie)}}function Hoe(n,e){if(n&1){let t=ze();L(0,"section")(1,"canvas",2,0),p(3,"section",3)(4,"div",4)(5,"div",5),q(6,ooe,1,2,"img",6)(7,aoe,1,1,"img",7),p(8,"div",8),D(9," watch now "),m()(),p(10,"div",9)(11,"div",10)(12,"h1",11),D(13),p(14,"span",12),D(15),me(16,"date"),m()()(),p(17,"div",13)(18,"div")(19,"span"),D(20),m(),D(21),me(22,"date"),m(),p(23,"div",14),q(24,coe,4,2,"div",15),m(),q(25,uoe,3,3,"div"),m(),p(26,"div",16)(27,"div",17),L(28,"app-progress-circle",18),me(29,"percentage"),m(),p(30,"div",19)(31,"span"),D(32,"User"),m(),p(33,"span"),D(34,"Score"),m()()(),p(35,"div",20)(36,"span",21),oe("click",function(){Re(t);let r=O();return Me(r.addToFavorites())}),L(37,"i",22),m(),p(38,"span",23),oe("click",function(){Re(t);let r=O();return Me(r.addToWatchlist())}),L(39,"i",24),m(),p(40,"div",25),oe("click",function(){Re(t);let r=O();return Me(r.openModal(r.showDetails))}),p(41,"span"),L(42,"i",26),m(),p(43,"p",27),D(44,"Play trailer"),m(),q(45,doe,2,0,"span",28),m()(),p(46,"div",29)(47,"div",30),q(48,hoe,2,1,"div",31),p(49,"span",32),D(50,"Overview"),m(),p(51,"div",33),D(52),m()()(),q(53,poe,3,0,"div",34),m()()(),p(54,"div",35)(55,"div",36),q(56,yoe,6,8,"section",37)(57,Soe,26,15,"section",37)(58,Aoe,19,3,"section",38)(59,Doe,5,2,"section",39)(60,Poe,5,2,"section",39),m(),p(61,"div",40),q(62,Roe,10,4,"ng-container",38),p(63,"div"),q(64,Uoe,19,6,"ng-container",38),m(),q(65,zoe,6,0,"div",41)(66,joe,8,8,"div",41),m()(),q(67,Goe,1,2,"app-show-modal",42)}if(n&2){let t=O();v(3),k("ngStyle",Kt(37,Qse,t.imageUrl?"linear-gradient("+t.extractedColor+", rgba(0, 0, 0, 0.5)), url("+t.imageUrl+")":"none")),v(3),k("ngIf",t.showDetails.poster_path),v(),k("ngIf",!t.showDetails.poster_path),v(),k("routerLink",qe(39,Xse,t.showType,t.showID)),v(5),ve("",t.showDetails.title||t.showDetails.name," "),v(2),ve("(",lt(16,29,t.showDetails.release_date||t.showDetails.first_air_date,"yyyy"),")"),v(5),ve("(",t.showDetails.origin_country[0],")"),v(),ve(" ",lt(22,32,t.showDetails.release_date||t.showDetails.first_air_date,"mediumDate")," "),v(3),k("ngForOf",t.showDetails.genres),v(),je(25,t.showDetails.runtime?25:-1),v(3),k("progress",ke(29,35,t.showDetails.vote_average))("paddingValue",30)("fontSizeValue",20),v(8),k("ngClass",qe(42,Jse,t._FireStoreService.isInFavorites(),!t._FireStoreService.isInFavorites())),v(2),k("ngClass",qe(45,Zse,t._FireStoreService.isInWatchlist(),!t._FireStoreService.isInWatchlist())),v(7),k("ngIf",t.noTrailers),v(3),je(48,t.showDetails.tagline?48:-1),v(4),J(t.showDetails.overview),v(),je(53,t.showType=="tv"?53:-1),v(3),k("ngIf",t.showCredits),v(),k("ngIf",t.showDetails.seasons&&t.showDetails.seasons.length>1),v(),k("ngIf",t.showReviews),v(),k("ngIf",t.showRecommendations&&t.showRecommendations.length>0),v(),k("ngIf",t.showRelated&&t.showRelated.length>0),v(2),k("ngIf",t.showExternalIDs),v(2),k("ngIf",t.showDetails.first_air_date||t.showDetails.release_date),v(),k("ngIf",t.showKeywords&&t.showKeywords.length>0),v(),k("ngIf",t.showDetails.belongs_to_collection&&t.showDetails.belongs_to_collection!==null),v(),k("ngIf",t.selectedMovie)}}var xU=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this._ActivatedRoute=H(Lt),this._Router=H(Et),this._FireStoreService=H(Qo),this._AuthenticationService=H(si),this._PLATFORM_ID=H(bn),this._Title=H(jn),this.showKeywords=[],this.showRecommendations=[],this.showRelated=[],this.reviews=[],this.mainImageUrl="https://image.tmdb.org/t/p/w500",this.currentStep=0,this.token=localStorage.getItem("S&MToken"),this.extractedColor="rgba(150, 90, 40, 0.4)",this.selectedMovieUrl="",this.selectedMovie=null,this.letterColorMap={A:"#FF5733",B:"#33FF57",C:"#3357FF",D:"#F0FF33",E:"#FF33F6",F:"#33FFF5",G:"#F733FF",H:"#FF3353",I:"#33FFB5",J:"#B533FF",K:"#FFB533",L:"#33B5FF",M:"#B5FF33",N:"#FFB5B5",O:"#B5FF57",P:"#FF5733",Q:"#33FF57",R:"#3357FF",S:"#F0FF33",T:"#FF33F6",U:"#33FFF5",V:"#F733FF",W:"#FF3353",X:"#33FFB5",Y:"#B533FF",Z:"#FFB533"},this.showFullContent=!1,this.wordLimit=20}ngOnInit(){this.loadShowDetails()}loadShowDetails(){this._ActivatedRoute.params.subscribe({next:i=>{this.showID=i.id,this.showType=i.type,this.currentStep=0,this.noTrailers=!1,this._MoviesService.getShowDetails(this.showID,this.showType).subscribe({next:r=>{this.showDetails=r,this.showDetails.poster_path!==null?this.imageUrl=`http://localhost:3000/image-proxy?url=${encodeURIComponent(this.mainImageUrl+this.showDetails.poster_path)}`:this.showDetails.backdrop_path!==null?this.imageUrl=`http://localhost:3000/image-proxy?url=${encodeURIComponent(this.mainImageUrl+this.showDetails.backdrop_path)}`:this.imageUrl="../../../assets/images/Freebie-DarkGrungeTextures-Preview-03.webp",this.loadAndExtractColor(),this._Title.setTitle((this.showDetails.name||this.showDetails.title)+" - "+this.showType+" - CinemaX")}}),this.showType=="tv"?this._MoviesService.getShowCredits(this.showID,this.showType).subscribe({next:r=>{this.showCredits=r}}):this.showType=="movie"&&this._MoviesService.getMovieCredits(this.showID,this.showType).subscribe({next:r=>{this.showCredits=r}}),this._MoviesService.getShowExternalIDs(this.showID,this.showType).subscribe({next:r=>{this.showExternalIDs=r}}),this._MoviesService.getShowKeywords(this.showID,this.showType).subscribe({next:r=>{this.showKeywords=r.results}}),this._MoviesService.getShowReviews(this.showID,this.showType).subscribe({next:r=>{this.showReviews=r,this.reviews=r.results,this.review=r.results[0]}}),this._MoviesService.getShowRecommendations(this.showID,this.showType,1).subscribe({next:r=>{this.showRecommendations=r.results}}),this._MoviesService.getShowSimilar(this.showID,this.showType).subscribe({next:r=>{this.showRelated=r.results}}),this.getUserData()}})}getUserData(){this._FireStoreService.isInWatchlist.set(!1),this._FireStoreService.isInFavorites.set(!1),this.token=localStorage.getItem("S&MToken"),this.token?this._AuthenticationService.GetLoggedUserData().subscribe({next:i=>{this.userData=i.user,this._FireStoreService.getUserIDByEmail(this.userData.email).then(r=>{r?(this.userID=r,this.checkShowInWatchlist(),this.checkShowInFavorites()):console.log("User not found")})}}):this._Router.navigate(["/login"])}checkShowInWatchlist(){return B(this,null,function*(){let i=yield this._FireStoreService.checkIfInWatchlist(this.userID,this.showID.toString());this._FireStoreService.isInWatchlist.set(i)})}checkShowInFavorites(){return B(this,null,function*(){let i=yield this._FireStoreService.checkIfInFavorites(this.userID,this.showID.toString());this._FireStoreService.isInFavorites.set(i)})}addToWatchlist(){this.userID!==void 0&&this.showDetails?this._FireStoreService.addToWatchlist(this.userID,this.showDetails):console.log("user id not found")}addToFavorites(){this.userID!==void 0&&this.showDetails?this._FireStoreService.addToFavorites(this.userID,this.showDetails):console.log("user id not found")}loadAndExtractColor(){let i=new Image;i.src=this.imageUrl,i.crossOrigin="Anonymous",i.onload=()=>{let r=this.imageCanvas.nativeElement,s=r.getContext("2d",{willReadFrequently:!0});r.width=i.width,r.height=i.height,s.drawImage(i,0,0);let o=.05,a=.05,l=Math.floor(r.width*o),c=Math.floor(r.height*a),u=s.getImageData(l,c,1,1).data;this.extractedColor=`rgba(${u[0]}, ${u[1]}, ${u[2]}, ${u[3]/255})`}}openModal(i){this.noTrailers||this._MoviesService.getShowTrailers(this.showID,this.showType).subscribe({next:r=>{let s=r.results.find(o=>o.name==="Official Trailer");if(s){let o=`https://www.youtube.com/embed/${s.key}`;this.selectedMovie=i,this.selectedMovieUrl=o}else if(r.results.length>0){let a=`https://www.youtube.com/embed/${r.results[0].key}`;this.selectedMovie=i,this.selectedMovieUrl=a}else this.noTrailers=!0,this.selectedMovie=null,this.selectedMovieUrl=""},error:r=>{console.error("Error fetching show trailers:",r)}})}closeModal(){this.selectedMovie=null,this.selectedMovieUrl=""}getColorForUsername(i){let r=i.charAt(0).toUpperCase();return this.letterColorMap[r]||"#CCCCCC"}nextReview(){this.showReviews.results.length>0&&this.currentStep<this.showReviews.results.length-1&&(this.review=this.showReviews.results[this.currentStep+1],this.currentStep++,this.showFullContent=!1)}prevReview(){this.showReviews.results.length>0&&this.currentStep>0&&(this.review=this.showReviews.results[this.currentStep-1],this.currentStep--,this.showFullContent=!1)}toggleContent(){this.showFullContent=!this.showFullContent}getTruncatedContent(i){let r=i.split(" ");return r.length>this.wordLimit?r.slice(0,this.wordLimit).join(" ")+"...":i}isContentLong(i){return i.split(" ").length>this.wordLimit}browserLog(i,r){typeof window<"u"&&console.log(i,r)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-show-details"]],viewQuery:function(r,s){if(r&1&&Af(Yse,5),r&2){let o;Df(o=Pf())&&(s.imageCanvas=o.first)}},standalone:!0,features:[he],decls:1,vars:1,consts:[["imageCanvas",""],["noReviews",""],[2,"display","none"],[1,"w-full","text-white","p-5","my-2",3,"ngStyle"],[1,"flex","flex-col","md:flex-row","items-center","md:items-start","mx-auto","gap-8","w-11/12"],[1,"lg:w-1/4","md:w-1/3","w-1/2"],["class","rounded-lg shadow-lg",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","rounded-lg shadow-lg",3,"alt",4,"ngIf"],[1,"bg-violet-300","w-full","p-4","text-center","text-black","crp","capitalize","font-semibold","text-lg","hover:bg-sky-900","hover:text-white","duration-300",3,"routerLink"],[1,"lg:w-3/4","md:w-2/3","w-full"],[1,"flex","justify-start","items-center"],[1,"text-6xl","font-black","m-0"],[1,"text-4xl","text-gray-300","font-normal"],[1,"flex","items-center","justify-start","gap-3"],[1,"flex","flex-wrap"],[4,"ngFor","ngForOf"],[1,"flex","items-center","justify-start","gap-3","mt-10"],[1,"text-black","crp"],[3,"progress","paddingValue","fontSizeValue"],[1,"flex","flex-col","text-lg"],[1,"flex","items-center","justify-start","gap-3","mt-4"],[1,"crp","rounded-full","bg-blue-800","text-white","p-4","w-10","h-10","flex","justify-center","items-center","me-4","text-sm",3,"click","ngClass"],[1,"fa-solid","fa-heart"],[1,"crp","rounded-full","bg-blue-800","p-4","w-10","h-10","flex","justify-center","items-center","me-4","text-sm",3,"click","ngClass"],[1,"fa-solid","fa-bookmark"],[1,"text-white","flex","justify-center","items-center","gap-2","text-lg","crp",3,"click"],[1,"fa-solid","fa-play"],[1,"capitalize"],["class","mx-3 text-white text-lg bg-black p-1",4,"ngIf"],[1,"flex","items-center","justify-start","mt-4"],[1,"flex","flex-col"],[1,"text-lg","mb-2","text-gray-300"],[1,"text-white","text-xl","font-bold"],[1,"text-lg","mb-4"],[1,"grid","grid-cols-3"],[1,"flex","mx-auto","w-11/12","mt-5"],[1,"w-2/3","flex","flex-col","overflow-hidden"],["class","mb-5 border-b-2 border-gray-200 pb-5",4,"ngIf"],[4,"ngIf"],["class","mt-5",4,"ngIf"],[1,"side-section","w-1/3","bg-slate-50","p-5","rounded-lg","shadow-lg"],["class","mt-10",4,"ngIf"],[3,"youtubeUrl","movie","close",4,"ngIf"],[1,"rounded-lg","shadow-lg",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"rounded-lg","shadow-lg",3,"alt"],[1,"rounded-lg","text-sm","hover:text-gray-300","duration-150","crp"],[1,"mx-3","text-white","text-lg","bg-black","p-1"],[1,"col","flex","flex-col"],[3,"routerLink"],[1,"crp"],[1,"mb-5","border-b-2","border-gray-200","pb-5"],[3,"slidesNum","showCredits"],[1,"mt-5","capitalize","crp","font-medium","hover:text-gray-600","duration-150","inline-block",3,"routerLink"],["class"," font-medium text-black text-lg",4,"ngIf"],[1,"bg-slate-100","border-1","shadow-lg","rounded-md","grid","lg:grid-cols-12","md:grid-cols-8","items-center","p-2","gap-3"],[1,"lg:col-span-3","md:col-span-3"],[1,"w-full",3,"src","alt"],[1,"lg:col-span-8","md:col-span-4"],[1,"font-medium","mt-4"],[1,"flex","gap-1","items-center"],[1,"p-1","bg-blue-900","text-white","text-sm","rounded-md"],[1,"fa-solid","fa-star","me-1"],[1,"text-[4px]","font-bold"],[1,"fa-solid","fa-circle"],[1,"my-6"],[1,"text"],[1,"font-medium","text-black","text-lg"],[1,"me-3"],[1,"underline"],[1,"flex","items-center","justify-between"],[1,"font-medium","text-black","text-lg","me-10"],[1,"relative","flex","flex-col","md:flex-row","md:gap-3","items-center","justify-between"],[1,"border-b-4","border-black"],[1,"mx-2",3,"click"],[1,"fa-solid","fa-arrow-left"],[1,"fa-solid","fa-arrow-right"],["class","mt-3 bg-slate-100 border-1 shadow-lg rounded-md p-2 gap-3",4,"ngIf","ngIfElse"],[1,"mt-3","bg-slate-100","border-1","shadow-lg","rounded-md","p-2","gap-3"],[1,"flex","items-center","gap-5","mb-3"],["class","w-10 h-10 rounded-full",3,"src","alt",4,"ngIf"],["class","w-10 h-10 rounded-full bg-amber-400 p-4 flex justify-center items-center",3,"ngStyle",4,"ngIf"],["class","p-1 bg-blue-900 text-white text-[10px] rounded-md",4,"ngIf"],["class","text-blue-500 cursor-pointer",3,"click",4,"ngIf"],[1,"w-10","h-10","rounded-full",3,"src","alt"],[1,"w-10","h-10","rounded-full","bg-amber-400","p-4","flex","justify-center","items-center",3,"ngStyle"],[1,"p-1","bg-blue-900","text-white","text-[10px]","rounded-md"],[1,"text-blue-500","cursor-pointer",3,"click"],[1,"hover:text-gray-600","crp","duration-100"],[1,"mt-5"],[1,"bg-slate-100","border-1","shadow-lg","rounded-md","p-2"],[3,"slidesNum","shows"],[1,"font-medium","text-black","text-lg","me-10","capitalize"],[1,"text-lg","flex","gap-5","items-center","mb-4"],["target","_blank",1,"text-black","hover:text-gray-700",3,"href"],[1,"fa-brands","fa-facebook"],[1,"fa-brands","fa-x-twitter"],[1,"fa-brands","fa-instagram"],[1,"fa-solid","fa-link"],[1,"text-xl","font-medium","text-black","mb-2"],[1,"p-4","mb-4"],[1,"mb-2"],[1,"font-semibold","text-black"],[1,"text-black"],["class","mb-2",4,"ngIf"],["class","flex items-center my-2 gap-3 crp",3,"routerLink",4,"ngFor","ngForOf"],[1,"flex","items-center","my-2","gap-3","crp",3,"routerLink"],["class","w-20 h-auto",3,"src","alt",4,"ngIf"],[1,"w-20","h-auto",3,"src","alt"],[1,"mt-10"],[1,"flex","flex-wrap","gap-3"],[1,"bg-slate-200","py-1","px-2","rounded-md","shadow-sm","text-black","text-sm"],[1,"text-xl","font-medium","text-black","mb-2","capitalize"],[1,"bg-slate-100","crp","hover:scale-105","duration-300",3,"routerLink"],["class","rounded-md shadow-md w-40 object-cover p-1 mx-auto",4,"ngIf"],[1,"text-center"],[1,"rounded-md","shadow-md","w-40","object-cover","p-1","mx-auto"],[3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",3,"alt"],[3,"close","youtubeUrl","movie"]],template:function(r,s){r&1&&q(0,Hoe,68,48),r&2&&je(0,s.showDetails?0:-1)},dependencies:[Is,CU,Ye,De,bt,Nt,vl,bU,Ut,qt,Py,EU,My],styles:["h1[_ngcontent-%COMP%]{font-size:30px!important;font-weight:700!important}"]});let n=e;return n})();var IU=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-not-found"]],standalone:!0,features:[he],decls:2,vars:0,template:function(r,s){r&1&&(p(0,"p"),D(1,"not-found works!"),m())}});let n=e;return n})();var Pu=(()=>{let e=class e{constructor(){this._HttpClient=H($n)}getPopularPeople(i){return this._HttpClient.get(`${te.url}person/popular?api_key=${te.apiKey}&page=${i}`)}getTrendingPeople(i){return this._HttpClient.get(`${te.url}trending/person/week?api_key=${te.apiKey}&page=${i}`)}getPersonDetails(i){return this._HttpClient.get(`${te.url}person/${i}?api_key=${te.apiKey}`)}getPersonCredits(i){return this._HttpClient.get(`${te.url}person/${i}/combined_credits?api_key=${te.apiKey}`)}getPersonExternalIDs(i){return this._HttpClient.get(`${te.url}person/${i}/external_ids?api_key=${te.apiKey}`)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=at({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Woe=n=>["/m/person",n];function Koe(n,e){if(n&1&&(wi(0),L(1,"img",23),Si()),n&2){let t=O().$implicit,i=O(2);v(),k("src",i.imageUrl+t.profile_path,pe)("alt",t.name)}}function Yoe(n,e){n&1&&L(0,"img",24)}function Qoe(n,e){if(n&1&&(p(0,"span",25),D(1),m()),n&2){let t=e.$implicit;v(),ve(" ",t.name||t.title," ")}}function Xoe(n,e){if(n&1&&(p(0,"div",15)(1,"div",16),q(2,Koe,2,2,"ng-container",17)(3,Yoe,1,0,"ng-template",null,0,yl),m(),p(5,"h2",18),D(6),m(),p(7,"div",19)(8,"h3",20),D(9,"Known for:"),m(),p(10,"div",21),q(11,Qoe,2,1,"span",22),m()()()),n&2){let t=e.$implicit,i=gl(4);v(),k("routerLink",Kt(5,Woe,t.id)),v(),k("ngIf",t.profile_path)("ngIfElse",i),v(4),ve(" ",t.name," "),v(5),k("ngForOf",t.known_for)}}function Joe(n,e){if(n&1&&(p(0,"div",13),q(1,Xoe,12,7,"div",14),m()),n&2){let t=O();v(),k("ngForOf",t.peopleList)}}function Zoe(n,e){n&1&&(p(0,"div",26)(1,"p",27),D(2,"No people found."),m()())}function eae(n,e){if(n&1){let t=ze();p(0,"span",28),oe("click",function(){Re(t);let r=O();return Me(r.fetchPeople(r.currentPage-2))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage-2)}}function tae(n,e){if(n&1){let t=ze();p(0,"span",28),oe("click",function(){Re(t);let r=O();return Me(r.fetchPeople(r.currentPage-1))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage-1)}}function nae(n,e){if(n&1){let t=ze();p(0,"span",28),oe("click",function(){Re(t);let r=O();return Me(r.fetchPeople(r.currentPage+1))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage+1)}}function iae(n,e){if(n&1){let t=ze();p(0,"span",28),oe("click",function(){Re(t);let r=O();return Me(r.fetchPeople(r.currentPage+2))}),D(1),m()}if(n&2){let t=O();v(),J(t.currentPage+2)}}var kU=(()=>{let e=class e{constructor(){this._PeopleService=H(Pu),this._DiscoverShowsService=H(Ny),this._ActivatedRoute=H(Lt),this.imageUrl="https://image.tmdb.org/t/p/w300/",this.MAX_PAGES=500,this.currentPage=1}ngOnInit(){this._ActivatedRoute.paramMap.subscribe(i=>{this.category=i.get("pCate"),this.fetchPeople(1)})}fetchPeople(i){this.category=="trending"?this._PeopleService.getTrendingPeople(i).subscribe({next:r=>{this.lastPage=r.total_pages,this.lastPage<this.MAX_PAGES&&(this.MAX_PAGES=this.lastPage),this.peopleList=r.results,this.currentPage=i},error:r=>{}}):this.category=="popular"&&this._PeopleService.getPopularPeople(i).subscribe({next:r=>{this.lastPage=r.total_pages,this.lastPage<this.MAX_PAGES&&(this.MAX_PAGES=this.lastPage),this.peopleList=r.results,this.currentPage=i},error:r=>{}})}nextPage(){this.currentPage<this.MAX_PAGES&&this.fetchPeople(this.currentPage+1)}prevPage(){this.currentPage>1&&this.fetchPeople(this.currentPage-1)}goFirst(){this.currentPage>1&&this.fetchPeople(1)}goLast(){this.currentPage<this.MAX_PAGES&&this.fetchPeople(this.MAX_PAGES)}isFirstPage(){return this.currentPage===1}isLastPage(){return this.currentPage===this.MAX_PAGES}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-people"]],standalone:!0,features:[he],decls:23,vars:10,consts:[["placeholderImage",""],[1,"my-10"],[1,"text-center","text-2xl","font-bold","text-orange-400","bg-cyan-800","p-2","mb-4"],[1,"container","mx-auto","w-4/5"],["class","grid gap-8 lg:grid-cols-5 md:grid-cols-4 sm:grid-cols-3 grid-cols-2",4,"ngIf"],["class","text-center mt-10",4,"ngIf"],[1,"flex","justify-center","items-center"],[1,"flex","justify-between","items-center","my-10","gap-3","bg-orange-400","md:w-2/3","w-full","p-4","rounded-lg","shadow-lg","overflow-hidden","whitespace-nowrap"],[1,"pagination-btn",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"page-number"],[1,"page-number-active"],[1,"fa-solid","fa-angles-right"],[1,"grid","gap-8","lg:grid-cols-5","md:grid-cols-4","sm:grid-cols-3","grid-cols-2"],["class","bg-slate-100 p-4 rounded-lg shadow-lg overflow-hidden group",4,"ngFor","ngForOf"],[1,"bg-slate-100","p-4","rounded-lg","shadow-lg","overflow-hidden","group"],[1,"overflow-hidden","rounded-lg","crp",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"mt-3","text-md","text-center","font-medium","text-gray-800","transition-colors","duration-300","group-hover:text-indigo-600"],[1,"mt-4","text-center"],[1,"text-sm","font-medium","text-gray-600","mb-2"],[1,"space-y-2"],["class","inline-block text-xs crp bg-gray-200 text-gray-800 px-2 py-1 rounded-full transform transition-transform duration-300 hover:scale-105 hover:bg-gray-300",4,"ngFor","ngForOf"],[1,"w-full","h-48","md:h-56","lg:h-64","object-cover","rounded-lg","transform","transition-transform","duration-500","group-hover:scale-110","group-hover:translate-y-2",3,"src","alt"],["src","../../../assets/images/lost_in_Giza.jpeg","alt","No profile picture available",1,"w-full","h-48","md:h-56","lg:h-64","object-cover","rounded-lg","transform","transition-transform","duration-500","group-hover:scale-110","group-hover:translate-y-2"],[1,"inline-block","text-xs","crp","bg-gray-200","text-gray-800","px-2","py-1","rounded-full","transform","transition-transform","duration-300","hover:scale-105","hover:bg-gray-300"],[1,"text-center","mt-10"],[1,"text-lg","text-gray-500"],[1,"page-number",3,"click"]],template:function(r,s){r&1&&(p(0,"section",1)(1,"h1",2),D(2),me(3,"formatTitle"),m(),p(4,"div",3),q(5,Joe,2,1,"div",4)(6,Zoe,3,0,"div",5),m(),p(7,"div",6)(8,"div",7)(9,"button",8),oe("click",function(){return s.goFirst()}),L(10,"i",9),m(),p(11,"button",8),oe("click",function(){return s.prevPage()}),D(12," Pervious "),m(),q(13,eae,2,1,"span",10)(14,tae,2,1,"span",10),p(15,"span",11),D(16),m(),q(17,nae,2,1,"span",10)(18,iae,2,1,"span",10),p(19,"button",8),oe("click",function(){return s.nextPage()}),D(20," Next "),m(),p(21,"button",8),oe("click",function(){return s.goLast()}),L(22,"i",12),m()()()()),r&2&&(v(2),ve(" ",ke(3,8,s.category)," Celebrities "),v(3),k("ngIf",s.peopleList&&s.peopleList.length>0),v(),k("ngIf",!s.peopleList||s.peopleList.length===0),v(7),je(13,s.currentPage>2?13:-1),v(),je(14,s.currentPage>1?14:-1),v(2),J(s.currentPage),v(),je(17,s.currentPage<500?17:-1),v(),je(18,s.currentPage<499?18:-1))},dependencies:[bt,De,Du,Ye],styles:["sup[_ngcontent-%COMP%]{font-size:.5em;vertical-align:super;top:0;left:0}.word-wrap[_ngcontent-%COMP%]{white-space:pre-line;line-height:1.5}.pagination-btn[_ngcontent-%COMP%]{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));border-radius:.5rem;--tw-bg-opacity: 1;background-color:rgb(63 131 248 / var(--tw-bg-opacity));padding:.5rem;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity));--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow);transition-property:transform;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1);box-shadow:0 4px #0000004d}.pagination-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px #0000004d}.pagination-btn[_ngcontent-%COMP%]:active{transform:translateY(2px);box-shadow:0 2px #0000004d}.page-number[_ngcontent-%COMP%], .page-number-active[_ngcontent-%COMP%]{margin-left:.5rem;margin-right:.5rem;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:1.125rem;line-height:1.75rem;font-weight:600}.page-number[_ngcontent-%COMP%]{border-radius:.375rem;--tw-bg-opacity: 1;background-color:rgb(100 116 139 / var(--tw-bg-opacity));padding:.25rem .5rem;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity));box-shadow:0 4px #0003}.page-number-active[_ngcontent-%COMP%]{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity));background-color:#e2e8f0;padding:4px 10px;border-radius:6px;box-shadow:inset 0 4px #0003}"]});let n=e;return n})();var AU=(()=>{let e=class e{transform(i){let r=new Date(i),s=Date.now()-r.getTime(),o=new Date(s);return Math.abs(o.getUTCFullYear()-1970)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275pipe=cn({name:"age",type:e,pure:!0,standalone:!0});let n=e;return n})();var DU=(n,e)=>["/m/show-details",n,e],rae=n=>["/m/person-shows",n];function sae(n,e){if(n&1&&(p(0,"div",8),L(1,"img",17),m()),n&2){let t=O(2);v(),k("src",t.mainImageUrl+t.personDetails.profile_path,pe)("alt",t.personDetails.name)}}function oae(n,e){n&1&&(p(0,"span",10),D(1,"Male"),m())}function aae(n,e){n&1&&(p(0,"span",10),D(1,"Female"),m())}function lae(n,e){n&1&&(p(0,"span",10),D(1,"Unknown"),m())}function cae(n,e){if(n&1&&(p(0,"div",8)(1,"h3",9),D(2,"Gender"),m(),q(3,oae,2,0,"span",18)(4,aae,2,0,"span",18)(5,lae,2,0,"span",18),m()),n&2){let t=O(2);v(3),k("ngIf",t.personDetails.gender===2),v(),k("ngIf",t.personDetails.gender===1),v(),k("ngIf",t.personDetails.gender!==1&&t.personDetails.gender!==2)}}function uae(n,e){if(n&1&&(p(0,"span"),D(1),me(2,"age"),m()),n&2){let t=O(3);v(),ve(" (",ke(2,1,t.personDetails.birthday)," years old)")}}function dae(n,e){if(n&1&&(p(0,"div",8)(1,"h3",9),D(2,"Born"),m(),p(3,"span",10),D(4),me(5,"date"),q(6,uae,3,3,"span",11),m()()),n&2){let t=O(2);v(4),ve(" ",lt(5,2,t.personDetails.birthday,"MMMM d, y")," "),v(2),k("ngIf",!t.personDetails.deathday)}}function hae(n,e){if(n&1&&(p(0,"div",8)(1,"h3",9),D(2,"Died"),m(),p(3,"span",10),D(4),me(5,"date"),m()()),n&2){let t=O(2);v(4),J(lt(5,1,t.personDetails.deathday,"MMMM d, y"))}}function fae(n,e){if(n&1&&(p(0,"div",8)(1,"h3",9),D(2,"place of birth"),m(),p(3,"span",10),D(4),m()()),n&2){let t=O(2);v(4),J(t.personDetails.place_of_birth)}}function pae(n,e){if(n&1&&(p(0,"div")(1,"h3",9),D(2,"Also Known As"),m(),p(3,"span",10),D(4),m()()),n&2){let t=O(2);v(4),J(t.personDetails.also_known_as)}}function mae(n,e){if(n&1&&(p(0,"a",23),L(1,"i",24),m()),n&2){let t=O(3);k("href","https://www.imdb.com/name/"+t.ex_Ids.imdb_id,pe)}}function gae(n,e){if(n&1&&(p(0,"a",23),L(1,"i",25),m()),n&2){let t=O(3);k("href","https://www.wikidata.org/wiki/"+t.ex_Ids.wikidata_id,pe)}}function yae(n,e){if(n&1&&(p(0,"a",23),L(1,"i",26),m()),n&2){let t=O(3);k("href","https://www.facebook.com/"+t.ex_Ids.facebook_id,pe)}}function vae(n,e){if(n&1&&(p(0,"a",23),L(1,"i",27),m()),n&2){let t=O(3);k("href","https://www.instagram.com/"+t.ex_Ids.instagram_id,pe)}}function _ae(n,e){if(n&1&&(p(0,"a",23),L(1,"i",28),m()),n&2){let t=O(3);k("href","https://www.tiktok.com/@"+t.ex_Ids.tiktok_id,pe)}}function wae(n,e){if(n&1&&(p(0,"a",23),L(1,"i",29),m()),n&2){let t=O(3);k("href","https://www.twitter.com/"+t.ex_Ids.twitter_id,pe)}}function Sae(n,e){if(n&1&&(p(0,"a",23),L(1,"i",30),m()),n&2){let t=O(3);k("href","https://www.youtube.com/user/"+t.ex_Ids.youtube_id,pe)}}function bae(n,e){if(n&1&&(p(0,"div",19)(1,"h3",20),D(2,"Personal Links"),m(),p(3,"div",21),q(4,mae,2,1,"a",22)(5,gae,2,1,"a",22)(6,yae,2,1,"a",22)(7,vae,2,1,"a",22)(8,_ae,2,1,"a",22)(9,wae,2,1,"a",22)(10,Sae,2,1,"a",22),m()()),n&2){let t=O(2);v(4),k("ngIf",t.ex_Ids.imdb_id),v(),k("ngIf",t.ex_Ids.wikidata_id),v(),k("ngIf",t.ex_Ids.facebook_id),v(),k("ngIf",t.ex_Ids.instagram_id),v(),k("ngIf",t.ex_Ids.tiktok_id),v(),k("ngIf",t.ex_Ids.twitter_id),v(),k("ngIf",t.ex_Ids.youtube_id)}}function Eae(n,e){if(n&1&&(p(0,"h2",31),D(1),m()),n&2){let t=O(2);v(),J(t.personDetails.name)}}function Cae(n,e){if(n&1){let t=ze();p(0,"span",35),oe("click",function(){Re(t);let r=O(3);return Me(r.toggleContent())}),D(1),m()}if(n&2){let t=O(3);v(),ve(" ",t.showFullContent?"Read Less":"Read More"," ")}}function Tae(n,e){if(n&1&&(p(0,"div",32)(1,"h3",20),D(2,"Biography"),m(),p(3,"p",33),D(4),q(5,Cae,2,1,"span",34),m()()),n&2){let t=O(2);v(4),ve(" ",t.showFullContent?t.personDetails.biography:t.getTruncatedContent(t.personDetails.biography)," "),v(),k("ngIf",t.isContentLong(t.personDetails.biography))}}function xae(n,e){if(n&1&&L(0,"img",48),n&2){let t=O().$implicit,i=O(3);k("src",i.mainImageUrl+t.poster_path,pe)("alt",t.name||t.title)}}function Iae(n,e){if(n&1&&L(0,"img",49),n&2){let t=O().$implicit;k("alt",t.name||t.title)}}function kae(n,e){if(n&1&&(p(0,"span"),D(1),me(2,"date"),m()),n&2){let t=O().$implicit;v(),ve("(",lt(2,1,t.release_date||t.first_air_date,"yyyy"),")")}}function Aae(n,e){if(n&1&&(p(0,"div",41)(1,"div",42)(2,"span",43),D(3),m(),p(4,"a",44),q(5,xae,1,2,"img",45)(6,Iae,1,1,"img",46),m(),p(7,"h2",47),D(8),q(9,kae,3,4,"span",11),m()()()),n&2){let t=e.$implicit;v(3),ve(" ",t.media_type," "),v(),k("routerLink",qe(6,DU,t.media_type||"movie",t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(2),ve("",t.name||t.title," "),v(),k("ngIf",t.release_date||t.first_air_date)}}function Dae(n,e){if(n&1&&(p(0,"a",50),D(1,"show all works"),L(2,"i",51),m()),n&2){let t=O(3);k("routerLink",Kt(1,rae,t.personDetails.id))}}function Pae(n,e){if(n&1&&(p(0,"div",36)(1,"h3",37),D(2," Known For "),p(3,"span"),D(4),m(),D(5,": "),m(),p(6,"div",38),q(7,Aae,10,9,"div",39),m(),q(8,Dae,3,3,"a",40),m()),n&2){let t=O(2);v(4),J(t.personDetails.known_for_department),v(3),k("ngForOf",t.castShows.slice(0,10)),v(),k("ngIf",t.castShows.length>10)}}function Rae(n,e){n&1&&(p(0,"h3",37),D(1," Other Works "),m())}function Mae(n,e){n&1&&(p(0,"h3",37),D(1,"Worked On"),m())}function Oae(n,e){if(n&1&&L(0,"img",48),n&2){let t=O().$implicit,i=O(3);k("src",i.mainImageUrl+t.poster_path,pe)("alt",t.name||t.title)}}function Nae(n,e){if(n&1&&L(0,"img",49),n&2){let t=O().$implicit;k("alt",t.name||t.title)}}function Lae(n,e){if(n&1&&(p(0,"span"),D(1),me(2,"date"),m()),n&2){let t=O().$implicit;v(),ve("(",lt(2,1,t.release_date||t.first_air_date,"yyyy"),")")}}function Fae(n,e){if(n&1&&(p(0,"div",54)(1,"div",55)(2,"span",43),D(3),m(),p(4,"a",44),q(5,Oae,1,2,"img",45)(6,Nae,1,1,"img",46),m(),p(7,"div",56)(8,"h2",57),D(9),q(10,Lae,3,4,"span",11),m(),p(11,"h3",58),D(12,"Department: "),p(13,"span",59),D(14),m()(),p(15,"h3",60),D(16,"Job: "),p(17,"span",59),D(18),m()()()()()),n&2){let t=e.$implicit;v(3),ve(" ",t.media_type," "),v(),k("routerLink",qe(8,DU,t.media_type||"movie",t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(3),ve("",t.name||t.title," "),v(),k("ngIf",t.release_date||t.first_air_date),v(4),J(t.department),v(4),J(t.job)}}function Bae(n,e){if(n&1&&(p(0,"div",36),q(1,Rae,2,0,"h3",52)(2,Mae,2,0,"h3",52),p(3,"div",38),q(4,Fae,19,11,"div",53),m()()),n&2){let t=O(2);v(),k("ngIf",t.crewShows.length>0&&t.castShows.length>0),v(),k("ngIf",t.crewShows.length>0&&t.castShows.length==0),v(2),k("ngForOf",t.crewShows)}}function Uae(n,e){if(n&1&&(p(0,"div",2)(1,"div",3),q(2,sae,2,2,"div",4),L(3,"div",5),p(4,"div",6)(5,"h2",7),D(6,"Personal Info"),m(),p(7,"div",8)(8,"h3",9),D(9,"Known For"),m(),p(10,"span",10),D(11),m()(),p(12,"div",8)(13,"h3",9),D(14,"Known Credits"),m(),p(15,"span",10),D(16),m()(),q(17,cae,6,3,"div",4)(18,dae,7,5,"div",4)(19,hae,6,4,"div",4)(20,fae,5,1,"div",4)(21,pae,5,1,"div",11)(22,bae,11,7,"div",12),m()(),p(23,"div",13),q(24,Eae,2,1,"h2",14)(25,Tae,6,2,"div",15)(26,Pae,9,3,"div",16)(27,Bae,5,3,"div",16),m()()),n&2){let t=O();v(2),k("ngIf",t.personDetails==null?null:t.personDetails.profile_path),v(9),J(t.personDetails.known_for_department),v(5),J(t.castShows.length+t.crewShows.length),v(),k("ngIf",t.personDetails.gender),v(),k("ngIf",t.personDetails.birthday),v(),k("ngIf",t.personDetails.deathday),v(),k("ngIf",t.personDetails.place_of_birth),v(),k("ngIf",t.personDetails.also_known_as.length>0),v(),k("ngIf",t.ex_Ids),v(2),k("ngIf",t.personDetails.name),v(),k("ngIf",t.personDetails.biography),v(),k("ngIf",t.castShows.length>0),v(),k("ngIf",t.crewShows.length>0)}}var PU=(()=>{let e=class e{constructor(){this._ActivatedRoute=H(Lt),this._PeopleService=H(Pu),this._Title=H(jn),this.mainImageUrl="https://image.tmdb.org/t/p/w500",this.castShows=[],this.crewShows=[],this.showFullContent=!1,this.wordLimit=20}ngOnInit(){this.loadPerson()}loadPerson(){this._ActivatedRoute.params.subscribe({next:i=>{this.personID=i.id,this._PeopleService.getPersonDetails(this.personID).subscribe({next:r=>{this.personDetails=r,this._Title.setTitle(this.personDetails.name+" - CinemaX")},error:r=>{console.error("Error fetching person details",r)}}),this._PeopleService.getPersonCredits(this.personID).subscribe({next:r=>{this.castShows=r.cast.sort((s,o)=>{let a=new Date(s.release_date||s.first_air_date);return new Date(o.release_date||o.first_air_date).getTime()-a.getTime()}),this.crewShows=r.crew.sort((s,o)=>{let a=new Date(s.release_date||s.first_air_date);return new Date(o.release_date||o.first_air_date).getTime()-a.getTime()})},error:r=>{console.error("Error fetching person credits",r)}}),this._PeopleService.getPersonExternalIDs(this.personID).subscribe({next:r=>{this.ex_Ids=r},error:r=>{console.error("Error fetching person Ex Ids",r)}})},error:i=>{console.error("Error fetching route params",i)}})}filterShowsByBirthdate(i,r){let s=new Date(r);return i.filter(o=>{let a=o.first_air_date||o.release_date;return a?new Date(a)>=s:!1})}toggleContent(){this.showFullContent=!this.showFullContent}getTruncatedContent(i){let r=i.split(" ");return r.length>this.wordLimit?r.slice(0,this.wordLimit).join(" ")+"...":i}isContentLong(i){return i.split(" ").length>this.wordLimit}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-person"]],standalone:!0,features:[he],decls:2,vars:1,consts:[[1,"my-10","flex","justify-center","items-center"],["class","container flex gap-10 justify-center ps-5",4,"ngIf"],[1,"container","flex","gap-10","justify-center","ps-5"],[1,"md:w-1/3","lg:w-1/5","w-1/2","p-4","bg-gray-100","rounded-lg","shadow-lg"],["class","mb-4",4,"ngIf"],[1,"socialLinks","mb-4"],[1,"bg-white","p-4","rounded-lg","shadow-md"],[1,"text-xl","font-semibold","text-gray-800","mb-4"],[1,"mb-4"],[1,"text-lg","font-medium","text-gray-700"],[1,"text-sm","text-gray-600"],[4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"md:w-2/3","lg:w-4/5","w-1/2","bg-gray-100","rounded-lg","shadow-lg","p-6"],["class","text-2xl font-bold text-gray-800 mb-4",4,"ngIf"],["class","mb-6",4,"ngIf"],["class","mt-8",4,"ngIf"],[1,"w-full","h-auto","rounded-md","border","border-gray-300","shadow-sm",3,"src","alt"],["class","text-sm text-gray-600",4,"ngIf"],[1,"mt-4"],[1,"text-lg","font-medium","text-gray-700","mb-2"],[1,"flex","gap-4"],["target","_blank","class","text-lg text-gray-600",3,"href",4,"ngIf"],["target","_blank",1,"text-lg","text-gray-600",3,"href"],[1,"fa-brands","fa-imdb","text-yellow-500"],[1,"fa-brands","fa-wikipedia-w","text-black"],[1,"fa-brands","fa-facebook","text-blue-600"],[1,"fa-brands","fa-instagram","text-pink-600"],[1,"fa-brands","fa-tiktok","text-black"],[1,"fa-brands","fa-twitter","text-blue-400"],[1,"fa-brands","fa-youtube","text-red-600"],[1,"text-2xl","font-bold","text-gray-800","mb-4"],[1,"mb-6"],[1,"text-gray-600"],["class","text-blue-500 cursor-pointer",3,"click",4,"ngIf"],[1,"text-blue-500","cursor-pointer",3,"click"],[1,"mt-8"],[1,"text-lg","font-medium","text-gray-700","mb-4"],[1,"flex","overflow-x-auto","gap-4"],["class","flex-none w-32 relative group",4,"ngFor","ngForOf"],["class","m-3 crp bg-slate-200 hover:bg-slate-400 rounded-md shadow-md  p-2 duration-150 capitalize inline-block",3,"routerLink",4,"ngIf"],[1,"flex-none","w-32","relative","group"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden"],[1,"absolute","top-2","left-2","bg-black","text-white","text-xs","font-semibold","px-2","py-1","rounded-md","z-10"],[1,"crp","relative",3,"routerLink"],["class","w-full h-48 object-cover transition-transform duration-300 ease-in-out group-hover:scale-105",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","w-full h-48 object-cover transition-transform duration-300 ease-in-out group-hover:scale-105",3,"alt",4,"ngIf"],[1,"text-sm","font-semibold","text-center","text-gray-800","p-2"],[1,"w-full","h-48","object-cover","transition-transform","duration-300","ease-in-out","group-hover:scale-105",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-48","object-cover","transition-transform","duration-300","ease-in-out","group-hover:scale-105",3,"alt"],[1,"m-3","crp","bg-slate-200","hover:bg-slate-400","rounded-md","shadow-md","p-2","duration-150","capitalize","inline-block",3,"routerLink"],[1,"mx-2","fa-solid","fa-arrow-right"],["class","text-lg font-medium text-gray-700 mb-4",4,"ngIf"],["class","flex-none w-48 relative group",4,"ngFor","ngForOf"],[1,"flex-none","w-48","relative","group"],[1,"bg-white","rounded-lg","shadow-lg","overflow-hidden"],[1,"p-4","text-center"],[1,"text-sm","font-semibold","text-gray-800","mb-1"],[1,"text-xs","text-gray-600","mb-1"],[1,"font-medium"],[1,"text-xs","text-gray-600"]],template:function(r,s){r&1&&(p(0,"section",0),q(1,Uae,28,13,"div",1),m()),r&2&&(v(),k("ngIf",s.personDetails))},dependencies:[De,bt,AU,Nt,Ye],styles:[".swiper-container[_ngcontent-%COMP%]{position:relative;width:100%;overflow:hidden}.swiper-wrapper[_ngcontent-%COMP%]{display:flex;gap:1rem;transition:transform .3s ease}.swiper-slide[_ngcontent-%COMP%]{min-width:150px;flex-shrink:0;scroll-snap-align:start}.swiper-button-prev[_ngcontent-%COMP%], .swiper-button-next[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);background-color:#00000080;border:none;color:#fff;padding:10px;cursor:pointer;z-index:10}.swiper-button-prev[_ngcontent-%COMP%]{left:10px}.swiper-button-next[_ngcontent-%COMP%]{right:10px}"]});let n=e;return n})();var RU=(n,e)=>["/m/show-details",n,e];function qae(n,e){if(n&1&&(p(0,"a",13),L(1,"img",14),m()),n&2){let t=O().$implicit,i=O();k("routerLink",qe(3,RU,t.media_type,t.id)),v(),k("src",i.mainImageUrl+t.poster_path,pe)("alt",t.title)}}function zae(n,e){if(n&1&&(p(0,"a",13),L(1,"img",15),m()),n&2){let t=O().$implicit;k("routerLink",qe(2,RU,t.media_type,t.id)),v(),k("alt",t.title||t.name)}}function Vae(n,e){if(n&1&&(p(0,"div",5)(1,"div",6),q(2,qae,2,6,"a",7)(3,zae,2,5,"a",7),m(),p(4,"div",8),L(5,"app-progress-circle",9),me(6,"percentage"),m(),p(7,"div",10)(8,"h3",11),D(9),me(10,"splitTitle"),m(),p(11,"p",12),D(12),me(13,"date"),m()()()),n&2){let t=e.$implicit;v(2),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(2),k("progress",ke(6,5,t.vote_average)),v(4),J(ke(10,7,t.title||t.name)),v(3),J(lt(13,9,t.release_date||t.first_air_date,"yyyy"))}}var MU=(()=>{let e=class e{constructor(){this._ActivatedRoute=H(Lt),this._PeopleService=H(Pu),this._Title=H(jn),this.showList=[],this.mainImageUrl="https://image.tmdb.org/t/p/w500",this.MAX_PAGES=500,this.currentPage=1}ngOnInit(){this.loadPerson()}loadPerson(){this._ActivatedRoute.params.subscribe({next:i=>{this.personID=i.id,this._PeopleService.getPersonCredits(this.personID).subscribe({next:r=>{this.showList=r.cast.sort((s,o)=>{let a=new Date(s.release_date||s.first_air_date);return new Date(o.release_date||o.first_air_date).getTime()-a.getTime()})},error:r=>{console.error("Error fetching person credits",r)}})},error:i=>{console.error("Error fetching route params",i)}})}fetchShows(i){}goToShowDetails(i){}prevPage(){}nextPage(){}goFirst(){this.currentPage>1&&this.fetchShows(1)}goLast(){this.currentPage<this.MAX_PAGES&&this.fetchShows(this.MAX_PAGES)}isFirstPage(){return this.currentPage===1}isLastPage(){return this.currentPage===this.MAX_PAGES}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-person-shows"]],standalone:!0,features:[he],decls:6,vars:1,consts:[[1,"my-10"],[1,"w-4/5","container","mx-auto","p-6"],[1,"text-4xl","font-bold","text-black","mb-4"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-5","gap-6"],["class"," bg-slate-100 rounded-lg shadow-lg p-2 relative transition-transform duration-500 hover:scale-105",4,"ngFor","ngForOf"],[1,"bg-slate-100","rounded-lg","shadow-lg","p-2","relative","transition-transform","duration-500","hover:scale-105"],[1,"h-52","overflow-hidden","rounded-lg"],[3,"routerLink",4,"ngIf"],[1,"relative","-top-5","left-2"],[3,"progress"],[1,"mt-2","text-center"],[1,"text-md","font-semibold","truncate"],[1,"text-sm"],[3,"routerLink"],[1,"w-full","h-full","object-cover","crp",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-full","object-cover","crp",3,"alt"]],template:function(r,s){r&1&&(p(0,"section",0)(1,"div",1)(2,"h1",2),D(3,"Shows"),m(),p(4,"div",3),q(5,Vae,14,12,"div",4),m()()()),r&2&&(v(5),k("ngForOf",s.showList))},dependencies:[De,bt,Nt,Ye,Ut,qt,ti]});let n=e;return n})();var OU=n=>["/m/person",n];function $ae(n,e){if(n&1&&L(0,"img",13),n&2){let t=O(2);k("src",t.mainImageUrl+t.showDetails.poster_path,pe)("alt",t.showDetails.title||t.showDetails.name)}}function jae(n,e){if(n&1&&L(0,"img",14),n&2){let t=O(2);k("alt",t.showDetails.title||t.showDetails.name)}}function Gae(n,e){if(n&1&&L(0,"img",26),n&2){let t=O().$implicit,i=O(3);k("src",i.mainImageUrl+t.profile_path,pe)("alt",t.name)}}function Hae(n,e){if(n&1&&L(0,"img",27),n&2){let t=O().$implicit;k("alt",t.name)}}function Wae(n,e){if(n&1&&(p(0,"p",28),D(1),m()),n&2){let t=O().$implicit;v(),J(t.character)}}function Kae(n,e){if(n&1&&(p(0,"p",28),D(1),m()),n&2){let t=O().$implicit;v(),J(t.roles[0].character)}}function Yae(n,e){if(n&1&&(p(0,"div",20)(1,"div",21),q(2,Gae,1,2,"img",22)(3,Hae,1,1,"img",23),m(),p(4,"div")(5,"h4",24),D(6),m(),q(7,Wae,2,1,"p",25)(8,Kae,2,1,"p",25),m()()),n&2){let t=e.$implicit,i=O(3);k("routerLink",Kt(6,OU,t.id)),v(2),k("ngIf",t.profile_path),v(),k("ngIf",!t.profile_path),v(3),J(t.name),v(),k("ngIf",i.showType=="movie"),v(),k("ngIf",i.showType=="tv")}}function Qae(n,e){if(n&1&&(p(0,"div",15)(1,"h3",16),D(2," Cast "),p(3,"span",17),D(4),m()(),p(5,"div",18),q(6,Yae,9,8,"div",19),m()()),n&2){let t=O(2);v(4),Bu("(",t.castCredits.length>50?50:t.castCredits.length,"",t.castCredits.length>50?"+":"",")"),v(2),k("ngForOf",t.castCredits.slice(0,50))}}function Xae(n,e){if(n&1&&L(0,"img",26),n&2){let t=O().$implicit,i=O(3);k("src",i.mainImageUrl+t.profile_path,pe)("alt",t.name)}}function Jae(n,e){if(n&1&&L(0,"img",27),n&2){let t=O().$implicit;k("alt",t.name)}}function Zae(n,e){if(n&1&&(p(0,"div",20)(1,"div",21),q(2,Xae,1,2,"img",22)(3,Jae,1,1,"img",23),m(),p(4,"div")(5,"h4",24),D(6),m(),p(7,"p",28),D(8),m()()()),n&2){let t=e.$implicit;k("routerLink",Kt(5,OU,t.id)),v(2),k("ngIf",t.profile_path),v(),k("ngIf",!t.profile_path),v(3),J(t.name),v(2),J(t.job)}}function ele(n,e){if(n&1&&(p(0,"div",29)(1,"h3",16),D(2," Crew "),p(3,"span",17),D(4),m()(),p(5,"div",18),q(6,Zae,9,7,"div",30),m()()),n&2){let t=O(2);v(4),Bu("(",t.crewCredits.length>50?50:t.crewCredits.length,"",t.crewCredits.length>50?"+":"",")"),v(2),k("ngForOf",t.crewCredits.slice(0,50))}}function tle(n,e){if(n&1){let t=ze();p(0,"section",1)(1,"div",2)(2,"div",3),q(3,$ae,1,2,"img",4)(4,jae,1,1,"img",5),m(),p(5,"div",6)(6,"h1",7),D(7),p(8,"span"),D(9),me(10,"date"),m()(),p(11,"span",8),oe("click",function(){Re(t);let r=O();return Me(r.goBackToMain(r.showType,r.showID))}),L(12,"i",9),D(13,"Back to Details"),m()()(),p(14,"div",10),q(15,Qae,7,3,"div",11)(16,ele,7,3,"div",12),m()()}if(n&2){let t=O();v(3),k("ngIf",t.showDetails.poster_path),v(),k("ngIf",!t.showDetails.poster_path),v(3),ve("",t.showDetails.title||t.showDetails.name," "),v(2),ve("(",lt(10,6,t.showDetails.release_date||t.showDetails.first_air_date,"yyyy"),")"),v(6),k("ngIf",t.castCredits&&t.castCredits.length>0),v(),k("ngIf",t.crewCredits&&t.crewCredits.length>0)}}var NU=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this._ActivatedRoute=H(Lt),this._Router=H(Et),this._Title=H(jn),this.castCredits=[],this.crewCredits=[],this.mainImageUrl="https://image.tmdb.org/t/p/w500"}ngOnInit(){this.loadCredits()}loadCredits(){this._ActivatedRoute.params.subscribe({next:i=>{this.showID=i.id,this.showType=i.type,this.showType=="tv"?this._MoviesService.getShowCredits(this.showID,this.showType).subscribe({next:r=>{this.showCredits=r,this.castCredits=r.cast,this.crewCredits=r.crew}}):this.showType=="movie"&&this._MoviesService.getMovieCredits(this.showID,this.showType).subscribe({next:r=>{this.showCredits=r,this.castCredits=r.cast,this.crewCredits=r.crew}}),this._MoviesService.getShowDetails(this.showID,this.showType).subscribe({next:r=>{this.showDetails=r,this._Title.setTitle((this.showDetails.name||this.showDetails.title)+"_cast&crew_CinemaX")}})}})}goBackToMain(i,r){this._Router.navigate(["/m/show-details",i||"show",r])}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-full-show-cast"]],standalone:!0,features:[he],decls:1,vars:1,consts:[["class","my-10",4,"ngIf"],[1,"my-10"],[1,"bg-orange-400","p-5","flex","items-center","gap-4"],[1,"w-1/5"],["class","w-full h-auto",3,"src","alt",4,"ngIf"],["class","w-full h-auto","src","../../../assets/images/angry-mac-boy-cinema.jpeg",3,"alt",4,"ngIf"],[1,"text-black","w-4/5"],[1,"text-4xl","font-bold"],[1,"inline-block","mt-2","p-2","text-lg","bg-slate-200","hover:bg-slate-300","cursor-pointer","duration-200","rounded-md","shadow-md",3,"click"],[1,"fa-solid","fa-arrow-left","mx-1"],[1,"container","mx-auto","bg-white","shadow-md","mt-10","p-6"],["class","cast",4,"ngIf"],["class","crew mt-10 border-t-4 border-red-500",4,"ngIf"],[1,"w-full","h-auto",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-auto",3,"alt"],[1,"cast"],[1,"text-2xl","font-semibold","mb-4"],[1,"text-sm","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],["class","flex items-center gap-4 bg-gray-100 p-4 rounded-md crp duration-300 hover:scale-105 ",3,"routerLink",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-4","bg-gray-100","p-4","rounded-md","crp","duration-300","hover:scale-105",3,"routerLink"],[1,"w-16","h-16"],["class","w-full h-full rounded-full object-cover",3,"src","alt",4,"ngIf"],["class","w-full h-full rounded-full object-cover","src","../../../assets/images/lost_in_Giza.jpeg",3,"alt",4,"ngIf"],[1,"text-lg","font-medium"],["class","text-gray-600",4,"ngIf"],[1,"w-full","h-full","rounded-full","object-cover",3,"src","alt"],["src","../../../assets/images/lost_in_Giza.jpeg",1,"w-full","h-full","rounded-full","object-cover",3,"alt"],[1,"text-gray-600"],[1,"crew","mt-10","border-t-4","border-red-500"],["class","flex items-center gap-4 bg-gray-100 p-4 rounded-md crp duration-300 hover:scale-105",3,"routerLink",4,"ngFor","ngForOf"]],template:function(r,s){r&1&&q(0,tle,17,9,"section",0),r&2&&k("ngIf",s.showDetails&&s.showCredits)},dependencies:[Ye,De,bt,Nt]});let n=e;return n})();var nle=["imageCanvas"],ile=(n,e)=>e.id,rle=n=>({"background-image":n,"background-size":"cover","background-position":"center","background-repeat":"no-repeat"}),sle=(n,e)=>["/m/show-details",n,e];function ole(n,e){if(n&1&&L(0,"img",22),n&2){let t=O(2);ii("alt",t.collectionDetails.name),k("src",t.mainImageUrl+t.collectionDetails.poster_path,pe)}}function ale(n,e){if(n&1&&L(0,"img",23),n&2){let t=O(2);ii("alt",t.collectionDetails.name)}}function lle(n,e){if(n&1&&(p(0,"section",4)(1,"div",5)(2,"div",6),q(3,ole,1,2,"img",7)(4,ale,1,1,"img",8),m(),p(5,"div",9)(6,"div",10)(7,"h1",11),D(8),m()(),L(9,"div",12),p(10,"div",13)(11,"span",14),L(12,"i",15),m(),p(13,"span",14),L(14,"i",16),m(),p(15,"span",14),L(16,"i",17),m()(),p(17,"div",18)(18,"div",19)(19,"span",20),D(20,"Overview"),m(),p(21,"div",21),D(22),m()()()()()()),n&2){let t=O();k("ngStyle",Kt(5,rle,"linear-gradient("+t.extractedColor+", rgba(0, 0, 0, 0.5)), url("+t.imageUrl+")")),v(3),k("ngIf",t.collectionDetails.poster_path),v(),k("ngIf",!t.collectionDetails.poster_path),v(4),ve("",t.collectionDetails.name," "),v(14),J(t.collectionDetails.overview)}}function cle(n,e){if(n&1&&(p(0,"div",27)(1,"div",28),L(2,"img",29),m(),p(3,"div",30),L(4,"app-progress-circle",31),me(5,"percentage"),m(),p(6,"div",32)(7,"h3",33),D(8),me(9,"splitTitle"),m(),p(10,"p",34),D(11),me(12,"date"),m()()()),n&2){let t=e.$implicit,i=O(2);v(),k("routerLink",qe(13,sle,t.media_type||"movie",t.id)),v(),k("src",i.mainImageUrl+t.poster_path,pe)("alt",t.original_title),v(2),k("progress",ke(5,6,t.vote_average)),v(4),J(ke(9,8,t.title)),v(3),J(lt(12,10,t.release_date,"yyyy"))}}function ule(n,e){if(n&1&&(p(0,"section",24)(1,"div",25)(2,"div",26),vn(3,cle,13,16,"div",27,ile),m()()()),n&2){let t=O();v(3),_n(t.collectionDetails.parts)}}var LU=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this._ActivatedRoute=H(Lt),this._Router=H(Et),this.mainImageUrl="https://image.tmdb.org/t/p/w500",this.extractedColor="rgba(150, 90, 40, 0.4)"}ngOnInit(){this.loadShowCollection()}loadShowCollection(){this._ActivatedRoute.params.subscribe({next:i=>{this.collectionID=i.CollectionId,this._MoviesService.getCollection(this.collectionID).subscribe({next:r=>{this.collectionDetails=r,this.collectionDetails.poster_path!==null&&(this.imageUrl=`http://localhost:3000/image-proxy?url=${encodeURIComponent(this.mainImageUrl+this.collectionDetails.backdrop_path)}`),this.loadAndExtractColor()}})}})}loadAndExtractColor(){let i=new Image;i.src=this.imageUrl,i.crossOrigin="Anonymous",i.onload=()=>{let r=this.imageCanvas.nativeElement,s=r.getContext("2d",{willReadFrequently:!0});r.width=i.width,r.height=i.height,s.drawImage(i,0,0);let o=.5,a=.5,l=Math.floor(r.width*o),c=Math.floor(r.height*a),u=s.getImageData(l,c,1,1).data;this.extractedColor=`rgba(${u[0]}, ${u[1]}, ${u[2]}, ${u[3]/255})`}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-show-collection"]],viewQuery:function(r,s){if(r&1&&Af(nle,5),r&2){let o;Df(o=Pf())&&(s.imageCanvas=o.first)}},standalone:!0,features:[he],decls:5,vars:2,consts:[["imageCanvas",""],[2,"display","none"],["class","w-full text-white p-5 my-2",3,"ngStyle",4,"ngIf"],["class","my-10",4,"ngIf"],[1,"w-full","text-white","p-5","my-2",3,"ngStyle"],[1,"flex","flex-col","md:flex-row","items-center","mx-auto","gap-8","w-11/12"],[1,"lg:w-1/4","md:w-1/3","w-1/2"],["class","rounded-lg shadow-lg",3,"src","alt",4,"ngIf"],["src","../../../assets/images/canot_find_movie.jpeg","class","rounded-lg shadow-lg",3,"alt",4,"ngIf"],[1,"lg:w-3/4","md:w-2/3","w-full"],[1,"flex","justify-start","items-center"],[1,"text-6xl","font-black","m-0"],[1,"flex","items-center","justify-start","gap-3"],[1,"flex","items-center","justify-start","gap-3","mt-4"],[1,"crp","rounded-full","bg-blue-800","text-white","p-4","w-10","h-10","flex","justify-center","items-center","me-4","text-sm"],[1,"fa-solid","fa-list"],[1,"fa-solid","fa-heart"],[1,"fa-solid","fa-bookmark"],[1,"flex","items-center","justify-start","mt-4"],[1,"flex","flex-col"],[1,"text-white","text-xl","font-bold"],[1,"text-lg","mb-4"],[1,"rounded-lg","shadow-lg",3,"src","alt"],["src","../../../assets/images/canot_find_movie.jpeg",1,"rounded-lg","shadow-lg",3,"alt"],[1,"my-10"],[1,"container","mx-auto","px-4"],[1,"flex","flex-wrap","justify-center","gap-6"],[1,"flex","flex-col","bg-slate-100","rounded-lg","shadow-lg","p-2","relative","transition-transform","duration-500","hover:scale-105","w-[45%]","sm:w-[30%]","lg:w-[18%]"],[1,"h-52","lg:h-64","xl:h-72","overflow-hidden","rounded-lg","crp",3,"routerLink"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"relative","-top-5","left-2"],[3,"progress"],[1,"mt-2","text-center"],[1,"text-md","font-semibold","truncate"],[1,"text-sm"]],template:function(r,s){r&1&&(L(0,"section")(1,"canvas",1,0),q(3,lle,23,7,"section",2)(4,ule,5,0,"section",3)),r&2&&(v(3),k("ngIf",s.collectionDetails),v(),k("ngIf",s.collectionDetails&&s.collectionDetails.parts&&s.collectionDetails.parts.length>0))},dependencies:[vl,De,Nt,Ut,Ye,qt,ti]});let n=e;return n})();function dle(n,e){if(n&1&&L(0,"img",7),n&2){let t=O(2);k("src",t.mainImageUrl+t.networkDetails.logo_path,pe)("alt",t.networkDetails.name)}}function hle(n,e){if(n&1&&(p(0,"div",8)(1,"h3",9),D(2,"Headquarters:"),m(),p(3,"p",10),D(4),m()()),n&2){let t=O(2);v(4),J(t.networkDetails.headquarters)}}function fle(n,e){if(n&1&&(p(0,"div",8)(1,"h3",9),D(2,"Homepage:"),m(),p(3,"a",11),D(4),m()()),n&2){let t=O(2);v(3),k("href",t.networkDetails.homepage,pe),v(),J(t.networkDetails.homepage)}}function ple(n,e){if(n&1&&(p(0,"div",8)(1,"h3",9),D(2,"Origin Country:"),m(),p(3,"p",10),D(4),m()()),n&2){let t=O(2);v(4),J(t.networkDetails.origin_country)}}function mle(n,e){if(n&1&&(p(0,"div",2)(1,"div",3),q(2,dle,1,2,"img",4),p(3,"h2",5),D(4),m()(),q(5,hle,5,1,"div",6)(6,fle,5,2,"div",6)(7,ple,5,1,"div",6),m()),n&2){let t=O();v(2),k("ngIf",t.networkDetails.logo_path),v(2),J(t.networkDetails.name),v(),k("ngIf",t.networkDetails.headquarters),v(),k("ngIf",t.networkDetails.homepage),v(),k("ngIf",t.networkDetails.origin_country)}}var FU=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this._ActivatedRoute=H(Lt),this._Title=H(jn),this.mainImageUrl="https://image.tmdb.org/t/p/w500"}ngOnInit(){this._ActivatedRoute.params.subscribe({next:i=>{this.network_id=i.id,this._MoviesService.getNetworkDetails(this.network_id).subscribe({next:r=>{this.networkDetails=r,this._Title.setTitle(this.networkDetails.name+" - CinemaX")}})}})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-network-details"]],standalone:!0,features:[he],decls:2,vars:1,consts:[[1,"my-10"],["class","bg-white shadow-md rounded-lg p-6 max-w-md mx-auto",4,"ngIf"],[1,"bg-white","shadow-md","rounded-lg","p-6","max-w-md","mx-auto"],[1,"flex","items-center","mb-4"],["class","w-20 h-auto mr-4",3,"src","alt",4,"ngIf"],[1,"text-xl","font-semibold","text-gray-800"],["class","mb-2",4,"ngIf"],[1,"w-20","h-auto","mr-4",3,"src","alt"],[1,"mb-2"],[1,"font-medium","text-gray-600"],[1,"text-gray-700"],["target","_blank",1,"text-blue-500","hover:underline",3,"href"]],template:function(r,s){r&1&&(p(0,"section",0),q(1,mle,8,5,"div",1),m()),r&2&&(v(),k("ngIf",s.networkDetails))},dependencies:[De]});let n=e;return n})();var gle=(n,e)=>["/m/show-details",n,e];function yle(n,e){if(n&1&&L(0,"img",13),n&2){let t=O().$implicit,i=O();k("src",i.mainImageUrl+t.poster_path,pe)("alt",t.name||t.title)}}function vle(n,e){if(n&1&&L(0,"img",14),n&2){let t=O().$implicit;k("alt",t.name||t.title)}}function _le(n,e){if(n&1&&(p(0,"div",4)(1,"div",5),q(2,yle,1,2,"img",6)(3,vle,1,1,"img",7),m(),p(4,"div",8),L(5,"app-progress-circle",9),me(6,"percentage"),m(),p(7,"div",10)(8,"h3",11),D(9),me(10,"splitTitle"),m(),p(11,"p",12),D(12),m()()()),n&2){let t=e.$implicit,i=O();v(),k("routerLink",qe(10,gle,i.showType,t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(2),k("progress",ke(6,6,t.vote_average)),v(4),ve(" ",ke(10,8,t.name||t.title)," "),v(3),J(t.first_air_date||t.release_date)}}var BU=(()=>{let e=class e{constructor(){this._MoviesService=H(en),this._ActivatedRoute=H(Lt),this._Title=H(jn),this.mainImageUrl="https://image.tmdb.org/t/p/w500"}ngOnInit(){this._ActivatedRoute.params.subscribe({next:i=>{this.keyword_name=i.name,this.showType=i.show_type,this._MoviesService.getKeywordDetails(this.keyword_name,this.showType).subscribe({next:r=>{this.showList=r.results}})}})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-keyword-shows"]],standalone:!0,features:[he],decls:4,vars:1,consts:[[1,"my-10"],[1,"container","mx-auto","px-4"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-5","gap-6"],["class","bg-slate-100 rounded-lg shadow-lg p-2 relative transition-transform duration-500 hover:scale-105",4,"ngFor","ngForOf"],[1,"bg-slate-100","rounded-lg","shadow-lg","p-2","relative","transition-transform","duration-500","hover:scale-105"],[1,"h-52","overflow-hidden","rounded-lg",3,"routerLink"],["class","w-full h-full object-cover crp",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","w-full h-full object-cover crp",3,"alt",4,"ngIf"],[1,"relative","-top-5","left-2"],[3,"progress"],[1,"mt-2","text-center"],[1,"text-md","font-semibold","truncate"],[1,"text-sm"],[1,"w-full","h-full","object-cover","crp",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-full","object-cover","crp",3,"alt"]],template:function(r,s){r&1&&(p(0,"section",0)(1,"div",1)(2,"div",2),q(3,_le,13,13,"div",3),m()()()),r&2&&(v(3),k("ngForOf",s.showList))},dependencies:[De,bt,Ye,Ut,qt,ti]});let n=e;return n})();var wle=(n,e)=>["/m/show-details",n,e];function Sle(n,e){if(n&1&&L(0,"img",14),n&2){let t=O().$implicit,i=O(2);k("src",i.mainImageUrl+t.poster_path,pe)("alt",t.name||t.title)}}function ble(n,e){if(n&1&&L(0,"img",15),n&2){let t=O().$implicit;k("alt",t.name||t.title)}}function Ele(n,e){if(n&1&&(p(0,"div",5)(1,"div",6),q(2,Sle,1,2,"img",7)(3,ble,1,1,"img",8),m(),p(4,"div",9),L(5,"app-progress-circle",10),me(6,"percentage"),m(),p(7,"div",11)(8,"h3",12),D(9),me(10,"splitTitle"),m(),p(11,"p",13),D(12),me(13,"date"),m()()()),n&2){let t=e.$implicit;v(),k("routerLink",qe(13,wle,t.name?"tv":"movie",t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(2),k("progress",ke(6,6,t.vote_average)),v(4),J(ke(10,8,t.title||t.name)),v(3),J(lt(13,10,t.release_date||t.first_air_date,"yyyy"))}}function Cle(n,e){if(n&1&&(p(0,"div",3),q(1,Ele,14,16,"div",4),m()),n&2){let t=O();v(),k("ngForOf",t.watchList)}}function Tle(n,e){n&1&&(p(0,"div",16)(1,"p"),D(2,"Your watchlist is empty."),m()())}var UU=(()=>{let e=class e{constructor(){this._FireStoreService=H(Qo),this._AuthenticationService=H(si),this._Router=H(Et),this.token=localStorage.getItem("S&MToken"),this.mainImageUrl="https://image.tmdb.org/t/p/w500"}ngOnInit(){this.getUserData()}getUserData(){this.token=localStorage.getItem("S&MToken"),this.token?this._AuthenticationService.GetLoggedUserData().subscribe({next:i=>{this.userData=i.user,this._FireStoreService.getUserIDByEmail(this.userData.email).then(r=>{r?(this.userID=r,this._FireStoreService.getWatchlist(this.userID).then(s=>{this.watchList=s})):console.log("User not found")})}}):this._Router.navigate(["/login"])}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-watchlist"]],standalone:!0,features:[he],decls:3,vars:2,consts:[[1,"my-10"],["class","grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-5","gap-6"],["class","bg-slate-100 rounded-lg shadow-lg p-2 relative transition-transform duration-500 hover:scale-105 ",4,"ngFor","ngForOf"],[1,"bg-slate-100","rounded-lg","shadow-lg","p-2","relative","transition-transform","duration-500","hover:scale-105"],[1,"h-52","overflow-hidden","rounded-lg","cursor-pointer",3,"routerLink"],["class","w-full h-full object-cover",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","w-full h-full object-cover",3,"alt",4,"ngIf"],[1,"relative","-top-5","left-2"],[3,"progress"],[1,"mt-2","text-center"],[1,"text-md","font-semibold","truncate"],[1,"text-sm"],[1,"w-full","h-full","object-cover",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-full","object-cover",3,"alt"],[1,"text-center"]],template:function(r,s){r&1&&(p(0,"section",0),q(1,Cle,2,1,"div",1)(2,Tle,3,0,"div",2),m()),r&2&&(v(),k("ngIf",s.watchList&&s.watchList.length>0),v(),k("ngIf",s.watchList&&s.watchList.length===0))},dependencies:[De,bt,Ye,Ut,qt,ti,Nt]});let n=e;return n})();var xle=(n,e)=>["/m/show-details",n,e];function Ile(n,e){if(n&1&&L(0,"img",14),n&2){let t=O().$implicit,i=O(2);k("src",i.mainImageUrl+t.poster_path,pe)("alt",t.name||t.title)}}function kle(n,e){if(n&1&&L(0,"img",15),n&2){let t=O().$implicit;k("alt",t.name||t.title)}}function Ale(n,e){if(n&1&&(p(0,"div",5)(1,"div",6),q(2,Ile,1,2,"img",7)(3,kle,1,1,"img",8),m(),p(4,"div",9),L(5,"app-progress-circle",10),me(6,"percentage"),m(),p(7,"div",11)(8,"h3",12),D(9),me(10,"splitTitle"),m(),p(11,"p",13),D(12),me(13,"date"),m()()()),n&2){let t=e.$implicit;v(),k("routerLink",qe(13,xle,t.name?"tv":"movie",t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(2),k("progress",ke(6,6,t.vote_average)),v(4),J(ke(10,8,t.title||t.name)),v(3),J(lt(13,10,t.release_date||t.first_air_date,"yyyy"))}}function Dle(n,e){if(n&1&&(p(0,"div",3),q(1,Ale,14,16,"div",4),m()),n&2){let t=O();v(),k("ngForOf",t.favList)}}function Ple(n,e){n&1&&(p(0,"div",16)(1,"p"),D(2,"Your watchlist is empty."),m()())}var qU=(()=>{let e=class e{constructor(){this._FireStoreService=H(Qo),this._AuthenticationService=H(si),this._Router=H(Et),this.token=localStorage.getItem("S&MToken"),this.mainImageUrl="https://image.tmdb.org/t/p/w500"}ngOnInit(){this.getUserData()}getUserData(){this.token=localStorage.getItem("S&MToken"),this.token?this._AuthenticationService.GetLoggedUserData().subscribe({next:i=>{this.userData=i.user,this._FireStoreService.getUserIDByEmail(this.userData.email).then(r=>{r?(this.userID=r,this._FireStoreService.getFavorites(this.userID).then(s=>{this.favList=s})):console.log("User not found")})}}):this._Router.navigate(["/login"])}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-favourites-shows"]],standalone:!0,features:[he],decls:3,vars:2,consts:[[1,"my-10"],["class","grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-5","gap-6"],["class","bg-slate-100 rounded-lg shadow-lg p-2 relative transition-transform duration-500 hover:scale-105 ",4,"ngFor","ngForOf"],[1,"bg-slate-100","rounded-lg","shadow-lg","p-2","relative","transition-transform","duration-500","hover:scale-105"],[1,"h-52","overflow-hidden","rounded-lg","cursor-pointer",3,"routerLink"],["class","w-full h-full object-cover",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","w-full h-full object-cover",3,"alt",4,"ngIf"],[1,"relative","-top-5","left-2"],[3,"progress"],[1,"mt-2","text-center"],[1,"text-md","font-semibold","truncate"],[1,"text-sm"],[1,"w-full","h-full","object-cover",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-full","object-cover",3,"alt"],[1,"text-center"]],template:function(r,s){r&1&&(p(0,"section",0),q(1,Dle,2,1,"div",1)(2,Ple,3,0,"div",2),m()),r&2&&(v(),k("ngIf",s.favList&&s.favList.length>0),v(),k("ngIf",s.favList&&s.favList.length===0))},dependencies:[De,bt,Ye,Ut,qt,ti,Nt]});let n=e;return n})();var Rle=(n,e)=>({"bg-cyan-200":n,"bg-white":e}),Mle=(n,e)=>["/m/show-details",n,e];function Ole(n,e){if(n&1&&(L(0,"iframe",7),me(1,"safeUrl")),n&2){let t=O();k("src",ke(1,1,t.showUrl),xf)}}function Nle(n,e){if(n&1){let t=ze();p(0,"div",8)(1,"button",9),oe("click",function(){Re(t);let r=O();return Me(r.toPervEpisode())}),D(2," Previous Episode "),m(),p(3,"button",9),oe("click",function(){Re(t);let r=O();return Me(r.toNextEpisode())}),D(4," Next Episode "),m()()}}function Lle(n,e){if(n&1&&(p(0,"option",18),D(1),m()),n&2){let t=e.$implicit;k("value",t),v(),ve("Season ",t,"")}}function Fle(n,e){if(n&1&&L(0,"img",29),n&2){let t=O().$implicit,i=O(2);k("src",i.mainImageUrl+t.still_path,pe)}}function Ble(n,e){n&1&&L(0,"img",30)}function Ule(n,e){if(n&1){let t=ze();p(0,"div",19),oe("click",function(){let r=Re(t).$implicit,s=O(2);return Me(s.selectEpisode(r.episode_number))}),p(1,"div",20),q(2,Fle,1,1,"img",21)(3,Ble,1,0,"img",22),m(),p(4,"div",23),L(5,"app-progress-circle",24),me(6,"percentage"),m(),p(7,"div",25)(8,"h3",26),D(9),m(),p(10,"p",27),D(11),me(12,"date"),m(),p(13,"p",28),D(14),m()()()}if(n&2){let t=e.$implicit,i=O(2);k("ngClass",qe(11,Rle,i.selectedEpisode()===t.episode_number,i.selectedEpisode()!==t.episode_number)),v(2),k("ngIf",t.still_path),v(),k("ngIf",!t.still_path),v(2),k("progress",ke(6,7,t.vote_average)),v(4),ve("Ep ",t.episode_number,""),v(2),J(ke(12,9,t.air_date)),v(3),J(t.overview||"No description available")}}function qle(n,e){if(n&1){let t=ze();p(0,"section",10)(1,"div",11)(2,"div",12)(3,"label",13),D(4,"Choose Season:"),m(),p(5,"select",14),Ci("ngModelChange",function(r){Re(t);let s=O();return Ei(s.selectedSeason,r)||(s.selectedSeason=r),Me(r)}),oe("change",function(){Re(t);let r=O();return Me(r.fetchSeasonData(r.selectedSeason()))}),q(6,Lle,2,2,"option",15),m()(),p(7,"div",16),q(8,Ule,15,14,"div",17),m()()()}if(n&2){let t=O();v(5),bi("ngModel",t.selectedSeason),v(),k("ngForOf",t.seasons),v(2),k("ngForOf",t.totalEpisodesPerSeason)}}function zle(n,e){if(n&1&&L(0,"img",41),n&2){let t=O().$implicit;k("src","https://image.tmdb.org/t/p/w500"+t.poster_path,pe)("alt",t.name||t.title)}}function Vle(n,e){if(n&1&&L(0,"img",42),n&2){let t=O().$implicit;k("alt",t.name||t.title)}}function $le(n,e){if(n&1&&(p(0,"span"),D(1),me(2,"date"),m()),n&2){let t=O().$implicit;v(),ve(" (",lt(2,1,t.release_date||t.first_air_date,"yyyy"),") ")}}function jle(n,e){if(n&1&&(p(0,"div",35)(1,"a",36),q(2,zle,1,2,"img",37)(3,Vle,1,1,"img",38),m(),p(4,"h2",39),D(5),q(6,$le,3,4,"span",40),m()()),n&2){let t=e.$implicit;v(),k("routerLink",qe(5,Mle,t.media_type||"movie",t.id)),v(),k("ngIf",t.poster_path),v(),k("ngIf",!t.poster_path),v(2),ve(" ",t.name||t.title," "),v(),k("ngIf",t.release_date||t.first_air_date)}}function Gle(n,e){if(n&1&&(p(0,"section",10)(1,"div",31)(2,"h3",32),D(3,"Recommended Shows:"),m(),p(4,"div",33),q(5,jle,7,8,"div",34),m()()()),n&2){let t=O();v(5),k("ngForOf",t.showRecommendations)}}var zU=(()=>{let e=class e{constructor(){this._ActivatedRoute=H(Lt),this._Router=H(Et),this._MoviesService=H(en),this._Title=H(jn),this.showRecommendations=[],this.mainImageUrl="https://image.tmdb.org/t/p/w500",this.selectedEpisode=_i(1),this.selectedSeason=_i(1),this.seasons=[]}ngOnInit(){this.loadShowDetails()}loadShowDetails(){this._ActivatedRoute.params.subscribe({next:i=>{this.showID=i.id,this.showType=i.type,this.showType=="movie"?this.showUrl=`https://vidsrc.net/embed/${this.showType}?tmdb=${this.showID}&ds_lang=en`:this.showType=="tv"?(this.showUrl=`https://vidsrc.net/embed/${this.showType}?tmdb=${this.showID}&season=${this.selectedSeason()}&episode=${this.selectedEpisode()}&ds_lang=en`,this.fetchSeasonData(this.selectedSeason())):this._Router.navigate(["/home"]),this._MoviesService.getShowDetails(this.showID,this.showType).subscribe({next:r=>{this.showDetails=r,this.totalSeasons=this.showDetails.number_of_seasons,this.seasons=Array.from({length:this.totalSeasons},(s,o)=>o+1)}}),this._MoviesService.getShowRecommendations(this.showID,this.showType,1).subscribe({next:r=>{this.showRecommendations=r.results}})}})}toPervEpisode(){this.selectedEpisode()>1?this.selectedEpisode.update(i=>i-1):this.selectedSeason()>1&&(this.selectedSeason.update(i=>i-1),this.fetchSeasonData(this.selectedSeason()),this.selectedEpisode.set(this.totalEpisodesPerSeason.length)),this.updateEpisode()}toNextEpisode(){this.selectedEpisode()<this.totalEpisodesPerSeason.length?this.selectedEpisode.update(i=>i+1):this.selectedSeason()<this.totalSeasons&&(this.selectedSeason.update(i=>i+1),this.selectedEpisode.set(1),this.fetchSeasonData(this.selectedSeason())),this.updateEpisode()}updateEpisode(){this.showUrl=`https://vidsrc.net/embed/${this.showType}?tmdb=${this.showID}&season=${this.selectedSeason()}&episode=${this.selectedEpisode()}&ds_lang=en`}fetchSeasonData(i){this._MoviesService.getSeasonDetails(this.showID,i).subscribe({next:r=>{this.seasonDetails=r,this.totalEpisodesPerSeason=this.seasonDetails.episodes}})}selectEpisode(i){this.selectedEpisode.set(i),this.showUrl=`https://vidsrc.net/embed/${this.showType}?tmdb=${this.showID}&season=${this.selectedSeason()}&episode=${this.selectedEpisode()}&ds_lang=en`,window.scrollTo({top:0,behavior:"smooth"}),this._Title.setTitle(`${this.showDetails.name} Season ${this.selectedSeason()} Episode ${this.selectedEpisode()} - ${this.showType} - CinemaX`)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-movie-theater"]],standalone:!0,features:[he],decls:7,vars:4,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gradient-to-t","from-black","via-gray-900","to-black","py-10"],[1,"relative","w-full","max-w-4xl","p-4"],[1,"absolute","inset-0","z-0","bg-gradient-to-t","from-black","via-transparent","to-black","opacity-80","rounded-lg"],["class","relative z-10 w-full h-[500px] md:h-[700px] border-4 border-gray-800 rounded-lg shadow-lg","frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture","allowfullscreen","",3,"src",4,"ngIf"],["class","relative z-10 flex items-center justify-between mt-4",4,"ngIf"],["class","my-10",4,"ngIf"],["class","my-10 ",4,"ngIf"],["frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture","allowfullscreen","",1,"relative","z-10","w-full","h-[500px]","md:h-[700px]","border-4","border-gray-800","rounded-lg","shadow-lg",3,"src"],[1,"relative","z-10","flex","items-center","justify-between","mt-4"],[1,"bg-gray-800","text-white","font-bold","py-2","px-4","rounded-lg","shadow-md","hover:bg-gray-600","transition","duration-300",3,"click"],[1,"my-10"],[1,"mx-3","bg-gray-100","p-5","rounded-lg","shadow-lg"],[1,"mb-5"],["for","season-select",1,"block","text-lg","font-semibold","mb-2","text-gray-800"],["id","season-select",1,"w-full","p-2","bg-gray-200","border","border-gray-300","rounded-lg","text-gray-800",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"grid","grid-cols-2","sm:grid-cols-4","md:grid-cols-8","gap-2"],["class","p-2 rounded-lg shadow-md relative hover:shadow-xl transition-shadow duration-300 cursor-pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[3,"value"],[1,"p-2","rounded-lg","shadow-md","relative","hover:shadow-xl","transition-shadow","duration-300","cursor-pointer",3,"click","ngClass"],[1,"h-28","overflow-hidden","rounded-lg","mb-2"],["alt","Episode Image","class","w-full h-full object-cover",3,"src",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","alt","Episode Image","class","w-full h-full object-cover",4,"ngIf"],[1,"relative","-top-5","left-2","mb-2","text-black"],[3,"progress"],[1,"text-gray-800"],[1,"text-sm","font-semibold","mb-1"],[1,"text-xs","text-gray-600","mb-1"],[1,"text-xs","text-gray-700","line-clamp-2"],["alt","Episode Image",1,"w-full","h-full","object-cover",3,"src"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","alt","Episode Image",1,"w-full","h-full","object-cover"],[1,"w-2/3","mx-auto"],[1,"text-lg","font-medium","text-gray-700","mb-4"],[1,"flex","overflow-x-auto","gap-4"],["class","flex-none w-48 relative group bg-white rounded-lg shadow-md overflow-hidden",4,"ngFor","ngForOf"],[1,"flex-none","w-48","relative","group","bg-white","rounded-lg","shadow-md","overflow-hidden"],[1,"relative","crp",3,"routerLink"],["class","w-full h-64 object-cover transition-transform duration-300 ease-in-out group-hover:scale-105",3,"src","alt",4,"ngIf"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg","class","w-full h-64 object-cover transition-transform duration-300 ease-in-out group-hover:scale-105",3,"alt",4,"ngIf"],[1,"text-sm","font-semibold","text-center","text-gray-800","p-2"],[4,"ngIf"],[1,"w-full","h-64","object-cover","transition-transform","duration-300","ease-in-out","group-hover:scale-105",3,"src","alt"],["src","../../../assets/images/angry-mac-boy-cinema.jpeg",1,"w-full","h-64","object-cover","transition-transform","duration-300","ease-in-out","group-hover:scale-105",3,"alt"]],template:function(r,s){r&1&&(p(0,"section",0)(1,"div",1),L(2,"div",2),q(3,Ole,2,3,"iframe",3)(4,Nle,5,0,"div",4),m()(),q(5,qle,9,3,"section",5)(6,Gle,6,1,"section",6)),r&2&&(v(3),k("ngIf",s.showUrl),v(),k("ngIf",s.showType=="tv"),v(),k("ngIf",s.showType=="tv"),v(),k("ngIf",s.showRecommendations&&s.showRecommendations.length>0))},dependencies:[De,bt,Ry,Ye,Nt,Wn,Hf,Wf,Gf,En,Ii,Is,qt,Ut]});let n=e;return n})();var VU=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-tv-theater"]],standalone:!0,features:[he],decls:2,vars:0,template:function(r,s){r&1&&(p(0,"p"),D(1,"tv-theater works!"),m())}});let n=e;return n})();var $U=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=de({type:e,selectors:[["app-discover"]],standalone:!0,features:[he],decls:2,vars:0,template:function(r,s){r&1&&(p(0,"p"),D(1,"discover works!"),m())}});let n=e;return n})();var jU=[{path:"",component:oU,canActivate:[cU],children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:sU},{path:"signup",component:lU}]},{path:"",component:aU,canActivate:[uU],children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:nU,title:"home"},{path:"m",component:gU,children:[{path:"movies/:category",component:iU,title:"movies"},{path:"tvshows/:tvCate",component:rU,title:"tv-shows"},{path:"people/:pCate",component:kU,title:"people"},{path:"discover",component:$U},{path:"person/:id",component:PU},{path:"person-shows/:id",component:MU},{path:"show-details/:type/:id",component:xU},{path:"show-details/:type/:id/cast&crew",component:NU},{path:"show-details/:type/:id/collection/:CollectionId",component:LU},{path:"network/:id",component:FU},{path:"keyword/:name/:show_type",component:BU},{path:"watchlist",component:UU},{path:"favourites",component:qU},{path:"Theater/:type/:id",component:zU},{path:"showTheater/:type/:id",component:VU}]},{path:"linked",component:yU,children:[{path:"timeline",component:mU,title:"timeline"},{path:"social-club",component:wU,title:"social-club"}]},{path:"search-results",component:SU}]},{path:"**",component:IU}];var Hle="@",Wle=(()=>{let e=class e{constructor(i,r,s,o,a){this.doc=i,this.delegate=r,this.zone=s,this.animationType=o,this.moduleImpl=a,this._rendererFactoryPromise=null,this.scheduler=H(nI,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-UPK6PYOD.mjs")).catch(r=>{throw new Hx(5300,!1)}).then(({\u0275createEngine:r,\u0275AnimationRendererFactory:s})=>{this._engine=r(this.animationType,this.doc,this.scheduler);let o=new s(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(i,r){let s=this.delegate.createRenderer(i,r);if(s.\u0275type===0)return s;typeof s.throwOnSyntheticProps=="boolean"&&(s.throwOnSyntheticProps=!1);let o=new Nx(s);return r?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(a=>{let l=a.createRenderer(i,r);o.use(l)}).catch(a=>{o.use(s)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(r){tI()},e.\u0275prov=at({token:e,factory:e.\u0275fac});let n=e;return n})(),Nx=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,i,r){this.delegate.insertBefore(e,t,i,r)}removeChild(e,t,i){this.delegate.removeChild(e,t,i)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){this.shouldReplay(t)&&this.replay.push(r=>r.setProperty(e,t,i)),this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.shouldReplay(t)&&this.replay.push(r=>r.listen(e,t,i)),this.delegate.listen(e,t,i)}shouldReplay(e){return this.replay!==null&&e.startsWith(Hle)}};function GU(n="animations"){return rI("NgAsyncAnimations"),Yx([{provide:iI,useFactory:(e,t,i)=>new Wle(e,t,i,n),deps:[fI,_I,Vn]},{provide:Zx,useValue:n==="noop"?"NoopAnimations":"BrowserAnimations"}])}var HU=(n,e)=>{let t=H(bn);return n.url.includes("linked")&&_l(t)&&localStorage.getItem("S&MToken")!==null&&(n=n.clone({setHeaders:{token:localStorage.getItem("S&MToken")}})),e(n)};var WU={providers:[TI(jU,xI({scrollPositionRestoration:"top"})),bI(),EI(),Qx([HI.initializeApp(te.firebaseConfig),dR,rB]),gI(vI(),yI([HU])),{provide:eI,useValue:{disableImageSizeWarning:!0,disableImageLazyLoadWarning:!0}},GU()]};var Kle={providers:[CI()]},KU=hI(WU,Kle);var Yle=()=>wI($I,KU),aEe=Yle;export{vr as a,aEe as b};
